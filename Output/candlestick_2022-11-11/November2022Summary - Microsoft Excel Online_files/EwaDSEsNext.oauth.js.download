'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[16],{1221:function(t,C,a){t=a(0);var c=a(944),b=a(4);class d{}Object(t.a)(d,"LokiTokenResult",null,[]);class f{constructor(n){this.ETb=n}Udd(){const n=this.FQh();return n?f.eod?new Promise((w,r)=>{this.ETb.continueWith(()=>{this.ETb.Ch||this.ETb.Sf?r(Error.create("Error downloading auth library")):this.ETb.result.wO("Loki",n).then(u=>{u=b.AFrameworkApplication.fa.qa("ForceLokiFallbackToACLPTokenIsEnabled")?this.IQh():
u.IsSuccess&&u.Token?Object.assign(new d,{isSuccess:!0,token:u.Token,errorMessage:null}):Object.assign(new d,{isSuccess:!1,token:null,errorMessage:JSON.stringify(u)});w(u);return u})})}):Promise.resolve(Object.assign(new d,{isSuccess:!1,token:null,errorMessage:"Not attempting to fetch token because host is not an O365 host."})):Promise.resolve(Object.assign(new d,{isSuccess:!1,token:null,errorMessage:String.format("Could not get Loki App Id for HostAuthorityType: [{0}]",c.a.yVe())}))}IQh(){const n=
b.AFrameworkApplication.fa.Va("LokiUserDataSignature")||"";return Object.assign(new d,{isSuccess:!0,token:n,errorMessage:null})}FQh(){let n=null;const w=c.a.N9b();2===w?n=b.AFrameworkApplication.fa.Va("LokiAADAppId"):1===w&&(n=b.AFrameworkApplication.fa.Va("LokiMSAAppId"));return n}static get eod(){return b.AFrameworkApplication.fa.qa("IsO365CommercialHost")||b.AFrameworkApplication.fa.qa("IsO365ConsumerHost")}}Object(t.a)(f,"LokiTokenManager",null,[412]);var e=a(246),k=a(82),l=a(516);class m{get name(){return"Common.App.LivePersonaUtils"}init(){k.a.instance.resolve("Common.ILokiTokenManager")}dispose(){}Rh(n){n.register(f,
"Common.App.LivePersonaUtils.LokiTokenManager").as("Common.ILokiTokenManager").tc().Fc(()=>new f(l.a.Uq(n.Wb("Common.App.OAuth.IOAuthManager"))))}static main(){e.a.instance.yi(new m)}}Object(t.a)(m,"LivePersonaUtilsPackage",null,[4,5]);a.d(C,"a",function(){return v});const v=()=>{Type.registerNamespace("Common.App.LivePersonaUtils");m.main()}},1244:function(t,C,a){var c=a(10);t=a(0);var b=a(82),d=a(221),f=a(7),e=a(15),k=a(810);class l{constructor(w){this.oAuthManager=w}wO(w,r){return this.oAuthManager?
this.oAuthManager.wO(w,r).then(u=>{u.IsSuccess||e.ULS.sendTraceTag(51401292,0,15,"Error retrieving auth token. Message: "+u.ErrorMessage+" Error code: "+u.ErrorCode+" App name: "+w);return Object(f.a)(new k.a,{IsSuccess:u.IsSuccess,Token:u.Token,ErrorCode:u.ErrorCode,ErrorMessage:u.ErrorMessage})}):(e.ULS.sendTraceTag(537154971,0,10,"Oauth manager is null"),Promise.resolve(Object(f.a)(new k.a,{IsSuccess:!1,Token:null,ErrorCode:"FailedToResolve",ErrorMessage:"Failed to resolve IOAuthManager from the container."})))}t5a(){return this.oAuthManager?
this.oAuthManager.t5a():null}}Object(t.a)(l,"OAuthManagerWrapper",null,[373]);var m=a(696);class v extends d.a{constructor(w){super();this.$=w;this.Fb()}create(){this.qb(Object(m.a)(this.$.da,349,()=>new l(b.a.instance.resolve("Common.App.OAuth.IOAuthManager"))))}static ka(w){w.da.Ga(350,new v(w))}}Object(t.a)(v,"OAuthManagerFactory",d.a,[]);a.d(C,"a",function(){return n});const n=()=>{c.a.Fa(w=>{v.ka(w)})}},1269:function(t,C,a){t=a(0);var c=a(15),b=a(838),d=a(919),f=a(4),e=a(98),k=a(728),l=a(246),
m=a(41),v=a(39),n=a(27),w=a(110),r=a(82),u=a(186);class y{get name(){return"Common.App.OAuth.OAuthPackage"}Rh(B){B.register(346,"Common.App.OAuth.IOAuthManager").tc().Fc(()=>new b.OAuthManager)}init(){const B=r.a.instance.resolve("Common.App.OAuth.IOAuthManager");this.INj(B)}INj(B){const z=f.AFrameworkApplication.fa.Va("FileSource");if(f.AFrameworkApplication.fa.qa("IsO365ConsumerHost")||f.AFrameworkApplication.fa.qa("IsO365CommercialHost")||"WopiTest"===z){var A=k.a.b3g;if(A&&A.IsEnabled){var I=
A.Application,F=k.a.authority;if(void 0!==I&&null!==I&&I.length&&void 0!==F&&null!==F&&F.length){var U=d.a[B.hS],X=n.a.YFa,S=B.$u();try{var H=new Map;void 0!==H&&null!==H?(H.set("SupportStatus",U),H.set("Browser",X),H.set("AuthStrategy",S)):H=null}catch(J){H=null}e.Health.instance.recordKpiUsageForAlertableKpi("WacCorePFT","WacOAuthFC",H);var D=v.a.Sd();B.wO("Core",I).then(J=>{const M=Math.floor(v.a.Sd()-D);U=d.a[B.hS];X=n.a.YFa;S=B.$u();c.ULS.sendTraceTag(562943369,3E3,50,'OAuthManager attempted to get a Core token to the WAC FrontEnd API in {0} ms. Success={1}, SupportStatus={2}, ErrorCode="{3}", Host="{4}", Browser="{5}", AuthStrategy="{6}"',
M,J.IsSuccess,U,J.ErrorCode,z,X,S);H&&(H.set("SupportStatus",U),H.set("Browser",X),H.set("AuthStrategy",S));var G=Object.assign(new u.a,{durationMs:M,extendedProperties:H});if(J.IsSuccess){if(e.Health.instance.recordKpiSuccess("WacCorePFT",G),G=A.Endpoint){var T=v.a.Sd();f.AFrameworkApplication.vd.umb(G,1,null,{["Authorization"]:"Bearer "+J.Token},"OAuthManagerValidateAccess",void 0,void 0,void 0,2E4).continueWith(K=>{var L=Math.floor(v.a.Sd()-T),V=null;K.Ch?K="Canceled":K.Sf?K="Faulted":(V=K.result,
K=V.succeeded?"Completed":"Failed");L={["TaskResult"]:K,["BrowserTokenDurationMS"]:M,["BrowserValidationDurationMS"]:L};V&&(L.HttpStatus=V.Ig.data.httpStatus,V.succeeded&&(V=m.a(V.Ig.data.Vd),L.ServerValidationDurationMS=V.ElapsedMilliseconds,L.ServerValidationResult=V.ValidatedToken,L.KMSI=V.KMSI,L.Scopes=V.Scopes,L.TokenExpirationS=Math.floor(parseInt(V.Expiration)-(new Date).getTime()/1E3)));c.ULS.sendTraceTag(520632322,3E3,"Completed"===K?50:15,w.a.toJSON(L))})}}else e.Health.instance.recordKpiFailure("WacCorePFT",
J.ErrorCode,!1,!1,G)}).catch(J=>{var M=Math.floor(v.a.Sd()-D);M=Object.assign(new u.a,{durationMs:M,extendedProperties:H});e.Health.instance.recordKpiFailure("WacCorePFT","UNEXPECTED CATCH: "+J.toString(),!1,!1,M)})}}}}dispose(){}static main(){l.a.instance.yi(new y)}static d8i(){l.a.instance.yi(new y,0,!0)}}Object(t.a)(y,"OAuthPackage",null,[4,5]);a.d(C,"a",function(){return x});const x=B=>{Type.registerNamespace("Common.App.OAuth");B?y.d8i():y.main()}},1456:function(t,C,a){a.r(C);t=a(1269);C=a(1221);
a=a(1244);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.AppsForOfficeCommon");Object(t.a)();Object(C.a)();Object(a.a)()},838:function(t,C,a){a.r(C);t=a(0);var c=a(15);const b=(O,ea)=>{var R=O.Qjg;if(!R){R=[];for(var oa in O)"string"===typeof oa&&R.push({key:oa,value:O[oa]});R.sort((pa,Pa)=>pa.value-Pa.value);O.Qjg=R}R=[];for(oa=1;0<ea;)ea&1&&O[oa]&&R.push(O[oa]),oa<<=1,ea>>=1;if(R.length&&0===ea)return R.reverse().join(", ")};var d=a(919),f;(function(O){O[O.external=0]="external";
O[O.msa=1]="msa";O[O.aad=2]="aad"})(f||(f={}));Object(t.b)("AuthorityType",f);class e{}Object(t.a)(e,"OAuthResult",null,[]);class k{constructor(O){this.hsg=O}initialize(){return Promise.resolve(0)}Fic(){return Promise.resolve(0)}wO(){c.ULS.sendTraceTag(574239257,3E3,50,"Automation flag set.  Returning Mock Token.");return Promise.resolve(Object.assign(new e,{IsSuccess:!0,Token:this.hsg}))}Fzc(){return Promise.resolve(Object.assign(new e,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",
ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))}hyc(){return!1}Gvb(){return"MockAuthTokenStrategy"}}Object(t.a)(k,"MockAuthTokenStrategy",null,[715]);var l=a(944);class m{static get(O,ea,R){if(!R)return O;let oa=0;return Promise.race([O,new Promise(pa=>{oa=window.setTimeout(()=>{pa(ea)},R)})]).then(pa=>{window.clearTimeout(oa);return Promise.resolve(pa)}).catch(()=>{window.clearTimeout(oa);return Promise.resolve(ea)})}}Object(t.a)(m,"PromiseWithTimeout",
null,[]);var v=a(4),n=a(728);class w{constructor(O,ea,R,oa,pa){this.scope=this.resource=null;this.silentLogin=!1;this.correlationId=this.options=null;this.resource=O;this.scope=ea;this.silentLogin=R;this.options=oa;this.correlationId=pa}}Object(t.a)(w,"TokenRequestParameters",null,[779]);var r=a(27),u=a(82);class y{constructor(){this.rie=null;let O=v.AFrameworkApplication.fa.Va(v.AFrameworkApplication.j7),ea=v.AFrameworkApplication.fa.Va(v.AFrameworkApplication.Aag);this.YWa=String.format("ParentFrameTokenStrategy uiHost={0} uiHostIntegrationType={1}",
O&&""!==O?O:"Unspecified",ea&&""!==ea?ea:"Unspecified")}initialize(){return new Promise(O=>{u.a.instance.Wb("Common.App.WopiIdentity.IWopiIdentity").execute(ea=>{this.rie=ea;O(0)})})}vi(O){const ea=["HTTPS:","API:"];let R=!1;const oa=O.toLocaleUpperCase();for(const pa of ea)if(oa.startsWith(pa)){R=!0;break}return R||this.vhi(O)?O+"/.default":O}vhi(O){return RegExp("/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i").test(O)}Fic(){return Promise.resolve(0)}wO(O,ea,R,oa,pa,
Pa,Z){if(r.a.Lwa){pa=n.a.vWj;if(!pa)return ea=Object.assign(new e,{IsSuccess:!1,ErrorCode:"TeamsNoAllowListFound",ErrorMessage:"No app list was found."}),Promise.resolve(ea);if(!Array.contains(pa,O))return ea=Object.assign(new e,{IsSuccess:!1,ErrorCode:"TeamsDisallowedApp",ErrorMessage:"Disallowed appName: "+O}),Promise.resolve(ea)}O=this.vi(R);R=new w(R,O,!oa,null,v.AFrameworkApplication.userSessionId);return this.rie.getAccessToken(R,ea,Z).then(Ra=>Object.assign(new e,{IsSuccess:!0,Token:Ra.accessToken}),
Ra=>Object.assign(new e,{IsSuccess:!1,ErrorCode:Ra}))}Fzc(){return Promise.resolve(Object.assign(new e,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))}hyc(){return!1}Gvb(){return this.YWa}}Object(t.a)(y,"ParentFrameTokenStrategy",null,[715]);var x=a(83),B=a(847),z=a(185);class A{constructor(){this.reject=this.resolve=null;this.startTime=0;this.fJf=this.hse=null}}Object(t.a)(A,"PromiseWrapper",
null,[]);class I{constructor(O=0){this.QB=0;this.Tjb=!1;this.Am=new z.a;this._timeout=O}enqueue(O){return new Promise((ea,R)=>{this.Am.add(Object.assign(new A,{fJf:O,resolve:ea,reject:R}));this.process()})}process(){if(this.Tjb||this.QB===this.Am.count)return!1;const O=this.Am.na(this.QB++);try{this.Tjb=!0,O.fJf().then(ea=>{this.Tjb=!1;this.M0c(O,ea,null,!0)}).catch(ea=>{this.Tjb=!1;this.M0c(O,null,ea,!1)})}catch(ea){this.Tjb=!1,this.M0c(O,null,ea,!1)}return!0}M0c(O,ea,R,oa){if(oa){const pa=()=>{O.resolve(ea);
this.process()};0<this._timeout?window.setTimeout(()=>{pa()},this._timeout):pa()}else{const pa=()=>{O.reject(R);this.process()};0<this._timeout?window.setTimeout(()=>{pa()},this._timeout):pa()}}}Object(t.a)(I,"PromiseQueue",null,[]);class F{constructor(){this.correlationId=this.resolve=null}}Object(t.a)(F,"ResolveWithCorrelation",null,[]);var U=a(84),X=a(144),S=a(816),H=a(163);class D extends X.a{constructor(O,ea,R,oa,pa,Pa,Z){super(!1,!1,!0);this.Y3d=this.M0=null;this.tX=O;this.Ktg=R;this.Fv=oa;
this.vxg=pa;this.fDa=Pa;this.Fs=document.createElement("iframe");this.Fs.id="SharedAuthInteractiveFrame";this.Fs.setAttribute("name","SharedAuthInteractiveFrame");this.Fs.setAttribute("title","SharedAuthInteractiveFrame");this.Fs.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");this.Fs.style.border="0";this.Fs.style.height="48px";this.Fs.style.width="190px";$addHandler(this.Fs,"error",Object(x.a)(this,this.ZQi,"onSharedAuthFrameError"));O=String.format("{0}{1}{2}{3}{4}{5}{6}{7}{8}",
this.tX,ea,"?replyUrl=",window.location.protocol,"//",window.location.host,"&interactive=1","&WacUserType=",v.AFrameworkApplication.userType);Z&&(O+="&vnext=1");this.Fs.src=O;this.qng=new Promise(Ra=>{this.Y3d=Ra});this.Z3d=!1}uwc(){this.M0={["id"]:"SharedAuthConsentDialog",["bodyControls"]:{["promptMessage"]:this.Ktg,["errorText"]:CommonUIStrings.l_InternalError,["rtl"]:v.AFrameworkApplication.isRtl,["frameLoaded"]:!1,["createFrame"]:Object(x.a)(this,this.U5g,"createFrame"),["resolveDialogStyles"]:this.Y3d}};
this.Rb=5;this.initializeAndShow(CommonUIStrings.l_SignIn,Object(x.a)(this,this.Guj,"sharedAuthConsentDialogHandler"),this.M0)}VAc(O=!1,ea=!1,R=5){this.M0&&this.M0.bodyControls&&(O!==Object(U.a)(Object,this.M0.bodyControls).frameLoaded&&(Object(U.a)(Object,this.M0.bodyControls).frameLoaded=O),ea!==Object(U.a)(Object,this.M0.bodyControls).frameLoadSuccess&&(Object(U.a)(Object,this.M0.bodyControls).frameLoadSuccess=ea),R!==this.M0.dialogButtonsOption&&(this.M0.dialogButtonsOption=null,this.Rb=R),this.update(this.M0))}YAj(O,
ea){const R=new S.a(H.a.Kuj);R.Values={["signInLabel"]:CommonUIStrings.l_SignIn,["cancelLabel"]:CommonUIStrings.l_DialogCancel,["rtl"]:v.AFrameworkApplication.isRtl,["messageCorrelationId"]:O,["dialogStyles"]:ea};this.Fv.QQa(R,this.Fs.contentWindow,this.tX)}pTe(){this.VAc(!0,!1,6)}get w0f(){return this.Fs}get veh(){return this.qng.then(O=>{this.Z3d=!0;return O})}get weh(){return this.Z3d}ZQi(){this.pTe()}U5g(){return this.Fs}Guj(O){0===O&&(this.vxg.reject(Object.assign(new e,{ErrorCode:"UserCancelled",
ErrorMessage:"The interactive flow was cancelled by the user"})),this.fDa(null))}}Object(t.a)(D,"SharedAuthConsentDialog",X.a,[732]);var J=a(1232),M=a(98),G=a(134),T=a(39),K=a(172),L=a(186);class V{constructor(){this.Fs=null;this.$Rb=0;this.cjb=this.mXa=this.PDc=this.fDa=this.TL=this.qhe=null;this.Fv=new J.a(null,null);this.yWb=v.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthVNext",!1);this.YWa="SharedAuthTokenStrategy "+(this.yWb?"BrowserAuth 1.20210701.2/MSAL 2.11.0":
"BrowserAuth 1.20210426.1/MSAL 2.11.0");this.tX=n.a.Iuj;this.rfe=n.a.Huj;this.J4d=n.a.enableConsoleLogging;this.Hng=v.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthPopupFlashEnabled",!1);this.Xvg=v.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthSkipUpnCheckEnabled",this.yWb);this.vqa={};this.gqg=new I(1500)}Gvb(){return this.YWa}initialize(){var {OAuthManager:O}=a(838);if("loadFrame"in this.vqa)return this.vqa.loadFrame.hse;
if(!this.tX)return M.Health.instance.recordKpiFailure(O.kpiName,"SharedAuthFrameOriginNotSet",!1,!1,null),c.ULS.sendTraceTag(562381581,3E3,10,"SharedAuthTokenStrategy Init failed: No Shared Frame Origin Path"),Promise.reject(1);O=this.Oxc("loadFrame");this.$Rb=T.a.Sd();var ea=this.tX+this.rfe+"?replyUrl="+window.location.protocol+"//"+window.location.host+"&usid="+v.AFrameworkApplication.userSessionId+"&WacUserType="+v.AFrameworkApplication.userType;this.yWb&&(ea+="&vnext=1");this.Fs=document.createElement("iframe");
this.Q9h(this.Fs);this.Fs.style.cssText="height:0;width:0;display:none;";this.Fs.id="SharedAuthFrame";this.Fs.setAttribute("name","SharedAuthFrame");this.Fs.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");this.Fs.setAttribute("title","SharedAuthFrame");this.Fs.src=ea;document.body.appendChild(this.Fs);ea=T.a.Sd()-this.$Rb;c.ULS.sendTraceTag(573112899,3E3,50,"SharedAuthTokenStrategy Create: Frame Appended to Document. E/T:[{0}]. sharedAuthFrame.Src={1}",ea,this.Fs.src);
return O}Fic(O){this.PDc=O;const ea=new S.a(H.a.z0f);ea.Values=this.Jre(O);O=this.Oxc("initFrame");this.Fv.QQa(ea,this.Fs.contentWindow,this.tX);c.ULS.sendTraceTag(573112900,3E3,50,"SharedAuthTokenStrategy Init: Called package initialize.");return O}wO(O,ea,R,oa,pa,Pa){const Z=new S.a(H.a.Luj),Ra=this.E0e();Z.Values=this.U$f(O,ea,R,oa,pa,Pa,Ra);O=this.Oxc(Ra);oa&&v.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthInteractiveConsentUI",!1)?this.gqg.enqueue(()=>
new Promise(Ga=>{this.YMj(Pa,Z,Ga,Ra)})):(this.Fv.QQa(Z,this.Fs.contentWindow,this.tX),c.ULS.sendTraceTag(573112901,3E3,50,"SharedAuthTokenStrategy TryGetToken: Called TryGetToken for app {0}",ea));return O}YMj(O,ea,R,oa){const pa=this.vqa[oa];pa&&(this.mXa=ea,this.fDa=Object.assign(new F,{resolve:R,correlationId:oa}),this.TL=new D(this.tX,this.rfe,O,this.Fv,pa,R,this.yWb),this.TL.uwc())}E0e(){return K.a.create().toString()}U$f(O,ea,R,oa,pa,Pa,Z){const Ra={};Ra.appName=O;Ra.appId=ea;Ra.target=R;Ra.withPopup=
oa;Ra.claims=pa;Ra.promptMessage=Pa;Ra.messageCorrelationId=Z;return Ra}Q9h(O){$addHandler(O,"load",Object(x.a)(this,this.aMi,"onIFrameLoaded"));$addHandler(O,"error",Object(x.a)(this,this.kmc,"onIFrameError"));this.Fv.$Ea(this.tX);this.Fv.eo(H.a.C0f);this.Fv.Tl(H.a.C0f,Object(x.a)(this,this.qQi,"onScriptLoaded"));this.Fv.eo(H.a.B0f);this.Fv.Tl(H.a.B0f,Object(x.a)(this,this.pQi,"onScriptInitialized"));this.Fv.eo(H.a.x0f);this.Fv.Tl(H.a.x0f,Object(x.a)(this,this.BLi,"onGetTokenResponse"));this.Fv.eo(H.a.D0f);
this.Fv.Tl(H.a.D0f,Object(x.a)(this,this.tNi,"onLoginResponse"));this.Fv.eo(H.a.A0f);this.Fv.Tl(H.a.A0f,Object(x.a)(this,this.vMi,"onInteractiveFlowReady"));this.Fv.eo(H.a.y0f);this.Fv.Tl(H.a.y0f,Object(x.a)(this,this.TLi,"onHideDialog"));this.Fv.eo(H.a.v0f);this.Fv.Tl(H.a.v0f,Object(x.a)(this,this.VGi,"onCloseDialog"))}Oxc(O){const ea=new A;ea.startTime=T.a.Sd();const R=new Promise((oa,pa)=>{ea.resolve=oa;ea.reject=pa});ea.hse=R;this.vqa[O]=ea;return R}aMi(){const O=T.a.Sd()-this.$Rb;c.ULS.sendTraceTag(572346566,
3E3,50,"WACOAuth.aspx iFrame loaded successfully. E/T:[{0}]",O)}kmc(O){const {OAuthManager:ea}=a(838),R=T.a.Sd()-this.$Rb,oa=Object.assign(new L.a,{durationMs:R});M.Health.instance.recordKpiFailure(ea.kpiName,"SharedAuthWACOAuthAspxFrameError",!1,!0,oa);c.ULS.sendTraceTag(572346567,3E3,10,"WACOAuth.aspx iFrame failed to load after {0} ms: {1}",R,this.J4d?JSON.stringify(O):"")}qQi(O){const {OAuthManager:ea}=a(838),R=this.vqa.loadFrame;var oa=T.a.Sd()-R.startTime,pa=O.Values.AuthLibrary.toString();
O=O.Values.Success.toString();c.ULS.sendTraceTag(573112902,3E3,50,"SharedAuthTokenStrategy OnScriptLoaded. Success={0} AuthLibrary={1} E/T: [{2}]",O,pa,oa);pa&&(this.YWa="SharedAuthTokenStrategy "+pa);pa=Boolean.parse(O);pa||(O=G.a.Lr(),void 0!==O&&null!==O&&(O.set("AuthLibrary",this.Gvb()),oa=Object.assign(new L.a,{durationMs:oa,extendedProperties:O}),M.Health.instance.recordKpiFailure(ea.kpiName,"SharedAuthStrategyInitFailed",!1,!0,oa)));R.resolve(pa?0:1)}pQi(O){if(O.Values.interactive&&this.mXa&&
this.mXa.Values.messageCorrelationId){const R=this.mXa.Values.messageCorrelationId.toString();if(O.Values.interactive&&this.TL){this.TL.veh.then(oa=>{this.Fv.QQa(this.mXa,this.TL.w0f.contentWindow,this.tX);this.TL.YAj(R,oa);this.TL.VAc(!0,!0);this.mXa=null});return}}O=this.vqa.initFrame;const ea=T.a.Sd()-O.startTime;c.ULS.sendTraceTag(573112903,3E3,50,"SharedAuthTokenStrategy OnScriptInitialized. E/T: [{0}]",ea);O.resolve(0)}BLi(O){if(O.Values.messageCorrelationId&&O.Values.messageCorrelationId.toString()){var ea=
O.Values.messageCorrelationId.toString(),R=this.vqa[ea];if(R){var oa=T.a.Sd()-R.startTime;c.ULS.sendTraceTag(573112906,3E3,50,"SharedAuthTokenStrategy OnGetTokenResponse. E/T: [{0}]",oa);O.Values.isSuccess&&O.Values.isSuccess?R.resolve(O.Values.response):R.reject(O.Values.response);this.iag(ea)}else c.ULS.sendTraceTag(573112905,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called with an unregistered messageCorrelationId")}else c.ULS.sendTraceTag(573112904,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called without valid messageCorrelationId")}vMi(){if(this.TL.weh)this.TL.pTe();
else if(this.PDc&&this.TL){const O=new S.a(H.a.z0f);O.Values=this.Jre(this.PDc,!0);this.Fv.QQa(O,this.TL.w0f.contentWindow,this.tX)}}TLi(){this.TL&&this.TL.Qwb()}VGi(O){O.Values.cancelled&&O.Values.cancelled&&O.Values.messageCorrelationId&&this.iag(O.Values.messageCorrelationId.toString());this.TL&&this.TL.hide()}Jre(O,ea=!1){const R={};R.appIds=this.fHh();R.upn=O.loginHint;R.authority=O.authority;R.authorityType=b(f,O.authorityType);R.tenantId=O.tenantId;R.correlationId=v.AFrameworkApplication.userSessionId;
R.enableConsoleLogging=this.J4d;R.enablePopupFlash=this.Hng;R.skipUpnCheck=this.Xvg;R.interactive=ea;return R}fHh(){const O=[],ea=n.a.iVc;for(let R in ea)Array.add(O,ea[R]);return O}Fzc(O,ea,R,oa,pa,Pa){const Z=new S.a(H.a.Juj),Ra=this.E0e();Z.Values=this.U$f(O,ea,R,oa,pa,Pa,Ra);this.qhe=Z;O=this.Oxc(Ra);c.ULS.sendTraceTag(555049437,3E3,50,"SharedAuthTokenStrategy TryLogin: Called TryLogin for app {0}",ea);this.Hyj();return O}hyc(){return!0}Hyj(){this.cjb||(this.cjb=new B.a(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Title,
CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Body,null),this.cjb.id=16,this.cjb.Wnd=!1,this.cjb.addButton(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,()=>{c.ULS.sendTraceTag(527827290,3E3,50,"SharedAuthTokenStrategy TryLogin: User Clicked Login");this.Fv.QQa(this.qhe,this.Fs.contentWindow,this.tX)},CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,!0),c.ULS.sendTraceTag(555049438,3E3,10,"Failed to add entry to business bar. Login message could not be shown to user."))}tNi(O){if(O.Values.messageCorrelationId&&
O.Values.messageCorrelationId.toString()){var ea=this.vqa[O.Values.messageCorrelationId.toString()];if(ea){var R=T.a.Sd()-ea.startTime;c.ULS.sendTraceTag(555049441,3E3,50,"SharedAuthTokenStrategy OnLoginResponse. E/T: [{0}]",R);O.Values.isSuccess&&O.Values.isSuccess?ea.resolve(O.Values.response):ea.reject(O.Values.response)}else c.ULS.sendTraceTag(555049440,3E3,10,"SharedAuthTokenStrategy OnLoginResponse called with an unregistered messageCorrelationId")}else c.ULS.sendTraceTag(555049439,3E3,10,"SharedAuthTokenStrategy OnLoginResponse called without valid messageCorrelationId")}iag(O){this.fDa&&
this.fDa.correlationId===O&&(this.fDa.resolve(null),this.fDa=null)}}Object(t.a)(V,"SharedAuthTokenStrategy",null,[715]);class W{constructor(O){this.gOc=O;this.YWa="UnsupportedAuthTokenStrategy Reason="+d.a[this.gOc]}initialize(){return Promise.resolve(0)}Fic(){return Promise.resolve(0)}wO(){return Promise.resolve(Object.assign(new e,{IsSuccess:!1,ErrorCode:d.a[this.gOc],ErrorMessage:"Unable to get a token. Reason: ["+d.a[this.gOc]+"]"}))}Fzc(){return Promise.resolve(Object.assign(new e,{IsSuccess:!1,
ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))}hyc(){return!1}Gvb(){return this.YWa}}Object(t.a)(W,"UnsupportedAuthTokenStrategy",null,[715]);var da=a(717);a.d(C,"OAuthManager",function(){return qa});class qa{constructor(O=null){this.hS=0;this.JO=null;this.sug=0;const ea=T.a.Sd();this.Wpg=this.Idh(O).then(R=>R?this.h8h():(c.ULS.sendTraceTag(527827277,3E3,15,"DetermineAuthLibrary failed leaving {0} in {1} ms, all future TryGetToken requests will fail.",
this.$u(),Math.floor(T.a.Sd()-ea)),R=G.a.Lr(),void 0!==R&&null!==R&&(R.set("AuthLibrary",this.$u()),R=Object.assign(new L.a,{durationMs:Math.floor(T.a.Sd()-ea),extendedProperties:R}),M.Health.instance.recordKpiFailure(qa.kpiName,"StrategyPickFailed",!1,!0,R)),Promise.resolve(1))).then(R=>0!==R?Promise.resolve(R):this.Kri())}Jdh(){var O=n.a.cAi;O&&0<O.length?(this.hS=1,this.JO=new k(O)):v.AFrameworkApplication.fa.qa("IsO365ConsumerHost")||v.AFrameworkApplication.fa.qa("IsO365CommercialHost")?v.AFrameworkApplication.fa.qa("IsAnonymousUser")?
(this.hS=2,this.JO=new W(this.hS)):(O=l.a.getAuthContext().loginHint)&&O.length?n.a.Vwb?(this.hS=1,this.JO=new y):(this.hS=1,this.JO=new V):(this.hS=3,this.JO=new W(this.hS)):(this.hS=4,this.JO=new W(this.hS))}$u(){return this.JO?this.JO.Gvb()||"Unknown":"None"}Idh(O=null){c.ULS.sendTraceTag(562128578,3E3,50,"Creating OAuthManager.");const ea=T.a.Sd();return v.AFrameworkApplication.fa.ndd().then(R=>{R?(this.Jdh(),O&&(this.JO=O),c.ULS.sendTraceTag(42084323,3E3,50,"Creation succeeded OAuthManager successfully in {4} ms with clientVer={0}, appVer={1}, docVer={2}, strategy={3}",
n.a.clientVersion,n.a.appVersion,n.a.Ggh,this.$u(),Math.floor(T.a.Sd()-ea))):c.ULS.sendTraceTag(562128579,3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(T.a.Sd()-ea));return Promise.resolve(R)},()=>{c.ULS.sendTraceTag(562128580,3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(T.a.Sd()-ea));return Promise.resolve(!1)})}h8h(){c.ULS.sendTraceTag(573390991,
3E3,50,"Initializing {0}",this.$u());const O=T.a.Sd();return m.get(this.JO.initialize(),2,n.a.LEd).then(ea=>{if(0===ea)c.ULS.sendTraceTag(42084353,3E3,50,"Initialization succeeded for {0} in {1} ms.",this.$u(),Math.floor(T.a.Sd()-O));else if(1===ea){c.ULS.sendTraceTag(527827291,3E3,15,"Initialization failed for {0} in {1} ms, all future TryGetToken requests will fail.",this.$u(),Math.floor(T.a.Sd()-O));var R=G.a.Lr();void 0!==R&&null!==R&&(R.set("AuthLibrary",this.$u()),R=Object.assign(new L.a,{durationMs:Math.floor(T.a.Sd()-
O),extendedProperties:R}),M.Health.instance.recordKpiFailure(qa.kpiName,"StrategyInitFailed",!1,!0,R))}else 2===ea&&(c.ULS.sendTraceTag(42267908,3E3,15,"Initialization timed out for {0} after {1} ms, all future TryGetToken requests will fail.",this.$u(),Math.floor(T.a.Sd()-O)),R=G.a.Lr(),void 0!==R&&null!==R&&(R.set("AuthLibrary",this.$u()),R=Object.assign(new L.a,{durationMs:Math.floor(T.a.Sd()-O),extendedProperties:R}),M.Health.instance.recordKpiFailure(qa.kpiName,"StrategyInitTimedOut",!1,!0,R)));
return Promise.resolve(ea)},()=>{c.ULS.sendTraceTag(574239256,3E3,15,"Initialization failed for {0} after {1} ms, all future TryGetToken requests will fail.",this.$u(),Math.floor(T.a.Sd()-O));return Promise.resolve(1)})}Kri(){c.ULS.sendTraceTag(562128581,3E3,50,"Loading {0}",this.$u());const O=T.a.Sd();return m.get(this.JO.Fic(l.a.getAuthContext()),2,n.a.LEd).then(ea=>{if(0===ea)c.ULS.sendTraceTag(562128582,3E3,50,"Load succeeded for {0} in {1} ms.",this.$u(),Math.floor(T.a.Sd()-O));else if(1===ea){c.ULS.sendTraceTag(562128583,
3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",this.$u(),Math.floor(T.a.Sd()-O));var R=G.a.Lr();void 0!==R&&null!==R&&(R.set("AuthLibrary",this.$u()),R=Object.assign(new L.a,{durationMs:Math.floor(T.a.Sd()-O),extendedProperties:R}),M.Health.instance.recordKpiFailure(qa.kpiName,"StrategyLoadFailed",!1,!0,R))}else 2===ea&&(c.ULS.sendTraceTag(558469660,3E3,15,"Load timed out for {0} after {1} ms, all future TryGetToken requests will fail.",this.$u(),Math.floor(T.a.Sd()-
O)),R=G.a.Lr(),void 0!==R&&null!==R&&(R.set("AuthLibrary",this.$u()),R=Object.assign(new L.a,{durationMs:Math.floor(T.a.Sd()-O),extendedProperties:R}),M.Health.instance.recordKpiFailure(qa.kpiName,"StrategyLoadTimedOut",!1,!0,R)));return Promise.resolve(ea)},()=>{c.ULS.sendTraceTag(562128584,3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",this.$u(),Math.floor(T.a.Sd()-O));return Promise.resolve(1)})}wO(O,ea,R=null){return this.Dzc(O,ea,!1,null,"",R)}V$f(O,ea,
R,oa,pa=null){return this.Dzc(O,ea,!0,R,oa,pa)}Dzc(O,ea,R,oa,pa,Pa,Z=0){Z+=1;c.ULS.sendTraceTag(42084352,3E3,50,"OAuthManager TryGetToken(appName={0}, target={1}) called.  Using strategy {2} - attempt {3}",O,this.yQa(O,ea),this.$u(),Z);var Ra=G.a.Lr();void 0!==Ra&&null!==Ra&&(Ra.set("AuthLibrary",this.$u()),Ra.set("AppName",O),Ra.set("Target",this.yQa(O,ea)),M.Health.instance.recordKpiUsage(qa.kpiName,0,"WacOAuthFC",Ra));if(!n.a.isEnabled){var Ga;return this.Vsd((Ga=new e,Ga.IsSuccess=!1,Ga.Token=
null,Ga.ErrorCode="NotEnabled",Ga.ErrorMessage="OAuthManager is disabled.",Ga),O)}const Ba=n.a.iVc[O];if(void 0===Ba||null===Ba){c.ULS.sendTraceTag(41961345,3E3,15,"Auth context not found. Ensure that your app [{0}] is listed in the OAuthManagerApplications setting.",O);var fa;return this.Vsd((fa=new e,fa.IsSuccess=!1,fa.Token=null,fa.ErrorCode="DisallowedApp",fa.ErrorMessage="Disallowed appName: "+O,fa),O)}const Y=T.a.Sd(),ja=this;Ra=this.Wpg.then(xa=>ja.Vci(O,Ba,ea,R,oa,pa,Pa,xa));Ga=R?0:n.a.LEd;
let ca;fa=(ca=new e,ca.IsSuccess=!1,ca.Token=null,ca.ErrorCode="authTokenStrategy_timeout",ca.ErrorMessage="Auth Strategy timed out after ["+Ga+"] ms when fetching token",ca);let aa=this,ta=this;return m.get(Ra,fa,Ga).then(xa=>Z<=qa.Lyi&&(xa.ErrorCode===qa.c9f||xa.ErrorCode===qa.AFj)?(c.ULS.sendTraceTag(573175516,3E3,50,"TryGetToken attempt {0} timed out after {1} ms - retrying",Z,Math.floor(T.a.Sd()-Y)),aa.Dzc(O,ea,R,oa,pa,Pa,Z)):xa.ErrorCode===qa.Ehf&&!R&&(c.ULS.sendTraceTag(561517645,3E3,50,"TryGetToken attempt {0} failed with ITP error.  3P Cookies are [{1}]. Retry: [{2]}]",
Z,qa.LJe),qa.Njh&&aa.JO.hyc()&&aa.JO.Fzc(O,Ba,ea,R,oa,pa).then(ia=>Promise.resolve(aa.Xic(ia,O,ea,Ba,Y))).catch(()=>{let ia;const ya=(ia=new e,ia.IsSuccess=!1,ia.Token=null,ia.ErrorCode="authTokenStrategy_failure",ia.ErrorMessage="LoginPopup failed, GetToken could not be called",ia);return Promise.resolve(aa.Xic(ya,O,ea,Ba,Y))}),qa.LJe)?aa.Dzc(O,ea,!0,oa,pa,Pa,Z):Promise.resolve(aa.Xic(xa,O,ea,Ba,Y))).catch(()=>{let xa;const ia=(xa=new e,xa.IsSuccess=!1,xa.Token=null,xa.ErrorCode="authTokenStrategy_failure",
xa.ErrorMessage="Auth Strategy failed with an unknown error",xa);return Promise.resolve(ta.Xic(ia,O,ea,Ba,Y))})}Vci(O,ea,R,oa,pa,Pa,Z,Ra){return 1===Ra||2===Ra?this.Vsd(Object.assign(new e,{IsSuccess:!1,Token:null,ErrorCode:1===Ra?"InitFailed":"InitTimedOut",ErrorMessage:"Auth Strategy Failed to Init or Load"}),O):this.JO.wO(O,ea,R,oa,pa,Pa,Z).then(Ga=>Promise.resolve(this.urf(Ga,!0,O))).catch(Ga=>Promise.resolve(this.urf(Ga,!1,O)))}Xic(O,ea,R,oa,pa){const Pa={};pa=T.a.Sd()-pa;Pa.IsSuccess=O.IsSuccess;
Pa.ErrorCode=O.IsSuccess?"Success":O.ErrorCode||"";Pa.ErrorMessage=O.IsSuccess?"Success":this.yQa(ea,O.ErrorMessage||"");Pa.Target=this.yQa(ea,R||"");Pa.TimeInMS=Math.floor(pa);Pa.AuthLibrary=this.$u();Pa.AppName=ea;Pa.AuthorityType=b(f,l.a.N9b());Pa.UserType=this.sZh(l.a.getAuthContext());Pa.IsAuthSupportedInSession=d.a[this.hS];Pa.RequestCount=++this.sug;Pa.AppId=oa;c.ULS.sendTraceTag(593863640,3E3,50,JSON.stringify(Pa));O.IsSuccess||(R=G.a.Lr(),void 0!==R&&null!==R&&(R.set("AppName",ea),R.set("AuthLibrary",
this.$u()),R.set("ErrorCode",O.ErrorCode),R.set("ErrorMessage",this.yQa(ea,O.ErrorMessage)),ea=Object.assign(new L.a,{durationMs:pa,extendedProperties:R}),M.Health.instance.recordKpiFailure(qa.kpiName,"TryGetTokenFailure",!1,!0,ea)));return O}Vsd(O,ea){c.ULS.sendTraceTag(578435090,3E3,15,"OAuthManager failed without invoking GetToken. AppName: '{0}', Reason: '{1}'",ea,this.yQa(ea,O.ErrorMessage));const R=G.a.Lr();void 0!==R&&null!==R&&(R.set("AppName",ea),R.set("AuthLibrary",this.$u()),R.set("ErrorCode",
O.ErrorCode),R.set("ErrorMessage",this.yQa(ea,O.ErrorMessage)),ea=Object.assign(new L.a,{extendedProperties:R}),M.Health.instance.recordKpiFailure(qa.kpiName,"FailureBeforeGetToken",!1,!0,ea));return Promise.resolve(O)}Ecf(O){return O===da.a.Ryc}yQa(O,ea){return this.Ecf(O)&&ea?"REDACTED":ea}sZh(O){return v.AFrameworkApplication.fa.qa("IsAnonymousUser")?"anonymous":!O.loginHint||1>O.loginHint.length?"empty":-1<O.loginHint.indexOf("guest#")?"guest":-1<O.loginHint.indexOf("ext#")?"external":0>O.upn.indexOf("@")?
"no-at":"supported"}t5a(){return 1===this.hS}urf(O,ea,R){let oa=null,pa=null,Pa=null,Z=null;O?O.ErrorCode||O.ErrorMessage?(pa=O.ErrorCode?O.ErrorCode:qa.PPe,Pa=O.ErrorMessage?O.ErrorMessage:"No message"):O.Token?ea?oa=O.Token:(pa=qa.V8i,Pa="A rejected promise returned a token."):(pa=qa.PPe,Pa=JSON.stringify(O)):(pa=qa.CCi,Pa="No result came from Auth Token Strategy");O&&O.Telemetry&&!this.Ecf(R)&&(Z=O.Telemetry,c.ULS.sendTraceTag(579166408,3E3,50,JSON.stringify(Z)));if(pa===qa.nAi||pa===qa.lKj)pa=
qa.c9f,Pa="Auth Library Timed Out";pa===qa.nMg&&-1<Pa.indexOf(qa.oyg)&&(pa=qa.Ehf);if(pa||Pa)oa=null;return Object.assign(new e,{IsSuccess:!!oa,Token:oa,ErrorCode:pa,ErrorMessage:Pa,Telemetry:Z})}static get LJe(){return v.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthInteractiveFallbackEnabled",!1)}static get Njh(){return v.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthLoginFlowEnabled",!1)}}qa.lKj="token_renewal_error";qa.PPe=
"Exception";qa.CCi="NoResult";qa.V8i="RejectToken";qa.nAi="monitor_window_timeout";qa.c9f="Timeout";qa.AFj="authTokenStrategy_timeout";qa.nMg="login_required";qa.oyg="AADSTS50058";qa.Ehf="Cookies Disabled";qa.kpiName="OAuthManager";qa.Lyi=2;Object(t.a)(qa,"OAuthManager",null,[346])},919:function(t,C,a){a.d(C,"a",function(){return c});t=a(0);var c;(function(b){b[b.unknown=0]="unknown";b[b.supported=1]="supported";b[b.userUnsupportedAnonymous=2]="userUnsupportedAnonymous";b[b.userUnsupportedNoLoginHint=
3]="userUnsupportedNoLoginHint";b[b.hostUnsupported=4]="hostUnsupported"})(c||(c={}));Object(t.b)("SupportStatus",c)}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.oauth.js.map/8400c2baf9915035b12bb7b67bf44ecc/EwaDSEsNext.oauth.js.map