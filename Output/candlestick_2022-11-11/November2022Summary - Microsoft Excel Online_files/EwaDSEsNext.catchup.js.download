'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[23],{1253:function(t,C,a){t=a(0);var c=a(15),b=a(80),d=a(816),f=a(84),e=a(185),k=a(8),l=a(211),m=a(65),v=a(43),n=a(513),w=a(170),r=a(109),u=a(281),y=a(1),x=a(11),B=a(100),z=a(14),A=a(280);a(97);var I=a(21),F=a(338);class U{constructor(G,T,K){this.XEa=G;this.Ck=T;this.nBc=K}}Object(t.a)(U,"UserActivityLocation",null,[]);var X=a(981),S=a(61);const H=(G,T,K,L,V,W=null)=>{W=G.Na(1,W);return S.g(G,"GetVersionHistoryHighlightActivitiesData",
W,T,K,L,V,4)};var D=a(758),J=a(55);a.d(C,"a",function(){return M});class M{constructor(G,T,K,L){this.authorColor=this.t1=this.dea=null;this.O6a=!1;this.y0a=-1;this.M3c=0;this.IHa=100;this.tka=-1;this.ZYd=null;this.$nb=k.a.JVj;this.nFe=k.a.KVj;this.ni=V=>{(V=u.a(V)?null:V.Result)?V.OperationWaitingForFileDownload?20>this.M3c?(this.IHa*=2,J.Task.delay(this.IHa).continueWith(()=>{this.nWd()})):(this.GAc(),c.ULS.sendTraceTag(537150406,0,50,"VersionHistoryHighlightManager::OnWebMethodSuccess Next Operation enqueue failed")):
V.ActivityList?(this.initialize(V.ActivityList,V.VersionAuthors),y.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")?this.vOa():this.Iwc(!0),this.ZYd.stop(),c.ULS.sendTraceTag(41743369,0,50,`VersionHistoryHighlightManager: Time taken For showing diffs in Ms:${this.ZYd.uc.toString()}`)):(this.GAc(),c.ULS.sendTraceTag(537150407,0,50,"VersionHistoryHighlightManager::OnWebMethodSuccess no activity list found.")):(this.IHa*=2,J.Task.delay(this.IHa).continueWith(()=>
{this.nWd()}),c.ULS.sendTraceTag(537150408,0,10,"VersionHistoryHighlightManager::OnWebMethodSuccess call returned null result."))};this.pya=()=>{this.GAc();c.ULS.sendTraceTag(537150405,0,10,"VersionHistoryHighlightManager::OnWebMethodFailure service call failed.")};this.Jqd=V=>{c.ULS.sendTraceTag(537150400,0,50,`VersionHistoryHighlightManager.IterateMessageHandler called with MessageID:${V.MessageId}`);switch(V.MessageId){case X.a.iterateNext:this.iterateNext();this.tka=(this.tka+1)%this.NR.length;
this.DJb(X.a.setCurrentChangeCount,this.tka+1);break;case X.a.Qwa:this.Qwa();this.tka=0>this.tka?0:this.tka;this.tka=(this.tka+this.NR.length-1)%this.NR.length;this.DJb(X.a.setCurrentChangeCount,this.tka+1);break;case X.a.SMb:this.Iwc(V.Values.ToggleValue)}};this.I_g=(V,W)=>this.Y1b(V.Ck,W.Ck);this.H_g=(V,W)=>this.Y1b(V.Ck,W);this.Vc=()=>{this.W4b()};this.sn=()=>{this.W4b()};this.nh=()=>{this.W4b()};c.ULS.sendTraceTag(537150411,0,50,"VersionHistoryHighlightManager::Constructor.");this.$=G;this.ariaLiveNotifier=
L;this.gridView=I.g(this.$);this.gridView.ha.NG(this.Vc);this.gridView.hC(this.sn);this.gridView.Xb.Nk(this.nh);this.ERj();T&&(this.ZYd=G.Ib.Bc("UserAction","VersionHistoryDiffManagerStopWatch"),this.nWd());if(this.Wr=K)G=b.a.naa(this.$.ya.VersionHistoryActionUrl)||D.a.l9,G!==D.a.l9&&this.Wr.$Ea(G),this.Wr.eo(X.a.iterateNext),this.Wr.eo(X.a.Qwa),this.Wr.eo(X.a.SMb),this.Wr.Tl(X.a.iterateNext,this.Jqd),this.Wr.Tl(X.a.Qwa,this.Jqd),this.Wr.Tl(X.a.SMb,this.Jqd)}get mfb(){return this.t1}get xJb(){return-1===
this.y0a?null:this.NR[this.y0a]}get NR(){this.O6a||(this.dea.sort(this.I_g),this.O6a=!0);return this.dea}dispose(){this.jza();this.dea=this.t1=null;this.gridView&&(this.gridView.ha&&this.gridView.ha.RF(this.Vc),this.gridView.AD(this.sn),this.gridView.Xb&&this.gridView.Xb.tk(this.nh),this.Wr&&(this.Wr.$na(X.a.Qwa),this.Wr.$na(X.a.iterateNext),this.Wr.$na(X.a.SMb)))}initialize(G,T){G?(this.jza(),this.y0a=-1,this.dea=[],this.O6a=!1,this.t1={},this.authorColor={},this.Hxi(T),this.u3c(G)):c.ULS.shipAssertTag(537150410,
0,!1,"VersionHistoryHighlightManager.Initialize - userActivityList was Null")}nWd(){c.ULS.sendTraceTag(537150409,0,50,`VersionHistoryHighlightManager: TryFetchUserActivityandTriggerDiff triggered: ${this.M3c.toString()} --${this.IHa.toString()}`);this.M3c++;const G=(T,K,L)=>H(this.$.oa.va,A.b(T,this.ni),A.a(K,this.pya),L,null);y.EwaSettings.dc()?this.$.userOperationManager.Ub(new w.a(537,0,G,80),null):this.$.userOperationManager.Ub(new n.a(537,0,G,16),null)}Iwc(G){const T=this.t1;for(let L in T){var K=
L;const V=T[L];V?V.pLb(G):c.ULS.shipAssertTag(537150404,0,!1,"VersionHistoryHighlightManager.ShowOrHideAllHighlights -"+K+"view was Null")}}jza(){const G=this.t1;for(let K in G){var T=K;const L=G[K];L?L.FHd():c.ULS.shipAssertTag(537150403,0,!1,"VersionHistoryHighlightManager.RemoveAllHighlights -"+T+"view was Null")}this.dea=this.t1=null}rWf(G){let T;if(({Z8e:T,meg:G}=this.QRh(G,this.y0a)).returnValue)if(c.ULS.shipAssertTag(537150402,0,!!G,"VersionHistoryHighlightManager.SelectNextOrPreviousChange - userActivityLocation is null"),
this.W4b(),G.XEa.toString()in this.t1){this.t1[G.XEa.toString()].plj(G.Ck);var K=v.D(G.Ck);this.ariaLiveNotifier.setEnabled(!1);this.ariaLiveNotifier.setEnabled(!0);this.ariaLiveNotifier.readText(String.format(z.a.instance.ob(158),T+1,this.NR.length,K.hz(!1),G.nBc.DisplayName));this.y0a=T}else c.ULS.shipAssertTag(537150401,0,!1,`VersionHistoryHighlightManager.SelectNextOrPreviousChange - ${G.XEa.toString()} view not present in views dictionary`)}DJb(G,T){if(y.EwaSettings.ma(319))if(this.Wr){var K=
{};K.count=T;G=new d.a(G);G.Values=K;this.Wr.send(G)}else c.ULS.sendTraceTag(537150370,0,10,"VersionHistoryHighlightManager.SendIteratorTextUpdateMessage hostPostmessenger is null");else c.ULS.sendTraceTag(537150371,0,50,"VersionHistoryHighlightManager.SendIteratorTextUpdateMessage VersionHistoryIterator BRS is turned off")}QRh(G,T){let K,L=!1;K=null;let V=0;for(;!L&&V<this.NR.length;){T=G?this.HRh(T):this.zTh(T);K=this.NR[T];const W=Object(f.a)(B.a,this.$.xa.getItemByName(K.Ck.SheetName));if(!W)return c.ULS.shipAssertTag(537150369,
0,!1,"VersionHistoryHighlightManager.GetNextorPreviousUserActivityLocationFromIndex - useractivitylocation contains sheetrange with null sheet"),{returnValue:!1,Z8e:T,meg:K};W.visible&&(L=!0);V++}return{returnValue:L,Z8e:T,meg:K}}HRh(G){return-1===G?this.XZe():(G+1)%this.NR.length}zTh(G){-1===G&&(G=this.XZe());return G=(G+this.NR.length-1)%this.NR.length}u3c(G){this.q$g(G);this.a3c()}gZh(G,T){const K=[];if(!G.RangeList)return c.ULS.shipAssertTag(537150368,0,!1,"VersionHistoryHighlightManager.GetUserActivityLocationFromRangeActivityLocation - ActivityLocationType.Range RangeList Null "),
K;for(const L of G.RangeList)L&&this.$.xa.Ek(L.SheetName)?(G=new U(0,L,T),K.push(G)):c.ULS.shipAssertTag(537150367,0,!1," Inavlid sheet name"+L.SheetName);return K}q$g(G){for(const T of G)if(!T||r.e(T.LocationList))c.ULS.sendTraceTag(537150366,0,50,"Empty Location list");else for(const K of T.LocationList)if(K)switch(K.Type){case 0:this.dea.push(...this.gZh(K,T.Person));break;default:c.ULS.sendTraceTag(537150364,0,50,"VersionHistoryHighlightManager.CreateViews Failed. Invalid ActivityLocationType")}else c.ULS.shipAssertTag(537150365,
0,!1,"VersionHistoryHighlightManager.CreateUserActivityLocationList - LocationList contains Null")}a3c(){var G={};const T=new e.a,K=[];for(const L of this.dea){T.contains(L.nBc)||T.add(L.nBc);if(0!==L.XEa)continue;const V=new F.a(v.D(L.Ck),m.d(this.$.xa.getItemByName(L.Ck.SheetName))),W=M.Jvc(V);W in G||K.push(V);G[W]=this.MJh(L.nBc)}c.ULS.sendTraceTag(42541534,0,15,`VersionHistoryHighlightManager.CreateRangeHighlightView. Total activities : ${this.dea.length}, Highlightable activities: ${K.length},Total userlist in activities : ${this.dea.length}, Total userlist from pane: ${K.length} `);
this.GAc();0<K.length&&(G=new (a(1356).RangeVersionHistoryHighlightView)(this.$,K,G,this.$nb),this.t1["0"]=G)}GAc(){const G=this.dea?this.NR.length:0;this.DJb(X.a.setCurrentChangeCount,0);this.DJb(X.a.setTotalChangesCount,G)}vOa(){this.DJb(X.a.vOa,0)}Hxi(G){if(G)for(let V=0;V<G.length;++V)if(y.EwaSettings.isChangeGateEnabled("OfficeVSO:5140301_HandleEmptyInitialsColor")&&!G[V].InitialsColor)c.ULS.sendTraceTag(537150362,0,15,"VersionHistoryHighlightManager.MapAuthorColorInfo: InitialsColor is null or empty for a version author");
else{var T=G[V].EmailAddress;var K=G[V].UserName;var L=null;if(G[V].LoginName){const W=G[V].LoginName.split("|");3===W.length&&(L=W[2])}L?this.authorColor[L]=G[V].InitialsColor:T?(c.ULS.sendTraceTag(537150361,0,15,"VersionHistoryHighlightManager Map Author Color: LoginName is null"),this.authorColor[T]=G[V].InitialsColor):K?(c.ULS.sendTraceTag(537150360,0,15,"VersionHistoryHighlightManager Map Author Color: Email Address is null"),this.authorColor[K]=G[V].InitialsColor):c.ULS.sendTraceTag(537150359,
0,10,"VersionHistoryHighlightManager Map Author Color: User name is null")}else c.ULS.sendTraceTag(537150363,0,15,"VersionHistoryHighlightManager.MapAuthorColorInfo: versionAuthors is null")}ERj(){if(this.$.ya.VersionHistoryHighlightsSettings){var G=Array.isArray(Sys.Serialization.JavaScriptSerializer.deserialize(this.$.ya.VersionHistoryHighlightsSettings))?Sys.Serialization.JavaScriptSerializer.deserialize(this.$.ya.VersionHistoryHighlightsSettings):null;for(let K=0;K<G.length;K++){var T=G[K];const L=
T.key?T.key:T.Key?T.Key:"";T=T.value?T.value:T.Value?T.Value:"";"DefaultColor"===L?this.nFe=T:"InitialTint"===L?this.$nb=T:c.ULS.sendTraceTag(537150357,0,15,"VersionHistoryHighlightManager.UpdateHighlightSettings Highlight Settings are incorrect")}}else c.ULS.sendTraceTag(537150358,0,15,"VersionHistoryHighlightManager.UpdateHighlightSettings Highlight Settings are null")}MJh(G){if(G.Email in this.authorColor)return this.authorColor[G.Email];if(G.DisplayName in this.authorColor)return this.authorColor[G.DisplayName];
c.ULS.sendTraceTag(537150356,0,15,"VersionHistoryHighlightManager GetColorFromPerson - unable to associate corresponding author in dictionary");return this.nFe}Y1b(G,T){var K=Object(f.a)(B.a,this.$.xa.getItemByName(G.SheetName));const L=Object(f.a)(B.a,this.$.xa.getItemByName(T.SheetName));return K&&L?(K=(K=x.HelperMethods.iD(K.index,L.index))||x.HelperMethods.iD(G.FirstRow,T.FirstRow))||x.HelperMethods.iD(G.FirstColumn,T.FirstColumn):(c.ULS.sendTraceTag(537150355,0,10,"VersionHistoryHighlightManager.CompareSharedSheetRange - null sheet"),
0)}XZe(){var G=v.m(this.gridView.ha.sa.activeRange,this.$.xa.pa);if(!G)return c.ULS.sendTraceTag(537150354,0,10,"VersionHistoryHighlightManager.GetNearestLocationIndexFromCurrentSelection - SelectedSharedSheetRange is null "),0;G=x.HelperMethods.mx(new l.a(this.NR),0,this.NR.length,G,this.H_g);0>G&&(G=~G);return G%this.NR.length}W4b(){if(this.xJb){if(!(this.xJb.XEa.toString()in this.t1)){c.ULS.shipAssertTag(537150353,0,!1,`VersionHistoryHighlightManager.DeselectCurrentlySelectedView - ${this.xJb.XEa.toString()} view not present in views dictionary`);
return}this.t1[this.xJb.XEa.toString()].edh(this.xJb.Ck)}this.y0a=-1}iterateNext(){this.rWf(!0)}Qwa(){this.rWf(!1)}static Jvc(G){return`${G.range}${G.sheetId}`}}Object(t.a)(M,"VersionHistoryHighlightManager",null,[419,2])},1356:function(t,C,a){a.r(C);t=a(0);var c=a(15),b=a(8);class d{}d.Drh="ewa-vhr-rectinnerborder";Object(t.a)(d,"CssClassNames",null,[]);var f=a(65),e=a(43),k=a(197),l=a(97),m=a(21),v=a(338),n=a(1253);a.d(C,"RangeVersionHistoryHighlightView",function(){return w});class w{constructor(r,
u,y,x){this.Yhb=null;this.$=r;this.nvg=u;this.xRa=y;this.yRa={};this.$nb=x;this.gai()}get iF(){return[w.S3]}get lb(){return this.Yhb||(this.Yhb=m.g(this.$).lb)}pLb(r){r?this.lb.zn(this.iF):this.lb.Mg(this.iF)}FHd(){this.pLb(!1);this.lb.fRa(new v.a(null,f.d(this.$.pa)),this.iF)}plj(r){if(this.xRa){var u=new v.a(e.D(r),f.d(this.$.xa.getItemByName(r.SheetName))),y=n.a.Jvc(u);if(y in this.xRa)if(y in this.yRa){u=k.a.cp(this.xRa[y]);y=this.yRa[y];for(let x in y)y[x].style.backgroundColor=`rgba(${u.r},${u.g},${u.b},${b.a.LVj})`;
m.g(this.$).ha.Pa.dH(null);m.g(this.$).B3e(r,60,!0,l.a.S3i)}else c.ULS.sendTraceTag(537150426,0,10,"RangeVersionHistoryHighlightView.SelectView sheetRangeToDivMap doesn't contain entry for "+y);else c.ULS.sendTraceTag(537150427,0,10,"RangeVersionHistoryHighlightView.SelectView sheetRangeToColorMap doesn't contain entry for "+y)}else c.ULS.sendTraceTag(537150428,0,10,"RangeVersionHistoryHighlightView.SelectView sheetRangeToColorMap is null")}edh(r){r=new v.a(e.D(r),f.d(this.$.xa.getItemByName(r.SheetName)));
var u=n.a.Jvc(r);if(u in this.yRa)if(u in this.xRa){r=k.a.cp(this.xRa[u]);u=this.yRa[u];for(let y in u)u[y].style.backgroundColor=`rgba(${r.r},${r.g},${r.b},${this.$nb})`}else c.ULS.sendTraceTag(537150424,0,10,"RangeVersionHistoryHighlightView.DeselectView sheetRangeToColorMap doesn't contain entry for "+u);else c.ULS.sendTraceTag(537150425,0,10,"RangeVersionHistoryHighlightView.DeSelectView sheetRangeToDivMap doesn't contain entry for "+u)}gai(){this.lb.vv(this.nvg,[w.S3],!1,(r,u)=>{if(r&&r.range&&
r.sheetId&&u){var y=new v.a(r.range,r.sheetId);y=n.a.Jvc(y);y in this.yRa||(this.yRa[y]={});this.yRa[y][r.paneType.toString()]=u;y in this.xRa?(r=this.xRa[y],y=k.a.cp(r),u.style.borderColor=r,u.style.backgroundColor=`rgba(${y.r},${y.g},${y.b},${this.$nb})`,r=document.createElement("div"),r.className=d.Drh,u.appendChild(r)):c.ULS.sendTraceTag(537150419,0,10,"RangeVersionHistoryHighlightView.InitializeSheetRangeList sheetRangeToColorMap doesn't contain entry for "+y)}else c.ULS.shipAssertTag(537150423,
0,!!r,"RangeVersionHistoryHighlightView.AddSheetRangeList: state is null"),c.ULS.shipAssertTag(537150422,0,!r||!!r.range,"RangeVersionHistoryHighlightView.AddSheetRangeList: state.Range is null"),c.ULS.shipAssertTag(537150421,0,!r||!!r.sheetId,"RangeVersionHistoryHighlightView.AddSheetRangeList: state.SheetId is null"),c.ULS.shipAssertTag(537150420,0,!!u,"RangeVersionHistoryHighlightView.AddSheetRangeList: div is null")})}}w.S3=23;Object(t.a)(w,"RangeVersionHistoryHighlightView",null,[447])},1420:function(t,
C,a){a.r(C);var c=a(10),b=a(0),d=a(4),f=a(221),e=a(15),k=a(114),l=a(171),m=a(41);class v extends k.a{constructor(la,jb,ra,hb,Eb){super(la,jb);this.executionContext=null;this.retryCount=0;this.MPi=fc=>{({GKd:fc}=this.SMj(fc)).returnValue?fc.Success?(l.c(2138207060,!0),e.ULS.sendTraceTag(42287318,0,15,"RestoreVersionActivity:onRestoreSuccessCallback Restore version is successful")):(l.c(2138207060,!1),e.ULS.sendTraceTag(42287317,0,10,`RestoreVersionActivity:onRestoreSuccessCallback Restore version failed with message ${fc.Output}`),
this.fh(this.RJ)):(l.c(2138207060,!1),this.fh(this.RJ));(fc=this.executionContext.activityState[v.ytd])&&fc();this.vp();this.executionContext.mM()};this.LPi=()=>{if(0<this.retryCount)e.ULS.sendTraceTag(537150418,0,15,`RestoreVersionActivity:onRestoreFailureCallback Retrying version restore, retry count : ${this.retryCount}`),this.retryCount--,this.iTf();else{e.ULS.sendTraceTag(42287320,0,10,"RestoreVersionActivity:onRestoreFailureCallback Restore version failed");l.c(2138207060,!1);this.fh(this.RJ);
var fc=this.executionContext.activityState[v.ytd];fc&&fc();this.vp();this.executionContext.mM()}};this.RJ=ra;this.n2=hb;this.baseUrl=Eb}execute(la){this.executionContext=la;this.retryCount=3;this.iTf();return 1}iTf(){var la=this.executionContext.activityState[v.Mpc];const jb=`${this.baseUrl}${"restoreversion.ashx"}`,ra={};ra.VersionId=this.executionContext.activityState[v.mfg];ra.QuerySignature=la;la=m.c(ra);this.n2.Bm(jb,2,la,{"Content-Type":"application/json; charset=utf-8"},!1,2,this.MPi,this.LPi,
null)}SMj(la){let jb;jb=null;la=la?la.data?la.data.Vd:null:null;return la&&la.length?({Ut:jb}=m.d(la)).returnValue?{returnValue:!0,GKd:jb}:(e.ULS.sendTraceTag(537150416,0,10,"RestoreVersionActivity:TryGetRestoreResult Failed in deserialization of returned data from restore version"),{returnValue:!1,GKd:jb}):(e.ULS.sendTraceTag(537150417,0,10,"RestoreVersionActivity:TryGetRestoreResult data returned from restoreversion call is null or empty"),{returnValue:!1,GKd:jb})}}v.mfg="RVAvi";v.Mpc="RVAqs";v.ytd=
"RVlvrt";Object(b.a)(v,"RestoreVersionActivity",k.a,[]);var n=a(6);class w extends f.a{constructor(la,jb,ra){super();this.activityName=la;this.JJ=jb;this.RJ=ra;this.Fb()}create(){this.qb(new v(this.activityName,this.JJ,this.RJ,d.AFrameworkApplication.vd,d.AFrameworkApplication.ta.Oa.iV))}static ka(la){la.da.Ga(320,new w(n.a.JKd,n.a.Zi,n.a.KKd))}}Object(b.a)(w,"RestoreVersionActivityFactory",f.a,[]);class r extends k.a{constructor(la,jb){super(la,jb)}execute(la){(0,la.activityState[r.z3f])(()=>{this.vp();
la.mM()});return 1}}r.z3f="RVEAssea";Object(b.a)(r,"RestoreVersionErrorActivity",k.a,[]);class u extends f.a{constructor(la,jb){super();this.activityName=la;this.JJ=jb;this.Fb()}create(){this.qb(new r(this.activityName,this.JJ))}static ka(la){la.da.Ga(321,new u(n.a.KKd,n.a.Zi))}}Object(b.a)(u,"RestoreVersionErrorActivityFactory",f.a,[]);var y=a(80),x=a(691),B=a(50),z=a(37),A=a(182),I=a(369),F=a(55);class U{constructor(la,jb){this.$=la;this.OVj=jb}Nc(){return d.AFrameworkApplication.fa.qa("IsAnonymousUser")?
(e.ULS.sendTraceTag(537150415,0,15,"Verison History Command Handler: Anonymous user."),!0):!1}executeCommand(la,jb){e.ULS.sendTraceTag(537150414,0,50,"VersionHistoryCommandHandler:ExecuteCommand called.");la=!1;switch(jb.command){case -1112508866:I.a(this.$)&&this.$.da.za(423).Jwc(!1),la=this.OVj.pBj()}e.ULS.sendTraceTag(537150413,0,50,`VersionHistoryCommandHandler:ExecuteCommand response${la}.`);return la?F.Task.Ta(la):A.a(jb.command)}Cc(la,jb){return-1112508866===jb.command&&this.$.isVersionHistoryEnabled()}Rc(){return!1}}
Object(b.a)(U,"VersionHistoryCommandHandler",null,[195]);var X=a(7),S=a(251),H=a(163),D=a(380);class J{static addAppPLTEventToLog(la){try{Microsoft.VersionHistory.VersionHistoryLogHelper.addAppPLTEventToLog(la)}catch(jb){}}static setIsPageLoadForFirstTime(la){try{Microsoft.VersionHistory.VersionHistoryLogHelper.setIsPageLoadForFirstTime(la)}catch(jb){}}}Object(b.a)(J,"VersionHistoryLogConnector",null,[]);var M=a(27),G=a(816),T=a(1232),K=a(153),L=a(90),V=a(29),W=a(1),da=a(42),qa=a(249),O=a(981),ea=
a(258),R=a(245),oa=a(12);class pa{constructor(la){this.zw=la}Xh(){ea.a(this.zw.$).dB(this.$d)||ea.a(this.zw.$).Xh(this)}m7(){ea.a(this.zw.$).dB(this.$d)&&ea.a(this.zw.$).Nz(this)}get $d(){return R.a.jfg}get mc(){return document.querySelector('[id="vhHeader"]')}get kf(){return!0}kh(la){return oa.DOMElementExtensions.vf(this.mc,la)}lj(){this.zw.$.frame.Ee.Sj(this.zw.$.frame.Ee.RE)}Nj(){}hg(la,jb){jb||this.zw.nNb.then(ra=>{ra.enterHeaderFocusTrapZone();return null});return!jb}}Object(b.a)(pa,"VersionHistoryHeader",
null,[102]);class Pa{constructor(la){this.zw=la}Xh(){ea.a(this.zw.$).dB(this.$d)||ea.a(this.zw.$).Xh(this)}m7(){ea.a(this.zw.$).dB(this.$d)&&ea.a(this.zw.$).Nz(this)}get $d(){return R.a.kfg}get mc(){return document.querySelector('[aria-describedby="versionHistoryPane"]')}get kf(){return!0}kh(la){return oa.DOMElementExtensions.vf(this.mc,la)}lj(){this.zw.$.frame.Ee.Sj(this.zw.$.frame.Ee.RE)}Nj(){}hg(la,jb){jb||this.zw.nNb.then(ra=>{ra.enterFocusTrapZone();return null});return!jb}}Object(b.a)(Pa,"VersionHistoryPane",
null,[102]);class Z{constructor(la){this.zw=la}Xh(){ea.a(this.zw.$).dB(this.$d)||ea.a(this.zw.$).Xh(this)}m7(){ea.a(this.zw.$).dB(this.$d)&&ea.a(this.zw.$).Nz(this)}get $d(){return R.a.lfg}get mc(){return document.querySelector('[id="vhViewer"]')}get kf(){return!0}kh(la){return oa.DOMElementExtensions.vf(this.mc,la)}lj(){this.zw.$.frame.Ee.Sj(this.zw.$.frame.Ee.RE)}Nj(){}hg(la,jb){jb||this.zw.nNb.then(ra=>{ra.enterViewerFocusTrapZone();return null});return!jb}}Object(b.a)(Z,"VersionHistoryViewer",
null,[102]);var Ra=a(140),Ga=a(252),Ba=a(68),fa=a(418),Y=a(758);class ja{constructor(){this.actionUrl=this.ulsLogger=null;this.useFetch=this.hideEmbedFooter=!1}}Object(b.a)(ja,"AppBootSettings",null,[]);class ca{constructor(){this.rootDiv=this.appBootSettings=null}}Object(b.a)(ca,"AppVersionControllerFactoryParameters",null,[]);class aa{constructor(){this.telemetryCollector=this.baseVersionInfo=this.selectedVersionInfo=null}}Object(b.a)(aa,"OnVersionSelectedParams",null,[]);class ta{constructor(){this.appName=
0;this.wdEnableDownloadTokens=!1;this.retryCount=0;this.wdEnableIterator=this.wdEnableRestore=this.wdEnableSaveACopy=!1;this.uiLocale=this.wacCluster=this.userSessionId=null;this.disableSaveACopy=this.wdEnableShowVersionChanges=this.wdEnableHiddenButtonsUntilVersionLoadComplete=this.viewerRootPositionRelative=this.useXhr=this.isRtl=!1;this.disabledChangeGates=null;this.wdEnableDeleteVersions=this.wdEnableSaveACopyOverFlowMenu=!1;this.wdExperimentWithIteratorLocation=this.wdEnableAppColorUpdate=null}}
Object(b.a)(ta,"AppSettings",null,[]);class xa{constructor(){this.perfTelemetryInfos=this.appSettings=this.docId=this.latestStreamServiceBase=this.serviceBase=this.ulsLogger=null}}Object(b.a)(xa,"ControllerFactoryParameters",null,[]);var ia=a(298);class ya{constructor(la){this.baseVersionInfo=this.I2=this.noa=this.sm=this.ewaAccessibilityManager=this.nNb=null;this.mHd=this.prf=!1;this.FEe=!0;this.dialog=this.LB=this.ASe=this.ED=this.bZd=this.$Yd=this.aZd=null;this.RAf=jb=>{e.ULS.sendTraceTag(42553885,
0,50,"VersionHistoryPaneActor:OnRestoreVersionSelected - Restore is triggered");if(this.ayj()){var ra=Eb=>{l.c(2138207060,!1);this.sm.setRestoreFailedAtServer(Eb)};this.ED&&this.ED.startTimer(ya.V8f);var hb=()=>{this.ED.endTimer(ya.V8f);this.Tve(this.ED)};this.sm.setRestoreInProgress();da.a(this.$).ls(new qa.a(n.a.Mx,5,()=>{const Eb=Ba.a(this.$).jd.activityState;Eb[Ga.a.oq]=n.a.Gye;Eb[Ra.a.CX]=!0;Eb[Ra.a.WS]=0;Eb[v.mfg]=jb;Eb[v.Mpc]=d.AFrameworkApplication.ij;Eb[v.ytd]=hb;Eb[r.z3f]=ra;W.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.RestoreVersionForConvergenceExcelOnline",
!1)&&(Eb[ia.a.kBd]=!0)}))}else l.c(2138207060,!1)};this.ADf=jb=>{this.nNb.then(ra=>{ra.enterFocusTrapZone();return null});e.ULS.sendTraceTag(537150349,0,50,"VersionHistoryPaneActor: OnVersionsReady called");this.ED.endTimer(ya.HUd);this.ED.incrementCounter(ya.m3g);e.ULS.sendTraceTag(537150348,0,50,`VersionHistoryPaneActor: OnVersionsReady TimeTakenGetVersionsToOnVersionsReady Ms:${this.ED.getTimerDuration(ya.HUd)}`);this.$ej(jb.containerDiv);jb.versions&&0<jb.versions.length&&(this.ASe=ya.fF(jb.versions[jb.versions.length-
1]));this.I2&&this.noa&&this.oMd(this.I2);e.ULS.sendTraceTag(537150346,0,50,"VersionHistoryPaneActor:OnVersionsReady Exit")};this.onVersionSelected=jb=>{e.ULS.sendTraceTag(537150345,0,50,`VersionHistoryPaneActor:OnVersionSelected called. for Version:${ya.fF(jb.currentVersion)}, LastSelected:${ya.fF(this.I2)}`);this.ED.incrementCounter(ya.l3g);this.I2=jb.currentVersion;this.baseVersionInfo=jb.baseVersion;this.prf=jb.noBaseToCompareTo;this.noa&&this.gVj()&&(this.oMd(jb.currentVersion),e.ULS.sendTraceTag(537150344,
0,50,"VersionHistoryPaneActor:OnVersionSelected Exit"))};this.Dvf=jb=>{e.ULS.sendTraceTag(537150337,0,50,`VersionHistoryPaneActor:OnDownloadTokenReady called. for Version:${(null===jb||void 0===jb?0:jb.versionSelected)?ya.fF(jb.versionSelected.currentVersion):null} UpdatedVersionsCount${(null===jb||void 0===jb?0:jb.updatedVersions)?jb.updatedVersions.length:0}, LastSelected:${ya.fF(this.I2)}`);this.ED.incrementCounter(ya.k3g);if(this.baseVersionInfo){if((null===jb||void 0===jb?0:jb.updatedVersions)&&
2<=jb.updatedVersions.length){let ra=null,hb=null;const Eb=ya.fF(this.I2),fc=ya.fF(this.baseVersionInfo);for(const Mc of jb.updatedVersions)if(jb=ya.fF(Mc),Eb===jb?ra=Mc:fc===jb&&(hb=Mc),ra&&hb)break;ra&&hb?(this.I2=ra,this.baseVersionInfo=hb,e.ULS.sendTraceTag(537150307,0,50,`VersionHistoryPaneActor:OnDownloadTokenReady -Calling versionsViewController:OnVersionSelected RevisionID[N]: ${ya.fF(this.I2)}, RevisionID[N-1]: ${ya.fF(this.baseVersionInfo)}.`),this.oMd(this.I2)):e.ULS.sendTraceTag(537150306,
0,50,`VersionHistoryPaneActor:OnDownloadTokenReady - does not find currentVersion or baseVersion from UpdatedVersions. RevisionID[N]: ${Eb}, RevisionID[N-1]: ${fc}.`)}else e.ULS.sendTraceTag(537150305,0,50,"VersionHistoryPaneActor:OnDownloadTokenReady - no diff call due to downloadTokenReadyObject or downloadTokenReadyObject.UpdatedVersions objects are null or not enough.");e.ULS.sendTraceTag(537150304,0,50,"VersionHistoryPaneActor:OnDownloadTokenReady")}else e.ULS.sendTraceTag(537150336,0,50,"VersionHistoryPaneActor:OnDownloadTokenReady baseVersionInfo is null in OnDownloadTokenReady callback.")};
this.Euf=()=>{e.ULS.sendTraceTag(537150303,0,50,"VersionHistoryPaneActor:OnCloseVersionHistoryDialog Called");this.QYg();const jb=new L.a(1470556788,0,this.$.Mc,0,null);this.$.Ka.Mb(jb)};this.iBf=jb=>{e.ULS.sendTraceTag(41739662,0,50,"VersionHistoryPaneActor:OnSaveACopy Called");let ra=new L.a(-1244760097,0,this.$.Mc,0,null);this.$.me.get(51)&&(e.ULS.sendTraceTag(537150301,0,50,"VersionHistoryPaneActor:OnSaveACopy for ODConsumer Called"),ra=new L.a(-309686558,0,this.$.Mc,0,null));l.c(1604651619,!0);
this.$.Ka.Mb(ra,{["FileDownloadUrl"]:jb})};this.Evf=jb=>{e.ULS.sendTraceTag(537150300,0,50,"VersionHistoryPaneActor:OnDownloadVersion Called");if(!W.EwaSettings.isChangeGateEnabled("OfficeVSO:6794681_VHDisableDownloadACopy")||this.$xj())jb=new S.QueryStringBuilder(jb),jb.Qi("fn",d.AFrameworkApplication.fileName),e.ULS.sendTraceTag(537150299,0,50,"VersionHistoryPaneActor:OnDownloadVersion URL Length is "+jb.toString().length),8===this.$.frame.C8a(jb.toString(),!0)?(e.ULS.sendTraceTag(587830283,0,10,
"VersionHistoryPaneActor:OnDownloadVersion failed"),l.c(1316171850,!1)):l.c(1316171850,!0)};this.jtf=jb=>{this.sm.setFullAppErrorCode(jb)};this.Mwf=jb=>{switch(jb){case 101:jb="VHFailedToGetDownloadToken";break;case 100:jb="VHFailedToLoadVersionList";break;case 104:jb="VHVersioningNotEnabled";break;case 105:jb="VHFileNotFound";break;case 106:jb="VHVersionTooOld";break;default:jb="None"}this.ED.addEvent("OnFullAppError",jb);e.ULS.sendTraceTag(537150291,0,10,`FullApp Error Event: ${jb}`)};this.NAd=
jb=>{this.FEe=jb;e.ULS.sendTraceTag(537150290,0,50,`VersionHistoryPaneActor:Show Changes toggled to:${jb.toString()}`);this.KMd(O.a.SMb,{["ToggleValue"]:jb})};this.eyf=jb=>{e.ULS.sendTraceTag(50405840,0,50,`VersionHistoryPaneActor:OnIteratorSelected next: ${jb}`);l.c(1488635506,!0);const ra={};jb?this.KMd(O.a.iterateNext,ra):this.KMd(O.a.Qwa,ra)};this.MGb=jb=>{switch(jb.MessageId){case H.a.HTa:e.ULS.sendTraceTag(537150289,0,50,"VersionHistoryPaneActor.ReceivePostMessageFromVHSession WacAppCompleted ");
W.EwaSettings.ma(420)&&this.sm.setVersionLoadComplete();break;case H.a.ITa:e.ULS.sendTraceTag(51128035,0,10,"VersionHistoryPaneActor.ReceivePostMessageFromVHSession WacAppFailed");break;case O.a.setCurrentChangeCount:jb=jb.Values.count;e.ULS.sendTraceTag(537150288,0,50,`VersionHistoryPaneActor.ReceivePostMessageFromVHSession SetCurrentChangeCount : ${jb}`);this.sm.setCurrentChangeCount(jb);break;case O.a.setTotalChangesCount:jb=jb.Values.count;e.ULS.sendTraceTag(537150287,0,50,`VersionHistoryPaneActor.ReceivePostMessageFromVHSession SetTotalChangesCount : ${jb}`);
this.sm.setTotalChangesCount(jb);break;case O.a.vOa:this.NAd(this.FEe);break;default:e.ULS.sendTraceTag(537150286,0,15,`VersionHistoryPaneActor.ReceivePostMessageFromVHSession MessageID:${jb.MessageId}`)}};this.$=la;this.D7b=this.$.Bb+ya.awh;this.lHd=!1;W.EwaSettings.ma(386)&&this.u$g();this.LAb="";this.xrd=0;this.perfTelemetryInfos=[]}dispose(){this.txe()}HYi(){this.$.da.Za(15,la=>{this.ewaAccessibilityManager=la;this.ewaAccessibilityManager.mode=2})}u$g(){this.aZd=new Pa(this);this.$Yd=new pa(this);
this.bZd=new Z(this)}pBj(){e.ULS.sendTraceTag(41739649,0,15,"VersionHistoryPaneActor:ShowVersionHistoryDialogAction called");d.AFrameworkApplication.fN("Microsoft.Office.Excel.Server.Flighting.IDenyListExcelVersionHistoryEnableODCSaveACopy");d.AFrameworkApplication.fN("Microsoft.Office.Excel.Server.Flighting.IDenyListVersionHistorySaveACopyOverFlowMenu");d.AFrameworkApplication.fN("Microsoft.Office.Excel.Server.Flighting.IDenyListExcelVersionHistoryRestoreSkipCoauthCheck");d.AFrameworkApplication.XH("8492a557;72ff4572");
this.ED=excelVersionHistory.FactoryGlobal.getTelemetryCollector();this.perfTelemetryInfos=[];this.ED.startTimer(ya.U8f);if(!this.sm&&(fa.a(()=>{this.sm=versionHistory.FactoryGlobal.getVersionHistoryControllerInstance(Object(X.a)(new xa,{ulsLogger:new D.a,docId:d.AFrameworkApplication.ij,appSettings:Object(X.a)(new ta,{appName:120,userSessionId:d.AFrameworkApplication.userSessionId,wdEnableSaveACopy:W.EwaSettings.ma(355),wdEnableDownloadTokens:W.EwaSettings.ma(350),wacCluster:d.AFrameworkApplication.vd.EO,
uiLocale:d.AFrameworkApplication.uiCulture||"en-us",wdEnableRestore:W.EwaSettings.ma(321)&&this.$.isEditMode,wdEnableIterator:W.EwaSettings.ma(318)&&W.EwaSettings.ma(319),useXhr:!1,wdEnableHiddenButtonsUntilVersionLoadComplete:W.EwaSettings.ma(420),disableSaveACopy:this.SPd(),wdEnableShowVersionChanges:W.EwaSettings.ma(318)&&W.EwaSettings.ma(320),disabledChangeGates:this.$.ya.VHSDisabledChangeGates,wdEnableSaveACopyOverFlowMenu:W.EwaSettings.ma(536),isRtl:d.AFrameworkApplication.isRtl,wdExperimentWithIteratorLocation:W.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.VersionHistoryIteratorInPane",
!1)}),perfTelemetryInfos:this.perfTelemetryInfos}))}),!this.sm))return e.ULS.sendTraceTag(537150352,0,10,"VersionHistoryPaneActor:ShowVersionHistoryDialogAction - VersionHistoryController should not be null"),l.c(429638140,!1),!1;this.qBj();this.ED.endTimer(ya.U8f);this.ED.startTimer(ya.X8f);e.ULS.sendTraceTag(537150351,0,50,"VersionHistoryPaneActor:ShowVersionHistoryDialogAction Returned Success");l.c(429638140,!0);return!0}qBj(){var la;this.Bj();if(!document.getElementById(this.D7b)){const jb=document.createElement("div");
jb.id=this.D7b;jb.style.width="100%";jb.style.zIndex="998";jb.style.display="block";jb.style.position="absolute";if(d.AFrameworkApplication.ta.Oa.$e){const ra=(null===(la=document.getElementById("HeaderRegion"))||void 0===la?void 0:la.offsetHeight)||0;jb.style.top=ra+"px";jb.style.bottom="0px";jb.style.height=`calc(100vh - ${ra}px)`}else jb.style.height="100%";this.$.dr.insertBefore(jb,this.$.dr.firstChild);this.nNb=this.sm.createVersionHistoryDialog(jb)}document.getElementById(this.D7b).style.display=
"block";this.aHd();this.ED.startTimer(ya.HUd);this.sm.getVersions("")}aHd(){W.EwaSettings.ma(386)&&(this.aZd.Xh(),this.$Yd.Xh(),this.bZd.Xh(),this.HYi())}YWd(){W.EwaSettings.ma(386)&&(this.aZd.m7(),this.$Yd.m7(),this.bZd.m7(),this.ewaAccessibilityManager&&(this.ewaAccessibilityManager.mode=0))}Bj(){this.sm.getVersionsReadyEvent().addListener(this.ADf);this.sm.getVersionSelectedEvent().addListener(this.onVersionSelected);this.sm.getCloseSelectedEvent().addListener(this.Euf);this.sm.getFullAppErrorEvent().addListener(this.Mwf);
this.sm.getIteratorSelectedEvent().addListener(this.eyf);this.sm.getShowVersionChangesToggledEvent().addListener(this.NAd);W.EwaSettings.ma(350)&&(this.sm.getDownloadTokenReadyEvent().addListener(this.Dvf),this.lHd=!0);W.EwaSettings.ma(355)&&(this.sm.getSaveACopySelectedEvent().addListener(this.iBf),this.sm.getDownloadVersionSelectedEvent().addListener(this.Evf));W.EwaSettings.ma(321)&&this.$.isEditMode&&(this.sm.getRestoreVersionSelectedEvent().addListener(this.RAf),this.mHd=!0);this.noa&&this.noa.getAppErrorEvent().addListener(this.jtf)}ek(){this.sm.getVersionsReadyEvent().removeListener(this.ADf);
this.sm.getVersionSelectedEvent().removeListener(this.onVersionSelected);this.sm.getCloseSelectedEvent().removeListener(this.Euf);this.sm.getFullAppErrorEvent().removeListener(this.Mwf);this.sm.getIteratorSelectedEvent().removeListener(this.eyf);this.sm.getShowVersionChangesToggledEvent().removeListener(this.NAd);W.EwaSettings.ma(355)&&(this.sm.getSaveACopySelectedEvent().removeListener(this.iBf),this.sm.getDownloadVersionSelectedEvent().removeListener(this.Evf));this.lHd&&(this.sm.getDownloadTokenReadyEvent().removeListener(this.Dvf),
this.lHd=!1);this.mHd&&(this.sm.getRestoreVersionSelectedEvent().removeListener(this.RAf),this.mHd=!1);this.noa&&this.noa.getAppErrorEvent().removeListener(this.jtf)}Tvj(){return this.SPd()||!d.AFrameworkApplication.sY}$xj(){return this.Tvj()?(e.ULS.sendTraceTag(520180169,0,15,"VersionHistoryPaneActor:OnDownloadVersion blocked"),l.c(1316171850,!1),!1):!0}ayj(){let la=!0;if(W.EwaSettings.ma(598)&&!this.$.TM)return e.ULS.sendTraceTag(537150350,0,15,"VersionHistoryPaneActor:ShouldTriggerRestore - Skipping coauth check with status "+
this.$.ea.amIAlone.toString()),!0;if(!this.$.ea.amIAlone&&!W.EwaSettings.ma(317)){this.hti();this.sm.setCoauthRestoreError();la=!1;const jb=new L.a(-729359593,0,this.$.Mc,0,null);this.$.Ka.Mb(jb)}this.$.TM&&(e.ULS.sendTraceTag(42522439,0,10,"VersionHistoryPaneActor:ShouldTriggerRestore - Restore failed, Unsaved changes present"),la&&(la=!1,this.oBj()));return la}oBj(){var la=V.a.Yc(1,0,1900,1899,0,-1603358883,"RestoreVersionUnsavedChangesError");la=this.dialog||new K.ErrorDialog(this.$,la);la.initialize();
la.Ff()}gVj(){e.ULS.sendTraceTag(537150343,0,50,`VersionHistoryPaneActor:ValidateDiffDiffParameters called for BaseVersion${this.baseVersionInfo?ya.fF(this.baseVersionInfo):""}`);if(ya.fF(this.I2)===this.ASe)return e.ULS.sendTraceTag(537150342,0,15,"VersionHistoryPaneActor:ValidateDiffDiffParameters for last version"),!0;if(W.EwaSettings.isChangeGateEnabled("OfficeVSO:4381797_XLVHSkipBaseVersionValidateForGroupingUI")&&!this.baseVersionInfo&&this.prf)return e.ULS.sendTraceTag(537150341,0,50,"VersionHistoryPaneActor:ValidateDiffDiffParameters skipping diff last version"),
!0;if(!this.baseVersionInfo)return e.ULS.sendTraceTag(537150340,0,10,"VersionHistoryPaneActor:ValidateDiffDiffParameters for null BaseVersion"),!1;const la=ya.iMh(this.baseVersionInfo);e.ULS.sendTraceTag(537150339,0,50,`downloadURL length ${la?la.length:0}`);return la?!0:(e.ULS.sendTraceTag(537150338,0,50,"VersionHistoryPaneActor:ValidateDiffDiffParameters downloadURL is null"),!1)}SPd(){return!this.$.Vja}QYg(){document.getElementById(this.D7b).style.display="none";const la=new L.a(-1423792966,0,
this.$.Mc,0,null);this.$.Ka.Mb(la);this.txe()}txe(){this.ED&&(this.ED.endTimer(ya.X8f),this.Tve(this.ED),this.ED=null);this.ek();this.YWd();this.perfTelemetryInfos&&(e.ULS.sendTraceTag(537150302,0,15,this.perfTelemetryInfos.map(la=>JSON.stringify(la)).toString()),this.perfTelemetryInfos=null);this.LB&&(this.LB.$na(H.a.HTa),this.LB.$na(H.a.ITa),this.LB.$na(O.a.setCurrentChangeCount),this.LB.$na(O.a.setTotalChangesCount),W.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")&&
this.LB.$na(O.a.vOa),this.LB.dispose(),this.LB=null)}$ej(la){try{this.noa?J.setIsPageLoadForFirstTime(!1):(J.setIsPageLoadForFirstTime(!0),fa.a(()=>{const jb=new ja;jb.ulsLogger=new D.a;jb.actionUrl=this.$.ya.VersionHistoryActionUrl;jb.hideEmbedFooter=!0;jb.useFetch=W.EwaSettings.ma(415)&&!M.a.kv;this.noa=excelVersionHistory.FactoryGlobal.getAppVersionControllerInstance(Object(X.a)(new ca,{appBootSettings:jb,rootDiv:la}))}))}catch(jb){e.ULS.sendTraceTag(41239239,0,10,`VersionHistoryPaneActor: ResetAppVersionController failed due to exception. ${jb}`)}}oMd(la){e.ULS.sendTraceTag(537150298,
0,50,`VersionHistoryPaneActor:SelectVersion called. for Version:${ya.fF(la)}, LastSelected:${this.LAb}`);if(la)if(ya.fF(la).length){var jb=(new Date).getTime();if(ya.fF(la)===this.LAb&&1E3>jb-this.xrd)e.ULS.sendTraceTag(537150295,0,50,"VersionHistoryPaneActor:SelectVersion reattempt within 1 sec");else{ya.fF(la)!==this.LAb&&(e.ULS.sendTraceTag(537150294,0,50,"VersionHistoryPaneActor:Reset Iterator states if user clicks on different version"),this.sm.setTotalChangesCount(-1),this.sm.setCurrentChangeCount(-1));
var ra=excelVersionHistory.FactoryGlobal.getTelemetryCollector();ra.addEvent("SelectVersion",ya.fF(la));try{this.IXj(ra);this.xrd=jb;this.LAb=ya.fF(la);const hb=new aa;hb.selectedVersionInfo=this.I2;hb.baseVersionInfo=this.baseVersionInfo;hb.telemetryCollector=ra;this.noa.onVersionSelectedWithParams(hb);this.sm&&W.EwaSettings.ma(355)&&this.sm.setDisableSaveACopy(this.SPd());const Eb=document.getElementById(ya.$vh);Eb&&!this.LB&&(e.ULS.sendTraceTag(537150293,0,50,"VersionHistoryPaneActor: SelectVersion Lazy instantiate VersionHistoryMessenger"),
this.LB=new O.a(Eb.contentWindow,y.a.naa(this.$.ya.VersionHistoryActionUrl)||Y.a.l9),this.LB.Tl(H.a.HTa,this.MGb),this.LB.Tl(H.a.ITa,this.MGb),this.LB.eo(O.a.setCurrentChangeCount),this.LB.eo(O.a.setTotalChangesCount),W.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")&&this.LB.eo(O.a.vOa),this.LB.Tl(O.a.setCurrentChangeCount,this.MGb),this.LB.Tl(O.a.setTotalChangesCount,this.MGb),W.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")&&
this.LB.Tl(O.a.vOa,this.MGb))}catch(hb){this.xrd=0,this.LAb="",ra.addEvent("Exception",hb.toString()),e.ULS.sendTraceTag(42016832,0,10,`VersionHistoryPaneActor: OnVersionSelected failed due to exception. ${hb}`)}finally{e.ULS.sendTraceTag(537150292,0,50,ra?ra.getJsonForLogging():"")}}}else e.ULS.sendTraceTag(537150296,0,50,"VersionHistoryPaneActor:SelectVersion selectedVersion RevisionId is null");else e.ULS.sendTraceTag(537150297,0,50,"VersionHistoryPaneActor:SelectVersion selectedVersion is null")}IXj(la){for(const jb of this.perfTelemetryInfos){const ra=
jb.TelemetryEventKey?jb.TelemetryEventKey:jb.telemetryEventKey?jb.telemetryEventKey:"",hb=jb.TelemetryEventData?jb.TelemetryEventData:jb.telemetryEventData?jb.telemetryEventData:"";ra&&hb&&la.addEvent(ra,hb)}this.perfTelemetryInfos.length=0}Tve(la){e.ULS.sendTraceTag(42553886,0,15,`VersionHistoryPaneActor:CaptureSessionTelemetry - ${la?la.getJsonForLogging():""} `)}hti(){const la=this.$.ea.Jm,jb={};let ra=null;for(const hb of la)hb.UserEmail&&(jb[hb.UserEmail]=hb.UserEmail in jb?jb[hb.UserEmail]+
1:1),hb.User.UserID===this.$.ea.clientId&&(ra=hb.UserEmail);e.ULS.sendTraceTag(42522438,0,10,`VersionHistoryPaneActor:LogCoauthorsTelemetry Restore failed, TotalAuthors: ${la.length}, TotalAuthorsAsYourself ${ra?jb[ra]:-1}`)}KMd(la,jb){e.ULS.sendTraceTag(537150285,0,50,`VersionHistoryPaneActor.SendPostMessageToTheVHSession called with MessageID:${la}`);if(this.LB){la=new G.a(la);la.Values[T.a.I3c]=this.$.ya.UserSessionId;if(jb)for(let ra in jb)la.Values[ra]=jb[ra];this.LB.send(la)}else e.ULS.sendTraceTag(537150284,
0,10,"VersionHistoryPaneActor.SendPostMessageToTheVHSession versionHistoryMessenger is null")}static fF(la){return la?la.RevisionID?la.RevisionID:la.revisionID?la.revisionID:"":""}static iMh(la){return la?la.DownloadUrl?la.DownloadUrl:la.downloadUrl?la.downloadUrl:"":""}}ya.awh="_excelVersionHistoryOverlay";ya.$vh="vhs_frame";ya.U8f="TimeTakenShowVersionHistoryDialogAction";ya.X8f="TimeTillVersionHistoryDialogWasOpenMs";ya.HUd="TimeTakenGetVersionsToOnVersionsReady";ya.l3g="CountOnVersionSelectedCalledinOneVHSession";
ya.m3g="CountOnVersionsReadyCalledinOneVHSession";ya.k3g="CountOnDownloadTokenReadyCalledinOneVHSession";ya.V8f="TimeTakenVersionRestore";Object(b.a)(ya,"VersionHistoryPaneActor",null,[2]);var ib=a(196);class wa extends x.a{constructor(la){super(la)}yd(){const la=this.ssi(),jb=B.GetServiceTaskFactory.Ra(this.$.da,21,137,this.hb);z.TaskExtensions.Aa(z.TaskExtensions.Wd([la,jb],this.la,3),()=>{var ra=jb.result;const hb=y.a.naa(this.$.ya.VersionHistoryActionUrl);hb!==Y.a.l9&&ra.$Ea(hb);ra=new ya(this.$);
this.gd([new U(this.$,ra)])},this.la,3)}ssi(){const la=B.GetServiceTaskFactory.cja(this.$.da,283,284,this.hb).then(jb=>jb.Zn.loadScript("excelVersionHistory"),jb=>{e.ULS.sendTraceTag(537150412,0,10,`versionHistoryManagerFactory: Dynamic Script Loading failed due to exception. ${jb}`);return Promise.reject(jb)});return ib.c(la)}static ka(la){x.a.Nd(304,new wa(la))}}Object(b.a)(wa,"VersionHistoryCommandHandlerFactory",x.a,[]);var sa=a(1253),Ya=a(696);class bb extends f.a{constructor(la){super();this.$=
la;this.Fb()}create(){const la=B.GetServiceTaskFactory.Ra(this.$.da,211,212,this.hb),jb=B.GetServiceTaskFactory.Ra(this.$.da,21,137,this.hb);z.TaskExtensions.Aa(z.TaskExtensions.Wd([la,jb],this.$.la),()=>{const ra=Object(Ya.a)(this.$.da,305,()=>new sa.a(this.$,!0,jb.result,la.result));this.qb(ra)},this.$.la,3)}static ka(la){la.da.Ga(306,new bb(la))}}Object(b.a)(bb,"VersionHistoryHighlightManagerFactory",f.a,[]);var mb=a(508),Ca=a(5),$a=a(160),Kb=a(14);class rb extends k.a{constructor(la,jb,ra){super(la,
jb);this.lineageManager=ra}execute(la){this.lineageManager.lineageHidePreviousHistory();return super.execute(la)}}Object(b.a)(rb,"LineageClearHistoryConfirmedActivity",k.a,[]);var cc=a(17),nc=a(139);class Wb{constructor(la,jb){this.$=la;this.lineageManager=jb;la=[new cc.a(n.a.isd,1038647878,0,0,2241),new cc.a(n.a.idle,1038647878,0,1)];Ba.a(this.$).NGd(new nc.a(n.a.hsd,n.a.idle,la),new rb(n.a.isd,n.a.idle,jb))}Nc(){return!1}executeCommand(la,jb,ra){la=!1;switch(jb.command){case 1834994092:9===jb.Re&&
this.HGj();this.Qyj(jb,ra);la=!0;break;case -409942531:this.Syj(),la=!0}return la?F.Task.Ta(!0):A.a(jb.command)}Cc(la,jb){return 1834994092===jb.command||-409942531===jb.command}Rc(){return!1}Qyj(la,jb){e.ULS.sendTraceTag(537155483,0,50,`LineageActivityCommandHandler::ShowChangesCore command location: ${jb.MenuItemId||la.Re}`);this.lineageManager.X2f(19===la.Re&&!!jb.MenuItemId,jb.MenuItemId,la.Re)}HGj(){const la=Ca.a.cqc;la!==$a.a(this.$).Vl.Tz&&$a.a(this.$).Vl.activateRibbonTab(la)}Syj(){da.a(this.$).ls(new qa.a(n.a.hsd,
5,()=>{const la=Ba.a(this.$).jd,jb=V.a.Yc(3,1,2238,2239,2240,1038647878,"LineageConfirmClearHistory");jb.HelpTopicId="a1493bf9-25c3-470a-b970-60eceb0136e5";jb.HelpDescription=Kb.a.instance.ga(1321);la.$q([jb])}))}}Object(b.a)(Wb,"LineageActivityCommandHandler",null,[195]);class Ea extends x.a{constructor(la){super(la)}yd(){z.TaskExtensions.Aa(B.GetServiceTaskFactory.Ra(this.$.da,366,367,this.hb),la=>{this.gd([new Wb(this.$,la.result)])},this.la,3)}static ka(la){x.a.Nd(363,new Ea(la))}}Object(b.a)(Ea,
"LineageActivityCommandHandlerFactory",x.a,[]);class ua{constructor(la){this.gdb=!0;ua.Qaf()?ua.Zaf()?(e.ULS.sendTraceTag(526434368,0,50,`LineageCatchUpExperimentManager is running in hybrid mode. TUI exhausted: ${!la}`),this.gdb=la):this.gdb=!1:this.gdb=!0}$5a(){return!this.gdb}static Zaf(){return ua.Qaf()&&W.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.LineageCatchUpIntegrationTeachingUXTreatmentToControl",!1)}static Qaf(){return W.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.LineageCatchUpIntegrationSummaryStringTreatment",
!1)}}Object(b.a)(ua,"LineageCatchUpExperimentManager",null,[481]);class ma extends f.a{constructor(la){super();this.$=la;this.Fb()}create(){ua.Zaf()?z.TaskExtensions.Aa(B.GetServiceTaskFactory.Ra(this.$.da,456,457,this.hb),la=>{z.TaskExtensions.Aa(la.result.mxj(),jb=>{this.uCe(jb.result)},this.$.la,3)},this.$.la,3):this.uCe(!0)}uCe(la){this.qb(this.$.da.za(458)||this.$.da.Ga(458,new ua(la)))}static ka(la){la.da.Ga(459,new ma(la))}}Object(b.a)(ma,"LineageCatchUpExperimentManagerFactory",f.a,[]);var fb=
a(413),sb=a(33),Ua=a(187),ab=a(82),na=a(146),Na=a(124);class Va{}Object(b.a)(Va,"LineageClientParams",null,[]);class Sa{}Object(b.a)(Sa,"LineageFilter",null,[]);var vb=a(65),Oa=a(77),yb=a(131),Ob=a(43),Ja=a(513),lb=a(170),Pb=a(121),Jb=a(109),Lb=a(281),Ab=a(280),nb=a(97),va=a(21),db=a(132),Xa=a(61);const gb=(la,jb,ra,hb,Eb,fc,Mc,xd=null)=>{xd=la.Na(1,xd);xd.clientParams=jb;xd.lineageFilter=ra;return Xa.g(la,"LineageOpenPaneOrChangeFilter",xd,hb,Eb,fc,Mc,0)},Ha=(la,jb,ra,hb,Eb,fc,Mc=null)=>{Mc=la.Na(1,
Mc);Mc.fetchFromBelow=jb;return Xa.g(la,"LineageLoadMore",Mc,ra,hb,Eb,fc,0)},tb=(la,jb,ra,hb,Eb,fc=null)=>{fc=la.Na(1,fc);return Xa.g(la,"LineageRefreshView",fc,jb,ra,hb,Eb,0)},bc=(la,jb,ra,hb,Eb,fc=null)=>{fc=la.Na(1,fc);return Xa.g(la,"LineageUpdateView",fc,jb,ra,hb,Eb,0)},tc=(la,jb,ra,hb,Eb,fc=null)=>{fc=la.Na(1,fc);return Xa.g(la,"LineageClosePane",fc,jb,ra,hb,Eb,0)},Ma=(la,jb,ra,hb,Eb,fc=null)=>{fc=la.Na(1,fc);return Xa.g(la,"LineageHidePreviousHistory",fc,jb,ra,hb,Eb,0)},Tb=(la,jb,ra,hb,Eb,
fc=null)=>{fc=la.Na(1,fc);return Xa.g(la,"LineageLoadInGridBlueDots",fc,jb,ra,hb,Eb,0)};var zb=a(51),ic=a(339);class Qb{constructor(){this.activityList=null;this.oldestActivityId=this.latestActivityId=0;this.lastSearchedActivityTimestamp=null;this.serverLastActivityId=this.serverFirstActivityId=this.serverMessageCode=0;this.docId=null;this.showLoadPrevious=!1;this.eolPersonHideHistory=this.eolDateHideHistory=this.eolCorrelationId=null}}Object(b.a)(Qb,"LineageActivitiesResponseDTO",null,[]);class wb extends Qb{constructor(){super();
this.hasNewActivities=!1;this.filterSheetMultiRange=null}}Object(b.a)(wb,"LineageActivitiesUpdateResponseDTO",Qb,[]);class hc{constructor(){this.onLearnMoreLinkClicked=this.isFeatureEnabled=this.onRangeFilterInputEnabled=this.tryParseRangeInfo=this.onVersionHistoryButtonClicked=this.onCardSelected=this.lineageUpdateViewRequest=this.lineageRefreshViewRequest=this.lineageLoadMoreRequest=this.lineageOpenPaneOrChangeFilterRequest=null}}Object(b.a)(hc,"LineageAppCallbacks",null,[]);class Za{constructor(){this.imageUrl=
this.email=this.displayName=this.provider=this.id=null}}Object(b.a)(Za,"LineageAuthorDTO",null,[]);class ub{constructor(){this.logger=this.uiCulture=this.dataCulture=null;this.clientBatchSize=0;this.lineageAppCallbacks=this.filterableSheetList=null}}Object(b.a)(ub,"LineageControllerFactoryParams",null,[]);class uc{constructor(){this.lastCol=this.firstCol=this.lastRow=this.firstRow=0}}Object(b.a)(uc,"LineageSharedRangeDTO",null,[]);class Oc{constructor(){this.sheetName=this.rangeList=null}}Object(b.a)(Oc,
"LineageSheetMultiRangeDTO",null,[]);class Bb{constructor(){this.activityId=0;this.displayTimestamp=this.author=this.activityGuid=null;this.activityType=0;this.rangeHighlightLocation=this.isBulkEditOverflow=this.valueChanges=this.gridLocation=this.sheetName=this.nestedActivityList=null;this.degradedCardTypeBits=0}}Object(b.a)(Bb,"LineageUserActivityDTO",null,[]);class Nb{constructor(){this.hasOldValue=this.hasNewValue=!1;this.cellLocation=this.oldValue=this.newValue=null}}Object(b.a)(Nb,"LineageValueChangeDTO",
null,[]);class dc{constructor(la,jb,ra,hb){this.gtb=this.zF=null;this.hE=this.lsd=0;this.aEb=()=>{this.L6&&(this.L6.stop(),this.L6=null);this.gLb.start();this.zF.createLineagePane(this.gsd,this.gtb)};this.lineageOpenPaneOrChangeFilterRequest=(Eb,fc)=>{this.gLb.stop();db.b(this.$).Cd(yb.a.hNi,{});this.eBj();const Mc=Object(X.a)(new Va,{ClientViewCapacity:Eb.clientViewCapacity});let xd=null;fc&&(xd=Object(X.a)(new Sa,{FilterSheetMultiRange:this.wLj(fc.filterSheetMultiRange)}));const Hd=Md=>{Md=Pb.a.lf(Md.data);
e.ULS.sendTraceTag(537155481,0,50,`LineageManager::LineageOpenPaneOrChangeFilter service call failed. Errors: [${V.a.yc(Md)}]`)};Eb=(Md,ae,me)=>gb(this.$.oa.va,Mc,xd,Ab.b(Md,this.Sdd("LineageOpenPaneOrChangeFilter")),Ab.a(ae,Hd),me,null);W.EwaSettings.dc()?this.$.userOperationManager.Ub(new lb.a(1010,0,Eb,80),null):this.$.userOperationManager.Ub(new Ja.a(1010,0,Eb,16),null)};this.lineageLoadMoreRequest=Eb=>{db.b(this.$).Cd(yb.a.gNi,{});const fc=xd=>{xd=Pb.a.lf(xd.data);e.ULS.sendTraceTag(537155480,
0,50,`LineageManager::LineageLoadMore service call failed. Errors: [${V.a.yc(xd)}]`)},Mc=(xd,Hd,Md)=>Ha(this.$.oa.va,Eb,Ab.b(xd,this.Sdd("LineageLoadMore")),Ab.a(Hd,fc),Md,null);W.EwaSettings.dc()?this.$.userOperationManager.Ub(new lb.a(1011,0,Mc,80),null):this.$.userOperationManager.Ub(new Ja.a(1011,0,Mc,16),null)};this.lineageRefreshViewRequest=()=>{db.b(this.$).Cd(yb.a.iNi,{});const Eb=Mc=>{Mc=Pb.a.lf(Mc.data);e.ULS.sendTraceTag(537155479,0,50,`LineageManager::LineageRefreshView service call failed. Errors: [${V.a.yc(Mc)}]`)},
fc=(Mc,xd,Hd)=>tb(this.$.oa.va,Ab.b(Mc,this.Sdd("LineageRefreshView")),Ab.a(xd,Eb),Hd,null);W.EwaSettings.dc()?this.$.userOperationManager.Ub(new lb.a(1012,0,fc,80),null):this.$.userOperationManager.Ub(new Ja.a(1012,0,fc,16),null)};this.lineageUpdateViewRequest=()=>{bc(this.$.oa.va,Eb=>{if(Eb=Lb.a(Eb)?null:Eb.Result){var fc={["CountOfUpdatedActivities"]:Eb.LineageActivitiesResponse.ActivityList.length};db.b(this.$).Cd(yb.a.jNi,fc);Eb=Object(X.a)(new wb,{activityList:this.Apc(Eb.LineageActivitiesResponse.ActivityList),
latestActivityId:Eb.LineageActivitiesResponse.LastSearchedActivityId,oldestActivityId:Eb.LineageActivitiesResponse.FirstSearchedActivityId,serverMessageCode:Eb.LineageActivitiesResponse.LineageResponseCode,lastSearchedActivityTimestamp:new Date(Eb.LineageActivitiesResponse.EcmaLastSearchedDate),hasNewActivities:Eb.HasNewActivities,filterSheetMultiRange:this.mLj(Eb.LineageActivitiesResponse.FilterSheetMultiRange),serverFirstActivityId:Eb.LineageActivitiesResponse.ServerFirstActivityId,serverLastActivityId:Eb.LineageActivitiesResponse.ServerLastActivityId,
showLoadPrevious:Eb.LineageActivitiesResponse.ShowLoadPrevious,eolCorrelationId:Eb.LineageActivitiesResponse.EolCorrelationId,eolDateHideHistory:new Date(Eb.LineageActivitiesResponse.EolDateHideHistory),eolPersonHideHistory:this.pvb(Eb.LineageActivitiesResponse.EolPersonHideHistory)});this.zF.onLineageActivitiesUpdateResponse(Eb)}else e.ULS.shipAssertTag(537155475,0,!!Eb,"LineageManager.LineageUpdateView returned null response.")},Eb=>{Eb=Pb.a.lf(Eb.data);e.ULS.sendTraceTag(537155474,0,50,`LineageManager::LineageUpdateView service call failed. Errors: [${V.a.yc(Eb)}]`)},
null,null)};this.onCardSelected=(Eb,fc)=>{if(Eb=Eb.rangeHighlightLocation){if(fc){let Mc;if(({range:Mc}=Ob.Z(fc,null)).returnValue){this.q7e(Eb.sheetName,this.xvb([Ob.j(Mc)]));return}e.ULS.shipAssertTag(537155472,0,!1,"The produced subCellLocation string "+fc+" is not valid.")}Eb.rangeList.length?this.q7e(Eb.sheetName,Eb.rangeList):this.W5h(Eb.sheetName)}};this.onLearnMoreLinkClicked=()=>{if(W.EwaSettings.isChangeGateEnabled("OfficeVSO:4597686_LineageLearnMoreLinkEnabled")){const Eb=new L.a(-859308420,
Oa.a.Eb,this.$.Mc,12,null);this.$.Ka.Mb(Eb,{[Oa.a.Zf]:"HelpID=XLO_LineageTS",["InputMethod"]:Oa.a.Eb,[Oa.a.Pc]:Ca.a.oQ,["ShouldCanvasTakeFocus"]:!0})}};this.onVersionHistoryButtonClicked=Eb=>{this.$.Ka.Mb(new L.a(-1112508866,Eb,this.$.Mc,12,null))};this.isFeatureEnabled=()=>!1;this.Uf=()=>{const Eb=this.$.ea.to.LineageVersion;Eb!==this.lsd&&(e.ULS.sendTraceTag(537155470,0,50,`LineageManager.OnWorkbookMetadataChanged: lineageVersion: ${Eb}, this.lineageVersion: ${this.lsd}`),this.lsd=Eb,this.F6i())};
this.Xc=(Eb,fc)=>{this.zF&&!this.lineageTaskPane.Efc&&fc.EH&&(e.ULS.sendTraceTag(587220563,0,15,"LineageManager::SessionIdChanged detected."),this.onStaleActivitiesDetected())};this.Ao=()=>{this.zF&&!this.lineageTaskPane.Efc&&(e.ULS.sendTraceTag(587220562,0,15,"LineageManager::LoadOnDemandOccurred detected."),this.onStaleActivitiesDetected())};this.nD=()=>{const Eb=this.U3a();this.zF.onFilterableSheetListChange(Eb)};this.mya=()=>{const Eb=this.U3a();this.zF.onFilterableSheetListChange(Eb)};this.onc=
()=>{const Eb=this.U3a();this.zF.onFilterableSheetListChange(Eb)};this.onPaneClosed=()=>{this.zF.onPaneClosed();tc(this.$.oa.va,null,Eb=>{Eb=Pb.a.lf(Eb.data);e.ULS.sendTraceTag(537155469,0,50,`LineageManager::OnLineageClosePaneFailed service call failed. Errors: [${V.a.yc(Eb)}]`)},null,null)};this.onRangeFilterInputEnabled=Eb=>{Eb?this.gridView.ha.cT(this.Vc):this.gridView.ha.rR(this.Vc)};this.Vc=()=>{var Eb=Ob.q(this.gridView.ha.sa.activeRange,this.$);Eb=Object(X.a)(new Oc,{rangeList:this.xvb(Eb.Ranges),
sheetName:Eb.SheetName});this.zF.onSelectedRangeUpdated(Eb)};this.tryParseRangeInfo=Eb=>{let fc;if(({sheetName:fc,range:Eb}=Ob.Z(Eb,this.$.xa)).returnValue){fc||(fc=this.$.xa.pa.sheetName);const Mc=[];Mc.push(Eb);Eb=Ob.u(fc,null,Mc);return Object(X.a)(new Oc,{rangeList:this.xvb(Eb.Ranges),sheetName:Eb.SheetName})}return null};this.Gz=()=>{const Eb=this.hE!==this.$.ea.Ke;this.zF&&this.lineageTaskPane.isVisible&&Eb&&(this.hE=this.$.ea.Ke,this.zF.onRefreshRequired())};this.$=la;jb.Ga(366,this);jb.Ga(501,
this);this.gridView=va.g(this.$);this.lineageTaskPane=ra;this.gsd=this.lineageTaskPane.pM();this.batchSize=50;this.L6=hb;this.gLb=this.$.Ib.Og("UserAction","LineagePaneLoadingShimmerStopWatch");this.Dpc=ab.a.instance.resolve("Common.App.People.IUserProfilePictureUtils");this.C$h();this.wAg()}dispose(){this.I9i();this.$=null;this.lineageTaskPane&&(this.lineageTaskPane.RN(this.onPaneClosed),this.lineageTaskPane.SF(this.Gz),this.lineageTaskPane=null);this.gLb=this.Dpc=this.gtb=this.gsd=this.zF=null}Pzj(){return Object(Ua.a)(this,
void 0,void 0,function*(){return new Promise(la=>{e.ULS.sendTraceTag(520717857,0,50,"LineageManager::showInGridBlueDots");db.b(this.$).Cd(yb.a.lineageLoadInGridBlueDots,{});const jb=Eb=>{Eb=Pb.a.lf(Eb.data);e.ULS.sendTraceTag(520717856,0,50,`LineageManager::LineageLoadInGridBlueDots service call failed. Errors: [${V.a.yc(Eb)}]`)},ra=Eb=>{if(Eb=Lb.a(Eb)?null:Eb.Result){var fc={["CountOfActivities"]:Eb.ActivityList.length};db.b(this.$).Cd(yb.a.sri,fc);Eb=this.Apc(Eb.ActivityList);la(Eb)}else e.ULS.shipAssertTag(520717854,
0,!!Eb,"LineageManager LineageLoadInGridBlueDots returned null response.")},hb=(Eb,fc,Mc)=>Tb(this.$.oa.va,Ab.b(Eb,ra),Ab.a(fc,jb),Mc,null);W.EwaSettings.dc()?this.$.userOperationManager.Ub(new lb.a(1024,0,hb,80),null):this.$.userOperationManager.Ub(new Ja.a(1024,0,hb,16),null)})})}X2f(la,jb,ra){if(this.lineageTaskPane.isVisible){if(9===ra){e.ULS.sendTraceTag(560989858,0,50,"LineageManager::ShowLineageTaskPane open from callout was invoked with an opened pane");return}if(!la&&16!==ra&&18!==ra){this.lineageTaskPane.Q_c();
return}}sb.a.Ad(this.$)||(this.gLb.start(),this.L6&&(zb.b().DA(this.gLb.id,this.L6.id,"actions","actions"),this.L6.stop(),this.L6=null));this.lineageTaskPane.Efc||e.ULS.sendTraceTag(537155482,0,50,`LineageManager::ShowLineageTaskPane pane reopened by user via ${la?jb:ra}`);this.hE=this.$.ea.Ke;this.gtb=null;la&&(la=Ob.r(this.gridView.ha.sa.selectedRanges,this.$),this.gtb=Object(X.a)(new Oc,{rangeList:jb.toString()===Ca.a.p2f?this.xvb(la.Ranges):null,sheetName:la.SheetName}));sb.a.Ad(this.$)&&this.lineageTaskPane.Efc?
this.lineageTaskPane.Lqj(this.aEb):this.zF.createLineagePane(this.gsd,this.gtb);this.lineageTaskPane.ig(!0);this.$.ud(-71295319,-1,0,null)}lineageHidePreviousHistory(){var la={["paneVisible"]:this.lineageTaskPane.isVisible};na.a.sendTelemetryEvent(Object(X.a)(new ic.a,{name:"Office.Excel.Online.Lineage.ClearHistoryConfirmed",dataFields:Na.a.Uj(la)}));la=(jb,ra,hb)=>Ma(this.$.oa.va,jb,ra,hb,null);W.EwaSettings.dc()?this.$.userOperationManager.Ub(new lb.a(1018,0,la,64),null):this.$.userOperationManager.Ub(new Ja.a(1018,
0,la,0),null);this.lineageTaskPane.isVisible||this.X2f(!1,null,4)}C$h(){const la=Object(X.a)(new hc,{tryParseRangeInfo:this.tryParseRangeInfo,isFeatureEnabled:this.isFeatureEnabled,onCardSelected:this.onCardSelected,onVersionHistoryButtonClicked:this.onVersionHistoryButtonClicked,onRangeFilterInputEnabled:this.onRangeFilterInputEnabled,onLearnMoreLinkClicked:this.onLearnMoreLinkClicked,lineageOpenPaneOrChangeFilterRequest:this.lineageOpenPaneOrChangeFilterRequest,lineageLoadMoreRequest:this.lineageLoadMoreRequest,
lineageRefreshViewRequest:this.lineageRefreshViewRequest,lineageUpdateViewRequest:this.lineageUpdateViewRequest});fa.a(()=>{this.zF=cellLineage.LineageActivityControllerFactoryGlobal.createLineageActivityController(Object(X.a)(new ub,{clientBatchSize:this.batchSize,filterableSheetList:this.U3a(),uiCulture:this.$.ya.UICultureTag,dataCulture:this.$.ya.DataCultureTag,logger:new D.a,lineageAppCallbacks:la}))})}Sdd(la){return jb=>{if(jb=Lb.a(jb)?null:jb.Result){var ra={["CountOfActivities"]:jb.ActivityList.length};
ra.WebRequestName=la;db.b(this.$).Cd(yb.a.EKi,ra);jb=Object(X.a)(new Qb,{activityList:this.Apc(jb.ActivityList),latestActivityId:jb.LastSearchedActivityId,oldestActivityId:jb.FirstSearchedActivityId,serverMessageCode:jb.LineageResponseCode,lastSearchedActivityTimestamp:new Date(jb.EcmaLastSearchedDate),serverFirstActivityId:jb.ServerFirstActivityId,serverLastActivityId:jb.ServerLastActivityId,showLoadPrevious:jb.ShowLoadPrevious,eolCorrelationId:jb.EolCorrelationId,eolDateHideHistory:new Date(jb.EolDateHideHistory),
eolPersonHideHistory:this.pvb(jb.EolPersonHideHistory)});this.zF.onLineageActivitiesResponse(jb)}else e.ULS.shipAssertTag(537155477,0,!!jb,"LineageManager."+la+" returned null response.")}}mLj(la){return Jb.e(la.Ranges)&&!la.SheetName?null:Object(X.a)(new Oc,{rangeList:this.xvb(la.Ranges),sheetName:la.SheetName})}xvb(la){const jb=[];for(const ra of la)la=Object(X.a)(new uc,{firstCol:ra.FirstColumn,firstRow:ra.FirstRow,lastRow:ra.LastRow,lastCol:ra.LastColumn}),jb.push(la);return jb}wLj(la){if(!la)return null;
const jb={};jb.Ranges=this.Sed(la.rangeList);jb.SheetName=la.sheetName;return jb}Sed(la){const jb=[];if(Jb.e(la))return jb;for(const ra of la)la={},la.FirstColumn=ra.firstCol,la.FirstRow=ra.firstRow,la.LastRow=ra.lastRow,la.LastColumn=ra.lastCol,jb.push(la);return jb}W5h(la){(la=this.$.xa.getItemByName(la))&&la.visible&&la.activate(!0)}q7e(la,jb){const ra=[];for(var hb of jb)jb={},jb.FirstColumn=hb.firstCol,jb.FirstRow=hb.firstRow,jb.LastRow=hb.lastRow,jb.LastColumn=hb.lastCol,ra.push(Ob.D(jb));hb=
ra.length-1;jb=ra[hb].topLeft;va.g(this.$).WY(ra,hb,la,null,jb,null,null,3,nb.a.tri,void 0,void 0,void 0,!0)}F6i(){this.zF&&this.lineageTaskPane.isVisible&&(this.hE=this.$.ea.Ke,this.zF.onRefreshRequired())}wAg(){this.lineageTaskPane.aM(this.onPaneClosed);this.lineageTaskPane.mE(this.Gz);this.$.ea.Lu(this.Uf);this.$.ea.jk(this.Xc);this.$.ea.$L(this.Ao);const la=this.$.xa;la.HX(this.nD);la.lga(this.onc);la.gFa(this.mya);la.eYa(this.onc)}I9i(){this.$.ea.Hw(this.Uf);this.gridView.ha.rR(this.Vc);this.$.ea.Ik(this.Xc);
this.$.ea.pR(this.Ao);const la=this.$.xa;la.l6(this.nD);la.pma(this.onc);la.PPa(this.mya);la.KHb(this.onc)}onStaleActivitiesDetected(){this.zF.onStaleActivitiesDetected()}U3a(){const la=this.$.xa.items,jb=[];for(const ra of la)ra.visible&&!vb.e(ra)&&jb.push(ra.sheetName);return jb}eBj(){if(W.EwaSettings.ma(604)){var la=this.$.da.za(403);la&&la.disable();la=new L.a(-847286761,Oa.a.Eb,this.$.Mc,0,Ca.a.KV);this.$.Ka.Mb(la,{["InputMethod"]:Oa.a.Eb,CalloutName:5})}}Apc(la){const jb=[];for(const ra of la)la=
Object(X.a)(new Bb,{activityId:Number.parseLocale(ra.UserActivity.Id),activityGuid:ra.Uid,activityType:ra.UserActivity.Type,author:this.pvb(ra.UserActivity.Person),sheetName:ra.SheetName,displayTimestamp:new Date(ra.UserActivity.DisplayTimestamp),gridLocation:ra.DisplayLocation,valueChanges:this.N0i(ra.LineageValueChangeList),isBulkEditOverflow:ra.IsBulkEditOverFlow,rangeHighlightLocation:this.C0i(ra.UserActivity.LocationList,ra.UserActivity.Type),nestedActivityList:this.v0i(ra.NestedActivityList),
degradedCardTypeBits:ra.DegradedCardTypeBits}),jb.push(la);return jb}C0i(la,jb){if(!la)return e.ULS.sendTraceTag(537155468,0,15,"LineageManager:: RangeHighlightLocation.ActivityLocationList is null"),null;if(!la.length)return e.ULS.sendTraceTag(537155467,0,50,"LineageManager:: RangeHighlightLocation.ActivityLocationList is empty"),null;const ra=[];var hb=[];let Eb="";21===jb?hb.push(la[0]):hb=la;for(const fc of hb)switch(fc.Type){case 1:break;case 2:Eb=fc.SheetName;break;case 0:la=fc;if(!la.RangeList){e.ULS.sendTraceTag(537155465,
0,50,"LineageManager:: RangeHighlightLocation.RangeActivityLocation is null");break}Eb=la.RangeList[0].SheetName;hb=[];21===jb?hb.push(la.RangeList[0]):hb=la.RangeList;for(const Mc of hb)la=Object(X.a)(new uc,{firstCol:Mc.FirstColumn,firstRow:Mc.FirstRow,lastRow:Mc.LastRow,lastCol:Mc.LastColumn}),ra.push(la);break;default:e.ULS.sendTraceTag(537155464,0,50,"LineageManager:: RangeHighlightLocation.ActivityLocationList is of type: ")}return Object(X.a)(new Oc,{sheetName:Eb,rangeList:ra})}N0i(la){const jb=
[];for(const ra of la)la=Object(X.a)(new Nb,{hasNewValue:ra.HasNewValue,hasOldValue:ra.HasOldValue,newValue:ra.HasNewValue?ra.NewValue:null,oldValue:ra.HasOldValue?ra.OldValue:null,cellLocation:ra.CellLocation}),jb.push(la);return jb}v0i(la){return la?this.Apc(la):null}pvb(la){if(!la)return null;let jb=null;W.EwaSettings.isChangeGateEnabled("OfficeVSO:4947893_ShowChangesUserProfilePictureSupportEnabled")&&d.AFrameworkApplication.fa.qa("IsUserProfilePictureResolutionEnabled")&&(jb=this.Dpc.nHa(la.Email,
la.Provider,d.AFrameworkApplication.ij,0));return Object(X.a)(new Za,{id:la.Id,provider:la.Provider,displayName:la.DisplayName,email:la.Email,imageUrl:jb})}}Object(b.a)(dc,"LineageManager",null,[429,430,2]);class sc extends f.a{constructor(la){super();this.L6=this.lineageTaskPane=null;this.$=la;this.Fb()}$ri(la){z.TaskExtensions.Aa(la,()=>{this.qb(this.$.da.za(366)||new dc(this.$,this.$.da,this.lineageTaskPane,this.L6))},this.$.la,3)}create(){this.L6=this.$.Ib.Bc("UserAction","LineagePaneSeenStopwatch");
this.L6.start();const la=B.GetServiceTaskFactory.Ra(this.$.da,365,364,this.hb),jb=fb.a(this.$),ra=B.GetServiceTaskFactory.Ra(this.$.da,283,284,this.hb);z.TaskExtensions.Aa(z.TaskExtensions.Wd([la,jb,ra],this.$.la),()=>{this.lineageTaskPane=la.result;sb.a.Ad(this.$)||jb.result.uQ(this.lineageTaskPane);this.$ri(ib.c(ra.result.Zn.loadScript("cellLineage")))},this.$.la,3)}static ka(la){la.da.Ga(367,new sc(la))}}Object(b.a)(sc,"LineageManagerFactory",f.a,[]);var yc=a(784),cd=a(222),pd=a(13),Rb=a(108),
Dc=a(259),nd=a(85),od=a(235),wd=a(19),Pc=a(700);const Hb=Ca.a.zyc+"LineageActivityPaneTitle",Nc=Ca.a.Idb+"LineageActivityCloseButton";class Db extends od.a{constructor(la,jb,ra){super(la);this.aEb=this.wye=this.he=null;this.lod=!0;this.su=0;this.Cp=!1;this.Ec=(hb,Eb)=>{Eb.fg||this.Q_c()};this.$j=()=>{this.Q_c();return!0};this.$=jb;this.taskPaneManager=ra;this.$.kk(this.Ec);ea.a(this.$).Xh(this);sb.a.Ad(this.$)&&(this.isVisible=!1)}dP(la){this.get_events().addHandler("LineageTaskPaneRemove",la)}qR(la){this.get_events().removeHandler("LineageTaskPaneRemove",
la)}mE(la){this.addHandler("LineageTaskPaneVisibilityChanged",la)}SF(la){this.removeHandler("LineageTaskPaneVisibilityChanged",la)}aM(la){this.get_events().addHandler("LineageTaskPaneClose",la)}RN(la){this.get_events().removeHandler("LineageTaskPaneClose",la)}get isVisible(){return super.isVisible}set isVisible(la){super.isVisible!==la&&(super.isVisible=la,this.raiseEvent("LineageTaskPaneVisibilityChanged"))}get Efc(){return this.lod}get kf(){return this.isVisible}get Yg(){return 15}get $d(){return R.a.vri}get Tk(){return wd.a.eth}get RM(){return Kb.a.instance.ga(1075)}get wo(){return 300}get isResizable(){return!1}get mc(){return this.domElement}get height(){return this.taskPaneManager.oO.offsetHeight}get titleText(){return Kb.a.instance.ga(1296)}get GB(){return this.taskPaneManager.rua(this.mc,
this.titleText,this.wo,this.isResizable,()=>{this.isVisible=!0;this.aEb?this.aEb():e.ULS.shipAssertTag(537155462,0,!1,"OnLineagePaneOpened callback not set.")},()=>{this.isVisible=!1},()=>{this.isVisible=!0},()=>{this.isVisible=!1},this.wo)}BH(){}lp(){return this.Cp}Zr(){return this.Cp}dR(){}mQ(){return!1}lj(){}Nj(){}dispose(){this.$&&(this.$.zl(this.Ec),ea.a(this.$).Nz(this));this.he&&(cd.a.instance.Ba(pd.a.click,this.he,this.$j),Rb.KeyInputManager.instance.Bv(this.he,this.wye));this.he=this.taskPaneManager=
this.$=null;super.dispose()}hg(la,jb){if(!jb){la=oa.DOMElementExtensions.getElementById(this.domElement,"LineagePaneFilterButton");if(!la)return!1;oa.DOMElementExtensions.setFocus(la)}return!jb}kh(la){return oa.DOMElementExtensions.vf(this.mc,la)}ig(la){this.Cp=la;const jb=this.taskPaneManager;if(this.isVisible=la)this.$.frame.Ee.Rj("LineagePane"),this.lod=!1;if(sb.a.Ad(this.$))la?jb.O5("LineageTaskPane",this.GB):jb.hideTaskPane("LineageTaskPane");else{this.taskPaneManager.Pw();const ra=!!this.taskPaneManager.Bg&&
15===this.taskPaneManager.Bg.taskPane.Yg;la&&0<jb.$z.length&&(!ra||jb.isCollapsed)&&jb.VF(this,!0)}this.$.qf()}pM(){var la=this.$.Bb;la=sb.a.Ad(this.$)?this.domElement:document.getElementById(la+Ca.a.ksd);var jb=this.ZG();la.appendChild(jb);jb=Pc.b("div","LineagePaneBodyId","LineageActivityBody");la.appendChild(jb);this.Mqj();return jb}Q_c(){this.$.frame.Ee.Rj(this.$.frame.Ee.RE||Dc.AFrame.hT);this.lod=!0;this.ig(!1);this.raiseEvent("LineageTaskPaneClose")}Lqj(la){this.aEb=la}Mqj(){this.$.frame.Ee.Sj("LineagePane");
const la=this.$.frame.Ee.vi("LineagePane");la.parent=Dc.AFrame.hT;la.dN=!0}ZG(){const la=Pc.b("div","LineagePaneHeaderId","LineageActivityPaneHeader"),jb=Pc.b("h1","LineagePaneTitleId",Hb);jb.innerText=this.titleText;this.he=yc.a.pb("LineagePaneCloseButtonId",Nc,Kb.a.instance.ga(10),"ClosePaneGlyph_16x16x32",!1);this.he.classList.add(d.AFrameworkApplication.isRtl?Ca.a.V$:Ca.a.W$);cd.a.instance.ra(pd.a.click,this.he,this.$j);this.wye=Rb.KeyInputManager.instance.ms(this.he,this.$j,nd.a.$h);la.appendChild(jb);
la.appendChild(this.he);return la}static ka(la,jb){const ra=la.Bb;let hb=document.getElementById(ra+Ca.a.ksd);hb||(hb=document.createElement("div"),hb.id=la.Bb+Ca.a.ksd,hb.classList.add("LineageActivityPane"),sb.a.Ad(la)||document.getElementById(ra+Ca.a.WQ).appendChild(hb));return la.da.za(365)||la.da.Ga(365,new Db(hb,la,jb))}}Object(b.a)(Db,"LineageTaskPane",od.a,[428,2,401,102]);class Cc extends f.a{constructor(la){super();this.eh=this.ri=null;this.$=la;this.Fb()}get pD(){this.ri||(this.ri=z.TaskExtensions.Aa(fb.a(this.$),
la=>{this.eh=Db.ka(this.$,la.result)},this.la,3));return this.ri}create(){const la=B.GetServiceTaskFactory.create(this.$.da,203,this.la,this.hb),jb=B.GetServiceTaskFactory.create(this.$.da,155,this.la,this.hb);z.TaskExtensions.Aa(z.TaskExtensions.ts(z.TaskExtensions.Wd([la,jb],this.la),()=>this.pD,this.la),()=>{this.qb(this.eh)},this.la,3)}dispose(){this.eh=this.ri=this.$=null;super.dispose()}static ka(la){la.da.Ga(364,new Cc(la))}}Object(b.a)(Cc,"LineageTaskPaneFactory",f.a,[]);class Xc{constructor(la,
jb){this.Rod=!1;this.Uf=()=>{this.q$f()};this.$=la;W.EwaSettings.ma(604)&&this.$.ea.I7a&&!Xc.twb&&(jb&&!jb.gdb||this.zVj(),Xc.C5e?e.ULS.sendTraceTag(537155461,0,50,"LineageTeachingCalloutTriggerManager will not trigger WYWA waterline check as it was already checked in session"):jb&&!jb.gdb||this.GVj());e.ULS.sendTraceTag(537155460,0,50,"LineageTeachingCalloutTriggerManager is initialized.")}dispose(){this.MHd();this.$=null;e.ULS.sendTraceTag(537155459,0,50,"LineageTeachingCalloutTriggerManager is disposed.")}disable(){Xc.twb||
(Xc.twb=!0,e.ULS.sendTraceTag(578557781,0,50,"LineageTeachingCalloutTriggerManager.Disable as the pane was opened."));this.MHd()}GVj(){W.EwaSettings.ma(600)&&!this.$.isAnonymousUser()&&Xa.i(this.$.oa.va,la=>{this.$?(la=la.Result,e.ULS.sendTraceTag(578557780,0,50,`CheckLineageWywaChanges service call succeeded, hasnewchanges = ${la}.`),Xc.C5e=!0,la&&this.f$f(0)):e.ULS.sendTraceTag(537155458,0,50,"LineageTeachingCalloutTriggerManager.VerifyWaterlineTrigger ignoring server response as class is disposed.")},
()=>{e.ULS.sendTraceTag(537155457,0,10,"CheckLineageWywaChanges service call failed.")},null,null)}zVj(){W.EwaSettings.ma(599)&&!this.q$f()&&(this.$.ea.Lu(this.Uf),this.Rod=!0)}q$f(){return this.$.ea&&this.$.ea.to&&this.$.ea.to.ShouldTriggerLineageCalloutOnMerge?(e.ULS.sendTraceTag(578557778,0,50,"LineageTeachingCalloutTriggerManager.TriggerLineageCalloutOnMerge"),this.f$f(1),!0):!1}f$f(la){Xc.twb?e.ULS.sendTraceTag(537155456,0,50,"LineageTeachingCalloutTriggerManager.TriggerCallout Will not trigger dialog as it was already shown in session"):
(Xc.twb=!0,e.ULS.sendTraceTag(578557776,0,50,`LineageTeachingCalloutTriggerManager.TriggerCallout triggering callout due to reason ${la}.`),this.MHd(),W.EwaSettings.ma(480)&&(la=new L.a(-847286761,Oa.a.Eb,this.$.Mc,0,Ca.a.KV),this.$.Ka.Mb(la,{["CalloutName"]:4})))}MHd(){this.Rod&&(this.Rod=!1,this.$.ea.Hw(this.Uf))}}Xc.twb=!1;Xc.C5e=!1;Object(b.a)(Xc,"LineageTeachingCalloutTriggerManager",null,[425,2]);class ld extends f.a{constructor(la){super();this.$=la;this.Fb()}create(){z.TaskExtensions.Aa(B.GetServiceTaskFactory.Ra(this.$.da,
458,459,this.hb),la=>{const jb=la.result;la=Object(Ya.b)(this.$.da,403,()=>new Xc(this.$,jb));this.qb(la)},this.$.la,3)}static ka(la){la.da.Ga(402,new ld(la))}}Object(b.a)(ld,"LineageTeachingCalloutTriggerManagerFactory",f.a,[]);class Dd extends f.a{constructor(la){super();this.$=la;this.Fb()}create(){z.TaskExtensions.Aa(B.GetServiceTaskFactory.Ra(this.$.da,366,367,0),la=>{this.qb(la.result)},this.$.la,3)}static ka(la){la.da.Ga(500,new Dd(la))}}Object(b.a)(Dd,"LineageBlueDotManagerFactory",f.a,[]);
var Od=a(871),Qd=a(79);class Nd{constructor(la,jb){this.wh=la;this.Gu=jb}iW(la,jb,ra,hb=null){return this.Cgh(la,hb,Eb=>this.wh.umb(Eb,2,ra,jb,void 0,void 0,void 0,void 0,void 0,"2"))}Cgh(la,jb,ra){const hb=!!jb&&""!==jb;let Eb=la;hb&&(Eb=y.a.ZS(la,"perfTag",jb));const fc=new Date;return Od.a.then(ra(Eb),Mc=>{const xd=+new Date-+fc;if(!Mc||!Mc.Ig||!Mc.Ig.data)return Mc;hb&&Mc.Ig.data.request&&this.zmj(Mc.Ig.data.request.getResolvedUrl(),jb,xd);return Mc})}zmj(la,jb,ra){la=this.Gu.ZUh(la);if(la.count&&
(la=Qd.last(la))){const hb={Message:"Request durations for activities calls."};hb.PerfTag=jb;hb.CustomDuration=ra;hb.PerformanceDuration=la.duration;e.ULS.sendTraceTag(592189641,3012,50,JSON.stringify(hb))}}}Object(b.a)(Nd,"CatchUpNetworkingWrapper",null,[198]);var he=a(241);class ve extends he.a{constructor(la,jb){super(la,jb)}daa(){return 6}}Object(b.a)(ve,"GetActivityFeedRequest",he.a,[]);class Td extends he.a{constructor(la,jb,ra,hb,Eb,fc){super(la,jb);this.ItemIds=null;this.ActivityStatesToReset=
this.ActivityStatesToSet=0;this.ResetUnseenCount=!1;this.ItemIds=ra;this.ActivityStatesToSet=hb;this.ActivityStatesToReset=Eb;this.ResetUnseenCount=fc}daa(){return 7}}Object(b.a)(Td,"UpdateActivityFeedStateRequest",he.a,[]);var ke=a(382);class xe{constructor(la,jb,ra){this.Gae=la;this.WBa=jb;this.mCa=ra}getActivityFeed(la){return Od.a.then(this.mCa.execute(new ve(this.WBa(),null),(jb,ra,hb)=>this.Gae.iW(jb,ra,hb,"ActivityFeed"),la),jb=>{if(!jb)return e.ULS.sendTraceTag(572846937,3012,10,"GetActivityFeed: Response is null"),
null;if(!jb.Ig)return e.ULS.sendTraceTag(572846938,3012,10,"GetActivityFeed: Response.Args is null"),null;if(!jb.Ig.data)return e.ULS.sendTraceTag(572846939,3012,10,"GetActivityFeed: Response.Args.Data is null"),null;if(!jb.Ig.data.Vd)return e.ULS.sendTraceTag(572846940,3012,10,"GetActivityFeed: Response.Args.Data.ResponseData is null"),null;jb=ke.a.JHa(jb.Ig.data.Vd);return jb?jb:(e.ULS.sendTraceTag(572846941,3012,10,"GetActivityFeed: Deserialized response is null"),null)})}JPj(la,jb,ra,hb){return Od.a.then(this.mCa.execute(new Td(this.WBa(),
null,la,jb,ra,hb),(Eb,fc,Mc)=>this.Gae.iW(Eb,fc,Mc,"UpdateActivityFeedState"),null),Eb=>{try{return Eb.succeeded}catch(fc){return e.ULS.sendTraceTag(523121054,3012,10,"UpdateActivityFeed: Exception: "+fc.message),!1}})}}Object(b.a)(xe,"CatchUpRequestHandler",null,[199]);var le=a(463);class Je{constructor(la){this.Ifa=la;this.v$d=new le.a}fti(){this.Tti()}Tti(){if(this.Ifa){var la=jb=>{this.v$d.contains("CatchUpChangesFeedback")||(this.v$d.add("CatchUpChangesFeedback"),jb.logActivity("CatchUpChangesFeedback",
null))};this.Ifa.execute(jb=>{window.setTimeout(()=>{la(jb)},2E4)})}else e.ULS.sendTraceTag(571586199,383,15,"FloodgateEventLogger: IFuture<ISystemInitiatedFeedback> was null")}}Object(b.a)(Je,"FloodgateEventLogger",null,[]);var Fe=a(185);class eb{constructor(la){this.ltg=la}get duration(){return this.ltg.duration}}Object(b.a)(eb,"PerformanceResourceTimingWrapper",null,[]);class Xb{constructor(la){this.Gu=la}ZUh(la){const jb=new Fe.a;if(!this.Gu)return jb;la=this.Gu.getEntriesByName(la,"resource");
if(!la)return jb;for(const ra of la)jb.add(new eb(ra));return jb}}Object(b.a)(Xb,"PerformanceWrapper",null,[]);var oc=a(246);class Gc{constructor(){this.fb=null}get name(){return"Common.App.CatchUpActivity"}Rh(la){this.fb=la;this.fb.register(Nd,"Common.App.CatchUpActivity.CatchUpNetworkingWrapper").as("Common.App.CatchUpActivity.ICatchUpNetworkingWrapper").tc().Fc(()=>new Nd(d.AFrameworkApplication.vd,new Xb(window.performance)));this.fb.register(xe,"Common.App.CatchUpActivity.CatchUpRequestHandler").as("Common.App.CatchUpActivity.ICatchUpRequestHandler").tc().Fc(()=>
new xe(this.fb.resolve("Common.App.CatchUpActivity.ICatchUpNetworkingWrapper"),()=>d.AFrameworkApplication.ij,new ke.a));this.fb.register(Je,"Common.App.CatchUpActivity.FloodgateEventLogger").tc().Fc(()=>new Je(this.fb.Wb("Common.ISystemInitiatedFeedback")))}init(){this.fb.resolve("Common.App.CatchUpActivity.ICatchUpNetworkingWrapper");this.fb.resolve("Common.App.CatchUpActivity.ICatchUpRequestHandler")}dispose(){}static main(){oc.a.instance.yi(new Gc)}}Object(b.a)(Gc,"CatchUpActivityPackage",null,
[4,5]);class Vc{constructor(la,jb){this.$=la;this.catchUpActivityManager=jb}Nc(la,jb){return this.catchUpActivityManager?-876699925===jb?!this.catchUpActivityManager.Paf:!1:!0}executeCommand(la,jb){la=!1;switch(jb.command){case -876699925:la=this.catchUpActivityManager.vSi()}return la?F.Task.Ta(!0):A.a(jb.command)}Cc(la,jb){return W.EwaSettings.ma(435)&&-876699925===jb.command?!0:!1}Rc(){return!1}}Object(b.a)(Vc,"CatchUpActivityCommandHandler",null,[195]);class P extends x.a{constructor(la){super(la)}yd(){this.$.da.Za(286,
la=>{this.gd([new Vc(this.$,la)])})}static ka(la){x.a.Nd(285,new P(la))}}Object(b.a)(P,"CatchUpActivityCommandHandlerFactory",x.a,[]);var Ta=a(262),pb=a(516),Yb=a(86),Ac=a(84),Zc=a(25);class id{constructor(la){this.ai=la}doesContentExist(la){if(!la)return e.ULS.sendTraceTag(537168066,3012,10,"Null activity: DoesContentExist. Default to false."),!1;switch(la.type){case 2:case 3:case 4:case 6:case 8:case 9:case 7:case 10:if(!la.navigationId)return e.ULS.sendTraceTag(537168065,3012,10,"Null activity.NavigationId: DoesContentExist. Default to false."),
!1;const jb={};jb.NavigationId=atob(la.navigationId);return 32===this.ai.de(Zc.a.YHa,2,jb);default:return!1}}}Object(b.a)(id,"CatchUpActivityContentManager",null,[482]);var gd=a(817),Ub=a(1229);class Lc{constructor(la){this.XDb=()=>{switch(this.fv.model.state){case 1:this.h3f(!0);break;case 0:this.pLb(!1);break;case 2:case 3:this.pLb(!0);break;default:e.ULS.shipAssertTag(537167968,0,!1,"RangeCatchUpActivityView.OnHighlightStateChanged - Invalid CatchUpActivityHighlightState:"+this.fv.model.state)}};
this.Cpg=la;this.fv.Kle(this.XDb);this.kz=[]}get fv(){return this.Cpg}dispose(){this.fv.mPf(this.XDb);this.kz=null}jqj(la){this.kz.push(la)}SXg(){this.kz.length=0}h3f(la){for(const jb of this.kz){jb.className=gd.a.NUg;const ra=document.getElementById(`${jb.id}-${Ca.a.Yve}`);oa.DOMElementExtensions.setVisible(ra,la)}}pLb(la){for(const jb of this.kz)jb&&(la?jb.className=2===this.fv.model.state?gd.a.I3i:gd.a.J3i:this.h3f(!1))}}Object(b.a)(Lc,"RangeCatchUpActivityView",null,[576,2]);var hd=a(22);class Kd extends Ub.a{constructor(la,
jb,ra){super(la,jb,ra);this.gridView=va.g(la);this.dma=jb}dispose(){this.gridView=null;super.dispose()}$Cg(la){const jb=this.mfb[0];jb?jb.jqj(la):e.ULS.shipAssertTag(537168004,0,!1,"RangeCatchUpActivityHighlightController.AddViewElement - RangeCatchUpActivityView is null for activityId"+this.dma.activityId)}Mfj(){const la=this.mfb[0];la&&la.SXg()}iBg(la){this.dma.addRange(la)}cKh(){if(3!==this.dma.activityType)return null;e.ULS.shipAssertTag(537168003,0,1===this.dma.MLb.length,"RangeCatchUpActivityHighlightController::GetCommentActivityRange Range Information Length should be 1.");
return Ob.D(this.dma.MLb[0])}tJb(la){if(la){if(!this.dma)return;this.owd(this.Vgj())}super.tJb(la)}u3c(){const la=this.a3c();this.mfb.push(la)}a3c(){return new Lc(this)}owd(la){la?la.SheetName?(this.gridView.ha.Pa.dH(null),this.gridView.focus(),this.gridView.B3e(la,3,!1,nb.a.H3i)):e.ULS.shipAssertTag(537168E3,0,!1,"RangeCatchUpActivityHighlightController.NavigateToRange: SheetName in the range is null."):e.ULS.shipAssertTag(537168001,0,!1,"RangeCatchUpActivityHighlightController.NavigateToRange: Range is null. Either the location list is empty or sheet is hidden.")}Vgj(){if(Jb.e(this.dma.MLb))return e.ULS.shipAssertTag(537167971,
0,!1,"RangeCatchUpActivityHighlightController.RetrieveRangeInformationForNavigation : SortedRanges is either null or empty."),null;var la=this.$.xa.pa;e.ULS.shipAssertTag(537167970,0,!!la,"RangeCatchUpActivityHighlightController.RetrieveRangeInformationForNavigation : currentSheet is null.");la=this.zMj(la.sheetName,this.dma.MLb);if(!la&&(la=this.LZh(this.dma.MLb),!la))return null;const jb={};jb.SheetName=la.SheetName;jb.FirstColumn=la.FirstColumn;jb.FirstRow=la.FirstRow;jb.LastColumn=la.FirstColumn;
jb.LastRow=la.FirstRow;return jb}LZh(la){if(Jb.e(la))return null;let jb=null;for(let hb=0;hb<la.length;hb++){var ra=la[hb].SheetName;if(!hd.a.equals(ra,jb,!1)&&(jb=ra,ra=this.$.xa.getItemByName(ra),null===ra||void 0===ra?0:ra.visible))return la[hb]}return null}zMj(la,jb){if(jb)for(const ra of jb)if(hd.a.equals(ra.SheetName,la,!1))return ra;return null}}Object(b.a)(Kd,"RangeCatchUpActivityHighlightController",Ub.a,[]);var Wd=a(78);class oe extends Wd.a{constructor(la,jb,ra,hb){super();this.$=la;this.r0d=
jb;this.Ujg=ra;this.cC=hb;this.state=0}get type(){return this.cC}get activityId(){return this.r0d}get activityType(){return this.Ujg}dispose(){this.r0d=null;super.dispose()}}Object(b.a)(oe,"CatchUpActivityHighlightModelBase",Wd.a,[]);class We extends oe{constructor(la,jb,ra,hb,Eb){super(la,jb,ra,hb);this.ranges=Eb;this.O6a=!1}get MLb(){this.O6a||(this.ranges.sort(We.Y1b),this.O6a=!0);return this.ranges}addRange(la){for(const jb of la)this.ranges.push(jb)}dispose(){this.ranges=null;super.dispose()}static Y1b(la,
jb){if(!la.SheetName||!jb.SheetName)return e.ULS.shipAssertTag(537167969,0,!1,"RangeCatchUpActivityHighlightModel.CompareSharedSheetRange : SheetName is null."),0;const ra=la.SheetName.localeCompare(jb.SheetName);return ra?ra:la.FirstColumn<jb.FirstColumn||la.FirstColumn===jb.FirstColumn&&la.FirstRow<jb.FirstRow?-1:la.FirstColumn===jb.FirstColumn&&la.FirstRow===jb.FirstRow?0:1}}Object(b.a)(We,"RangeCatchUpActivityHighlightModel",oe,[]);var Ze=a(338);class Be{constructor(){this.O0c=[];this.JKb={};
this.rje={}}dispose(){this.rje=this.JKb=this.O0c=null}Rcj(la){va.g(la).lb.zn([24])}W4g(la,jb,ra){const hb={};for(const fc of jb){if(!fc||Jb.e(fc.LocationList))continue;jb=[];const Mc={},xd=[];for(const Hd of fc.LocationList){if(!Hd){e.ULS.shipAssertTag(537168013,0,!1,"CatchUpActivityHighlightManagerHelper.CreateControllersAndHighlights - Location is Null for activityId : "+fc.Id);break}switch(Hd.Type){case 0:var Eb=Hd;let Md;"0"in Mc?(Md=Mc["0"],Md.iBg(Eb.RangeList)):(Md=new Kd(la,new We(la,fc.Id,
fc.Type,0,Eb.RangeList),ra),jb.push(Md),Mc["0"]=Md);for(const ae of Eb.RangeList){Eb=new Ze.a(Ob.D(ae),vb.d(la.xa.getItemByName(ae.SheetName)));if(this.Ivc(Eb)in this.JKb)this.JKb[this.Ivc(Eb)].push(Md);else{let me=[];me.push(Md);this.JKb[this.Ivc(Eb)]=me}xd.push(Eb);this.O0c.push(Eb)}break;default:e.ULS.sendTraceTag(537168012,0,10,"CatchUpHighlightControllersCreator.CreateControllersAndHighlights(): Failed.Invalid ActivityLocationType")}}e.ULS.shipAssertTag(537168011,0,!(fc.Id in hb),"CatchUpHighlightControllersCreator.CreateAndUpdateControllers - highlightControllers already has activity: "+
fc.Id);this.rje[fc.Id]=xd;hb[fc.Id]=jb}this.p6g(la,this.O0c,this.JKb);return hb}KXg(la){for(let jb in la){const ra=la[jb];for(const hb of ra)hb.Mfj()}}Ivc(la){return`${la.range}-${la.sheetId}`}p6g(la,jb,ra){this.KXg(ra);va.g(la).lb.vv(jb,[24],!0,(hb,Eb)=>{var fc=new Ze.a(hb.range,hb.sheetId);fc=this.Ivc(fc);const Mc=ra[fc];if(Mc)for(const xd of Mc)xd.$Cg(Eb),hb.metadata=xd;else e.ULS.shipAssertTag(537168010,0,!1,"CatchUpHighlightControllersCreator.CreateHighlightsAndUpdateControllers(), Missing Controller for SheetRangeKey "+
fc)})}}Object(b.a)(Be,"CatchUpHighlightControllersCreator",null,[]);class af{constructor(){this.activityIds=this.container=this.target=null;this.isSticky=!1;this.dirHint=0}}Object(b.a)(af,"CreateIndicatorTooltipParameters",null,[]);class ff{constructor(){this.clearSticky=!1}}Object(b.a)(ff,"DismissIndicatorTooltipParameters",null,[]);class Pe{constructor(){this.target=null;this.isSticky=!1}}Object(b.a)(Pe,"UpdateIndicatorTooltipParameters",null,[]);class Ne{constructor(la){this.IQa=this.J2b=this.qea=
null;this.R3={};this.KCa=null;this.Gid=!1;this.XDb=(jb,ra)=>{switch(ra.state){case 0:case 1:3===ra.fEd&&(this.j5h(),this.IQa=null);break;case 2:break;case 3:this.a5c();this.IQa=ra.activityId;this.Tyj();break;default:e.ULS.shipAssertTag(537168030,0,!1,"CatchUpActivityHighlightManager.OnHighlightStateChanged - Invalid CatchUpActivityHighlightState:"+ra.state)}};this.Ql=()=>{this.zrb()};this.Vc=()=>{this.zrb()};this.sn=()=>{this.zrb()};this.nh=()=>{this.zrb()};this.h2f=(jb,ra)=>{this.qea&&ra.zH!==this.Bja&&
(ra.isSticky&&this.s5b(!0),(jb=this.PMj(ra.zH))?(this.qea.createActivityIndicatorTooltip(Object(X.a)(new af,{target:ra.zH,container:jb,activityIds:[ra.activityId],isSticky:ra.isSticky,dirHint:this.gridView.rtl?12:9})),ra.isSticky?(this.Bja=ra.zH,e.ULS.sendTraceTag(51172352,0,50,"CatchUpActivityHighlightManager::ShowActivityFlyoutHandler: Activity Indicator Raising Selected/Unselected Event.")):(this.Hcc=ra.zH,e.ULS.sendTraceTag(51172353,0,50,"CatchUpActivityHighlightManager::ShowActivityFlyoutHandler: Activity Indicator Raising Hover/Unhover Event.")),
this.ffc||(this.gridView.view.Ls(this.fAc),this.gridView.Ku(this.fAc),this.ffc=!0)):e.ULS.shipAssertTag(537168027,0,!1,"CatchUpActivityHighlightManager::ShowActivityFlyoutHandler FlyoutContainer is null."))};this.bHe=(jb,ra)=>{this.s5b(ra.kfh)};this.fAc=()=>{this.qea?(this.Bja&&this.qea.updateActivityIndicatorTooltip(Object(X.a)(new Pe,{target:this.Bja,isSticky:!0})),this.Hcc&&this.qea.updateActivityIndicatorTooltip(Object(X.a)(new Pe,{target:this.Bja,isSticky:!1}))):e.ULS.shipAssertTag(537168024,
0,!1,"CatchUpActivityHighlightManager::UpdateActivityFlyouts ActivityIndicatorTooltipManager is null.")};this.$=la;this.gridView=va.g(this.$);this.ha=this.gridView.ha;this.Ya=this.gridView.Xb;this.ha.dYb(this.Ql);this.ha.NG(this.Vc);this.gridView.hC(this.sn);this.Ya.Nk(this.nh);this.Bja=this.Hcc=null;this.ffc=!1;this.Y$c={}}get sje(){return this.qea}set sje(la){this.qea=la}get excelCommentManager(){this.KCa||(this.KCa=this.$.da.za(65));return this.KCa}get lqb(){this.J2b||(this.J2b=new Be);return this.J2b}set lqb(la){this.J2b=
la}dispose(){this.ha.orc(this.Ql);this.ha.RF(this.Vc);this.gridView.AD(this.sn);this.Ya.tk(this.nh);this.kGe();this.Y$c=this.Bja=this.Hcc=this.IQa=this.Ya=this.ha=this.gridView=null}Onj(la){this.kGe();if(!Jb.e(la)){e.ULS.sendTraceTag(537168035,0,50,"In CatchUpActivityHighlightManager:ProcessActivityPayloadHighlights().");if(this.R3=this.lqb.W4g(this.$,la,this)){la=this.R3;for(let jb in la){const ra=la[jb];for(const hb of ra)this.yLg(hb)}}this.lqb.Rcj(this.$)}}Iwc(la){if(la&&this.Gid)e.ULS.shipAssertTag(537168034,
0,!1,"CatchUpActivityHighlightManager.ShowOrHideAllHighlights - Trying to show all highlights when marked as read");else if(la||this.zrb(),this.R3){const jb=this.R3;for(let ra in jb){const hb=jb[ra];for(const Eb of hb)Eb.oAj(la)}}}V5h(la){this.Bja&&this.s5b(!0);this.a5c();if(la=this.R3[la.activityId])for(const jb of la)jb.tJb(!0);else e.ULS.sendTraceTag(537168032,0,50,"CatchUpActivityHighlightManager.OnSelectHighlight - Controllers not found during select")}kGe(){if(this.R3){const la=this.R3;for(let jb in la){const ra=
la[jb];for(const hb of ra)this.J9i(hb),hb.dispose()}}this.R3={};this.lqb.dispose();this.lqb=null}Tyj(){if(this.excelCommentManager){var la=this.R3[this.IQa];la&&0<la.length&&3===la[0].model.activityType&&((la=la[0])?this.excelCommentManager.vzj(la.cKh()):e.ULS.shipAssertTag(537168029,0,!1,"RangeCatchUpActivityHighlightController::ShowCommentFlyoutOnSelectedActivity RangeController is Null."))}}j5h(){this.excelCommentManager&&this.excelCommentManager.vsb()}a5c(){if(this.IQa){const la=this.R3[this.IQa];
if(la){for(const jb of la)jb.tJb(!1);this.IQa=null}else e.ULS.sendTraceTag(537168028,0,50,"CatchUpActivityHighlightManager.DeselectCurrentlySelected - Controllers not found for deselection")}}zrb(){this.a5c();this.s5b(!0)}PMj(la){if(!la)return e.ULS.shipAssertTag(537168026,0,!1,"CatchUpActivityHighlightManager::TryGetFlyoutContainer HighlightDot is null."),null;la=`${la.id}-${Ca.a.LUg}`;let jb=this.Y$c[la];if(!jb){if(!this.gridView.domElement)return e.ULS.shipAssertTag(537168025,0,!1,"CatchUpActivityHighlightManager::TryGetFlyoutContainer gridView.DOMElement is null."),
null;jb=document.createElement("Div");jb.className=gd.a.MUg;jb.id=la;this.gridView.domElement.appendChild(jb);this.Y$c[la]=jb}return jb}s5b(la){this.qea&&(this.qea.dismissActivityIndicatorTooltips(Object(X.a)(new ff,{clearSticky:la})),this.Hcc=null,la&&(this.Bja=null),this.ffc&&!this.Bja&&(this.gridView.view.Pq(this.fAc),this.gridView.py(this.fAc),this.ffc=!1))}yLg(la){la.Kle(this.XDb);la.DDg(this.h2f);la.CDg(this.bHe)}J9i(la){la.mPf(this.XDb);la.S$i(this.h2f);la.R$i(this.bHe)}}Object(b.a)(Ne,"CatchUpActivityHighlightManager",
null,[495,2]);class se{constructor(la,jb){this.$=la;this.ai=jb}navigateToActivity(la){if(la.fromSummaryString){var jb=new L.a(1834994092,Oa.a.Eb,this.$.Mc,18,null);this.$.Ka.Mb(jb);return this.QTa(1)}la=la.activity;if(!this.mdi(la))return this.QTa(4);if(!this.omi(la))return this.QTa(7);const ra={};try{jb=window.self.atob(la.navigationId);if(!jb)return this.QTa(5);ra.NavigationId=jb}catch(hb){return e.ULS.sendTraceTag(537168023,3012,10,`Exception thrown when trying to decode activity NavigationID: ${hb}`),
this.QTa(5)}if(8===this.ai.de(Zc.a.YHa,2,ra))return this.ai.processAction(Zc.a.M8a,2),this.QTa(2);jb=32===this.ai.de(Zc.a.K_a,2,ra)?1:6;return this.QTa(jb)}mdi(la){return la&&la.navigationId?!0:!1}omi(la){switch(la.type){case 3:case 4:case 6:case 7:case 9:case 8:return!0;default:return!1}}QTa(la){return Promise.resolve(la)}}Object(b.a)(se,"CatchUpActivityNavigationManager",null,[483]);var Wa=a(440);class Sb{}Object(b.a)(Sb,"GetRelevantActivitiesDataRequest",null,[]);class wc{constructor(){this.activityFeedItemId=
this.activityId=null;this.type=0;this.collectionId=this.state=this.navigationId=this.relevancy=this.displayTimestamp=this.location=this.actors=null}}Object(b.a)(wc,"Activity",null,[]);class Uc{constructor(){this.collectionId=this.type=this.id=null;this.activityState=0;this.timestamp=this.activityFeedItemPayload=null}}Object(b.a)(Uc,"ActivityFeedItem",null,[]);class ob{constructor(){this.activityFeedItems=null}}Object(b.a)(ob,"ActivityFeedPayload",null,[]);class Zb{constructor(){this.lowWaterline=
this.highWaterline=this.wywaWaterline=this.actors=this.activities=null;this.hasMore=!1;this.isFirstDocumentOpen=null}}Object(b.a)(Zb,"ActivityRequestPayload",null,[]);class Bc{constructor(){this.color=this.imageUrl=this.email=this.givenName=this.displayName=this.provider=this.id=null}}Object(b.a)(Bc,"Person",null,[]);class bd extends wc{constructor(){super();this.relationship=0}}Object(b.a)(bd,"TaskActivity",wc,[]);const Ed=(la,jb,ra,hb,Eb,fc=null)=>{fc=la.Na(1,fc);return Xa.g(la,"GetLineageWywaAuthors",
fc,jb,ra,hb,Eb,4)},ge=(la,jb,ra,hb,Eb,fc,Mc=null)=>{Mc=la.Na(1,Mc);Mc.getRelevantActivitiesDataRequest=jb;return Xa.g(la,"GetRelevantActivitiesData",Mc,ra,hb,Eb,fc,0)};class be{constructor(la,jb,ra=!1){this.leg=null;this.$=la;this.B0b=jb;this.BFb=ab.a.instance.resolve("Common.App.People.IPeopleColorUtils");this.Dpc=ab.a.instance.resolve("Common.App.People.IUserProfilePictureUtils");this.$5a=ra}requestWYWAActivities(){return this.$5a?new Promise((la,jb)=>{Ed(this.$.oa.va,ra=>{var hb;const Eb=Lb.a(ra)?
null:ra.Result;W.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)?(ra=null===(hb=null===Eb||void 0===Eb?void 0:Eb.WywaAuthors)||void 0===hb?void 0:hb.length,null!=ra&&0<ra&&z.TaskExtensions.Aa(B.GetServiceTaskFactory.Ra(this.$.da,501,500,0),fc=>{fc.result.Pzj().then(Mc=>{const xd=Mc.map(Hd=>({activityId:Hd.activityGuid,activityFeedItemId:null,type:1,actors:[{id:Hd.author.id,provider:Hd.author.provider,displayName:Hd.author.displayName,givenName:null,email:Hd.author.email,imageUrl:Hd.author.imageUrl,
color:null}],location:null,displayTimestamp:Hd.displayTimestamp,relevancy:null,navigationId:null,state:0,collectionId:null}));this.leg=Mc.map(Hd=>{const Md=Hd.rangeHighlightLocation.rangeList.map(ae=>({Type:0,RangeList:[{SheetName:Hd.sheetName,FirstRow:ae.firstRow,LastRow:ae.lastRow,FirstColumn:ae.firstCol,LastColumn:ae.lastCol}]}));return{Id:Hd.activityGuid,Type:null,Person:null,DisplayTimestamp:null,LocationList:Md}});Mc={activities:xd,actors:Eb?this.uac(Eb.WywaAuthors):null,hasMore:!1,highWaterline:be.Fha,
lowWaterline:be.Fha,wywaWaterline:be.Fha};la(Mc)},()=>{})},this.$.la,3)):(hb=Object(X.a)(new Zb,{activities:[],actors:Eb?this.uac(Eb.WywaAuthors):null,hasMore:!1,highWaterline:be.Fha,lowWaterline:be.Fha,wywaWaterline:be.Fha}),la(hb))},()=>{e.ULS.sendTraceTag(537168022,0,10,"CatchUpActivityRequestManager::GetLineageWywaAuthors service call failed.");jb(null)},null,null)}):Promise.resolve(be.K4b)}requestActivities(){return Promise.resolve(be.K4b)}requestRelevantActivities(){if(!this.$.ea.fc||this.$.ea.A4a)return e.ULS.sendTraceTag(537168021,
3012,15,`CatchUpActivityRequestManager.RequestRelevantActivities: RequestRelevantActivities skipped [IsSessionActive: ${this.$.ea.fc}, HasRaisedSessionEnded: ${this.$.ea.A4a}]`),Promise.resolve(be.K4b);const la=Object(X.a)(new Sb,{SetDaysBack:d.AFrameworkApplication.fa.nd("AppWaterlineOverrideDaysValue",0),SetTimestamp:d.AFrameworkApplication.fa.nd("AppWaterlineOverrideTimestampValue",0)});return new Promise((jb,ra)=>{ge(this.$.oa.va,la,hb=>{let Eb=be.K4b;hb?Lb.a(hb)?(hb=V.a.yc(hb.Errors),e.ULS.sendTraceTag(578353159,
3012,10,`CatchUpActivityRequestManager::GetRelevantActivitiesData call returned errors codes: ${hb}`)):Eb=this.EUh(hb.Result):e.ULS.sendTraceTag(537168020,3012,10,"CatchUpActivityRequestManager::GetRelevantActivitiesData call returned Null result.");jb(Eb)},hb=>{hb=Pb.a.lf(hb.data);hb=V.a.yc(hb);e.ULS.sendTraceTag(537168019,3012,10,`CatchUpActivityRequestManager::GetRelevantActivitiesData call has failed - Errors: [${hb}]`);ra(null)},null,null)})}requestActivityFeed(){return ib.b(this.getActivityFeed()).then(la=>
Object(X.a)(new ob,{activityFeedItems:this.kLj(la)}))}updateActivityState(la){return W.EwaSettings.ma(451)?Promise.resolve(!0):this.B0b?ib.b(this.B0b).then(jb=>{var ra,hb;return ib.b(jb.JPj(la.itemIds,null!==(ra=la.activityStatesToSet)&&void 0!==ra?ra:0,null!==(hb=la.activityStatesToReset)&&void 0!==hb?hb:0,la.resetUnseenCount))}):Promise.resolve(!1)}getActivityFeed(){return this.B0b?Od.a.CUd(this.B0b,la=>la.getActivityFeed(null)):F.Task.Ta([])}EUh(la){if(!la)return e.ULS.sendTraceTag(537168018,3012,
10,"CatchUpActivityRequestManager::GetRelevantActivityRequestPayload response is null."),Object(X.a)(new Zb,{activities:[]});const jb=this.a$f(la.NewActivities,2);la=this.a$f(la.OutstandingActivities,3);for(const ra of la)jb.push(ra);return Object(X.a)(new Zb,{activities:jb})}a$f(la,jb=1){const ra=[];if(!la||!la.length)return ra;for(const hb of la)hb?(la=be.rLj(hb.Type),6===la||7===la||9===la||8===la?ra.push(Object(X.a)(new bd,{activityId:hb.Id,type:la,displayTimestamp:new Date(hb.DisplayTimestamp),
navigationId:hb.NavigationId,actors:this.uac(hb.People),relevancy:jb,relationship:this.qLj(hb.Relationship)})):ra.push(Object(X.a)(new wc,{activityId:hb.Id,type:la,displayTimestamp:new Date(hb.DisplayTimestamp),navigationId:hb.NavigationId,actors:this.uac(hb.People),relevancy:jb}))):e.ULS.shipAssertTag(537168017,3012,!1,"CatchUpActivityRequestManager.TranslateRelevantActivitiesToActivities: relevantActivity is null");return ra}qLj(la){switch(la){case 1:return 1;case 2:return 2;case 3:return 3}e.ULS.sendTraceTag(537168016,
0,10,"Unexpected Relationship.");return 1}kLj(la){const jb=[];for(const ra of la)la=Object(X.a)(new Uc,{id:ra.id,type:ra.type,collectionId:ra.collectionId,activityState:ra.activityState,activityFeedItemPayload:ra.activityFeedItemPayload,timestamp:ra.timestamp}),jb.push(la);return jb}uac(la){const jb=[];if(!la||!la.length)return jb;for(const ra of la)ra&&jb.push(this.pvb(ra));return jb}pvb(la){return Object(X.a)(new Bc,{id:la.Id,provider:la.Provider,displayName:la.DisplayName,email:la.Email,imageUrl:this.Dpc.nHa(la.Email,
la.Provider,d.AFrameworkApplication.ij,0),color:this.BFb.Wfd(new Wa.a(null,void 0,la.DisplayName),6)})}static rLj(la){switch(la){case 1:return 3;case 2:return 4;case 3:return 6;case 4:return 7;case 6:return 8;case 5:return 9;case 7:return 10;default:return e.ULS.shipAssertTag(537168015,3012,!1,"CatchUpActivityRequestManager.TranslateRelevantActivityTypeToActivityType: unknown RelevantActivityType"),1}}}be.Fha="<WywaWaterline>DefaultWaterline</WywaWaterline>";be.K4b=Object(X.a)(new Zb,{activities:[],
actors:[],hasMore:!1,highWaterline:be.Fha,lowWaterline:be.Fha,wywaWaterline:be.Fha});Object(b.a)(be,"CatchUpActivityRequestManager",null,[484]);class qe{constructor(la){this.$=la}shouldShowEmptyExperienceButton(){return this.$.ea.I7a?!0:!1}onButtonClick(){const la={["InputMethod"]:Oa.a.Eb};this.$.Ka.Mb(new L.a(1834994092,Oa.a.Eb,this.$.Mc,16,null),la)}getExplanationText(){const la=this.$.da.za(365);return Kb.a.instance.Xa(la&&la.isVisible?650:649)}getCommandName(){return Kb.a.instance.ga(448)}}Object(b.a)(qe,
"CatchUpEmptyExperienceBehaviorManager",null,[485]);const ze=la=>{window.performance&&"function"===typeof window.performance.mark&&window.performance.mark("CatchUpInit."+la)};class Ce{constructor(la,jb=null){this.$=la;this.flyoutRibbonButton=jb;ea.a(this.$).Xh(this);this.hasFocus=!1}dispose(){ea.a(this.$).Nz(this)}get mc(){return document.getElementById("catchUpFlyoutContainer")}get kf(){return this.flyoutRibbonButton.Acf&&!this.hasFocus}get $d(){return R.a.hZc}hg(la,jb){if(jb)return!1;la=document.getElementById("flyoutItem0");
if(!la)return e.ULS.sendTraceTag(537168009,3012,10,"Could not find firstItem in flyout when setting up focus"),!1;la.focus();this.pfh(la);return!0}kh(la){return this.mc?oa.DOMElementExtensions.vf(this.mc,la):!1}lj(){this.hasFocus=!0}Nj(){this.hasFocus=!1}pfh(la){if(Sys.Browser.agent===Sys.Browser.Firefox){var jb=document.createEvent("KeyboardEvent");jb.initKeyEvent(pd.a.Kb,!0,!0,window.self,!1,!1,!1,!1,nd.a.vBc,0);la.dispatchEvent(jb)}else jb=document.createEvent("Events"),jb.initEvent(pd.a.Kb,!0,
!0),jb.keyCode=nd.a.vBc,jb.which=nd.a.vBc,la.dispatchEvent(jb)}}Object(b.a)(Ce,"FlyoutFocus",null,[102,2]);var Ve=a(416);class we{constructor(la){this.buttonClickedCallback=null;this.uib=this.zyb=!1;this.CBh=new Date;this.LSe=la}dispose(){this.uib=this.zyb=!1}registerButtonClickedEvent(la){this.buttonClickedCallback&&e.ULS.sendTraceTag(537168008,3012,15,"RegisterButtonClickedEvent: Button clicked callback should only be registered once.");this.buttonClickedCallback=la.buttonClickedCallback}onFlyoutInitialized(){this.zyb&&
e.ULS.sendTraceTag(537168007,3012,15,"OnFlyoutInitialized: Flyout should only be initialized once.");const la=(new Date).getTime()-this.CBh.getTime();e.ULS.sendTraceTag(593601546,3012,50,`Time from retrieve activities to initialize Flyout: ${la}`);l.c(Zc.a.PUg,!0,l.e,0,0,la);this.zyb=!0;Ve.a.fC&&Ve.a.fC.updateCommandUI(!0)}logFlightTriggers(){}toggleCatchUpFlyout(){this.zyb?this.buttonClickedCallback?this.buttonClickedCallback():e.ULS.sendTraceTag(537168005,3012,10,"ToggleCatchUpFlyout: User clicked the button before the buttonClickedCallback was registered."):
e.ULS.sendTraceTag(537168006,3012,10,"ToggleCatchUpFlyout: User clicked the button before the flyout was initialized.")}get Acf(){return this.uib}onFlyoutVisibilityChanged(la){this.uib!==la.flyoutIsVisible&&(this.uib=la.flyoutIsVisible,Ve.a.fC&&Ve.a.fC.updateCommandUI(!0),this.uib||this.LSe&&this.LSe.fti())}}Object(b.a)(we,"FlyoutRibbonButton",null,[494]);var vc=a(520);class ed{constructor(){this.flyoutAnchorTarget=this.useCompactSummaryString=this.disableDismissOnClick=this.customDynamicEntryPointEnabled=
this.dynamicEntryPointEnabled=this.activityFeedDataEnabled=this.includeRelevantAuthorsInSummaryString=this.summaryStringEnabled=this.flyoutEnabled=this.featuredActivityGroupsEnabled=null}}Object(b.a)(ed,"CatchUpConfiguration",null,[]);class Id{constructor(){this.emptyCatchUpBehaviorManager=this.ulsLogger=this.uiCulture=this.flyoutRibbonButton=this.flyoutFocus=this.dataCulture=this.changeSummariesDataProvider=this.appColorUpdateIsEnabled=this.activityRequestManager=this.activityNavigationManager=this.activityContentManager=
null}}Object(b.a)(Id,"SharedControllerFactoryParameters",null,[]);class Ld{constructor(la,jb,ra=null,hb=null){this.rGa=null;this.A5e=!1;this.SDf=Eb=>{W.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)&&!Ta.a.Dh(Eb.wywaActivities)&&2!==Eb.wywaActivities[0].type&&(this.a_a.Onj(this.gZc.leg),this.a_a.Iwc(!0),this.a_a.V5h(Eb.wywaActivities[0]))};this.$=la;this.a_a=new Ne(this.$);this.$1d=new id(d.AFrameworkApplication.wb,W.EwaSettings.ma(451));la=pb.a.RJj(ab.a.instance.Wb("Common.App.CatchUpActivity.ICatchUpRequestHandler"));
this.Njf=hb;this.gZc=new be(this.$,la,this.$5a());this.Zve=new se(this.$,d.AFrameworkApplication.wb);this.emptyCatchUpBehaviorManager=new qe(this.$);this.Mri(Eb=>{this.gGi(Eb)},jb);this.Mti();jb=null;ra||(jb=ab.a.instance.resolve("Common.App.CatchUpActivity.FloodgateEventLogger"));this.flyoutRibbonButton=ra||new we(jb);this.flyoutFocus=new Ce(this.$,this.flyoutRibbonButton)}get Paf(){const la=this.flyoutRibbonButton.zyb;la&&!this.A5e&&(e.ULS.sendTraceTag(588129368,3012,50,"Catch Up Flyout is ready and button is enabled."),
this.A5e=!0);return la}get xei(){return this.flyoutRibbonButton.Acf}dispose(){this.rGa&&this.rGa.getWywaEvent().removeListener(this.SDf);this.rGa=this.$=null;Yb.a.Ia(this.a_a);this.flyoutRibbonButton=this.flyoutFocus=this.$1d=this.Zve=this.gZc=this.a_a=null}vSi(){this.flyoutRibbonButton.toggleCatchUpFlyout();return!0}Mti(){e.ULS.sendTraceTag(589608192,3012,50,"Catch Up script is loaded and Flyout is enabled.");this.laf()&&e.ULS.sendTraceTag(526718752,3012,50,"ActivityFeedData is enabled")}Mri(la,
jb){ze("ScriptDownload");z.TaskExtensions.Aa(B.GetServiceTaskFactory.Ra(this.$.da,283,284,jb),ra=>{la(ib.c(ra.result.Zn.loadScript("catchUpActivity")))},this.$.da.la,3)}$5a(){return!!this.Njf&&this.Njf.$5a()&&this.$.ea.I7a}laf(){return W.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ActivityFeedIsEnabled",!1)}gGi(la){z.TaskExtensions.Aa(la,()=>{fa.a(()=>{this.rGa=catchUpActivity.FactoryGlobal.getExcelCatchUpAppInstance(Object(X.a)(new Id,{activityContentManager:Object(Ac.a)(482,
this.$1d),activityNavigationManager:Object(Ac.a)(483,this.Zve),activityRequestManager:Object(Ac.a)(484,this.gZc),dataCulture:this.$.ya.DataCultureTag,flyoutFocus:null,flyoutRibbonButton:Object(Ac.a)(we,this.flyoutRibbonButton),uiCulture:this.$.ya.UICultureTag,ulsLogger:new D.a,emptyCatchUpBehaviorManager:Object(Ac.a)(485,this.emptyCatchUpBehaviorManager)}))});this.a_a.sje=this.rGa.getActivityIndicatorTooltipManager();vc.a(this.$);this.rGa.getWywaEvent().addListener(this.SDf);ze("InitializeCatchUpApp");
this.rGa.initialize(Object(X.a)(new ed,{featuredActivityGroupsEnabled:!1,summaryStringEnabled:this.$5a(),includeRelevantAuthorsInSummaryString:!1,useCompactSummaryString:!0,activityFeedDataEnabled:this.laf()}))},this.$.la,3)}}Object(b.a)(Ld,"CatchUpActivityManager",null,[486,2]);class ce extends f.a{constructor(la){super();this.$=la;this.Fb()}create(){z.TaskExtensions.Aa(B.GetServiceTaskFactory.Ra(this.$.da,458,459,this.hb),la=>{const jb=la.result;la=Object(Ya.a)(this.$.da,286,()=>new Ld(this.$,this.hb,
null,jb));this.qb(la)},this.$.la,3)}static ka(la){la.da.Ga(287,new ce(la))}}Object(b.a)(ce,"CatchUpActivityManagerFactory",f.a,[]);Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client");Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.Lineage");Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.VersionHistory");Type.registerNamespace("_Ewa");c.a.Fa(wa.ka);c.a.Fa(bb.ka);c.a.Fa(u.ka);c.a.Fa(w.ka);mb.a.Hi('.LineageActivityPane{height:100%;display:flex;flex-direction:column;overflow:hidden;background-color:#edebe9}.LineageActivityPaneHeader{display:flex;flex-direction:row;position:relative;overflow:hidden;padding-right:16px;padding-left:16px;padding-top:16px;padding-bottom:11px;height:auto;background-color:#edebe9}.LineageActivityPaneTitle{max-width:240px;display:inline-flex;font-weight:bold;font-family:"Segoe UI Semi Bold","Segoe UI Web",Arial,Verdana,sans-serif;font-size:16px;line-height:16px;flex-grow:1;align-content:center;height:auto;text-overflow:ellipsis;overflow:hidden;background-color:#edebe9;margin:0}.LineageActivityCloseButton{display:inline-flex;align-self:center}.LineageActivityBody{height:100%;padding-left:16px;overflow:hidden;background-color:#edebe9}');
(()=>{c.a.Fa(la=>{Cc.ka(la);sc.ka(la);ma.ka(la);ld.ka(la);W.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)&&Dd.ka(la);Ea.ka(la)})})();Type.registerNamespace("Common.App.CatchUpActivity");Gc.main();(()=>{c.a.Fa(la=>{ze("Begin");ce.ka(la);P.ka(la)})})()},981:function(t,C,a){a.d(C,"a",function(){return d});t=a(0);var c=a(163);C=a(1232);var b=a(758);class d extends C.a{constructor(f,e){super(f,e);e!==b.a.l9&&this.$Ea(e);this.dga(d.iterateNext);this.dga(d.Qwa);this.SSc(c.a.HTa);
this.SSc(c.a.ITa)}}d.iterateNext="IterateNext";d.Qwa="IteratePrevious";d.SMb="ToggleShowChanges";d.setCurrentChangeCount="SetCurrentChangeCount";d.setTotalChangesCount="SetTotalChangesCount";d.vOa="OnVHDiffReady";Object(t.a)(d,"VersionHistoryMessenger",C.a,[])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.catchup.js.map/e95bd3617807c5dc1fa12a312a491434/EwaDSEsNext.catchup.js.map