'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[17],{1106:function(t,C,a){a.d(C,"a",function(){return c});const c=()=>{Type.registerNamespace("Common.App.InsertFile")}},1107:function(t,C,a){a.d(C,"a",function(){return c});const c=()=>{Type.registerNamespace("Common.App.InsertPicture")}},1109:function(t,C,a){a.d(C,"a",function(){return b});var c=a(508);const b=()=>{c.a.Hi(".insert-media-dialog-old{width:870px;float:left;margin-top:7px}.insert-media-dialog{width:870px;width:clamp(400px,870px,80vw);float:left;margin-top:7px}.app-rtl .insert-media-dialog{float:right}.insert-media-frame{width:100%;height:100%;visibility:visible}.insert-media-panel-old{height:550px}.insert-media-panel{height:550px;height:clamp(300px,550px,90vh)}.keep-focus-start{position:absolute;width:-1000px;top:-1000px}.keep-focus{position:absolute;width:-1000px;top:1000px}.display-none{display:none}.padding-zero{padding:0}")}},
1133:function(t,C,a){var c=a(0),b=a(7),d=a(15),f=a(221),e=a(30),k=a(27),l=a(346),m=a(172),v=a(262),n=a(350),w=a(4),r=a(1),u=a(38),y=a(8),x=a(282),B=a(14);class z extends x.a{constructor(P){super(P);this.sYg=()=>{d.ULS.sendTraceTag(537167827,0,50,"ClipboardReadPermissionAskDialog OK button pressed")};d.ULS.sendTraceTag(537167828,0,50,"ClipboardReadPermissionAskDialog.ClipboardReadPermissionAskDialog");this.Rb=0;this.rc(1,B.a.instance.ga(2257));P=B.a.instance.ga(2255);const Ta=this.KM();this.initializeAndShow(P,
this.sYg,Ta)}get oc(){return"ClipboardReadPermissionAskDialog"}KM(){const P={};P.id=this.oc;const Ta=B.a.instance.ga(2256);P.DialogMessage=Ta;return P}}Object(c.a)(z,"ClipboardReadPermissionAskDialog",x.a,[]);var A=a(51);const I=(P,Ta,pb,Yb,Ac)=>{const Zc=P.Stopwatch,id={};id.a=Ac;id.e=Zc.id;id.c="RearrangeRowColumn";id.b="mouse";id.d=P.OperationId.toString();id.f=pb.toString();id.g=Yb.toString();id.h=Ta.toString();id.i=P.DragDropIsShiftKeyDown;id.j=!0;id.o=Zc.uc;id.q=!1;id.r=P.CopyPasteTargetType.toString();
id.s=P.EncounteredDeploymentErrors;return id};class F{constructor(P,Ta){this.eEh=()=>{const pb={};pb.SourceItem=this.toString();return pb};this.sessionStateId=P;this.sessionId=Ta;this.toJSON=this.eEh}Xbf(P){return P?this.sessionStateId===P.sessionStateId&&this.sessionId===P.sessionId:!1}isFromCurrentSession(P){return this.sessionId===P.ya.UserSessionId}}Object(c.a)(F,"SourceItem",null,[]);class U extends F{constructor(P,Ta,pb,Yb,Ac){super(pb,Yb);this.activeFloatingObjectControlId=P;this.sheetName=
Ta;this.type=Ac}isEqual(P){return P&&Object.getType(P)===U?this.Xbf(P)&&this.activeFloatingObjectControlId===P.activeFloatingObjectControlId&&this.sheetName===P.sheetName:!1}toString(){return this.type.toString()}}Object(c.a)(U,"ArtSourceItem",F,[]);var X;(function(P){P[P.valid=0]="valid";P[P.notPairwiseDisjoint=1]="notPairwiseDisjoint";P[P.cutNotSupportedInDiscontinuousSelection=2]="cutNotSupportedInDiscontinuousSelection";P[P.notValidForm=3]="notValidForm";P[P.temporarilyBlockedCopy=4]="temporarilyBlockedCopy"})(X||
(X={}));Object(c.b)("CopySourceValidationOptions",X);var S=a(43);class H extends F{constructor(P,Ta,pb,Yb,Ac){super(Yb,Ac);d.ULS.shipAssertTag(537167645,0,!!Ta&&0<Ta.length,"RangeSourceItem.ctor: ranges should not be null or empty");this.$=P;this.ranges=Ta;this.sheetName=pb}isEqual(P){return P&&Object.getType(P)===H?this.Xbf(P)&&S.Q(this.ranges,P.ranges)&&this.sheetName===P.sheetName:!1}toString(){return S.i(this.ranges,",",this.$,!1)}}Object(c.a)(H,"RangeSourceItem",F,[]);const D=P=>!!P&&Object.getType(P)===
H;class J{}J.wUj="PasteError_FailedToReadFromClipboard_UserHashMismatchError";Object(c.a)(J,"ExpectedErrorNames",null,[]);class M{}M.plainText="text/plain";M.html="text/html";M.png="image/png";M.shadowWorkbook="data/shadow-workbook";M.mii="metadata/is-last-copy-was-external";M.Qei="metadata/is-last-copy-was-external-XLO-source";M.OWg="metadata/chrome-extension-id";M.mqb="copyId";M.xHg="metadata/additional-signature-data-attributes";Object(c.a)(M,"ClipboardDataFormat",null,[]);const G=P=>P.clipboardItems&&
(P=P.clipboardItems.getItem(M.mii))&&"1"===P?!0:!1,T=P=>G(P)&&!(void 0===P.clipboardItems||null===P.clipboardItems)&&!!P.clipboardItems.getItem(M.png)&&!P.clipboardItems.getItem(M.plainText),K=P=>P.clipboardItems&&(P=P.clipboardItems.getItem(M.Qei))&&"1"===P?!0:!1,L=P=>P&&(P=P.getCachedMetadata(),null===P||void 0===P?0:P.lastCopy)?P.lastCopy:null;var V=a(48),W=a(21),da=a(34);class qa{constructor(P,Ta,pb,Yb){this.$=P;this.originalDestinations=Ta;this.M7b=pb;this.fkg=Yb;this.cug=this.originalDestinations;
this.Xng=this.M7b;this.wrg="PasteRecoveryUI"}get wHg(){return this.fkg}get Iqi(){return this.wrg}get i6i(){return this.cug}get Kwh(){return this.Xng}xJa(){return qa.BWi}YLh(){return this.M7b&&1===this.M7b.length?this.ZLh(this.M7b[0]):null}ZLh(P){var Ta=W.g(this.$);const pb=Ta.ib.Vi(P);var Yb=Ta.mg(P,pb);Ta=Ta.rtl;if(!Yb)return null;P=W.g(this.$).Lf(pb);const Ac=P.Mm;if(!Ac.Dd(Yb))return null;Yb=Ac.Ge(Yb);const Zc=Yb.topLeft.y;var id=Yb.bottomRight.y;const gd=Ta?Yb.bottomRight.x:Yb.topLeft.x;Yb=Ta?
Yb.topLeft.x:Yb.bottomRight.x;var Ub=new V.a(Yb+(Ta?-81:81),id+38+6);if(Ac.pha(Ub))return this.K3a(P,Ac,pb,Yb,id,Ta?12:-3,66);Ub=new V.a(Yb+(Ta?-81:81),id);if(Ac.pha(Ub))return this.K3a(P,Ac,pb,Yb,id,Ta?20:3,22);Ub=new V.a(Yb,id+38+6);if(Ac.pha(Ub))return this.K3a(P,Ac,pb,Yb,id,-81+(Ta?18:0),66);Yb=new V.a(gd+(Ta?81:-81),id);if(Ac.pha(Yb))return this.K3a(P,Ac,pb,gd,id,-81+(Ta?12:-6),22);id=new V.a(gd,Zc-38-6);return Ac.pha(id)?this.K3a(P,Ac,pb,gd,Zc,Ta?15:0,16):this.K3a(P,Ac,pb,Ta?Ac.topLeft.x:Ac.bottomRight.x,
Ac.bottomRight.y,-81+(Ta?15:-6),22)}K3a(P,Ta,pb,Yb,Ac,Zc,id){var gd=W.g(this.$);const Ub=gd.rtl;P=Sys.UI.DomElement.getLocation(P.domElement);Yb=new Sys.UI.Point(Yb+(Ub?0:P.x)-Ta.topLeft.x,Ac+P.y-Ta.topLeft.y);Ub&&(gd=gd.view.visibleArea,Yb.x=gd.bottomRight.x-gd.topLeft.x-Yb.x,2===pb||4===pb)&&(Yb.x+=Ta.bottomRight.x);Yb=da.a(this.$).gja(Yb);return new Sys.UI.Point(Yb.x+Zc,Yb.y+id)}}qa.BWi=["PasteRecoveryUI"];Object(c.a)(qa,"PasteRecoveryUI",null,[795]);var O=a(77),ea=a(175);class R{}R.hzg="ActiveSelection";
R.shadowWorkbook="ShadowWorkbook";R.rig="GVML";R.plainText="PlainText";R.html="Html";R.JNg="Bitmap";Object(c.a)(R,"PayloadType",null,[]);class oa{}oa.WBj="Slice4";oa.XBj="Slice5";oa.YBj="Slice6";Object(c.a)(oa,"SliceName",null,[]);class pa{}pa.PCi="NotCalled";pa.success="Success";pa.failed="Failed";Object(c.a)(pa,"SucceededPopulatingSystemClipboardOptions",null,[]);var Pa=a(355);const Z=(P,Ta)=>P?Ta&&Ta.ya?P.sessionId!==Ta.ya.UserSessionId:(d.ULS.shipAssertTag(537166209,0,!1,"ewaControl shouldn't be null"),
!1):(d.ULS.shipAssertTag(537166210,0,!1,"copyContext shouldn't be null"),!1),Ra=P=>{switch(P){case 0:return"None";case 2:return"Art";case 1:return"Range";default:return"Unknown"}},Ga=P=>{if(!P)return"null";const Ta=[];for(const pb of P.get())Ta.push(`${pb.clipboardDataFormat}(${pb.data.length})`);Ta.sort();return Ta.join(",")};var Ba;(function(P){P[P.valid=0]="valid";P[P.destinationRangesIsEmpty=1]="destinationRangesIsEmpty";P[P.discontinuousSelectionNotSupportPasteFromExternal=2]="discontinuousSelectionNotSupportPasteFromExternal";
P[P.discontinuousSelectionNotSupportPasteCrossSession=3]="discontinuousSelectionNotSupportPasteCrossSession";P[P.multipleSourcesAndMultipleDestinationsAreNotSupported=4]="multipleSourcesAndMultipleDestinationsAreNotSupported";P[P.multipleDestinationsAreNotMultiplyOfSourceRange=5]="multipleDestinationsAreNotMultiplyOfSourceRange";P[P.sourceAndDestinationAreOverlapping=6]="sourceAndDestinationAreOverlapping";P[P.copySourceNotValid=7]="copySourceNotValid";P[P.cutNotSupportedInDiscontinuousSelection=
8]="cutNotSupportedInDiscontinuousSelection";P[P.pasteLinkNotSupportMultipleDestination=9]="pasteLinkNotSupportMultipleDestination";P[P.temporarilyBlockedPaste=10]="temporarilyBlockedPaste";P[P.unknown=100]="unknown"})(Ba||(Ba={}));Object(c.b)("PasteValidationOptions",Ba);var fa=a(50),Y=a(33),ja=a(145),ca=a(37),aa=a(153),ta=a(340),xa=a(29),ia=a(313),ya=a(11),ib=a(22),wa=a(97),sa=a(125),Ya=a(112),bb=a(562),mb=a(99),Ca=a(55),$a=a(196),Kb=a(65),rb=a(338);class cc extends u.a{constructor(P,Ta,pb,Yb,Ac,
Zc,id,gd,Ub=null){super();this.pasteShortcutManager=null;this.bbf=r.EwaSettings.xb();this.pwa=r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CopyPasteWFEIncreasedLimits",!1);this.F8f=null;this.G6a=!1;this.Wdf=r.EwaSettings.isChangeGateEnabled("OfficeVSO:6004791_MergedCellOverlapTelemetry");this.Vpd=r.EwaSettings.isChangeGateEnabled("OfficeVSO:6660890_Tag_aoi75RetryLoggingFix2");this.Tzd=Lc=>{this.Dvj(Lc)&&(this.Jp.ucc(),d.ULS.sendTraceTag(537167777,0,50,"CopyPasteInfrastructure.OnMetadataChanged: found that cut/copy operation was preformed in another session therefore removed the highlight in this session."))};
this.tvi=(Lc,hd)=>{d.ULS.sendTraceTag(537167768,0,50,`CopyPasteInfrastructure.LogShortcutDialogAndRestoreFocus: Got shortcut dialog, user pressed [${Lc}]. userPressedExtensionLink=${hd}`);this.gridView.focus()};this.$c=(Lc,hd)=>{hd.aN||hd.fg||this.ir("OnWorkbookOpened",!1).catch(()=>{})};this.Gh=(Lc,hd)=>{Lc=L(this.xK);const Kd=this.Jp.zvb(Lc);Kd&&(hd.pa&&hd.pa.sheetName===Kd.sheetName&&Kd.isFromCurrentSession(this.$)?this.Jp.p7e(Kd.ranges,Lc.commandParameters.commandType):this.Jp.ucc())};this.qmc=
(Lc,hd)=>{Lc=L(this.xK);(Lc=this.Jp.zvb(Lc))&&hd.item&&hd.item.sheetName===Lc.sheetName&&Lc.isFromCurrentSession(this.$)&&this.ir("OnItemDeleting",!1).catch(()=>{})};this.CEb=(Lc,hd)=>{this.bbf?this.F8f(Lc,hd):this.HCf()};this.bR=(Lc,hd)=>{1===hd.Lq&&hd.xf.operation.flags&2&&this.ir("OnQueueItemChanged/ItemRemoved",!1).catch(()=>{})};this.$=P;this.ug=pb;this.gridView=W.g(P);this.Jp=Ac;this.Wai=Zc;this.xK=Ta;this.M2b=Yb;this.getStringifiedError=Ub||copyPasteInfra.getStringifiedError;this.U1f=1===gd;
this.P$c=r.EwaSettings.isChangeGateEnabled("OfficeVSO:6713439_FixCloneRangeArray");this.Bj();this.copyPasteShortcutDialogFactory=this.$.da.za(85);d.ULS.shipAssertTag(537167825,0,!!this.copyPasteShortcutDialogFactory,"CopyPasteInfrastructure.ctor: this.copyPasteShortcutDialogFactory shouldn't be null.");id||(d.ULS.sendTraceTag(537167824,0,50,"CopyPasteInfrastructure.ctor: userId is null, using default userId."),id=cc.ich);this.userHash=e.a.Sv(id);this.vzi="CultureTag: "+B.a.instance.urb+" HASH: ";
this.xK.addMetadataChangeListener(cc.ypf,this.Tzd);this.lyi=ea.a.bCb;this.Bxa=this.pwa?r.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.CopyPasteHtmlImportMaxLength",this.$.ya.CopyPasteMaxPayloadLength):y.a.Bxa;(this.so=r.EwaSettings.getBooleanFeatureGate(ea.a.ePa,!1))&&P.da.Za(478,Lc=>{this.pasteShortcutManager=Lc});this.bbf&&(this.F8f=ia.a(()=>{this.HCf()},1,this.$.la,"CopyPasteInfrastructure.OnStartEditInternal",!0))}get pasteIndicationManager(){return this.$.da.za(373)}LFg(P){this.addHandler(cc.RAd,
P)}Cbj(P){this.removeHandler(cc.RAd,P)}copy(P){P.stopwatch=this.$.Ib.Bc("UserAction",A.b().nj(P.ribbonCommandInfo.command)+"ClientSide");if(this.so){const Zc=fa.GetServiceTaskFactory.Ra(this.$.da,478,479,0);ca.TaskExtensions.Aa(Zc,()=>{this.pasteShortcutManager=Zc.result},this.la,3)}const Ta=!!L(this.xK);r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!k.a.pz&&(this.G6a=!1);this.ir("Copy/before/"+l.a[P.ribbonCommandInfo.method],!1,void 0,!0,P.copyPasteTargetType).catch(()=>
{});var pb=-1985798686===P.ribbonCommandInfo.command;if(1===this.gridView.Je&&(pb=this.Jp.obf(this.gridView.ha.sa.selectedRanges,pb),0!==pb)){const Zc=cc.a2g(pb);this.Gya(Zc,X[pb],!1);return Promise.reject(!1)}P.userHash=this.userHash;P.id=m.a.create().toString();let Yb=this,Ac=this;return this.M2b.onCopy(P).then(Zc=>{Zc.isAsyncCopy||P.stopwatch.stop();Yb.pasteIndicationManager.iIe();const id=Pa.d(P);d.ULS.sendTraceTag(24150883,0,50,`CopyPasteInfrastructure.OnCopy: Copy operation finished successfully. ${id}`);
Yb.sti(Zc,Ta);Zc=r.EwaSettings.isChangeGateEnabled("OfficeVSO:6591921_CheckTargetTypeForEnterToPaste")?1===P.copyPasteTargetType:!0;!P.isFormatPainter&&Yb.so&&Zc&&(Yb.pasteShortcutManager?Yb.pasteShortcutManager.Ojh():d.ULS.shipAssertTag(537167823,0,!1,"Copy: pasteShortcutManager is null."));return Promise.resolve(!0)},Zc=>{let id=!1,gd="none",Ub=cc.rrb,Lc=!0,hd=-1,Kd=cc.copyErrorName+cc.qIa,Wd=!1,oe=null;if(Zc){oe=Zc.copyContext;hd=Zc.reason;Kd+=cc.FJa(Zc);Zc.message&&(Ub=Zc.message);var We=cc.$1g(Zc);
if(We)if(3===We.copyErrorName)id=!0,Ub=gd="Async Copy canceled by the user.",Lc=!1;else if(xa.a.er(We.ewaErrors))if(Ub=Ac.C$b(We.ewaErrors),xa.a.jh(We.ewaErrors,cc.operationSucceededWithAlert))Wd=id=!0;else if(xa.a.jh(We.ewaErrors,cc.pasteDataLimitHit)||xa.a.jh(We.ewaErrors,cc.copyThrottlingError))id=!0;13===Zc.reason?(id=!0,Lc=!1):11===Zc.reason&&(Lc=!1)}We=Zc?Ac.getStringifiedError(Zc):"null";id?(We=Pa.d(P),d.ULS.sendTraceTag(36304157,0,15,`CopyPasteInfrastructure.OnCopy: Copy operation failed with an expected error. clearStateNeeded: ${Lc}, Friendly message: ${gd}, Error Message: ${Ub}, CommandParameters: ${We}`)):
d.ULS.sendTraceTag(24150912,0,10,`CopyPasteInfrastructure.OnCopy: Copy operation failed with an unexpected error. clearStateNeeded: ${Lc}, Error Message: ${We}, CommandParameters: ${Pa.d(P)}`);Lc&&Ac.ir("Copy/fail/"+l.a[P.ribbonCommandInfo.method],!0,void 0,void 0,P.copyPasteTargetType).catch(()=>{});Ac.rti(P,id,Ub,Kd,hd,Wd,oe);return Promise.reject(Zc)})}paste(P){P.stopwatch=this.$.Ib.Bc("UserAction",A.b().nj(P.ribbonCommandInfo.command)+"ClientSide");r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",
!1)&&!k.a.pz&&(d.ULS.sendTraceTag(537167822,0,50,"CopyPasteInfrastructure.OnPaste: Cross-app shadow workbook paste is enabled"),this.G6a=!1,P.clipboardPicklingApiDataFormatsToRead=[M.shadowWorkbook]);W.g(this.$).Gi&&W.g(this.$).Gi.T6(this.qed(P.ribbonCommandInfo.command),P.stopwatch.id);if(P.isPasteCommandFromRecoveryUI){var Ta=this.$.da.za(406);var pb=this.P$c?S.d(Ta.Zhc):v.a.clone(Ta.Zhc);Ta=Ta.hrd;P.pasteRecoveryCachedClipboardItems=Ta?Ta[cc.FFf]:null}else pb=this.P$c?S.d(this.gridView.ha.sa.selectedRanges):
v.a.clone(this.gridView.ha.sa.selectedRanges);P.originalDestinations=pb;P.expandDestinations=this.kYc(P.originalDestinations,P.commandType);if(this.xYc(P.commandType,P.expandDestinations)||this.UTg())return P.userHash=this.userHash,P.id=m.a.create().toString(),r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.PerfImpactExperimentForAsyncApi",!1)&&!k.a.pz&&(P.clipboardReadPermissionPromptShown=!1,P.clipboardAsyncApiDataFormatsToRead=[M.plainText+"Async"],this.M2b.shouldShowClipboardReadPermissionDialog().then(Yb=>
{Yb&&(P.clipboardReadPermissionPromptShown=!0,new z(this.$));return Promise.resolve(!0)},()=>Promise.resolve(!0))),this.M2b.onPaste(P).then(Yb=>this.Qmc(Yb,P),Yb=>this.pEb(P,Yb));this.$.ud(927125067,O.a.Eb,30,null);pb=S.i(P.expandDestinations,",",this.$,!1);d.ULS.sendTraceTag(24150913,0,15,`CopyPasteInfrastructure.OnPaste: paste was triggered but the estimated destination range is not editable, do nothing. ExpandDestinations: ${pb}, CommandType: ${P.commandType}, copyPasteTargetType="${P.copyPasteTargetType}"`);
return Promise.resolve(!0)}qed(P){switch(P){case 1804571062:return 6;case -185374993:return 7;case 1766348718:return 8;default:return 3}}UTg(){return!!W.g(this.$).ha.Pa.activeFloatingObjectControlId&&this.$.rq(null,!1,470)}GAb(){const P=L(this.xK);return P&&P.commandParameters?P.commandParameters.copyPasteTargetType:0}lii(){return!!L(this.xK)&&Z(L(this.xK),this.$)}ir(P,Ta,pb=!1,Yb=!1,Ac=0){try{this.so&&this.pasteShortcutManager&&this.pasteShortcutManager.p5b();let Zc=Ac;const id=this.zpi();if(!Yb&&
2===id)return d.ULS.sendTraceTag(537167821,0,50,`CopyPasteInfrastructure.ClearState clipboard won't be cleared as there's art in the clipboard. clearClipboardContent = '${Ta}', isExplicit = '${pb}', isForce = '${Yb}', Current CCP operation copyPasteTargetType = '${Ac}', LastCopyPasteTargetType = '${id}'`),Promise.reject(null);0===Zc&&(Zc=id);const gd=this.$.Ib.Bc("UserAction","ClearCopyState"),Ub=gd.id;d.ULS.sendTraceTag(537167820,0,50,`CopyPasteInfrastructure.ClearState clear clipboard state. clearClipboardContent = '${Ta}', isExplicit = '${pb}', isForce = '${Yb}', Current CCP operation copyPasteTargetType = '${Ac}', LastCopyPasteTargetType = '${id}'`);
this.Jp.ucc();this.r3i();return this.M2b.onCancelCopy(Ta).then(()=>{Ta&&r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!k.a.pz&&(this.G6a=!1);gd.stop();this.Xkf(P,Ub,!0,pb,Ta,"","",gd.uc,Zc);return Promise.resolve(!0)},Lc=>{var hd=Lc?this.getStringifiedError(Lc):"null";d.ULS.sendTraceTag(24150915,0,15,`CopyPasteInfrastructure.ClearState: error during call to copyPasteFlowManager.OnClear(). error: ${hd}`);gd.stop();hd=cc.iUg+cc.qIa;let Kd=cc.rrb;Lc&&(hd+=
cc.FJa(Lc),Lc.message&&(Kd=Lc.message));this.Xkf(P,Ub,!1,pb,Ta,Kd,hd,gd.uc,Zc);return Promise.reject(Lc)})}catch(Zc){return Promise.reject(null)}}u_c(P,Ta,pb=!1,Yb=!1,Ac=0){return Yb||!r.EwaSettings.ma(651)||this.Ogh()?this.ir(P,Ta,pb,Yb,Ac):(d.ULS.sendTraceTag(537167819,0,50,"CopyPasteInfrastructure.ClearStateOnlyIfClipboardHasContentFromSameSession clipboard won't be cleared as there is no content in the clipboard from the current session"),Promise.reject(null))}Gya(P,Ta,pb){d.ULS.sendTraceTag(590705172,
0,50,`CopyPasteInfrastructure.PopupDiscontinuousSelectionErrorDialog: Blocked CCP due to discontinuous selection, reason: ${Ta}`);const Yb=new mb.a;Yb.ia("reason",Ta);bb.a(sa.a.discontinuousSelectionBlocking,[pb?Ya.a.uWi:Ya.a.U2g],!0,!0,!1,!1,Yb);P=xa.a.Yc(1,1,756,P,0,371863010,"DiscontinuousSelectionBlocking");r.EwaSettings.wz()?new ta.a(this.$,P):(P=new aa.ErrorDialog(this.$,P),P.initialize(),P.Ff())}zpi(){const P=L(this.xK);return P&&P.sourceItem?Object.getType(P.sourceItem)===U?2:1:0}dragDropCells(P,
Ta,pb,Yb,Ac=!1){P.stopwatch=this.$.Ib.Bc("UserAction","DragDropClientSide");this.ir("DragDrop/before/"+l.a[P.ribbonCommandInfo.method],!1,void 0,void 0,P.copyPasteTargetType).catch(()=>{});const Zc=Ac?2:1;let id=0;id=Ac?4:Yb?256:128;const gd={encounteredDeploymentErrors:!1};gd.commandParameters=P;P.userHash=this.userHash;P.id=m.a.create().toString();return this.Vpd?this.Jp.pasteRange(P.ribbonCommandInfo,S.q(Ta,this.$),S.q(pb,this.$),Zc,id,[P.stopwatch],gd,!1,()=>{d.ULS.sendTraceTag(537167818,0,50,
`CopyPasteInfrastructure.DragDropCells: success. copyPasteTargetType="${P.copyPasteTargetType}"`);this.M7a(P,Zc,Ta,pb,gd)},Ub=>{const Lc=Ub?this.getStringifiedError(Ub):"null";d.ULS.sendTraceTag(537167817,0,10,`CopyPasteInfrastructure.DragDropCells: ${Lc}, copyPasteTargetType="${P.copyPasteTargetType}"`);this.f9a(Ub,P,Zc,Ta,pb,gd)}).then(()=>{this.gridView.ha.selectionType=-1;return Promise.resolve(!0)},Ub=>Promise.reject(Ub)):this.Jp.pasteRange(P.ribbonCommandInfo,S.q(Ta,this.$),S.q(pb,this.$),Zc,
id,[P.stopwatch],gd,!1,null,null).then(()=>{d.ULS.sendTraceTag(521410075,0,50,`CopyPasteInfrastructure.DragDropCells: success. copyPasteTargetType="${P.copyPasteTargetType}"`);this.gridView.ha.selectionType=-1;this.M7a(P,Zc,Ta,pb,gd);return Promise.resolve(!0)},Ub=>{const Lc=Ub?this.getStringifiedError(Ub):"null";d.ULS.sendTraceTag(521410074,0,10,`CopyPasteInfrastructure.DragDropCells: ${Lc}, copyPasteTargetType="${P.copyPasteTargetType}"`);this.f9a(Ub,P,Zc,Ta,pb,gd);return Promise.reject(Ub)})}lhh(P,
Ta,pb,Yb,Ac=!1){P.stopwatch=this.$.Ib.Bc("UserAction","DragDropReplaceClientSide");this.u_c("DragDropReplace/before/"+l.a[P.ribbonCommandInfo.method],!1,void 0,void 0,P.copyPasteTargetType).catch(()=>{});const Zc=Ac?2:1;let id=0;id=Ac?4:Yb?256:128;const gd={encounteredDeploymentErrors:!1};gd.commandParameters=P;r.EwaSettings.getBooleanFeatureGate(ea.a.X5b,!1)&&(P.isDragInsert=!1);P.userHash=this.userHash;P.id=m.a.create().toString();return this.Vpd?this.Jp.pasteRange(P.ribbonCommandInfo,S.q(Ta,this.$),
S.q(pb,this.$),Zc,id,[P.stopwatch],gd,!1,()=>{d.ULS.sendTraceTag(537167816,0,50,`CopyPasteInfrastructure.DragDropReplaceCells: success. copyPasteTargetType="${P.copyPasteTargetType}"`);this.M7a(P,Zc,Ta,pb,gd)},Ub=>{const Lc=Ub?this.getStringifiedError(Ub):"null";d.ULS.sendTraceTag(537167815,0,10,`CopyPasteInfrastructure.DragDropReplaceCells: ${Lc}, copyPasteTargetType="${P.copyPasteTargetType}"`);return this.f9a(Ub,P,Zc,Ta,pb,gd)}).then(()=>{this.gridView.ha.selectionType=-1;return Promise.resolve(!0)},
Ub=>Promise.reject(Ub)):this.Jp.pasteRange(P.ribbonCommandInfo,S.q(Ta,this.$),S.q(pb,this.$),Zc,id,[P.stopwatch],gd,!1,null,null).then(()=>{d.ULS.sendTraceTag(521410073,0,50,`CopyPasteInfrastructure.DragDropReplaceCells: success. copyPasteTargetType="${P.copyPasteTargetType}"`);this.gridView.ha.selectionType=-1;this.M7a(P,Zc,Ta,pb,gd);return Promise.resolve(!0)},Ub=>{const Lc=Ub?this.getStringifiedError(Ub):"null";d.ULS.sendTraceTag(521410072,0,10,`CopyPasteInfrastructure.DragDropReplaceCells: ${Lc}, copyPasteTargetType="${P.copyPasteTargetType}"`);
this.f9a(Ub,P,Zc,Ta,pb,gd);return Promise.reject(Ub)})}khh(P,Ta,pb,Yb,Ac=!1){P.stopwatch=this.$.Ib.Bc("UserAction","DragDropInsertClientSide");this.u_c("DragDropInsert/before/"+l.a[P.ribbonCommandInfo.method],!1,void 0,void 0,P.copyPasteTargetType).catch(()=>{});const Zc=Ac?2:1,id=S.K(this.kYc([pb],Zc));var gd=this.$.ea.pa.sheetName;const Ub=this.$.ea.pa.sheetName,Lc=S.v(Ta,this.$);Lc.SheetName=gd;gd=S.v(id,this.$);gd.SheetName=Ub;Yb=id.isRow||Ta.isRow||Yb?1:0;const hd={encounteredDeploymentErrors:!1};
P.isDragInsert=!0;hd.commandParameters=P;P.userHash=this.userHash;P.id=m.a.create().toString();if(this.Vpd)return Ac=this.Jp.pIe(hd,Lc,gd,Ac,Yb,P.ribbonCommandInfo,()=>{d.ULS.sendTraceTag(537167814,0,50,`CopyPasteInfrastructure.DragDropInsertCells: success. copyPasteTargetType="${P.copyPasteTargetType}"`);this.M7a(P,Zc,Ta,pb,hd)},Wd=>{const oe=Wd?this.getStringifiedError(Wd):"null";d.ULS.sendTraceTag(537167813,0,10,`CopyPasteInfrastructure.DragDropInsertCells: ${oe}, copyPasteTargetType="${P.copyPasteTargetType}"`);
this.f9a(Wd,P,Zc,Ta,pb,hd)}),$a.c(Ac.then(()=>{this.gridView.ha.selectionType=-1;return Promise.resolve(!0)},Wd=>Promise.reject(Wd))).Uo(()=>!0);Ac=this.Jp.pIe(hd,Lc,gd,Ac,Yb,P.ribbonCommandInfo,null,null);let Kd=this;return $a.c(Ac.then(()=>{d.ULS.sendTraceTag(521410071,0,50,`CopyPasteInfrastructure.DragDropInsertCells: success. copyPasteTargetType="${P.copyPasteTargetType}"`);this.gridView.ha.selectionType=-1;this.M7a(P,Zc,Ta,pb,hd);return Promise.resolve(!0)},Wd=>{const oe=Wd?Kd.getStringifiedError(Wd):
"null";d.ULS.sendTraceTag(521410070,0,10,`CopyPasteInfrastructure.DragDropInsertCells: ${oe}, copyPasteTargetType="${P.copyPasteTargetType}"`);Kd.f9a(Wd,P,Zc,Ta,pb,hd);return Promise.reject(Wd)})).Uo(()=>!0)}Vai(P,Ta){var pb=L(this.xK);if(!pb)return d.ULS.sendTraceTag(537167812,0,50,"InsertCopiedCutCells: CopyContext must not be null or undefined"),Ca.Task.Ta(!1);if(!D(pb.sourceItem))return d.ULS.sendTraceTag(537167811,0,50,"InsertCopiedCutCells: CopyContext must be a Range"),Ca.Task.Ta(!1);var Yb=
pb.sourceItem;if(!Yb)return d.ULS.shipAssertTag(537167810,0,!!Yb,"InsertCopiedCutCells: rangeSourceItem must not be null or undefined"),Ca.Task.Ta(!1);if(!Yb.isFromCurrentSession(this.$))return d.ULS.sendTraceTag(537167809,0,50,"InsertCopiedCutCells: rangeSourceItem is from a different session"),Ca.Task.Ta(!1);if(1<Yb.ranges.length)return d.ULS.sendTraceTag(537167808,0,50,"InsertCopiedCutCells: multiple source ranges are not supported"),this.Gya(2191,"InsertCopiedCutCells",!0),Ca.Task.Ta(!1);pb=S.K(Yb.ranges);
var Ac=this.gridView.ha.sa.Wc.clone();P=S.K(this.kYc([Ac],P));const Zc=this.Sif();Yb=Yb.sheetName;Ac=this.$.ea.pa.sheetName;const id=S.v(pb,this.$);id.SheetName=Yb;const gd=S.v(P,this.$);gd.SheetName=Ac;return(P.Ze||pb.Ze?Ca.Task.Ta(0):P.isRow||pb.isRow?Ca.Task.Ta(1):this.Wai.b3b(this.$,W.g(this.$).rtl)).Uo(Ub=>this.Jp.executeInsertCopiedCutCellsOperation(id,gd,Zc,Ub.result,Ta)).continueWith(()=>{Zc?this.Jp.ucc():this.ir("InsertCopiedCutCells/success/"+l.a[Ta.method],!0)})}wnd(){const P=L(this.xK),
Ta=this.gridView.ha.sa.wg;return!!P&&D(P.sourceItem)&&Ta&&1===P.sourceItem.ranges.length}Sif(){return this.Tif(-911352779)}Yhc(){return this.Tif(-1985798686)}xYc(P,Ta){var pb=new ja.a(this.$.xa),Yb=36===P;const Ac=pb.Ud(4);P=2===this.GAb()&&pb.Ud(1);Yb=Yb&&Ac;pb=!pb.li||!this.Yhc()||!ja.a.L5b(Ta,W.g(this.$));return Yb||P||this.$.rq(Ta,!0)&&pb}kfc(P,Ta){return this.Jp.kfc(P,Ta)}dispose(){super.dispose();this.ek();this.xK.removeMetadataChangeListener(cc.ypf)}O5c(P,Ta,pb,Yb,Ac,Zc){if(!this.aYg(P.commandParameters.ribbonCommandInfo.command))return P.cseStatus=
2,!1;if(Zc&&Ta.Dd(Yb))return P.cseStatus=4,!1;if(pb!==Ac)return P.cseStatus=6,!1;if(r.EwaSettings.isChangeGateEnabled("OfficeVSO:5593878_PasteCSE_CCPErrorTests")&&(Yb.width%Ta.width||Yb.height%Ta.height))return P.cseStatus=16,!1;if(r.EwaSettings.getBooleanFeatureGate(ea.a.oEe,!1)){if(pb=Ta,Yb=Yb.Ge(this.gridView.gi),Ta=null===Ta.Ge(this.gridView.gi),Ac=P.commandParameters.ribbonCommandInfo.command,Ta&&1804571062!==Ac&&-185374993!==Ac||!Yb)return P.cseStatus=7,!1}else if(pb=Ta.Ge(this.gridView.gi),
Yb=Yb.Ge(this.gridView.gi),!pb||!Yb)return P.cseStatus=7,!1;Ta=S.v(pb,this.$);Ta=this.ug.zWi(this.gridView,Ta,S.v(Yb,this.$),P.commandParameters.ribbonCommandInfo.command,P.commandParameters.stopwatch);1===Ta&&(Zc&&(this.ug.m_c(pb,!1),this.ug.m_c(pb,!0)),-185374993===P.commandParameters.ribbonCommandInfo.command&&W.g(this.$).b3i(),this.pasteIndicationManager.jid(P.commandParameters.id),this.Vtc(P.commandParameters.expandDestinations,P.commandParameters.isPasteCommandFromRecoveryUI),this.Uxe("DoPasteClientEstimation/"+
l.a[P.commandParameters.ribbonCommandInfo.method],P));P.cseStatus=Ta;return 1===Ta}PGf(){this.copyPasteShortcutDialogFactory.create(this.$).showDialog(!0,!1,!1,this.tvi)}Glf(P,Ta,pb,Yb){P=I(P,Ta,pb,Yb,this.$.ya.UserSessionId);P.k=!0;A.b().Le(45,P,!0)}BAf(P,Ta,pb,Yb,Ac){var Zc=!1,id=!1,gd=cc.rrb,Ub=cc.lIe+cc.qIa;P&&(Ub+=cc.FJa(P),xa.a.er(P.ewaErrors)?(gd=this.C$b(P.ewaErrors),xa.a.jh(P.ewaErrors,[-103190598])&&(Zc=!0)):P.message&&(gd=P.message));id||(id=this.Lmd(P));Ta=I(Ta,pb,Yb,Ac,this.$.ya.UserSessionId);
Ta.k=!1;Ta.l=id;Ta.n=gd;Ta.p=Ub;Ta.q=Zc;A.b().Le(45,Ta,!0);return Promise.reject(P)}aYg(P){switch(P){case 237279923:case 808159687:return ea.a.wji;case -185374993:return!0;case 1804571062:return!0;default:return!1}}Tif(P){const Ta=L(this.xK);if(!Ta)return!1;const pb=Ta.sourceItem;return pb&&!pb.isFromCurrentSession(this.$)?(d.ULS.sendTraceTag(537167779,0,50,"CopyPasteInfrastructure.LastOperationWasCopyCut: Last copy operation was from a different session."),!1):Ta.commandParameters.ribbonCommandInfo.command===
P}Ogh(){var P=L(this.xK);return P?(P=P.sourceItem)&&!P.isFromCurrentSession(this.$)?(d.ULS.sendTraceTag(537167778,0,50,"CopyPasteInfrastructure.DoesClipboardHaveCopiedOrCutContent: Last copy/cut operation was from a different session."),!1):!0:!1}Dvj(P){return P&&P.lastCopy?Z(P.lastCopy,this.$):!0}qXe(P,Ta,pb,Yb,Ac){const Zc={};Zc.a=this.$.ya.UserSessionId;Zc.e=P.stopwatch.id;Zc.c=A.b().nj(P.ribbonCommandInfo.command);Zc.b=l.a[P.ribbonCommandInfo.method];Zc.d=P.id;Zc.f=pb.toString();Zc.g=Yb.toString();
Zc.h=Ta.toString();Zc.o=P.stopwatch.uc;Zc.q=!1;Zc.r=P.copyPasteTargetType.toString();Zc.s=Ac.encounteredDeploymentErrors;r.EwaSettings.getBooleanFeatureGate(ea.a.X5b,!1)&&(Zc.i=Ac.commandParameters.dragDropIsShiftKeyDown,Zc.j=Ac.commandParameters.isDragInsert);return Zc}M7a(P,Ta,pb,Yb,Ac){P=this.qXe(P,Ta,pb,Yb,Ac);P.k=!0;A.b().Le(45,P,!0)}Ati(P,Ta,pb,Yb,Ac,Zc,id,gd,Ub){P=this.qXe(P,Ta,pb,Yb,Ub);P.k=!1;P.l=Ac;P.n=Zc;P.p=id;P.q=gd;A.b().Le(45,P,!0)}Xkf(P,Ta,pb,Yb,Ac,Zc,id,gd,Ub){const Lc={};Lc.a=this.$.ya.UserSessionId;
Lc.b=Ta;Lc.c=P;Lc.f=pb;Lc.e=Yb;Lc.d=Ac;Lc.g=Zc;Lc.h=id;Lc.i=gd;Lc.j=Ub.toString();A.b().Le(46,Lc,!0)}sti(P,Ta){P=this.NWe(P.commandParameters,P);P.l=!0;P.j=Ta;A.b().Le(43,P,!0)}rti(P,Ta,pb,Yb,Ac,Zc,id){P=this.NWe(P,id);P.l=!1;P.m=Ta;P.o=pb;P.y=Yb;P.x=Ac;P.z=Zc;A.b().Le(43,P,!0);d.ULS.sendTraceTag(537167776,0,15,`CopyPasteInfrastructure.LogCopyFailedTelemetry: ErrorName=${P.y},ErrorReason=${P.x},IsExpectedError=${P.m},IsSucceededWithAlert=${P.z},ErrorMessage=${P.o}`)}NWe(P,Ta){const pb={};pb.a=this.$.ya.UserSessionId;
pb.f=P.stopwatch.id;pb.g=P.id;pb.c=A.b().nj(P.ribbonCommandInfo.command);pb.b=l.a[P.ribbonCommandInfo.method];pb.q=P.stopwatch.uc;pb.bd=cc.Q9b();pb.bg=P.copyPasteHandlerName;pb.bj=void 0===P.ribbonCommandInfo.Re||null===P.ribbonCommandInfo.Re?null:n.a[P.ribbonCommandInfo.Re];pb.bq=P.uploadToClipService;pb.br=P.floatingObjectType;pb.s=P.copyPasteTargetType.toString();pb.bc=Ra(P.copyPasteTargetType);pb.z=!1;if(Ta){pb.bk=Ta.id;pb.bl=Ta.serverRequestTimeInMs;Ta.requestTelemetryData&&(pb.bm=Ta.requestTelemetryData.EcsOperationDuration,
pb.bn=Ta.requestTelemetryData.EcsRequestDuration,pb.bo=Ta.requestTelemetryData.WfeRequestDuration);pb.d=Ta.sourceItem?Ta.sourceItem.toString():null;pb.e=-1;if(D(Ta.sourceItem)){pb.e=0;P=Ta.sourceItem.ranges;for(const Yb of P)pb.e+=Yb.WG}pb.h=Ta.isAsyncCopy;pb.i=Ta.isFromCache;pb.k=Ta.isSelectionAllowed;pb.r=Ta.plainTextPayloadSize;pb.u=Ta.htmlPayloadSize;pb.v=Ta.htmlSizeExceedsLimit;pb.w=Ta.copyTotalSizeExceedsLimit;pb.t=Ta.shadowWorkbookPayloadSize;pb.p=Ta.clientSideCopyTime;pb.ba=Ta.encounteredDeploymentErrors;
pb.bb=Ta.shadowWorkbookSizeExceedsLimit;pb.be=Ta.syncClipboardItemsKeys;pb.bf=Ta.asyncClipboardItemsKeys;pb.bh=this.gBe(Ta.succeededPopulatingSystemClipboardSync);pb.bi=this.gBe(Ta.succeededPopulatingSystemClipboardAsync)}return pb}Vtc(P,Ta=!1){if(!this.gridView.eb&&!this.gridView.xi){var pb=this.gridView.ha.sa,Yb=!Ta&&1===P.length&&S.Q(P,pb.selectedRanges),Ac=Yb?pb.activeCell:P[0].topLeft;P[0].contains(Ac)||(d.ULS.shipAssertTag(537167775,0,!1,`CopyPasteInfrastructure.SelectPastedRange: SelectedRanges ${pb.selectedRanges}, IndexOfActiveRange ${pb.Xr}, ActiveCell ${pb.activeCell}, calculatedDestinationRanges ${P}, keepThePreviousActiveCell ${Yb}, newActiveCell ${Ac}, isPasteCommandFromRecoveryUI ${Ta}`),
Ac=P[0].topLeft);this.gridView.ha.Lw(P,0,Ac,0,void 0,wa.a.Z2g)}}J_e(P,Ta){const pb={};pb.a=this.$.ya.UserSessionId;pb.g=P.stopwatch.id;pb.t=P.stopwatch.uc;pb.bz=!1;Ta&&(pb.bv=Ta.id,pb.bw=Ta.serverRequestTimeInMs,pb.n=Ta.commandParameters.clipboardFormatReadTimes,pb.o=Ta.commandParameters.clipboardFormatReadStatus,pb.p=Ta.commandParameters.clipboardReadPermissionPromptShown,pb.q=Ta.commandParameters.asyncApiReadTimedOut,Ta.requestTelemetryData&&(pb.cb=Ta.requestTelemetryData.EcsOperationDuration,pb.cc=
Ta.requestTelemetryData.EcsRequestDuration,pb.cd=Ta.requestTelemetryData.WfeRequestDuration));pb.x=P.copyPasteTargetType.toString();pb.bl=Ra(P.copyPasteTargetType);pb.br=P.copyPasteHandlerName;pb.i=S.i(P.expandDestinations,",",this.$,!1);pb.h=S.i(P.originalDestinations,",",this.$,!1);pb.e=P.id;pb.d=P.commandType;pb.c=A.b().nj(P.ribbonCommandInfo.command);pb.b=l.a[P.ribbonCommandInfo.method];pb.bf=!1;pb.bg=!1;pb.bp=cc.Q9b();pb.bt=void 0===P.ribbonCommandInfo.Re||null===P.ribbonCommandInfo.Re?null:
n.a[P.ribbonCommandInfo.Re];pb.cj=P.isPasteCommandFromEnterShortcut;if(pb.ca=P.isPasteCommandFromRecoveryUI)pb.cf=P.pasteRecoveryUndoStopwatch.id,pb.cg=P.pasteRecoveryUndoStopwatch.uc;if(Ta){if((P=Ta.copyContextSnapshot)&&!Ta.wasLastCopyExternal){pb.f=P.commandParameters.id;pb.j=P.sourceItem.toString();pb.k=-1;if(D(P.sourceItem)){pb.k=0;const Yb=P.sourceItem.ranges;for(const Ac of Yb)pb.k+=Ac.WG}pb.bg=1===P.commandParameters.commandType}else Ta.clipboardItems?pb.f=Ta.clipboardItems.getItem(M.mqb):
d.ULS.sendTraceTag(537167774,0,50,"CopyPasteInfrastructure.GetPasteUsageData: pasteContext.ClipboardItems is null");pb.bz=Ta.pasteRecoveryUIDisplayed;pb.ci=Ta.cseStatus}else d.ULS.sendTraceTag(537167773,0,50,"CopyPasteInfrastructure.GetPasteUsageData: pasteContext is null");return pb}Jui(P,Ta,pb,Yb,Ac,Zc,id,gd,Ub){P=this.J_e(P,gd);P.l=!1;P.m=Ta;P.s=pb;P.bc=Yb;P.be=Ac;P.bd=Zc;P.bf=id;gd?(P.y=G(gd)||!gd.copyContextSnapshot,P.bi=!P.y&&Z(gd.copyContextSnapshot,this.$),P.bj=gd.shadowWorkbookSizeExceedsLimit,
P.v=gd.shadowWorkbookPayloadSize,P.w=gd.htmlPayloadSize,P.bq=Ga(gd.clipboardItems),P.bb=gd.activeSelectionType,P.bs=gd.isSameSession,P.bn=gd.payloadOrigin,P.bo=gd.payloadType,P.bu=gd.externalAppSource,P.bx=gd.indicationDisplayScheduled,P.by=gd.pasteIndicationDisplayStatus,P.ck=gd.pasteDestinationHasMergedCells):P.bi=Z(Ub,this.$);A.b().Le(44,P,!0);d.ULS.sendTraceTag(537167772,0,15,`CopyPasteInfrastructure.LogPasteFailedTelemetry: ErrorName=${P.be},ErrorReason=${P.bd},IsExpectedError=${P.m},IsSucceededWithAlert=${P.bf},ErrorMessage=${P.s}`)}Kui(P){const Ta=
this.J_e(P.commandParameters,P);Ta.y=P.wasLastCopyExternal;Ta.l=!0;Ta.u=P.plainTextPayloadSize;Ta.v=P.shadowWorkbookPayloadSize;Ta.w=P.htmlPayloadSize;Ta.z=P.isClipboardDataContainShadowWorkbook;Ta.ba=P.isShadowWorkbookParsedSuccessfully;Ta.bb=P.activeSelectionType;Ta.bc=P.pasteResult;Ta.bh=P.encounteredDeploymentErrors;Ta.bj=P.shadowWorkbookSizeExceedsLimit;Ta.bk=K(P);Ta.bq=Ga(P.clipboardItems);Ta.bs=P.isSameSession;Ta.bn=P.payloadOrigin;Ta.bo=P.payloadType;Ta.bu=P.externalAppSource;Ta.bx=P.indicationDisplayScheduled;
Ta.by=P.pasteIndicationDisplayStatus;Ta.ck=P.pasteDestinationHasMergedCells;Ta.bm=P.clipboardItems?P.clipboardItems.getItem(M.OWg):null;Ta.bi=!P.isSameSession&&!P.wasLastCopyExternal;A.b().Le(44,Ta,!0)}Bj(){this.$.xa.Pf(this.Gh);this.$.xa.UEg(this.qmc);this.$.userOperationManager.Hr(this.bR);this.$.el(this.$c);W.g(this.$).Xb.Nk(this.CEb)}ek(){this.$&&this.$.xa&&(this.$.xa.zg(this.Gh),this.$.xa.Vaj(this.qmc));this.$&&this.$.userOperationManager&&this.$.userOperationManager.Co(this.bR);this.gridView&&
this.gridView.Xb&&this.gridView.Xb.tk(this.CEb)}pEb(P,Ta){var pb=null;let Yb=!1;var Ac=null;let Zc="UnknownFailure",id=-1,gd=cc.rrb,Ub=cc.pasteErrorName+cc.qIa,Lc=!1;this.pasteIndicationManager.jid(P.id);this.Wdf&&this.pasteDestinationHasMergedCells(P.expandDestinations)&&(Ta.pasteContext.pasteDestinationHasMergedCells=!0);const hd=L(this.xK);(P.clearStateOnFinish||P.clearSystemClipboard)&&this.ir("Paste/fail/"+l.a[P.ribbonCommandInfo.method],!0,void 0,void 0,P.copyPasteTargetType).catch(()=>{});
if(Ta){id=Ta.reason;Ub+=cc.FJa(Ta);Ta.message&&(gd=Ta.message);if(pb=cc.n2g(Ta))if(1===pb.pasteErrorName)Yb=!0,Zc="CopyPasteLengthTooLongPopup",gd=Ac="The pasted content is too long. Popup a dialog to the user.",d.ULS.sendTraceTag(25216992,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Ac}, copyPasteTargetType="${P.copyPasteTargetType}"`),pb=xa.a.Yc(1,0,26,695,0,1306609195,"CopyPasteOversizeError"),r.EwaSettings.wz()?new ta.a(this.$,pb):(pb=new aa.ErrorDialog(this.$,pb),pb.initialize(),pb.Ff());else if(7===
pb.pasteErrorName)Yb=!0,Zc="No-Op",gd=Ac="The shadow workbook is not ready yet and an async copy failed to populate the clipboard. Do nothing (by the spec)",d.ULS.sendTraceTag(33948251,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Ac}, copyPasteTargetType="${P.copyPasteTargetType}"`);else if(8===pb.pasteErrorName)Yb=!0,Zc="UseShortcutsPopup",gd=Ac="Unable to paste content from the system clipboard. Popup dialog to the user.",d.ULS.sendTraceTag(25216994,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Ac}, copyPasteTargetType="${P.copyPasteTargetType}"`),
this.PGf();else if(18===pb.pasteErrorName){Yb=!0;Zc="PasteExternalNotSupportMultipleSelectionPopup";gd="Paste external not support multiple selection.";Ac="Unknown";var Kd=2191;100!==pb.validationFailureReason&&(Ac=Ba[pb.validationFailureReason],Kd=cc.ZAe(pb.validationFailureReason));this.Gya(Kd,Ac,!0)}else 20===pb.pasteErrorName||19===pb.pasteErrorName?(Yb=!0,20===pb.pasteErrorName?(Zc="PasteAcrossSessionNotSupportMultipleSelectionPopup",gd="Paste across session does not support multiple selection."):
(Zc="PasteInSameSessionNotSupportMultipleSelectionPopup",gd="This kind of multiple selection is not supported for same session paste."),Ac="Unknown",Kd=2191,100!==pb.validationFailureReason&&(Ac=Ba[pb.validationFailureReason],Kd=cc.ZAe(pb.validationFailureReason)),pb=6===pb.validationFailureReason,this.xYc(P.commandType,P.expandDestinations)&&pb&&this.Vtc(P.expandDestinations),this.Gya(Kd,Ac,!0)):6===pb.pasteErrorName?(Yb=!0,Zc="No-Op",gd=Ac="Paste Formatting/Transpose is not yet a supported operation on System Clipboard based content",
d.ULS.sendTraceTag(36263241,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Ac}, copyPasteTargetType="${P.copyPasteTargetType}"`)):17===pb.pasteErrorName?(Yb=!0,Zc="No-Op",gd=Ac="Paste text on Art is not yet a supported operation",d.ULS.sendTraceTag(0,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Ac}, copyPasteTargetType="${P.copyPasteTargetType}"`)):16===pb.pasteErrorName?(Yb=!0,Zc="No-Op",gd=Ac="Paste has failed because the previous copy has failed",pb=this.getStringifiedError(pb),d.ULS.sendTraceTag(537167771,
0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Ac}, copyPasteTargetType="${P.copyPasteTargetType}", error=${pb}`)):xa.a.er(pb.ewaErrors)?(xa.a.q9(pb.ewaErrors)||xa.a.jh(pb.ewaErrors,xa.a.nbc())?(Yb=!0,Zc="CommunicationError",Ac=xa.a.yc(pb.ewaErrors),d.ULS.sendTraceTag(36304159,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${gd} copyPasteTargetType="${P.copyPasteTargetType}"`)):xa.a.jh(pb.ewaErrors,cc.Ajj)?(Yb=!0,Zc="SavingWorkbookError",Ac=xa.a.yc(pb.ewaErrors),d.ULS.sendTraceTag(36304160,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${gd} copyPasteTargetType="${P.copyPasteTargetType}"`)):
xa.a.jh(pb.ewaErrors,cc.operationSucceededWithAlert)&&(Lc=Yb=!0,Zc="OperationSucceededWithAlert",Ac=xa.a.yc(pb.ewaErrors),d.ULS.sendTraceTag(36304161,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${gd} copyPasteTargetType="${P.copyPasteTargetType}"`)),Yb||(gd=this.C$b(pb.ewaErrors),Yb=this.Lmd(Ta))):11===pb.pasteErrorName&&(Yb=!0,Zc="No-Op",gd="Paste has failed because user try copy cross-session oart object");15===Ta.reason&&(Yb=!0,Zc="No-Op",gd="Rejecting deferred paste there is metadata update without copy context. Usually it means that copy canceled before finished.");
ib.a.equals(Ub,J.wUj,!1)&&(Yb=!0,Zc="No-Op",gd="User hash of the copy is different then the user hash of the paste during cross-session copy-paste. Do nothing.")}Yb||(pb=Ta?this.getStringifiedError(Ta):"null",d.ULS.sendTraceTag(24150916,0,10,`CopyPasteInfrastructure.OnPasteFailed: ${pb}, copyPasteTargetType="${P.copyPasteTargetType}"`));this.Jui(P,Yb,gd,Zc,Ub,id,Lc,Ta.pasteContext,hd);return Promise.reject(Ta)}Qmc(P,Ta){var pb;d.ULS.sendTraceTag(24150917,0,50,`CopyPasteInfrastructure.OnPasteSuccess: paste succeed. copyPasteTargetType="${Ta.copyPasteTargetType}"`);
this.pasteIndicationManager.jid(Ta.id);if(this.EWi(Ta.copyPasteTargetType,P)){r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!k.a.pz&&P.wasLastCopyExternal&&P.payloadType===R.shadowWorkbook&&(this.G6a=!0);var Yb=null;(null===(pb=P.pastedRange)||void 0===pb?0:pb.Ranges)&&0<P.pastedRange.Ranges.length?Yb=S.g(P.pastedRange.Ranges):P.wasLastCopyExternal||(Yb=Ta.expandDestinations);this.llj(P,Yb);if(this.zxj(P,Yb)){let Ac;this.P$c?(pb=S.d(Ta.originalDestinations),
Ac=1028===Ta.commandType?S.d(Ta.expandDestinations):S.d(Yb)):(pb=v.a.clone(Ta.originalDestinations),Ac=1028===Ta.commandType?v.a.clone(Ta.expandDestinations):v.a.clone(Yb));let Zc=null;P.wasLastCopyExternal&&(Ta.isKeyboardEvent||Ta.isPasteCommandFromRecoveryUI)&&(Zc={[cc.FFf]:P.clipboardItems});this.Wdf&&this.pasteDestinationHasMergedCells(Ta.expandDestinations)&&(P.pasteDestinationHasMergedCells=!0);P.pasteRecoveryUIDisplayed=!0;const id=new qa(this.$,pb,Ac,Zc),gd=fa.GetServiceTaskFactory.Ra(this.$.da,
406,405,0);ca.TaskExtensions.Aa(gd,()=>{const Ub=gd.result;Ub.INg(id);Ub.MAj(Ta.ribbonCommandInfo.method)},this.la,8)}!P.pasteRecoveryUIDisplayed&&Yb.length&&(Yb=S.K(Yb),w.AFrameworkApplication.XH("XLS-SmartView-CutAndPaste-Treatment;XLS-SmartView-CutAndPaste-Control"),r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.CutAndPasteEnabled",!1)&&Yb&&(pb=Kb.d(this.$.xa.pa),Yb=new rb.a(Yb,pb),this.dWd(Yb,"CutAndPaste")))}this.Uxe("Paste/success/"+l.a[Ta.ribbonCommandInfo.method],P);
this.Kui(P);this.U1f&&(!Ta.isKeyboardEvent||K(P))&&this.$.ea.Tg.get(66)&&(d.ULS.sendTraceTag(537167770,0,15,"CopyPasteInfrastructure.OnPasteSuccess: show localStorage disable notification"),this.U1f=!1,this.R3g());return Promise.resolve(!0)}zxj(P,Ta){return!Ta||1!==Ta.length||P.commandParameters.clearSystemClipboard||P.commandParameters.clearStateOnFinish||P.commandParameters.skipClipboardAccess?!1:G(P)&&(Ta=P.clipboardItems.getItem(M.plainText),P=P.clipboardItems.getItem(M.html),void 0===Ta||null===
Ta||Ta.length>this.lyi||void 0===P||null===P||P.length>this.Bxa)?(d.ULS.sendTraceTag(537167769,0,50,"CopyPasteInfrastructure.ShouldShowPasteRecoveryUI: Not showing PasteRecoveryUI for external copy."),!1):!0}EWi(P,Ta){return 1===P||Ta.payloadType===R.plainText||r.EwaSettings.ma(161)&&Ta.payloadType===R.html||r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!k.a.pz&&Ta.payloadType===R.shadowWorkbook}pasteDestinationHasMergedCells(P){const Ta=W.g(this.$).Ea.cF();
if(!Ta||!Ta.length)return!1;for(const pb of Ta)if(pb.gw(P[0]))return!0;return!1}Uxe(P,Ta){let pb;({xGa:pb}=this.Oei(Ta)).returnValue&&this.ir(P,pb,void 0,void 0,Ta.commandParameters.copyPasteTargetType).catch(()=>{})}f9a(P,Ta,pb,Yb,Ac,Zc){var id=P?this.getStringifiedError(P):"null";d.ULS.sendTraceTag(24150918,0,10,`CopyPasteInfrastructure.OnDragAndDropCellsFailed: ${id}`);let gd=id=!1,Ub=!1,Lc=cc.rrb,hd=cc.lIe+cc.qIa;P&&(hd+=cc.FJa(P),xa.a.er(P.ewaErrors)?(Lc=this.C$b(P.ewaErrors),xa.a.jh(P.ewaErrors,
cc.operationSucceededWithAlert)&&(id=!0),xa.a.jh(P.ewaErrors,cc.dragDropNonEmptyRange)&&(gd=Ub=!0)):P.message&&(Lc=P.message));Ub||(Ub=this.Lmd(P));gd?this.gridView.ha.selectionType=-1:this.Jp.l6i(Ac);this.Ati(Ta,pb,Yb,Ac,Ub,Lc,hd,id,Zc)}kYc(P,Ta){let pb=P;const Yb=this.eQh();if(null===Yb||void 0===Yb?0:Yb.ranges)pb=this.Jp.iTg(Ta,Yb.ranges,P);return pb}eQh(){const P=L(this.xK);return P&&D(P.sourceItem)?P.sourceItem:null}r3i(){this.raiseEvent(cc.RAd,null)}llj(P,Ta){const pb=P.commandParameters.originalDestinations;
Ta&&(S.Q(this.gridView.ha.sa.selectedRanges,pb)?(this.Vtc(Ta),P=ya.HelperMethods.Anb(Ta),d.ULS.sendTraceTag(537167767,0,50,`CopyPasteInfrastructure.SelectPastedRangeIfNeeded: select paste range, range: ${P}`)):P.commandParameters.isPasteCommandFromRecoveryUI?(this.Vtc(Ta,!0),d.ULS.sendTraceTag(537167766,0,50,`CopyPasteInfrastructure.SelectPastedRangeIfNeeded: select paste range for IsPasteCommandFromRecoveryUI, range: ${Ta}, active cell: ${Ta[0].topLeft}`)):(P=ya.HelperMethods.Anb(pb),d.ULS.sendTraceTag(537167765,
0,50,`CopyPasteInfrastructure.SelectPastedRangeIfNeeded: user change his selection during paste operation. don't change selection. originalPasteDestinations: ${P}`)))}Oei(P){if(P.isPlainTextPaste||P.isHtmlPaste||T(P)||P.commandParameters.isPasteCommandFromEnterShortcut)return{returnValue:!0,xGa:!1};var Ta=P.copyContextSnapshot;if(P.commandParameters.clearStateOnFinish)return{returnValue:!0,xGa:!0};if(Ta&&D(Ta.sourceItem)){var pb=Ta.sourceItem;if(!pb.isFromCurrentSession(this.$))return{returnValue:!1,
xGa:!0};Ta=-1985798686===Ta.commandParameters.ribbonCommandInfo.command;if(!(1<pb.ranges.length||1<P.commandParameters.expandDestinations.length)){const Yb=S.K(pb.ranges);P=S.K(P.commandParameters.expandDestinations);const Ac=this.$.ea.pa.sheetName;pb=pb.sheetName;if(pb===Ac&&P.equals(Yb))return{returnValue:!1,xGa:!0};if(pb===Ac&&P.Ge(Yb))return{returnValue:!0,xGa:!1}}return{returnValue:Ta,xGa:!0}}return{returnValue:!1,xGa:!0}}HCf(){var P=L(this.xK);(P=this.Jp.zvb(P))&&P.isFromCurrentSession(this.$)&&
this.ir("OnStartEdit",!1).catch(()=>{})}C$b(P){P=xa.a.MMh(P,cc.qIa);return this.vzi+e.a.Sv(P).toString()}Lmd(P){P=cc.FJa(P);return!!P&&ib.a.v1a(P,cc.uzi)}R3g(){const P=xa.a.Yc(1,2,332,333,k.a.jp?334:k.a.JH?335:336,530046625,"ActivateLocalStorage"),Ta=fa.GetServiceTaskFactory.Ra(this.$.da,5,4,0);ca.TaskExtensions.Aa(Ta,()=>{Ta.result.Yf(43,P)},this.la,3)}gBe(P){return void 0===P||null===P?pa.PCi:P?pa.success:pa.failed}static n2g(P){const Ta=P.innerError;return Ta&&0!==Ta.pasteErrorName?P.innerError:
null}static $1g(P){const Ta=P.innerError;return Ta&&0!==Ta.copyErrorName?P.innerError:null}static FJa(P){let Ta="";if(!P)return cc.tFe;P.errorName&&(Ta=P.errorName,P.innerError&&(Ta+=cc.qIa+cc.FJa(P.innerError)));Ta||(Ta=P&&P.name?P.name:cc.tFe);return Ta}static Q9b(){cc.LR||(Y.a.kef()?cc.LR=oa.YBj:Y.a.$nd()?cc.LR=oa.XBj:cc.LR=oa.WBj);return cc.LR}static ZAe(P){switch(P){case 7:case 1:return 2198;case 5:return 2195;case 6:return 2194;case 8:case 3:case 2:case 4:case 9:case 10:return 2191;default:return d.ULS.shipAssertTag(537167764,
0,!1,`CopyPasteInfrastructure.ConvertPasteValidationOptionToJsStringId: no case for validationOptions = ${P}`),2198}}static a2g(P){switch(P){case 3:return 2192;case 1:return 2193;case 2:case 4:return 2191;default:return d.ULS.shipAssertTag(537167763,0,!1,`CopyPasteInfrastructure.ConvertCopySourceValidationOptionToJsStringId: no case for validationOptions = ${P}`),2198}}dWd(P,Ta){ca.TaskExtensions.Aa(fa.GetServiceTaskFactory.Ra(this.$.da,426,427,1),pb=>{void pb.result.g7(P,Ta);d.ULS.sendTraceTag(512615303,
0,50,"CopyPasteInfrastructure.triggerTableInvitationHandRaise: IntelligentMetadataOverlayManager is triggered.")},this.$.la,3)}}cc.ypf="EwaJsMetadataChangeListenerId";cc.RAd="cpiOSC";cc.ich="cpiDID";cc.rrb="Unknown";cc.tFe="UnknownError";cc.qIa="_";cc.lIe="DragAndDropError";cc.pasteErrorName="PasteError";cc.iUg="CancelError";cc.copyErrorName="CopyError";cc.uzi="MergedCellOverlap";cc.FFf="PasteRecoveryCachedClipboardItems";cc.Ajj=[1352631530,1679665408];cc.operationSucceededWithAlert=[-103190598];
cc.pasteDataLimitHit=[1306609195];cc.copyThrottlingError=[-386183710];cc.dragDropNonEmptyRange=[563945982];cc.LR=null;Object(c.a)(cc,"CopyPasteInfrastructure",u.a,[780,781,2]);class nc{constructor(){this.t_a=this.fye=null}}Object(c.a)(nc,"ClipboardPlatformInitializationResult",null,[]);var Wb=a(185),Ea=a(637),ua=a(551),ma=a(120),fb=a(5),sb=a(61);const Ua=(P,Ta,pb,Yb,Ac,Zc,id,gd,Ub,Lc=null)=>{Ub=P.Na(9,Ub);Ub.sourceRanges=Ta;Ub.destinationRanges=pb;Ub.flags=Yb;return sb.g(P,"PasteRange",Ub,Ac,Zc,id,
gd,64,Lc)},ab=(P,Ta,pb,Yb,Ac,Zc,id,gd=null)=>{id=P.Na(1,id);id.pasteHtmlParameters=Ta;return sb.g(P,"PasteHtmlContent",id,pb,Yb,Ac,Zc,64,gd)},na=(P,Ta,pb,Yb,Ac,Zc,id,gd,Ub=null)=>{gd=P.Na(9,gd);gd.destinationRange=Ta;gd.source=pb;return sb.g(P,"PasteString",gd,Yb,Ac,Zc,id,64,Ub)},Na=(P,Ta,pb,Yb,Ac,Zc,id=null,gd=null)=>{id=P.Na(1,id);id.copyParameters=Ta;return sb.g(P,"Copy",id,pb,Yb,Ac,Zc,0,gd)},Va=(P,Ta,pb,Yb,Ac,Zc,id=null,gd=null)=>{id=P.Na(1,id);id.copyParameters=Ta;return sb.g(P,"Cut",id,pb,Yb,
Ac,Zc,0,gd)},Sa=(P,Ta,pb,Yb,Ac,Zc,id=null,gd=null)=>{id=P.Na(1,id);id.pasteParameters=Ta;return sb.g(P,"Paste",id,pb,Yb,Ac,Zc,64,gd)};class vb{constructor(P,Ta,pb){this.destinationRange=this.sourceRange=null;this.pasteFlags=0;this.sourceRange=P;this.destinationRange=Ta;this.pasteFlags=pb}}Object(c.a)(vb,"MacroRecorderPasteRangePayload",null,[101]);class Oa{constructor(P,Ta){this.content=this.destinationRange=null;this.destinationRange=P;this.content=Ta}getContent(){return this.content}}Object(c.a)(Oa,
"MacroRecorderPasteStringPayload",null,[101]);class yb{constructor(P){this.pasteParameters=null;this.pasteParameters=P}}Object(c.a)(yb,"MacroRecorderPastePayload",null,[101]);var Ob=a(580),Ja=a(759),lb=a(513),Pb=a(170),Jb=a(208),Lb=a(121),Ab=a(280);const nb=(P,Ta,pb,Yb,Ac,Zc,id=null)=>{id=P.Na(41,id);id.insertCopiedCutCellsParameters=Ta;return sb.g(P,"InsertCopiedCutCells",id,pb,Yb,Ac,Zc,4)},va=(P,Ta,pb,Yb,Ac,Zc,id=null)=>{id=P.Na(41,id);id.insertCopiedCutCellsParameters=Ta;return sb.g(P,"InsertCopiedCutCellsV2",
id,pb,Yb,Ac,Zc,0)};class db{constructor(P){this.parameters=null;this.parameters=P}getParameters(){return this.parameters}}Object(c.a)(db,"MacroRecorderRangeCopyCutCellsInsertedPayload",null,[101]);var Xa=a(368);class gb{constructor(P,Ta,pb,Yb,Ac,Zc,id,gd,Ub){this.destinationRange=P;this.mqb=pb;this.xWi=Yb;this.Jd=Ac;this.hOb=Zc;this.pasteContext=id;this.b1b=gd;this.M9f=Ub}}Object(c.a)(gb,"PasteHtmlRequestParams",null,[]);class Ha{constructor(P,Ta){this.Lhc=this.DMa=null;this.MOa=ea.a.MOa;this.fCd=
ea.a.fCd;this.bCb=ea.a.bCb;this.Hec=r.EwaSettings.getBooleanFeatureGate(ea.a.J3b,!1);this.xnd=ea.a.xnd;this.kld=!1;this.pwa=r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CopyPasteWFEIncreasedLimits",!1);this.Hz=(pb,Yb)=>{if(2===Yb.Lq)this.ov.clear(),this.DMa=null;else if(1===Yb.Lq&&this.ov&&this.ov.contains(Yb.xf)){pb=ma.a(Yb.xf.operation.operationName);const Ac=Yb.xf.dequeueUtcTime.getTime()-Yb.xf.enqueueUtcTime.getTime();d.ULS.sendTraceTag(526758673,0,50,`CopyPasteUtils.OnQueueChanged: web method ${pb} returned, it took ${Ac} milliseconds to complete.`);
this.ov.remove(Yb.xf);this.DMa=null}};this.$=P;this.gridView=Ta;this.kld&&(this.$.userOperationManager.Hr(this.Hz),this.ov=new Wb.a)}get Bxa(){return this.pwa?r.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.CopyPasteHtmlImportMaxLength",this.$.ya.CopyPasteMaxPayloadLength):y.a.Bxa}copy(P,Ta,pb,Yb=null,Ac=null){const Zc=this.$.oa.va.Sb();this.kld&&this.xX();var id=(gd,Ub,Lc)=>{const hd={CopyPasteTargetType:1};hd.SourceRanges=P;hd.CopyOperationId=Ta.id;d.ULS.sendTraceTag(537167756,0,50,`CopyPasteInfrastructure.Copy served from CopyPasteProxy : ${this.pwa}, CopyOperationId : ${hd.CopyOperationId}`);
return this.DMa=this.pwa?Na(this.$.oa.Wv,hd,Ab.b(gd,pb),Yb?Ab.a(Ub,Yb):Ub,Lc,Ta.ribbonCommandInfo,Zc,Ac):Na(this.$.oa.va,hd,Ab.b(gd,pb),Yb?Ab.a(Ub,Yb):Ub,Lc,Ta.ribbonCommandInfo,Zc,Ac)};this.Lhc=Zc.ClientRequestId;id=r.EwaSettings.dc()?new Pb.a(505,0,id,80):new lb.a(505,0,id,16);id=this.$.userOperationManager.Ub(id,Ta.ribbonCommandInfo);this.kld&&this.ov.add(id)}EFf(P,Ta,pb,Yb,Ac,Zc){return new Promise((id,gd)=>{var Ub;const Lc=Zc.commandParameters.stopwatch.uc;let hd=2;20===Zc.commandParameters.commandType&&
(hd=16);36===Zc.commandParameters.commandType&&(hd=32);Y.a.$nd()&&68===Zc.commandParameters.commandType&&(hd=64);Y.a.yqd(this.$)&&1028===Zc.commandParameters.commandType&&(hd=1024);let Kd=null;if(null===(Ub=Zc.copyContextSnapshot)||void 0===Ub?0:Ub.commandParameters)Kd=Zc.copyContextSnapshot.commandParameters.id;Ha.IMd(this.$,P,Yb,Ta,pb,null,Wd=>{Ha.Nbc(Wd,Zc,id,gd,Lc,this.$,null,null,null)},Wd=>{Zc.serverRequestTimeInMs=Zc.commandParameters.stopwatch.uc-Lc;Wd=Lb.a.lf(Wd.data);gd(new Ja.a(5,Wd))},
Ac,hd,Kd,Zc.commandParameters.id)})}pasteRange(P,Ta,pb,Yb,Ac,Zc,id,gd,Ub,Lc){return new Promise((hd,Kd)=>{const Wd=id.commandParameters.stopwatch.uc;Ha.wmj(this.$,P,Ta,pb,Yb|-5&Ac,oe=>{Ha.Nbc(oe,id,hd,Kd,Wd,this.$,null,Ub,Lc)},oe=>{id.serverRequestTimeInMs=id.commandParameters.stopwatch.uc-Wd;oe=Lb.a.lf(oe.data);oe=new Ja.a(5,oe);null===Lc||void 0===Lc?void 0:Lc(oe);Kd(oe)},Zc,gd)})}A0i(P,Ta,pb,Yb,Ac,Zc,id){return(new Promise((gd,Ub)=>{if(Ta)if(Ta.length>this.Bxa){var Lc=id.clipboardItems.getItem(M.plainText);
let hd=-1;void 0!==Lc&&null!==Lc&&(hd=Lc.length);ea.a.icf&&Ta.length<this.fCd&&Ta.length>this.MOa&&(this.IGf(Ta),this.uV=new gb(P,Ta,pb,Yb,Ac,Zc,id,0,this.roc.length),window.requestIdleCallback&&window.requestIdleCallback(()=>this.vCd()));d.ULS.sendTraceTag(42071712,0,15,`CopyPasteInfrastructure.ProcessPasteHtml copy paste length too long. clipboardHtml.Length: ${Ta.length}, MaxHtmlImportLength: ${this.Bxa}, PlainTextLength: ${hd}`);Ub(new Ja.a(1))}else Lc=(hd,Kd,Wd)=>{this.$.ry();const oe=id.commandParameters.stopwatch.uc;
hd=Ab.b(hd,af=>{Ha.Nbc(af,id,gd,Ub,oe,this.$,Ta,null,null)});Kd=Ab.a(Kd,af=>{id.serverRequestTimeInMs=id.commandParameters.stopwatch.uc-oe;af=Lb.a.lf(af.data);Ub(new Ja.a(3,af))});const We=this.$.oa.va.Sb(),Ze=S.v(P,this.$),Be={};Be.SourceHtml=Ta;Be.DestinationRanges=Ze?S.s(Ze):null;Be.CopyOperationId=pb;Be.PasteId=Yb;d.ULS.sendTraceTag(537167755,0,50,`CopyPasteInfrastructure.ProcessPasteHtml served from CopyPasteProxy : ${this.pwa}. PasteId : ${Be.PasteId}`);return this.pwa?ab(this.$.oa.Wv,Be,hd,
Kd,Wd,null,We,Zc):ab(this.$.oa.va,Be,hd,Kd,Wd,null,We,Zc)},Lc=r.EwaSettings.dc()?new Pb.a(204,0,Lc,65):new lb.a(204,0,Lc,1),this.$.userOperationManager.Ub(Lc,Ac);else gd("")})).then(()=>{ea.a.icf&&Ta.length>this.MOa&&(this.IGf(Ta),this.uV=new gb(P,Ta,pb,Yb,Ac,Zc,id,0,this.roc.length),window.requestIdleCallback&&window.requestIdleCallback(()=>this.vCd()))})}IGf(P){const Ta=this.$.Ib.Bc("Task","pasteHtmlChunkOperation"),pb=Math.floor(P.length/this.MOa)+1;this.roc=Array(pb);let Yb=0;for(;Yb<pb;)this.roc[Yb]=
P.substring(Yb*this.MOa,(Yb+1)*this.MOa),Yb++;d.ULS.sendTraceTag(523257954,0,50,`CopyPasteUtils.populatePasteChunks Time taken for chunking: ${Ta.uc}`)}vCd(){this.wWi(this.uV.destinationRange,this.roc[this.uV.b1b],this.uV.mqb,this.uV.xWi,this.uV.Jd,this.uV.hOb,this.uV.pasteContext,this.uV.b1b,this.uV.M9f);this.uV.b1b++;this.uV.b1b<this.uV.M9f&&window.requestIdleCallback(()=>this.vCd())}wWi(P,Ta,pb,Yb,Ac,Zc,id,gd,Ub){var Lc=(hd,Kd,Wd)=>{const oe=id.commandParameters.stopwatch.uc;hd=Ab.b(hd,()=>{d.ULS.sendTraceTag(512313415,
0,15,`CopyPasteUtils.pasteHtmlServerCall succeeded serverRequestTimeInMs:${id.commandParameters.stopwatch.uc-oe},
             pasteid:${Yb},
             chunkIndex:${gd},
             totalChunks:${Ub}`)});Kd=Ab.a(Kd,()=>{id.serverRequestTimeInMs=id.commandParameters.stopwatch.uc-oe;d.ULS.sendTraceTag(512313414,0,15,`CopyPasteUtils.pasteHtmlServerCall failed serverRequestTimeInMs:${id.serverRequestTimeInMs},
               pasteid:${Yb},
               chunkIndex:${gd},
               totalChunks:${Ub}`)});const We=this.$.oa.va.Sb();var Ze=S.v(P,this.$);Ze={SourceHtml:Ta,DestinationRanges:Ze?S.s(Ze):null,CopyOperationId:pb,PasteId:`${Yb}_chunk_${gd}`,ChunkIndex:gd,TotalChunks:Ub};d.ULS.sendTraceTag(523257952,0,50,`CopyPasteInfrastructure.ProcessPasteHtml served from CopyPasteProxy : ${this.pwa}. PasteId : ${Ze.PasteId}`);return ab(this.$.oa.Wv,Ze,hd,Kd,Wd,null,We,Zc)};Lc=r.EwaSettings.dc()?new Pb.a(204,0,Lc,65):new lb.a(204,0,Lc,1);this.$.userOperationManager.Ub(Lc,
Ac)}B0i(P,Ta,pb,Yb,Ac){return new Promise((Zc,id)=>{d.ULS.sendTraceTag(537167754,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: method start. pasteContext.Id=${Ac.id}`);Ta&&(Ta=ib.a.trimEnd(Ta,"\n","\r"));d.ULS.sendTraceTag(537167753,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: after clipboardText.TrimEnd. pasteContext.Id=${Ac.id}`);if(Ta)if(Ta.length>this.bCb)d.ULS.sendTraceTag(24150921,0,15,"CopyPasteInfrastructure.ProcessPasteText copy paste length too long. clipboardText.Length: {0}, MaxCopyPasteLength: {1}",
Ta.length,this.bCb),id(new Ja.a(1));else{let Ub,Lc;const hd=S.v(P,this.$);d.ULS.sendTraceTag(537167752,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before treatAsLink calculation. pasteContext.Id=${Ac.id}`);var gd=!this.$.ea.isNamedObjectViewMode&&!Ta.includes("\n")&&!Ta.includes("\t");d.ULS.sendTraceTag(537167751,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before isLink check. pasteContext.Id=${Ac.id}. treatAsLink=${gd}`);gd=gd&&ib.a.Kdf(Ta);d.ULS.sendTraceTag(537167750,
0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: after treatAsLink calculation. pasteContext.Id=${Ac.id}. treatAsLink=${gd}`);const Kd=this.$.oa.va.Sb();if(gd){Lc=526;d.ULS.sendTraceTag(537167749,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before FixUpUrl. pasteContext.Id=${Ac.id}`);const Wd=Jb.a.Q$c(Ta);d.ULS.sendTraceTag(537167748,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: after FixUpUrl. pasteContext.Id=${Ac.id}`);const oe=S.s(hd);gd=(We,
Ze,Be)=>{const af=Ac.commandParameters.stopwatch.uc;We=Ab.b(We,ff=>{d.ULS.sendTraceTag(537167747,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: on ApplyHyperlink successCallback. pasteContext.Id=${Ac.id}`);Ac.requestTelemetryData=ff.RequestTelemetryData;Ac.serverRequestTimeInMs=Ac.commandParameters.stopwatch.uc-af;ff.Errors&&0<ff.Errors.length?id(new Ja.a(2,ff.Errors)):Zc(Ta)});Ze=Ab.a(Ze,ff=>{Ac.serverRequestTimeInMs=Ac.commandParameters.stopwatch.uc-af;ff=Lb.a.lf(ff.data);id(new Ja.a(2,
ff))});this.$.ry();d.ULS.sendTraceTag(537167746,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before ApplyHyperlink. pasteContext.Id=${Ac.id}`);return sb.b(this.$.oa.va,oe,Ta,Wd,!1,!1,63,We,Ze,Be,P,Kd,Yb)};Ub=()=>new Ob.a(oe,Ta,Wd)}else Lc=180,gd=(Wd,oe,We)=>{this.$.ry();const Ze=Ac.commandParameters.stopwatch.uc;Wd=Ab.b(Wd,Be=>{d.ULS.sendTraceTag(537167745,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: on PasteString successCallback. pasteContext.Id=${Ac.id}`);
Ha.Nbc(Be,Ac,Zc,id,Ze,this.$,Ta,null,null)});oe=Ab.a(oe,Be=>{Ac.serverRequestTimeInMs=Ac.commandParameters.stopwatch.uc-Ze;Be=Lb.a.lf(Be.data);id(new Ja.a(4,Be))});d.ULS.sendTraceTag(537167744,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before PasteString. pasteContext.Id=${Ac.id}`);return na(this.$.oa.va,hd,Ta,Wd,oe,We,null,Kd,Yb)},Ub=()=>new Oa(hd,Ta);d.ULS.sendTraceTag(537167715,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before UserNonBlockingWebMethodOperation. pasteContext.Id=${Ac.id}`);
gd=r.EwaSettings.dc()?new Pb.a(Lc,0,gd,65,Ub):new lb.a(Lc,0,gd,1,Ub);d.ULS.sendTraceTag(537167714,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: returning. pasteContext.Id=${Ac.id}`);this.$.userOperationManager.Ub(gd,pb)}else Zc("")})}p7e(P,Ta){Ta=[1===Ta?4:5];this.gridView.lb.vv(rb.a.d7(Kb.d(this.$.pa),P),Ta,!0);this.gridView.lb.zn(Ta);this.gridView.lb.update(!0)}ucc(){const P=[4,5];this.gridView.lb.Mg(P,!1,!1);this.gridView.lb.oi(null,P,!1);1===this.gridView.ha.Je&&this.gridView.zn(!1,
!1);this.gridView.lb.update(!1,!1)}iTg(P,Ta,pb){const Yb=[];for(const Ac of pb)Yb.push(this.lTg(P,Ta,Ac));return Yb}xX(){if(this.ov)for(let P of this.ov)if(this.$&&this.$.userOperationManager){if(P.operation){const Ta=ma.a(P.operation.operationName);d.ULS.sendTraceTag(526758675,0,50,`CopyPasteUtils.AbortOutstandingUserOperation: Trying to abort pending operation ${Ta}.`)}this.gUg();this.$.userOperationManager.ita(P)}}gUg(){if(this.DMa){const P=this.DMa.Nt;d.ULS.sendTraceTag(526758674,0,15,`Cancelling pending copy request with Id=${P}`);
Lb.a.tu(P);!r.EwaSettings.isChangeGateEnabled("OfficeVSO:6151555_DisableCancelCopyRequest")&&this.Lhc&&sb.h(this.$.oa.va,this.Lhc,null,null,null);this.Lhc=this.DMa=null}}lTg(P,Ta,pb){d.ULS.shipAssertTag(537167713,0,!!Ta,"CopyPasteUtils.CalculateSingleImpactedRange: sourceArray shouldn't be null");d.ULS.shipAssertTag(537167712,0,0<Ta.length,"CopyPasteUtils.CalculateSingleImpactedRange: sourceArray length shouldn't be zero");let Yb=0,Ac=0;var Zc=new Set;const id=new Set;for(const gd of Ta){Ta=`${gd.left}_${gd.right}`;
const Ub=`${gd.top}_${gd.bottom}`;id.has(Ta)||(id.add(Ta),Ac+=gd.width);Zc.has(Ub)||(Zc.add(Ub),Yb+=gd.height)}if(36===P)return pb.isSingle?Ha.pQe(Ac,Yb,pb):pb.clone();516===P&&(P=Yb,Yb=Ac,Ac=P);P=!(pb.width%Ac)&&!(pb.height%Yb);Zc=pb.xZ&&!(pb.height%Yb);pb.D4&&!(pb.width%Ac)||Zc?pb=Ha.pQe(Ac,Yb,pb):P?pb=pb.clone():(pb=pb.clone(),pb.bottom=Math.min(y.a.dh,pb.top+Yb-1),pb.right=Math.min(y.a.mh,pb.left+Ac-1));return pb}KKg(P,Ta,pb,Yb,Ac,Zc,id,gd,Ub,Lc,hd){if(!Yb||!Yb.length)return 1;if(1<Yb.length){if(!this.Hec&&
Zc)return 3;if(Lc)return 0;if(gd)return 9;if(Ub)return 8;if(hd)return 2;if(1<Ta.length)return 4;const Kd=Ta[0];if(!id&&!v.a.all(Yb,Wd=>Wd.isSingle||!(Wd.width%Kd.width)&&!(Wd.height%Kd.height)))return 5;if((!this.Hec||!Zc)&&ib.a.equals(P,pb,!0))for(const Wd of Ac)if(Wd.Dd(Kd)&&!Wd.equals(Kd))return 6}else if(Ta&&0<Ta.length){if(0!==this.obf(Ta,Ub))return 7;if(1<Ta.length){if(!this.Hec&&Zc)return 3;if((!this.Hec||!Zc)&&ib.a.equals(P,pb,!0))for(const Kd of Ta)if(P=Ac[0],Kd.Dd(P)&&!Kd.equals(P))return 6}}return 0}obf(P,
Ta){if(!P||1>=P.length)return 0;if(Ta)return 2;if(!S.S(P))return 1;Ta=new Ea.a(ua.a.Sk());for(const pb of P)for(const Yb of P){const Ac=pb.top===Yb.top&&pb.bottom===Yb.bottom,Zc=pb.left===Yb.left&&pb.right===Yb.right,id=Math.max(pb.left,Yb.left)<Math.min(pb.right,Yb.right);if(Math.max(pb.top,Yb.top)<Math.min(pb.bottom,Yb.bottom)&&!Ac||id&&!Zc)return 3;Ta.add(`${pb.top}-${pb.bottom}-${Yb.left}-${Yb.right}`);Ta.add(`${Yb.top}-${Yb.bottom}-${pb.left}-${pb.right}`)}for(const pb of P)Ta.remove(`${pb.top}-${pb.bottom}-${pb.left}-${pb.right}`);
return 0<Ta.count?3:0}l6i(P){const Ta=this.gridView.ha;Ta.updateSelection(P,P.topLeft,0);Ta.selectionType=-1}zvb(P){if(null===P||void 0===P?0:P.sourceItem){if(!D(P.sourceItem))return null;if((P=P.sourceItem)&&S.cb(P.ranges,!0))return P}return null}kfc(P,Ta){d.ULS.shipAssertTag(537167711,0,!!P,"CopyPasteUtils.IsFromKeyboardShortcut: commandInfo shouldn't be null");return Ta&&fb.a.bG in Ta||P.tabName?!1:1===P.method}static wmj(P,Ta,pb,Yb,Ac,Zc,id,gd,Ub){const Lc=P.oa.va.Sb(Ub?{MZ:!0,dZ:1}:{MZ:!1,dZ:0});
Ub=(Kd,Wd,oe)=>{P.ry();return Ua(P.oa.va,pb,Yb,Ac,Ab.b(Kd,Zc),Ab.a(Wd,id),oe,null,Lc,gd)};const hd=()=>new vb(pb,Yb,Ac);Ub=r.EwaSettings.dc()?new Pb.a(506,0,Ub,65,hd):new lb.a(506,0,Ub,1,hd);P.userOperationManager.Ub(Ub,Ta)}static Nbc(P,Ta,pb,Yb,Ac,Zc,id=null,gd,Ub){d.ULS.sendTraceTag(537167710,0,50,`CopyPasteInfrastructure.HandlePasteResult profiling trace: on HandlePasteResult start. pasteContext.Id=${Ta.id}`);Ta.requestTelemetryData=P.RequestTelemetryData;Ta.serverRequestTimeInMs=Ta.commandParameters.stopwatch.uc-
Ac;xa.a.rg(P.Errors)?xa.a.tga(P.Errors)?(Ta&&(Ta.encounteredDeploymentErrors=!0),P=xa.a.yc(P.Errors),d.ULS.sendTraceTag(537167707,0,15,`CopyPasteUtils.HandlePasteServerResponse: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${P}`)):(P=new Ja.a(5,P.Errors),null===Ub||void 0===Ub?void 0:Ub(P),Yb(P)):P.Result?(Yb=!!P&&!!P.RequestTelemetryData,W.g(Zc).Gi.Pka(Ta.commandParameters.stopwatch.id,P.StateId,Yb?P.RequestTelemetryData.EcsOperationDuration:0,Yb?P.RequestTelemetryData.EcsRequestDuration:
0,Yb?P.RequestTelemetryData.WfeRequestDuration:0),Ta.pastedRange=P.Result.SheetMultiRange,d.ULS.sendTraceTag(537167708,0,50,`CopyPasteInfrastructure.HandlePasteResult profiling trace: resolving promise ewaResult.Result is not null. pasteContext.Id=${Ta.id}`),null===gd||void 0===gd?void 0:gd(),pb(!0)):(d.ULS.sendTraceTag(537167709,0,50,`CopyPasteInfrastructure.HandlePasteResult profiling trace: resolving promise when ewaResult.Result is null. pasteContext.Id=${Ta.id}`),pb(id||!0))}static IMd(P,Ta,
pb,Yb,Ac,Zc,id,gd,Ub,Lc,hd,Kd){const Wd=P.oa.va.Sb(),oe=Ha.S7g(pb,Yb,Ac,Lc,hd,Kd);pb=(We,Ze,Be)=>{P.ry();return Sa(P.oa.va,oe,Ab.b(We,id),Ab.a(Ze,gd),Be,Zc,Wd,Ub)};Yb=()=>new yb(oe);pb=r.EwaSettings.dc()?new Pb.a(503,0,pb,65,Yb):new lb.a(503,0,pb,1,Yb);P.userOperationManager.Ub(pb,Ta)}static S7g(P,Ta,pb,Yb,Ac,Zc){const id={};id.ShadowWorkbookBase64=P.shadowWorkbookBase64;id.SourceRanges={};id.SourceRanges.Ranges=Array(1);id.SourceRanges.Ranges[0]={};id.SourceRanges.Ranges[0].FirstRow=P.rangeRowStart;
id.SourceRanges.Ranges[0].LastRow=P.rangeRowEnd;id.SourceRanges.Ranges[0].FirstColumn=P.rangeColumnStart;id.SourceRanges.Ranges[0].LastColumn=P.rangeColumnEnd;r.EwaSettings.getBooleanFeatureGate(ea.a.J3b,!1)?pb?id.DestinationRanges=S.u(pb.SheetName,pb.NamedObjectName,S.g(pb.Ranges)):(d.ULS.sendTraceTag(537167706,0,15,"CopyPasteInfrastructure.CreatePasteParameters: multiRangeDestination is null"),id.DestinationRanges=null):id.DestinationRanges=Ta?S.s(Ta):null;id.CopyPasteTargetType=1;id.PasteType=
Yb;id.CopyOperationId=Ac;id.PasteId=Zc;id.SourceClientPath=P.sourceClientPath;id.SourceSheetName=P.sourceSheetName;id.SourceWorkbookName=P.sourceWorkbookName;if(!P.originalSourceRangesCountExceedsLimit&&P.originalSourceRanges&&0<P.originalSourceRanges.length&&1024===Yb){id.OriginalSourceMultiRange={};Ta=Array(P.originalSourceRanges.length);for(pb=0;pb<Ta.length;++pb)Ta[pb]={},Ta[pb].FirstRow=P.originalSourceRanges[pb][0],Ta[pb].FirstColumn=P.originalSourceRanges[pb][1],Ta[pb].LastRow=P.originalSourceRanges[pb][2],
Ta[pb].LastColumn=P.originalSourceRanges[pb][3];id.OriginalSourceMultiRange.Ranges=Ta}return id}static pQe(P,Ta,pb){pb=pb.clone();pb.height<Ta&&(pb.bottom=Math.min(y.a.dh,pb.top+Ta-1));pb.width<P&&(pb.right=Math.min(y.a.mh,pb.left+P-1));return pb}executeInsertCopiedCutCellsOperation(P,Ta,pb,Yb,Ac,Zc=null,id=null,gd=!1){const Ub={};Ub.InsertDirection=Yb;Ub.SourceRange=P;Ub.DestRange=Ta;Ub.CopyCutOperation=pb?0:1;const Lc=this.$.oa.va,hd=this.$.oa.va.Sb(),Kd=()=>new db(Ub);return Xa.a(this.$.userOperationManager,
(Wd,oe,We)=>this.xnd&&gd?va(Lc,Ub,Zc?Ab.b(Wd,Zc):Wd,id?Ab.a(oe,id):oe,We,hd):nb(Lc,Ub,Zc?Ab.b(Wd,Zc):Wd,id?Ab.a(oe,id):oe,We,null),Wd=>new Pb.a(104,0,Wd,void 0,Kd),Ac)}pIe(P,Ta,pb,Yb,Ac,Zc,id,gd){return new Promise((Ub,Lc)=>{this.executeInsertCopiedCutCellsOperation(Ta,pb,Yb,Ac,Zc,hd=>{P.requestTelemetryData=hd.RequestTelemetryData;if(hd.Errors&&0<hd.Errors.length){const Kd=new Ja.a(21,hd.Errors);null===gd||void 0===gd?void 0:gd(Kd);Lc(new Ja.a(21,hd.Errors))}else null===id||void 0===id?void 0:id(),
Ub(!0)},hd=>{hd=Lb.a.lf(hd.data);hd=new Ja.a(21,hd);null===gd||void 0===gd?void 0:gd(hd);Lc(hd)},!0)})}}Object(c.a)(Ha,"CopyPasteUtils",null,[778]);var tb=a(489),bc;(function(P){P[P.range=0]="range";P[P.art=1]="art"})(bc||(bc={}));Object(c.b)("SourceItemType",bc);var tc=a(24),Ma=a(90);class Tb{constructor(P){this.s6f={["SourceItemType.Range"]:0,["SourceItemType.Art"]:1};this.NLb={};this.o6f={["FloatingObjectType.Unknown"]:99,["FloatingObjectType.CardView"]:6,["FloatingObjectType.Chart"]:0,["FloatingObjectType.Group"]:7,
["FloatingObjectType.Image"]:1,["FloatingObjectType.Ink"]:8,["FloatingObjectType.InteractiveReport"]:4,["FloatingObjectType.ModernOfficeExtension"]:3,["FloatingObjectType.Shape"]:5,["FloatingObjectType.Slicer"]:2,["FloatingObjectType.Unsupported"]:100};this.UVc={["99"]:"FloatingObjectType.Unknown",["6"]:"FloatingObjectType.CardView",["0"]:"FloatingObjectType.Chart",["7"]:"FloatingObjectType.Group",["1"]:"FloatingObjectType.Image",["8"]:"FloatingObjectType.Ink",["4"]:"FloatingObjectType.InteractiveReport",
["3"]:"FloatingObjectType.ModernOfficeExtension",["5"]:"FloatingObjectType.Shape",["2"]:"FloatingObjectType.Slicer",["100"]:"FloatingObjectType.Unsupported"};this.r6f={["RibbonCommand.Copy"]:-911352779,["RibbonCommand.Cut"]:-1985798686};this.WKd={["-911352779"]:"RibbonCommand.Copy",["-1985798686"]:"RibbonCommand.Cut"};this.q6f={["InputManager.InputMethod.NotDefined"]:-1,["InputManager.InputMethod.Unknown"]:0,["InputManager.InputMethod.Keyboard"]:1,["InputManager.InputMethod.Mouse"]:2,["InputManager.InputMethod.Touch"]:3,
["InputManager.InputMethod.CrossSlide"]:9};this.Mja={};this.p6f={["FrameMode.None"]:0,["FrameMode.Reading"]:1,["FrameMode.Edit"]:2};this.D2a={};this.t6f={["UILocation.Unknown"]:0,["UILocation.UpperRibbon"]:1,["UILocation.Ribbon"]:2,["UILocation.QAT"]:3,["UILocation.Jewel"]:4,["UILocation.NavigationPane"]:5,["UILocation.KeyboardShortcut"]:6,["UILocation.StatusBar"]:7,["UILocation.Dialog"]:8,["UILocation.Floatie"]:9,["UILocation.NotificationBar"]:10,["UILocation.StandaloneCuiRoot"]:11,["UILocation.TaskPane"]:12,
["UILocation.HeroDock"]:13,["UILocation.SingleLineRibbon"]:14,["UILocation.MultilineRibbon"]:15,["UILocation.Overflow"]:16,["UILocation.TellMe"]:17,["UILocation.FarPeripheralControls"]:18,["UILocation.ContextMenu"]:19,["UILocation.DialogMenu"]:20,["UILocation.Header"]:21,["UILocation.FileMenu"]:22,["UILocation.Toolbar"]:26,["UILocation.Canvas"]:30};this.Ar={};this.$=P;this.Mja.notDefined="InputManager.InputMethod.NotDefined";this.Mja.unknown="InputManager.InputMethod.Unknown";this.Mja.keyboard="InputManager.InputMethod.Keyboard";
this.Mja.mouse="InputManager.InputMethod.Mouse";this.Mja.touch="InputManager.InputMethod.Touch";this.Mja.crossSlide="InputManager.InputMethod.CrossSlide";this.D2a.none="FrameMode.None";this.D2a.reading="FrameMode.Reading";this.D2a.edit="FrameMode.Edit";this.Ar.unknown="UILocation.Unknown";this.Ar.upperRibbon="UILocation.UpperRibbon";this.Ar.ribbon="UILocation.Ribbon";this.Ar.QAT="UILocation.QAT";this.Ar.jewel="UILocation.Jewel";this.Ar.navigationPane="UILocation.NavigationPane";this.Ar.keyboardShortcut=
"UILocation.KeyboardShortcut";this.Ar.statusBar="UILocation.StatusBar";this.Ar.dialog="UILocation.Dialog";this.Ar.floatie="UILocation.Floatie";this.Ar.notificationBar="UILocation.NotificationBar";this.Ar.standaloneCuiRoot="UILocation.StandaloneCuiRoot";this.Ar.taskPane="UILocation.TaskPane";this.Ar.heroDock="UILocation.HeroDock";this.Ar.singleLineRibbon="UILocation.SingleLineRibbon";this.Ar.multilineRibbon="UILocation.MultilineRibbon";this.Ar.overflow="UILocation.Overflow";this.Ar.tellMe="UILocation.TellMe";
this.Ar.farPeripheralControls="UILocation.FarPeripheralControls";this.Ar.header="UILocation.Header";this.Ar.fileMenu="UILocation.FileMenu";this.Ar.contextMenu="UILocation.ContextMenu";this.Ar.dialogMenu="UILocation.DialogMenu";this.Ar.toolbar="UILocation.Toolbar";this.Ar.canvas="UILocation.Canvas";this.NLb.range="SourceItemType.Range";this.NLb.art="SourceItemType.Art"}serializeSourceItem(P){const Ta={};if(P&&Object.getType(P)===H)Ta.sheetName=P.sheetName,Ta.topArray=v.a.map(P.ranges,pb=>pb.top),Ta.leftArray=
v.a.map(P.ranges,pb=>pb.left),Ta.bottomArray=v.a.map(P.ranges,pb=>pb.bottom),Ta.rightArray=v.a.map(P.ranges,pb=>pb.right),Ta.sessionStateId=P.sessionStateId,Ta.sessionId=P.sessionId,Ta.sourceItemType=this.lXf(0);else if(P&&Object.getType(P)===U)Ta.activeFloatingObjectControlId=P.activeFloatingObjectControlId,Ta.sheetName=P.sheetName,Ta.sessionStateId=P.sessionStateId,Ta.sessionId=P.sessionId,Ta.floatingObjectType=this.Zmj(P.type),Ta.sourceItemType=this.lXf(1);else return d.ULS.shipAssertTag(537167705,
0,!1,"EnvironmentSerializationHelper.SerializeSourceItem: sourceItem shouldn't be null."),null;return JSON.stringify(Ta)}serializeCommandParameters(P){if(!P)return d.ULS.shipAssertTag(537167704,0,!1,"EnvironmentSerializationHelper.Serialize: commandParameters shouldn't be null."),null;const Ta={};Ta.id=P.id;Ta.commandType=P.commandType;Ta.copyPasteTargetType=P.copyPasteTargetType;P.ribbonCommandInfo&&(Ta.ribbonCommandName=this.hnj(P.ribbonCommandInfo.command),Ta.inputMethodName=this.bnj(P.ribbonCommandInfo.method),
Ta.frameModeName=this.$mj(P.ribbonCommandInfo.mode),Ta.uiLocationName=this.lnj(P.ribbonCommandInfo.Re),Ta.tabName=P.ribbonCommandInfo.tabName);return JSON.stringify(Ta)}deserializeSourceItem(P){if(!P)return null;try{const Ta=JSON.parse(P);if(!Ta)return d.ULS.shipAssertTag(537167703,0,!1,"EnvironmentSerializationHelper.Deserialize: Json.Parse return null result."),null;let pb=null;switch(this.ldh(Ta.sourceItemType)){case 0:pb=new H(this.$,this.idh(Ta),Ta.sheetName,Ta.sessionStateId,Ta.sessionId);break;
case 1:pb=new U(Ta.activeFloatingObjectControlId,Ta.sheetName,Ta.sessionStateId,Ta.sessionId,this.fdh(Ta.floatingObjectType))}return pb}catch(Ta){return d.ULS.sendTraceTag(537167702,0,10,`EnvironmentSerializationHelper.DeserializeSourceItem: got exception while try to JSON.Parse string length: ${P?P.length:0}, errror: ${Ta}`),null}}deserializeCommandParameters(P){if(!P)return null;try{const Ta=JSON.parse(P);if(!Ta)return d.ULS.shipAssertTag(537167701,0,!1,"EnvironmentSerializationHelper.DeserializeCommandParameters: Json.Parse return null result."),
null;const pb=Pa.a();pb.id=Ta.id;pb.ribbonCommandInfo=this.kdh(Ta);pb.commandType=Ta.commandType;pb.copyPasteTargetType=Ta.copyPasteTargetType;return pb}catch(Ta){return d.ULS.sendTraceTag(537167700,0,10,`EnvironmentSerializationHelper.DeserializeCommandParameters: got exception while try to JSON.Parse string length: ${P?P.length:0}, errror: ${Ta}`),null}}idh(P){const Ta=[];d.ULS.shipAssertTag(537167699,0,!!P.topArray&&0<P.topArray.length,`EnvironmentSerializationHelper.DeserializeRanges: TopArray shouldn't be ${P.topArray?
"empty":"null"}.`);d.ULS.shipAssertTag(537167698,0,!!P.leftArray&&0<P.leftArray.length,`EnvironmentSerializationHelper.DeserializeRanges: LeftArray shouldn't be ${P.leftArray?"empty":"null"}.`);d.ULS.shipAssertTag(537167697,0,!!P.bottomArray&&0<P.bottomArray.length,`EnvironmentSerializationHelper.DeserializeRanges: BottomArray shouldn't be ${P.bottomArray?"empty":"null"}.`);d.ULS.shipAssertTag(537167696,0,!!P.rightArray&&0<P.rightArray.length,`EnvironmentSerializationHelper.DeserializeRanges: RightArray shouldn't be ${P.rightArray?
"empty":"null"}.`);if(!(P.topArray&&P.leftArray&&P.bottomArray&&P.rightArray))return Ta;d.ULS.shipAssertTag(537167695,0,P.topArray.length===P.bottomArray.length&&P.topArray.length===P.leftArray.length&&P.topArray.length===P.rightArray.length,`EnvironmentSerializationHelper.DeserializeRanges: The length of TopArray(${P.topArray.length}), BottomArray(${P.bottomArray.length}), LeftArray(${P.leftArray.length}), RightArray(${P.rightArray.length}) should be the same.`);const pb=Math.min(P.topArray.length,
P.bottomArray.length,P.leftArray.length,P.rightArray.length);for(let Yb=0;Yb<pb;Yb++)Ta.push(new tc.Range(P.topArray[Yb],P.leftArray[Yb],P.bottomArray[Yb],P.rightArray[Yb],!1,!1));return Ta}kdh(P){return new Ma.a(this.jdh(P.ribbonCommandName),this.hdh(P.inputMethodName),this.gdh(P.frameModeName),this.ndh(P.uiLocationName),P.tabName)}hnj(P){return void 0!==P&&null!==P&&P.toString()in this.WKd?this.WKd[P.toString()]:(d.ULS.shipAssertTag(537167694,0,!1,`EnvironmentSerializationHelper.SerializeRibbonCommand expected to get RibbonCommand.Copy(${-911352779}) or RibbonCommand.Cut(${-1985798686}) but got ${P}`),
this.WKd["-911352779"])}jdh(P){return P&&P in this.r6f?this.r6f[P]:(d.ULS.shipAssertTag(537167693,0,!1,`EnvironmentSerializationHelper.DeserializeRibbonCommand: expected to get RibbonCommand.Copy(${-911352779}) or RibbonCommand.Cut(${-1985798686}) but got ${P}`),-911352779)}bnj(P){return void 0!==P&&null!==P&&l.a[P]in this.Mja?this.Mja[l.a[P]]:(d.ULS.shipAssertTag(537167692,0,!1,`EnvironmentSerializationHelper.SerializeInputMethod: got unexpected value ${P}`),this.Mja.unknown)}hdh(P){return P&&P in
this.q6f?this.q6f[P]:(d.ULS.shipAssertTag(537167691,0,!1,`EnvironmentSerializationHelper.DeserializeInputMethod: got unexpected value ${P}`),0)}$mj(P){return void 0!==P&&null!==P&&tb.a[P]in this.D2a?this.D2a[tb.a[P]]:(d.ULS.shipAssertTag(537167690,0,!1,`EnvironmentSerializationHelper.SerializeFrameMode: got unexpected value ${P}`),this.D2a.edit)}gdh(P){return P&&P in this.p6f?this.p6f[P]:(d.ULS.shipAssertTag(537167689,0,!1,`EnvironmentSerializationHelper.DeserializeFrameMode: got unexpected value ${P}`),
2)}lXf(P){return void 0!==P&&null!==P&&bc[P]in this.NLb?this.NLb[bc[P]]:(d.ULS.shipAssertTag(537167688,0,!1,`EnvironmentSerializationHelper.SerializeSourceItemType: got unexpected value ${P}`),this.NLb.range)}ldh(P){return P&&P in this.s6f?this.s6f[P]:(d.ULS.shipAssertTag(537167687,0,!1,`EnvironmentSerializationHelper.DeserializeSourceItemType: got unexpected value ${P}`),0)}Zmj(P){return void 0!==P&&null!==P&&P.toString()in this.UVc?this.UVc[P.toString()]:(d.ULS.shipAssertTag(537167686,0,!1,`EnvironmentSerializationHelper.SerializeArtSourceItemType: got unexpected value ${P}`),
this.UVc["99"])}fdh(P){return P&&P in this.o6f?this.o6f[P]:(d.ULS.shipAssertTag(537167685,0,!1,`EnvironmentSerializationHelper.DeserializeArtSourceItemType: got unexpected value ${P}`),99)}lnj(P){return void 0!==P&&null!==P&&n.a[P]in this.Ar?this.Ar[n.a[P]]:(d.ULS.shipAssertTag(36229129,0,!1,`EnvironmentSerializationHelper.SerializeUILocation: got unexpected value ${P}`),this.Ar.ribbon)}ndh(P){return P&&P in this.t6f?this.t6f[P]:(d.ULS.shipAssertTag(537167684,0,!1,`EnvironmentSerializationHelper.DeserializeUILocation: got unexpected value ${P}`),
2)}}Object(c.a)(Tb,"EnvironmentSerializationHelper",null,[]);class zb{}zb.DUf="SameSession";zb.pEe="CrossSession";zb.Bjf="LegacyCrossSession";zb.external="External";Object(c.a)(zb,"PayloadOrigin",null,[]);const ic=P=>P?P.shadowWorkbookSizeExceedsLimit&&void 0!==P.shadowWorkbookBlockedSize&&null!==P.shadowWorkbookBlockedSize?P.shadowWorkbookBlockedSize:P.shadowWorkbookBase64?P.shadowWorkbookBase64.length:0:0,Qb=P=>P.shadowWorkbookSizeExceedsLimit?!0:ic(P)>y.a.Ljc;class wb{constructor(P,Ta){this._name=
Ta;this.$=P;this.Qm=B.a.instance;this.Jp=new Ha(P,W.g(P))}get name(){return this._name}get XVc(){return this.Qm.Xa(5)}shouldWaitForCopyToComplete(){return!1}onDeferredPasteStarted(){}onDeferredPasteCompleted(){}beforePaste(){}mNj(P){let Ta;Ta=null;try{const pb=P.getItem(M.shadowWorkbook);if(!pb)return{returnValue:!1,Z_:Ta};Ta=JSON.parse(pb);return{returnValue:this.Bni(Ta),Z_:Ta}}catch(pb){return d.ULS.sendTraceTag(537167835,0,50,"BaseCopyPasteHandler.TryParseRangeShadowWorkbookPayload: Exception caught: "+
pb),{returnValue:!1,Z_:Ta}}}Bni(P){return!!P&&(!!P.shadowWorkbookBase64||P.shadowWorkbookSizeExceedsLimit)&&void 0!==P.rangeRowStart&&void 0!==P.rangeRowEnd&&void 0!==P.rangeColumnStart&&void 0!==P.rangeColumnEnd}poc(P){P.wasLastCopyExternal=!0;if(r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!k.a.pz&&516!==P.commandParameters.commandType&&1028!==P.commandParameters.commandType){var Ta=null;if(({Z_:Ta}=this.mNj(P.clipboardItems)).returnValue)return P.isShadowWorkbookParsedSuccessfully=
!0,this.vWi(P,Ta)}if(516!==P.commandParameters.commandType&&36!==P.commandParameters.commandType){if(r.EwaSettings.ma(161)&&20!==P.commandParameters.commandType&&(null===this.$.shortcutKeyManager||this.$.shortcutKeyManager.Lec)&&(Ta=P.clipboardItems.getItem(M.html),void 0!==Ta&&null!==Ta&&Ta&&Ta.trim()!==this.XVc&&(Ta.startsWith("<")||k.a.Tf&&Ta.startsWith("\n<")))){const pb=P.clipboardItems.getItem(M.mqb);return this.tWi(P,Ta,void 0===pb?null:pb)}return this.AFf(P)}return Promise.reject(new Ja.a(6))}vWi(P,
Ta){d.ULS.sendTraceTag(537167834,0,50,"BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: Pasting shadow workbook from system clipboard");P.pasteResult="SystemClipboardShadowWorkbookPaste";P.payloadType=R.shadowWorkbook;P.payloadOrigin=zb.external;P.shadowWorkbookPayloadSize=ic(Ta);P.shadowWorkbookSizeExceedsLimit=Qb(Ta);let pb=null,Yb=null;const Ac=P.commandParameters.originalDestinations;r.EwaSettings.getBooleanFeatureGate(ea.a.J3b,!1)?pb=S.r(Ac,this.$):Yb=S.v(S.K(Ac),this.$);Ta.hasOwnProperty("originalSourceRangesCountExceedsLimit")&&
(P.originalSourceRangesCountExceedsLimit=Ta.originalSourceRangesCountExceedsLimit);if(P.shadowWorkbookSizeExceedsLimit)return d.ULS.sendTraceTag(537167833,0,15,`BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: shadow workbook length(${P.shadowWorkbookPayloadSize}) is over the limit(${y.a.Ljc}). reject the paste request. ShadowWorkbookSizeExceedsLimit: ${Ta.shadowWorkbookSizeExceedsLimit}`),Promise.reject(new Ja.a(1));d.ULS.sendTraceTag(537167832,0,50,`BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: trigger Paste request. PasteOperationId=${P.commandParameters.id}`);
return this.Jp.EFf(P.commandParameters.ribbonCommandInfo,Yb,pb,Ta,[P.commandParameters.stopwatch],P)}AFf(P){var Ta=P.clipboardItems.getItem(M.plainText);if(void 0!==Ta&&null!==Ta&&Ta.trim()===this.XVc)return Promise.reject(new Ja.a(7));void 0!==Ta&&null!==Ta&&(P.plainTextPayloadSize=Ta.length);P.isPlainTextPaste=!0;P.pasteResult="SystemClipboardPaste";P.payloadOrigin=K(P)?zb.Bjf:zb.external;P.payloadType=R.plainText;d.ULS.sendTraceTag(537167831,0,50,`BaseRangeCopyPasteHandler.PasteByPlainText: trigger ProcessPasteText request. pasteContext.Id=${P.id}, PasteOperationId=${P.commandParameters.id}`);
Ta=this.Jp.B0i(S.K(P.commandParameters.originalDestinations),Ta,P.commandParameters.ribbonCommandInfo,[P.commandParameters.stopwatch],P);d.ULS.sendTraceTag(537167830,0,50,`BaseRangeCopyPasteHandler.PasteByPlainText: returned from ProcessPasteText. pasteContext.Id=${P.id}`);return Ta}tWi(P,Ta,pb){P.htmlPayloadSize=Ta.length;P.isHtmlPaste=!0;P.pasteResult="SystemClipboardHtmlPaste";P.payloadType=R.html;P.payloadOrigin=K(P)?zb.Bjf:zb.external;d.ULS.sendTraceTag(42071711,0,50,`BaseRangeCopyPasteHandler.PasteByHtml: trigger ProcessPasteHtml request. PasteOperationId=${P.commandParameters.id}`);
return this.Jp.A0i(S.K(P.commandParameters.originalDestinations),Ta,pb,P.commandParameters.id,P.commandParameters.ribbonCommandInfo,[P.commandParameters.stopwatch],P)}ODe(P){const Ta={};P&&(Ta.shadowWorkbookBase64=P.ShadowWorkbookBase64,Ta.shadowWorkbookSizeExceedsLimit=P.ShadowWorkbookSizeExceedsLimit,Ta.originalSourceRangesCountExceedsLimit=P.OriginalSourceRangesCountExceedsLimit,Ta.originalSourceRangesCount=P.OriginalSourceRangesCount,Ta.shadowWorkbookBlockedSize=P.ShadowWorkbookBlockedSize);return Ta}Reg(P,
Ta){const pb=G(P),Yb=32===(P.commandParameters.commandType&32),Ac=1024===(P.commandParameters.commandType&1024);let Zc=!1,id=null,gd=null,Ub=!1;if(!pb){Zc=-1985798686===P.commandParameters.ribbonCommandInfo.command;var Lc=P.copyContextSnapshot;if(Ta)Ub=!Lc.sourceItem.isFromCurrentSession(this.$);else if(Lc=this.Jp.zvb(Lc))id=Lc.ranges,gd=Lc.sheetName,Ub=!P.isSameSession}return this.Jp.KKg(gd,id,this.$.pa.sheetName,P.commandParameters.originalDestinations,P.commandParameters.expandDestinations,Ub,
Yb,Ac,Zc,Ta,pb)}}Object(c.a)(wb,"BaseCopyPasteHandler",null,[809,810,811]);class hc{constructor(P){this.clipboardItems=this.key=null;this.T9=P}eva(P){return this.key&&this.key.isEqual(P)?this.createClipboardItems(this.clipboardItems):null}setValue(P,Ta){this.key=P;this.clipboardItems=this.createClipboardItems(Ta)}createClipboardItems(P){const Ta=this.T9.create();var pb=P.getItem(M.plainText);pb&&Ta.setItem(M.plainText,pb);(pb=P.getItem(M.shadowWorkbook))&&Ta.setItem(M.shadowWorkbook,pb);(P=P.getItem(M.html))&&
Ta.setItem(M.html,P);return Ta}}Object(c.a)(hc,"CopyCache",null,[]);var Za=a(75);class ub extends wb{constructor(P,Ta,pb,Yb,Ac=null){super(P,Yb);this.Y2g=Ta;this.T9=pb;this.N1c=Ac||new hc(this.T9);this.gridView=W.g(P);this.ha=this.gridView.ha;this.clipboardRangeFactory=P.da.za(169)}getSourceItem(){const P=r.EwaSettings.isChangeGateEnabled("OfficeVSO:6713439_FixCloneRangeArray")?S.d(this.gridView.ha.sa.selectedRanges):v.a.clone(this.gridView.ha.sa.selectedRanges);return new H(this.$,P,this.$.ea.pa.sheetName,
this.$.ea.Ke,this.$.ya.UserSessionId)}beforeSerialize(P){P.isSelectionAllowed=!1;P.isAsyncCopy=!1;P.isFromCache=!1;P.encounteredDeploymentErrors=!1;P.plainTextPayloadSize=0;P.shadowWorkbookPayloadSize=0;P.htmlPayloadSize=0;P.clientSideCopyTime=0;const Ta=new ja.a(this.$.xa),pb=P.sourceItem;P.isSelectionAllowed=v.a.all(pb.ranges,Yb=>this.isSelectionAllowed(Ta,Yb));P.isSelectionAllowed&&this.Jp.p7e(pb.ranges,P.commandParameters.commandType)}YLa(P){return this.gridView.Ea.kZ()&&W.i(this.gridView,P)}SWi(P,
Ta,pb,Yb){let Ac=!1,Zc=1===Ta.commandParameters.commandType,id=Yb[0].WG;1===pb.ranges.length&&1===Yb.length?r.EwaSettings.isChangeGateEnabled("OfficeVSO:5593878_PasteCSE_CCPErrorTests1")&&Zc&&1!==id&&id!==pb.ranges[0].WG?P.cseStatus=17:Ac=this.Y2g.O5c(P,S.K(pb.ranges),pb.sheetName,S.K(P.commandParameters.expandDestinations),this.$.ea.pa.sheetName,Zc):P.cseStatus=5;Ac&&W.g(this.$).Gi.e0(P.commandParameters.stopwatch.id,Za.BasicTelemetryCalculator.vQ);return this.CWi(P,pb,S.u(this.$.pa.sheetName,null,
Yb),Ta.commandParameters.commandType,Ac)}isSelectionAllowed(P,Ta){return P.Ezb(Ta,this.gridView)}CWi(P,Ta,pb,Yb,Ac){Ta=S.u(Ta.sheetName,null,Ta.ranges);P.pasteResult="SameSessionPaste";P.payloadOrigin=zb.DUf;P.payloadType=R.hzg;d.ULS.sendTraceTag(537167829,0,50,`BaseRangeCopyPasteHandler.PasteSameSession: trigger PasteRange request. PasteOperationId=${P.commandParameters.id}`);return this.Jp.pasteRange(P.commandParameters.ribbonCommandInfo,Ta,pb,Yb,P.commandParameters.commandType,[P.commandParameters.stopwatch],
P,Ac,null,null)}}Object(c.a)(ub,"BaseRangeCopyPasteHandler",wb,[]);var uc=a(35);class Oc{constructor(P){this.WT=new uc.a(!0);this.$=P}onDeferredPasteStarted(P){this.WT.mb(P.id)||this.WT.add(P.id,!0);if(0<this.WT.count){const Ta=fa.GetServiceTaskFactory.Ra(this.$.da,5,4,0);ca.TaskExtensions.Aa(Ta,()=>{Ta.result.Yf(28,null)},this.$.la,3)}}onDeferredPasteCompleted(P){const Ta=0<this.WT.count;this.WT.mb(P.id)&&this.WT.remove(P.id);if(Ta&&!this.WT.count){const pb=fa.GetServiceTaskFactory.Ra(this.$.da,
5,4,0);ca.TaskExtensions.Aa(pb,()=>{pb.result.removeEntry(28)},this.$.la,3)}}}Object(c.a)(Oc,"DeferredPasteTracker",null,[]);var Bb;(function(P){P[P.none=0]="none";P[P.loadClipboardFromServerFailed=1]="loadClipboardFromServerFailed";P[P.loadCopiedDataFromServerFailed=2]="loadCopiedDataFromServerFailed";P[P.asyncCopyCanceled=3]="asyncCopyCanceled";P[P.loadCopiedArtDataFromServerFailed=4]="loadCopiedArtDataFromServerFailed"})(Bb||(Bb={}));Object(c.b)("CopyErrorType",Bb);var Nb=a(921),dc=a(1108);class sc extends Nb.a{constructor(P,
Ta=null){super(Bb[P]);this.copyErrorName=0;this.ewaErrors=null;this.copyErrorName=P;this.ewaErrors=Ta;if(null===Ta||void 0===Ta?0:Ta.length)this.innerError=new dc.a(Ta,null)}}Object(c.a)(sc,"CopyInnerError",Nb.a,[]);class yc extends ub{constructor(P,Ta,pb,Yb=null){super(P,Ta,pb,"AcrossSessionRangeCopyPasteHandler",Yb);this.WT=new Oc(P)}serialize(P){const Ta=P.sourceItem,pb={};let Yb=this.N1c.eva(Ta);if(Yb)pb.synchronousResult=Yb,P.isFromCache=!0,P.clientSideCopyTime=P.commandParameters.stopwatch.uc;
else{let Zc=null;var Ac=S.F(Ta.ranges);if(!Y.a.cdf()&&this.YLa(Ac)){d.ULS.sendTraceTag(537167936,0,50,"AcrossSessionRangeCopyPasteHandler.Serialize: All data is loaded prepare the data in the client side.");Ac=this.clipboardRangeFactory.create(Ac);try{Zc=Ac.toString(),Yb=this.T9.create(),Yb.setItem(M.plainText,Zc),this.N1c.setValue(Ta,Yb),pb.synchronousResult=Yb,P.clientSideCopyTime=P.commandParameters.stopwatch.uc}finally{Ac&&Ac.dispose()}}else P.isAsyncCopy=!0,pb.synchronousResult=this.T9.create(),
pb.synchronousResult.setItem(M.plainText,this.XVc);pb.asynchronousResult=this.rcd(P,Ta,Zc)}P.syncClipboardItemsKeys=Ga(pb.synchronousResult);return pb}shouldWaitForCopyToComplete(P){if(!P||!P.copyContextSnapshot)return d.ULS.sendTraceTag(537167907,0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: pasteContext or pasteContext.CopyContextSnapshot is not define, return false."),!1;d.ULS.shipAssertTag(537167906,0,!!this.$.ya,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: this.EwaControl.BootstrapContext shouldn't be null");
if(P.copyContextSnapshot.sessionId===this.$.ya.UserSessionId)return d.ULS.sendTraceTag(537167905,0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: Same session copy scenario, return false."),!1;d.ULS.sendTraceTag(537167904,0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: returning true");return!0}onDeferredPasteStarted(P){this.WT.onDeferredPasteStarted(P)}onDeferredPasteCompleted(P){this.WT.onDeferredPasteCompleted(P)}deserialize(P){P.isClipboardDataContainShadowWorkbook=
!(void 0===P.clipboardItems.getItem(M.shadowWorkbook)||null===P.clipboardItems.getItem(M.shadowWorkbook));if(W.g(this.$).ha.Je&326)return G(P)&&(P.wasLastCopyExternal=!0),Promise.reject(new Ja.a(17));var Ta=this.Reg(P,!1);if(0!==Ta)return Promise.reject(new Ja.a(G(P)?18:P.isSameSession?19:20,void 0,void 0,void 0,Ta));var pb=P.copyContextSnapshot,Yb=this.Jp.zvb(pb);if(G(P))return this.poc(P);Ta=P.commandParameters.originalDestinations;if(Yb&&P.isSameSession)return this.SWi(P,pb,Yb,Ta);if(516!==P.commandParameters.commandType){if(({Z_:pb}=
this.lNj(P.clipboardItems)).returnValue){P.isShadowWorkbookParsedSuccessfully=!0;let Ac=Yb=null;r.EwaSettings.getBooleanFeatureGate(ea.a.J3b,!1)?Yb=S.r(Ta,this.$):Ac=S.v(S.K(Ta),this.$);return this.rWi(P,Ac,Yb,pb)}if(P.isClipboardInaccessible)return Promise.reject(new Ja.a(8));if(36!==P.commandParameters.commandType)return this.AFf(P)}return Promise.reject(new Ja.a(6))}beforePaste(P){this.$.da.za(373).Vjj(P);P.indicationDisplayScheduled=!0}DMj(P){let Ta;if(!(P&&P.SourceRanges&&P.SourceRanges.Ranges&&
P.SourceRanges.Ranges.length&&(P.OriginalSourceRangesCountExceedsLimit||P.OriginalSourceMultiRange&&P.OriginalSourceMultiRange.Ranges&&P.OriginalSourceMultiRange.Ranges.length)))return{returnValue:!1,Z_:null};var pb=P.SourceRanges.Ranges[0];if(!P.ShadowWorkbookBase64&&!P.ShadowWorkbookSizeExceedsLimit)return{returnValue:!1,Z_:null};Ta=this.ODe(P);Ta.rangeRowStart=pb.FirstRow;Ta.rangeRowEnd=pb.LastRow;Ta.rangeColumnStart=pb.FirstColumn;Ta.rangeColumnEnd=pb.LastColumn;Ta.sourceClientPath=P.SourceClientPath;
Ta.sourceSheetName=P.SourceSheetName;Ta.sourceWorkbookName=P.SourceWorkbookName;if(!P.OriginalSourceRangesCountExceedsLimit)for(P=P.OriginalSourceMultiRange.Ranges,Ta.originalSourceRanges=Array(P.length),pb=0;pb<P.length;++pb)Ta.originalSourceRanges[pb]=[P[pb].FirstRow,P[pb].FirstColumn,P[pb].LastRow,P[pb].LastColumn];return{returnValue:!0,Z_:Ta}}lNj(P){let Ta;Ta=null;P=P.getItem(M.shadowWorkbook);if(!P)return{returnValue:!1,Z_:Ta};Ta=JSON.parse(P);return{returnValue:this.Ani(Ta),Z_:Ta}}Ani(P){return!!P&&
(!!P.shadowWorkbookBase64||P.shadowWorkbookSizeExceedsLimit)&&void 0!==P.rangeRowStart&&void 0!==P.rangeRowEnd&&void 0!==P.rangeColumnStart&&void 0!==P.rangeColumnEnd}rWi(P,Ta,pb,Yb){d.ULS.shipAssertTag(537167903,0,!!Yb,"AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: shadowWorkbookPayload shouldn't be null");w.AFrameworkApplication.fN("Microsoft.Office.Excel.Server.Flighting.IDenyListNewCopyPasteExperienceAcrossSessions");P.pasteResult="CrossSessionPaste";P.payloadOrigin=zb.pEe;P.payloadType=
R.shadowWorkbook;P.shadowWorkbookPayloadSize=ic(Yb);P.shadowWorkbookSizeExceedsLimit=Qb(Yb);Yb.hasOwnProperty("originalSourceRangesCountExceedsLimit")&&(P.originalSourceRangesCountExceedsLimit=Yb.originalSourceRangesCountExceedsLimit);if(P.shadowWorkbookSizeExceedsLimit)return d.ULS.sendTraceTag(34415003,0,15,`AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: shadow workbook length(${P.shadowWorkbookPayloadSize}) is over the limit(${y.a.Ljc}). reject the paste request. ShadowWorkbookSizeExceedsLimit: ${Yb.shadowWorkbookSizeExceedsLimit}`),
Promise.reject(new Ja.a(1));if(1028===P.commandParameters.commandType&&P.originalSourceRangesCountExceedsLimit)return d.ULS.sendTraceTag(572617859,0,15,`AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: Original source ranges count(${Yb.originalSourceRangesCount}) is over the limit(${y.a.myi}). Reject the paste request. OriginalSourceRangesCountExceedsLimit: ${Yb.originalSourceRangesCountExceedsLimit}`),Promise.reject(new Ja.a(1));d.ULS.sendTraceTag(537167902,0,50,`AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: trigger Paste request. PasteOperationId=${P.commandParameters.id}`);
return this.Jp.EFf(P.commandParameters.ribbonCommandInfo,Ta,pb,Yb,[P.commandParameters.stopwatch],P)}rcd(P,Ta,pb){d.ULS.shipAssertTag(537167901,0,!!P,"AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: copyContext shouldn't be null");const Yb=P.commandParameters.stopwatch.uc;return new Promise((Ac,Zc)=>{d.ULS.sendTraceTag(26035421,0,50,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: issue request to the server to get the copied data for copy Id: ${P.id}`);const id=S.u(Ta.sheetName,
null,Ta.ranges);this.Jp.copy(id,P.commandParameters,gd=>{P.requestTelemetryData=gd.RequestTelemetryData;P.serverRequestTimeInMs=P.commandParameters.stopwatch.uc-Yb;if(xa.a.rg(gd.Errors))if(xa.a.tga(gd.Errors))P.encounteredDeploymentErrors=!0,gd=xa.a.yc(gd.Errors),d.ULS.sendTraceTag(537167898,0,15,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${gd}. copy Id: ${P.id}`);else{var Ub=xa.a.yc(gd.Errors);
d.ULS.sendTraceTag(26035419,0,10,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${Ub}. copy Id: ${P.id}`);Zc(new sc(2,gd.Errors))}else if(d.ULS.sendTraceTag(537167900,0,50,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer succeed for copy Id: ${P.id}`),P.markForCancellation)Zc(new sc(3,gd.Errors));else{gd=gd.Result;var Lc=gd.PlainTextResult;void 0!==pb&&null!==pb&&(Lc=pb);void 0!==Lc&&null!==Lc&&(P.plainTextPayloadSize=
Lc.length);Ub=this.T9.create();if(({Z_:hd}=this.DMj(gd)).returnValue){P.shadowWorkbookPayloadSize=ic(hd);P.shadowWorkbookSizeExceedsLimit=Qb(hd);P.originalSourceRangesCountExceedsLimit=gd.OriginalSourceRangesCountExceedsLimit;var hd=JSON.stringify(hd);Ub.setItem(M.shadowWorkbook,hd)}Ub.setItem(M.plainText,Lc);Y.a.cdf()&&(Lc=gd.HtmlResult,P.htmlSizeExceedsLimit=gd.HtmlSizeExceedsLimit,void 0!==Lc&&null!==Lc&&(P.htmlPayloadSize=Lc.length),Ub.setItem(M.html,Lc));P.copyTotalSizeExceedsLimit=gd.CopyTotalSizeExceedsLimit;
Ub.setItem(M.mqb,P.commandParameters.id);this.N1c.setValue(Ta,Ub);P.asyncClipboardItemsKeys=Ga(Ub);Ac(Ub)}},gd=>{P.serverRequestTimeInMs=P.commandParameters.stopwatch.uc-Yb;gd=Lb.a.lf(gd.data);const Ub=xa.a.yc(gd);d.ULS.sendTraceTag(537167897,0,10,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${Ub}. copy Id: ${P.id}`);Zc(new sc(2,gd))},[P.commandParameters.stopwatch])})}}Object(c.a)(yc,"AcrossSessionRangeCopyPasteHandler",ub,[]);class cd{constructor(P,
Ta,pb,Yb,Ac,Zc=null,id=null){this.floatingObjectId=P;this.commandParameters=Ta;this.wt=pb;this.sah=Yb;this.N$=Zc;this.hOb=id;this.O2g=Ac}}Object(c.a)(cd,"CopyArtRequest",null,[]);class pd{constructor(P,Ta,pb,Yb,Ac,Zc,id,gd,Ub){this.promise=null;this.ribbonCommandInfo=P;this.destination=Ta;this.gGe=pb;this.hOb=Ac;this.Z_=Zc;this.item=id;this.pasteContext=gd;this.kNa=pb||Ta.FirstRow+"_"+Ta.FirstColumn;this.zdf=!0;this.cye=Ub}}Object(c.a)(pd,"PasteArtRequest",null,[]);class Rb{constructor(P,Ta){this.mIb=
new mb.a;this.WYa=P;this.$=Ta;this.$0i=pb=>Promise.resolve(pb);this.pEb=pb=>Promise.reject(pb)}S2h(P){if(this.xji(P.kNa)){d.ULS.sendTraceTag(537167681,5,50,`PasteArtRequestManager.HandleRequest: Enqueued paste request as a result of rapid paste on same destination: ${P.kNa}`);const Ta=this.mIb.na(P.kNa);this.mIb.ia(P.kNa,P);const pb=Ta.promise;Ta.zdf=!1;return this.kkh(P,pb)}this.mIb.ia(P.kNa,P);return this.Aqi(P)}xji(P){return this.mIb.mb(P)}Aqi(P){return new Promise((Ta,pb)=>{P.promise=this.WYa.zFf(P).then(Yb=>
{Ta(null);return this.Qmc(P,Yb)},Yb=>{pb(null);return this.pEb(Yb)})})}kkh(P,Ta){return new Promise((pb,Yb)=>{P.promise=Ta.then(Ac=>{this.vSj(P,Ac);return this.WYa.zFf(P).then(Zc=>{pb(null);return this.Qmc(P,Zc)},Zc=>{Yb(null);return this.pEb(Zc)})},Ac=>this.pEb(Ac))})}Qmc(P,Ta){P.zdf&&(this.xXg(P.kNa),this.mMd(P,Ta));return this.$0i(Ta)}xXg(P){this.mIb.remove(P)}mMd(P,Ta){const pb=this.OVh();P.kNa===pb&&this.WYa.mMd(P.destination,Ta,P.item.type)}OVh(){var P=W.g(this.$).ha.Pa.activeFloatingObjectControlId;
P||(P=S.v(W.g(this.$).ha.sa.activeCell,this.$),P=P.FirstRow+"_"+P.FirstColumn);return P}vSj(P,Ta){P.destination=null;P.gGe=Ta}}Object(c.a)(Rb,"PasteArtRequestManager",null,[]);var Dc=a(198),nd=a(122),od=a(104);class wd extends wb{constructor(P,Ta,pb,Yb,Ac=null){super(P,"ArtCopyPasteHandler");this.tYg="XLO";this.uYg="3";this.WT=new Oc(P);this.T9=Ta;this.WYa=pb;this.ha=W.g(P).ha;this.M1c=Ac||new hc(this.T9);this.sWi=new Rb(pb,P);this.Cnb=Yb}getSourceItem(){d.ULS.shipAssertTag(537167896,0,!!this.ha.Pa.activeFloatingObjectControlId,
"Expecting a floating object to be currently selected for copy");d.ULS.sendTraceTag(537167895,0,50,`ArtCopyPasteHandler.GetSourceItem: Creating ArtSourceItem with FloatingObjectId=[${this.ha.Pa.activeFloatingObjectControlId}]`);return new U(this.ha.Pa.activeFloatingObjectControlId,this.$.ea.pa.sheetName,this.$.ea.Ke,this.$.ya.UserSessionId,this.ha.Pa.$b.floatingObject.type)}beforeSerialize(P){P&&P.commandParameters?(P?(P.isAsyncCopy=!1,P.isSelectionAllowed=!1,P.isFromCache=!1,P.plainTextPayloadSize=
0,P.shadowWorkbookPayloadSize=0,P.htmlPayloadSize=0,P.htmlSizeExceedsLimit=!1,P.clientSideCopyTime=0,P.encounteredDeploymentErrors=!1,P.shadowWorkbookSizeExceedsLimit=!1,P.originalSourceRangesCountExceedsLimit=!1,P.copyTotalSizeExceedsLimit=!1):d.ULS.sendTraceTag(537167826,0,10,"CommonCopyPasteUtils.InitializeCopyContext: copyContext is null."),P.commandParameters.copyPasteTargetType=2):d.ULS.sendTraceTag(537167894,0,10,"ArtCopyPasteHandler.BeforeSerialize: copyContext or copyContext.CommandParameters is null.")}serialize(P){const Ta=
P.sourceItem,pb={};if(!Ta)return d.ULS.sendTraceTag(537167893,0,10,"ArtCopyPasteHandler.Serialize: artSourceItem should not be null"),pb;if(!this.pmi())return d.ULS.sendTraceTag(36824456,0,50,"ArtCopyPasteHandler.Serialize: Unsupported floating object type. This will clear the clipboard"),pb;d.ULS.sendTraceTag(537167892,0,50,`ArtCopyPasteHandler.Serialize: Serializing ArtSourceItem with FloatingObjectId=[${Ta.activeFloatingObjectControlId}]`);this.pDd();let Yb=this.M1c.eva(Ta);if(Yb)pb.synchronousResult=
Yb,P.isFromCache=!0,P.isAsyncCopy=!1,P.clientSideCopyTime=P.commandParameters.stopwatch.uc,1===P.commandParameters.commandType&&this.$.ud(2045211913,P.commandParameters.ribbonCommandInfo.method,P.commandParameters.ribbonCommandInfo.Re,null);else{P.isFromCache=!1;P.isAsyncCopy=!0;Yb=this.T9.create();if(P.commandParameters.uploadToClipService){const Ac={};Ac["data-clipservice-ccpid"]=P.commandParameters.id;Ac["data-pkey"]=P.commandParameters.pKey;Ac["data-clipservice-type"]=P.commandParameters.clipServiceDataType;
Ac["data-clipservice-count"]=P.commandParameters.objectCount.toString();Ac["data-clipservice-dc"]=P.commandParameters.clipServiceDataCenter;Ac["data-clipservice-client"]=this.tYg;Ac["data-TimeStamp"]=(new Date).toUTCString();Ac["data-clipservice-version"]=this.uYg;Yb.setItem(M.xHg,JSON.stringify(Ac))}pb.synchronousResult=this.RAg(Yb);pb.asynchronousResult=this.rcd(P,Ta,Yb)}P.syncClipboardItemsKeys=Ga(pb.synchronousResult);return pb}RAg(P){d.ULS.shipAssertTag(537167891,0,!!this.ha.Pa.$b,"Expecting a floating object to be currently selected for copy");
P||(P=this.T9.create());const Ta=this.ha.Pa.$b.Wtb();Ta&&P.setItem(M.html,`<img src='${Ta}'>`);return P}pDd(){const P=this.ha.Pa.$b;this.Cnb.pDd(nd.a.zpb(P.floatingObject),nd.a.wYg(P.Xt))}shouldWaitForCopyToComplete(){d.ULS.sendTraceTag(537167890,0,50,"ArtCopyPasteHandler.ShouldWaitForCopyToComplete: returning true");return!0}onDeferredPasteStarted(P){this.WT.onDeferredPasteStarted(P)}onDeferredPasteCompleted(P){this.WT.onDeferredPasteCompleted(P)}deserialize(P){var Ta=G(P),pb=null;let Yb=null;var Ac=
!1;if(!Ta){pb=P.copyContextSnapshot;Yb=pb.sourceItem;if(!Yb)return Promise.reject(new Ja.a(10));Ac=Yb.isFromCurrentSession(this.$)}var Zc=this.Reg(P,!0);if(0!==Zc)return Promise.reject(new Ja.a(Ta?18:Ac?19:20,void 0,void 0,void 0,Zc));if(Ta)return this.poc(P);if(!Ac&&!wd.sfi(Yb))return P=`User attempted to paste art of type [${Yb.type}] between sessions.`,d.ULS.sendTraceTag(537167889,0,50,P),Promise.reject(new Ja.a(11,void 0,void 0,P));if(pb.isAsyncSerializeFailed)return Promise.reject(new Ja.a(16,
void 0,void 0,"Last async serialize failed, therefore no current shadow workbook payload to paste"));let id;try{const gd=P.clipboardItems.getItem(M.shadowWorkbook);id=JSON.parse(gd)}catch(gd){return P=copyPasteInfra.getStringifiedError(gd),d.ULS.sendTraceTag(537167888,0,10,`ArtCopyPasteHandler.Deserialize: Failed to parse shadow workbook JSON with exception: ${P}`),Promise.reject(new Ja.a(12,void 0,gd))}id.floatingObjectId!==Yb.activeFloatingObjectControlId?d.ULS.sendTraceTag(537167887,0,10,`ArtCopyPasteHandler.Deserialize: FloatingObjectId mismatch! Deserializing with artSourceItem.ActiveFloatingObjectControlId=[${Yb.activeFloatingObjectControlId}], shadowWorkbookPayload.FloatingObjectId=[${id.floatingObjectId}]`):
d.ULS.sendTraceTag(537167886,0,50,`ArtCopyPasteHandler.Deserialize: Deserializing with artSourceItem.ActiveFloatingObjectControlId=[${Yb.activeFloatingObjectControlId}], shadowWorkbookPayload.FloatingObjectId=[${id.floatingObjectId}]`);if(!id||!id.shadowWorkbookBase64)return Promise.reject(new Ja.a(13,void 0,void 0,`shadowWorkbookPayload is null = ${!id}`));P.isShadowWorkbookParsedSuccessfully=!0;P.shadowWorkbookPayloadSize=ic(id);P.shadowWorkbookSizeExceedsLimit=Qb(id);P.payloadOrigin=Ac?zb.DUf:
zb.pEe;P.payloadType=R.rig;if(Qb(id))return P=`Shadow workbook size [${P.shadowWorkbookPayloadSize}] is over the limit [${y.a.Ljc}]. ShadowWorkbookSizeExceedsLimit: ${id.shadowWorkbookSizeExceedsLimit}`,d.ULS.sendTraceTag(36304156,0,15,`ArtCopyPasteHandler.Deserialize: ${P}`),Promise.reject(new Ja.a(1,void 0,void 0,P));pb=Ta=null;W.g(this.$).ha.Je&326?pb=W.g(this.$).ha.Pa.activeFloatingObjectControlId:Ta=this.$.pa&&this.$.pa.activeCell?S.v(this.$.pa.activeCell,this.$):S.v(S.K(P.commandParameters.originalDestinations),
this.$);Ac=null;if(this.Cnb.v1f(Yb))try{Ac=this.Cnb.O5c()}catch(gd){Zc=copyPasteInfra.getStringifiedError(gd),d.ULS.sendTraceTag(537167885,0,10,`ArtCopyPasteHandler.Deserialize: Exception encountered while performing client-side estimation. Exception: ${Zc}`)}return this.sWi.S2h(new pd(P.commandParameters.ribbonCommandInfo,Ta,pb,P.commandParameters.commandType,[P.commandParameters.stopwatch],id,Yb,P,Ac))}poc(P){P.wasLastCopyExternal=!0;if(P.clipboardItems.getItem("image/png")){const Ta=P.commandParameters.stopwatch.uc;
P.payloadType=R.JNg;return $a.b(this.$.ud(1403967063,P.commandParameters.ribbonCommandInfo.method,P.commandParameters.ribbonCommandInfo.Re,{["dataUrl"]:P.clipboardItems.getItem("image/png")})).then(pb=>{P.serverRequestTimeInMs=P.commandParameters.stopwatch.uc-Ta;return pb?Promise.resolve(null):Promise.reject(new Ja.a(15))},()=>{P.serverRequestTimeInMs=P.commandParameters.stopwatch.uc-Ta;return Promise.reject(new Ja.a(15))})}d.ULS.shipAssertTag(537167884,0,!1,"Should not paste external content that is not image via ArtCopyPasteHandler");
return super.poc(P)}pmi(){const P=W.g(this.$).ha;return P.Pa.activeFloatingObjectControlId&&P.Pa.$b&&P.Pa.$b.floatingObject?P.Pa.$b.floatingObject.CTd():!1}rcd(P,Ta,pb){return new Promise((Yb,Ac)=>{const Zc=P.commandParameters.stopwatch.uc;d.ULS.sendTraceTag(41562516,0,50,"ArtCopyPasteHandler.GetCopiedDataFromServer: issue request to the server to get the copied data...");this.WYa.Q2g(new cd(Ta.activeFloatingObjectControlId,P.commandParameters,id=>{P.requestTelemetryData=id.RequestTelemetryData;P.serverRequestTimeInMs=
P.commandParameters.stopwatch.uc-Zc;if(xa.a.rg(id.Errors))if(xa.a.tga(id.Errors))P.encounteredDeploymentErrors=!0,id=xa.a.yc(id.Errors),d.ULS.sendTraceTag(537167879,0,15,`ArtCopyPasteHandler.GetCopiedDataFromServer: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${id}`);else{var gd=xa.a.yc(id.Errors);d.ULS.sendTraceTag(36229122,0,10,`ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${gd}`);Ac(new sc(4,id.Errors))}else if(d.ULS.sendTraceTag(537167883,
0,50,`ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer succeeded for FloatingObjectId=[${Ta.activeFloatingObjectControlId}].`),P.markForCancellation)Ac(new sc(3,id.Errors));else{if(xa.a.er(id.Errors)){var Ub=xa.a.yc(id.Errors);d.ULS.sendTraceTag(537167882,0,50,`ArtCopyPasteHandler.GetCopiedDataFromServer: Server messages present. Errors: ${Ub}`)}if(Ub=id.Result){Ub=this.ODe(Ub);Ub.floatingObjectId=Ta.activeFloatingObjectControlId;P.shadowWorkbookPayloadSize=ic(Ub);P.shadowWorkbookSizeExceedsLimit=
Qb(Ub);try{gd=JSON.stringify(Ub)}catch(Lc){Ac(new Ja.a(14,void 0,Lc,`Failed to stringify shadow workbook: copyContext.ShadowWorkbookPayloadSize: [${P.shadowWorkbookPayloadSize}], shadowWorkbookPayload.FloatingObjectId: [${Ub.floatingObjectId}]`));return}d.ULS.shipAssertTag(537167881,0,!!pb,"Expecting syncClipboardItems to be defined");pb.setItem(M.shadowWorkbook,gd);1===P.commandParameters.commandType&&(this.JZi(Ta.type,Ta.activeFloatingObjectControlId,id.StateId),this.deleteFloatingObject(Ta.activeFloatingObjectControlId,
Ta.type));this.M1c.setValue(Ta,pb);P.asyncClipboardItemsKeys=Ga(pb);Yb(pb)}else d.ULS.sendTraceTag(537167880,0,50,`ArtCopyPasteHandler.GetCopiedDataFromServer: Result form server returned null, copied item id: ${Ta.activeFloatingObjectControlId}`),Yb(this.M1c.eva(Ta))}},P.commandParameters.commandType,Ta.type,id=>{P.serverRequestTimeInMs=P.commandParameters.stopwatch.uc-Zc;id=Lb.a.lf(id.data);1===P.commandParameters.commandType&&this.WYa.lOj(Ta.type,Ta.activeFloatingObjectControlId);const gd=xa.a.yc(id);
d.ULS.sendTraceTag(537167878,0,10,`ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${gd}`);Ac(new sc(4,id))},[P.commandParameters.stopwatch]))})}deleteFloatingObject(P,Ta){P=Dc.a.cz(Ta,P);if(P=od.a(this.$).vq(P))od.a(this.$).deleteFloatingObject(P,14,!0),W.g(this.$).ha.Pa.SA=null}JZi(P,Ta,pb){const Yb=this.$.da.za(277);if(Yb){let Zc=null;P=Dc.a.cz(P,Ta);P=od.a(this.$).vq(P);if(null===P||void 0===P?0:P.Ri)Zc=P.Ri.block;if(Zc){var Ac=P.floatingObject.Lg();Yb.IXb(()=>
!Zc.Fi.mb(Ac),pb,"CutArt")}}}static sfi(P){return 1===P.type||5===P.type}}Object(c.a)(wd,"ArtCopyPasteHandler",wb,[]);var Pc=a(58);class Hb extends yb{constructor(P,Ta,pb,Yb){super(P);this.isFromCurrentSession=!1;this.left=this.top=0;this.isFromCurrentSession=Ta;this.top=pb;this.left=Yb}}Object(c.a)(Hb,"MacroRecorderPasteArtPayload",yb,[]);class Nc{constructor(P,Ta){this.$=P;this.Cnb=Ta}l8h(P,Ta,pb,Yb,Ac,Zc=null,id=null){const gd=this.$.oa.va.Sb();let Ub=null;const Lc={CopyPasteTargetType:2};Lc.FloatingObjectId=
P;Lc.CopyOperationId=pb.id;pb.floatingObjectType=Ta;Lc.UploadToClipService=pb.uploadToClipService;Lc.PKey=pb.pKey;Lc.ClipServiceDataCenter=pb.clipServiceDataCenter;let hd=0;2===Ac?(Ac=505,hd=16,Ub=(Kd,Wd,oe)=>Na(this.$.oa.va,Lc,Ab.b(Kd,Yb),Zc?Ab.a(Wd,Zc):Wd,oe,pb.ribbonCommandInfo,gd,id)):(Ac=179,Ub=(Kd,Wd,oe)=>{this.ngh(Ta,P);this.$.ry();return Va(this.$.oa.va,Lc,Ab.b(Kd,Yb),Zc?Ab.a(Wd,Zc):Wd,oe,pb.ribbonCommandInfo,gd,id)});r.EwaSettings.dc()?this.$.userOperationManager.Ub(new Pb.a(Ac,0,Ub,hd|64),
pb.ribbonCommandInfo):this.$.userOperationManager.Ub(new lb.a(Ac,0,Ub,hd),pb.ribbonCommandInfo)}ngh(P,Ta){var pb=Dc.a.cz(P,Ta);(pb=od.a(this.$).vq(pb))?(W.g(this.$).ha.Pa.dH(pb),pb.isVisible=!1):d.ULS.sendTraceTag(537167876,0,50,`ArtCopyPasteUtils.DoCutClientEstimation: floatingObjectcontrol is null. FloatingObjectType : ${P}, FloatingObjectId: ${Ta}`)}lOj(P,Ta){P=Dc.a.cz(P,Ta);if(P=od.a(this.$).vq(P))P.isVisible=!0}Q2g(P){this.l8h(P.floatingObjectId,P.O2g,P.commandParameters,P.wt,P.sah,P.N$,P.hOb)}M8h(P,
Ta,pb,Yb,Ac,Zc,id,gd=null,Ub=!0){return new Promise((Lc,hd)=>{const Kd=Zc.commandParameters.stopwatch.uc;this.IMd(P,Ac,Ta,pb,Wd=>{Zc.requestTelemetryData=Wd.RequestTelemetryData;Zc.serverRequestTimeInMs=Zc.commandParameters.stopwatch.uc-Kd;if(xa.a.tga(Wd.Errors))Zc&&(Zc.encounteredDeploymentErrors=!0),Wd=xa.a.yc(Wd.Errors),d.ULS.sendTraceTag(537167875,0,15,`ArtCopyPasteUtils.PasteArt: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${Wd}`);else if(xa.a.rg(Wd.Errors)){var oe=
xa.a.yc(Wd.Errors);d.ULS.sendTraceTag(36459652,0,10,`ArtCopyPasteUtils.PasteArt: PasteArt failed. errors: ${oe}`);hd(new Ja.a(9,Wd.Errors))}else Wd.Result?(oe=Wd.Result,d.ULS.sendTraceTag(537167874,0,50,"ArtCopyPasteUtils.PasteArt: PasteArt succeeded."),this.YZi(id,oe.FloatingObjectId,Wd.StateId),Lc(Nc.yjd(oe.FloatingObjectId))):(d.ULS.sendTraceTag(537167873,0,10,"ArtCopyPasteUtils.PasteArt: PasteArt failed, result returned from server is null."),hd(new Ja.a(9,Wd.Errors)))},Wd=>{Zc.serverRequestTimeInMs=
Zc.commandParameters.stopwatch.uc-Kd;Wd=Lb.a.lf(Wd.data);d.ULS.sendTraceTag(537167872,0,10,`ArtCopyPasteUtils.PasteArt: PasteArt failed. errors: ${xa.a.yc(Wd)}`);hd(new Ja.a(9,Wd))},Yb,gd,Ub)})}YZi(P,Ta,pb){const Yb=this.$.da.za(277);if(Yb){const Ac=Dc.a.cz(P,Nc.yjd(Ta));Yb.IXb(()=>!!od.a(this.$).vq(Ac),pb,"PasteArt")}}KWd(P,Ta){Ta&&this.Cnb.KWd(P,Dc.a.cz(P.type,Ta))}zFf(P){return this.M8h(P.ribbonCommandInfo,P.destination,P.gGe,P.hOb,P.Z_,P.pasteContext,P.item.type,P.cye,P.item.isFromCurrentSession(this.$)).then(Ta=>
Ta,Ta=>{this.KWd(P.item,P.cye);return Promise.reject(Ta)})}mMd(P,Ta,pb){P||(P=S.v(W.g(this.$).ha.sa.activeCell,this.$));W.g(this.$).vgc(S.D(P),1)?od.a(this.$).Ima(pb,Ta,!0):W.g(this.$).ha.Pa.tGa(P,Ta,pb).continueWith(Yb=>{Yb.result?d.ULS.sendTraceTag(537167843,5,50,`ArtCopyPasteUtils.SelectPastedObject: Selection succeeded in async manner for object ID [${Ta}]`):d.ULS.sendTraceTag(537167842,5,10,`ArtCopyPasteUtils.SelectPastedObject: Selection failed in async manner for object ID [${Ta}]`)})}IMd(P,
Ta,pb,Yb,Ac,Zc,id,gd,Ub=!0){const Lc=this.$.oa.va.Sb(),hd={};hd.ShadowWorkbookBase64=Ta.shadowWorkbookBase64;hd.FloatingObjectId=Yb;hd.DestinationRanges=pb?S.s(pb):null;hd.CopyPasteTargetType=2;hd.ClientEstimationFloatingObjectId=gd;pb=(Kd,Wd,oe)=>{gd||this.$.ry();return Sa(this.$.oa.va,hd,Ab.b(Kd,Ac),Ab.a(Wd,Zc),oe,null,Lc,id)};Yb=()=>{if(Ub){let Kd;Kd=Pc.a.Vh(Pc.a.Ac(hd));Kd.FloatingObjectId=Ta.floatingObjectId;hd.DestinationRanges||(Kd.DestinationRanges=S.p(this.$.xa.pa.sheetName,"",0,0,0,0));
return new Hb(Kd,Ub,0,0)}return new Hb(hd,Ub,0,0)};pb=r.EwaSettings.dc()?new Pb.a(503,0,pb,void 0,Yb):new lb.a(503,0,pb,void 0,Yb);pb.flags=r.EwaSettings.dc()?65:1;this.$.userOperationManager.Ub(pb,P)}static yjd(P){return`${P.length+2}.{${P.toUpperCase()}}`}}Object(c.a)(Nc,"ArtCopyPasteUtils",null,[801]);var Db=a(215);class Cc{constructor(P){this.K1c=this.Csa=null;this.h$a=15;this.$=P}pDd(P,Ta){this.Csa=P;this.K1c=Ta}O5c(){if(!this.Csa||!this.K1c)return d.ULS.sendTraceTag(537167841,0,15,"ArtPasteClientEstimation.DoPasteClientEstimation: copiedFloatingObjectControl and/or copiedEffectsExtents is null, aborting client side estimation."),
"";const P=nd.a.zpb(new Dc.a(this.Csa));P.Id=Nc.yjd(m.a.create().toString());P.Version=-1;P.Name="";P.IsClientEstimation=!0;var Ta=this.$9h(P);if(!Ta)return null;const pb=new Dc.a(P);Ta.block.Fi.add(pb);pb.rIb();const Yb=od.a(this.$);Yb.$2b(pb,Ta);Ta=Yb.vq(Dc.a.JOh(P));!Ta||Ta.floatingObject.JLa||Ta.floatingObject.dMa||Ta.$Qa(this.K1c);Yb.Ima(P.Type,P.Id,!0);return P.Id}v1f(P){return r.EwaSettings.ma(222)&&P.isFromCurrentSession(this.$)&&!W.g(this.$).rtl&&!W.g(this.$).ib.mj}KWd(P,Ta){this.v1f(P)&&
(P=od.a(this.$).vq(Ta))&&(d.ULS.sendTraceTag(537167840,5,50,`ArtPasteClientEstimation.UndoPasteClientEstimation: undoing client-side estimation. Removing floating object with ID: [${Ta}] of type [${P.floatingObject.type}]`),od.a(this.$).deleteFloatingObject(P,15,!0),P.Ri&&P.Gab(P.Ri,!1))}$9h(P){if(!P)return d.ULS.sendTraceTag(537167839,0,15,"ArtPasteClientEstimation.InitializeFloatingObjectLocation: Called with null FloatingObjectData."),null;if(W.g(this.$).ha.Pa.activeFloatingObjectControlId){var Ta=
W.g(this.$).ha.Pa.SA.floatingObject;P.OriginDeltaX=Ta.offsetX+this.h$a;P.OriginDeltaY=Ta.offsetY+this.h$a;P.AbsoluteLeft+=this.h$a;P.AbsoluteTop+=this.h$a;P.AbsoluteRight+=this.h$a;P.AbsoluteBottom+=this.h$a;P.ZOrder=Ta.MB+1;return W.g(this.$).ha.Pa.SA.Ri}if(!this.$.pa||!this.$.pa.activeCell)return d.ULS.sendTraceTag(537167838,0,15,"ArtPasteClientEstimation.InitializeFloatingObjectLocation: ActiveItem/ActiveCell is null - cannot perform estimation for grid paste."),null;var pb=this.$.pa.activeCell;
Ta=W.g(this.$).FW(pb);if(!Ta)return d.ULS.sendTraceTag(537167837,0,15,`ArtPasteClientEstimation.InitializeFloatingObjectLocation: gridViewBlock for range ${pb.toString()} is null.`),null;const Yb=ya.HelperMethods.lvb(Ta.domElement,Ta.rj.domElement);pb=Ta.gridView.mg(pb,2);if(!Yb||!pb)return d.ULS.sendTraceTag(537167836,0,15,`ArtPasteClientEstimation.InitializeFloatingObjectLocation: blockPositionRelativeToGridOrigin is null: ${!Yb}. cellPositionRelativeToGridOrigin is null: ${!pb} .`),null;P.OriginDeltaX=
pb.topLeft.x-Yb.x;P.OriginDeltaY=pb.topLeft.y-Yb.y;P.AbsoluteLeft=pb.topLeft.x;P.AbsoluteTop=pb.topLeft.y;P.AbsoluteRight=P.AbsoluteLeft+Math.abs(this.Csa.AbsoluteRight-this.Csa.AbsoluteLeft);P.AbsoluteBottom=P.AbsoluteTop+Math.abs(this.Csa.AbsoluteBottom-this.Csa.AbsoluteTop);P.ZOrder=this.Csa.ZOrder+100;return new Db.a(Ta.gridView.Ea.Jl(Ta.hashCode),Ta.hashCode)}}Object(c.a)(Cc,"ArtPasteClientEstimation",null,[802]);class Xc{create(){const P=window.clipboardPlatform;return P?P.createClipboardItems():
null}}Object(c.a)(Xc,"ClipboardItemsFactory",null,[800]);class ld{}ld.undefined="Undefined";Object(c.a)(ld,"CCPTelemetryConsts",null,[]);class Dd{}Dd.cells="Cells";Dd.floatingObject="FloatingObject";Dd.unknown="Unknown";Object(c.a)(Dd,"ActiveSelection",null,[]);class Od{}Od.zfh="DisplayNotInvoked";Od.G5c="Displayed";Od.h_i="PrerequisitesNotReady";Object(c.a)(Od,"PasteIndicationDisplayStatus",null,[]);var Qd=a(109);class Nd{constructor(P){this.NDc=this.YNc=null;this.$=P}get vFd(){if(!this.YNc){const P=
this.$.da.za(254,!0);P&&(this.YNc=new yc(this.$,P,new Xc))}return this.YNc}get TVc(){if(!this.NDc&&this.$.da.za(254,!0)){const P=new Cc(this.$);this.NDc=new wd(this.$,new Xc,new Nc(this.$,P),P)}return this.NDc}getCopyFlowHandler(P){const Ta=this.FKh(W.g(this.$).Je);P.commandParameters.copyPasteHandlerName=Ta.name;return Ta}getPasteFlowHandler(P){var Ta=P.copyContextSnapshot;Ta=T(P)?this.TVc:G(P)?this.vFd:(null===Ta||void 0===Ta?0:Ta.sourceItem)&&Object.getType(Ta.sourceItem)===U?this.TVc:this.vFd;
P.commandParameters.copyPasteHandlerName=Ta.name;return Ta}initializePasteContext(P){if(P&&(P.isSameSession=!1,P.isShadowWorkbookParsedSuccessfully=!1,P.pasteResult=ld.undefined,P.payloadOrigin=ld.undefined,P.payloadType=ld.undefined,P.encounteredDeploymentErrors=!1,P.shadowWorkbookSizeExceedsLimit=!1,P.originalSourceRangesCountExceedsLimit=!1,P.activeSelectionType=this.tGh(),P.indicationDisplayScheduled=!1,P.pasteDestinationHasMergedCells=!1,P.pasteIndicationDisplayStatus=Od.zfh,P.copyContextSnapshot)){var Ta=
P.copyContextSnapshot;const id=D(Ta.sourceItem);var pb=Ta.sourceItem;var Yb=!!pb&&Object.getType(pb)===U;pb=0;var Ac=!1;id?(Ac=Ta.sourceItem,P.isSameSession=Ac.isFromCurrentSession(this.$),pb=1,Ac=this.yji(Ac,P)):Yb&&(P.isSameSession=Ta.sourceItem.isFromCurrentSession(this.$),pb=2);if(P.copyContextSnapshot.commandParameters){const gd=-1985798686===Ta.commandParameters.ribbonCommandInfo.command;Yb=P.commandParameters;var Zc=this.$;Ta?Zc&&Zc.ya?Ta=Ta.sessionId===Zc.ya.UserSessionId:(d.ULS.shipAssertTag(537166211,
0,!1,"ewaControl shouldn't be null"),Ta=!1):(d.ULS.shipAssertTag(537166212,0,!1,"copyContext shouldn't be null"),Ta=!1);Yb.clearSystemClipboard=Ta&&gd&&id&&!Ac;P.commandParameters.copyPasteTargetType=pb}}}getSessionId(){return this.$.ya.UserSessionId}yji(P,Ta){const pb=Qd.b(P.ranges,Yb=>Yb.Ze)&&Qd.b(Ta.commandParameters.originalDestinations,Yb=>1!==Yb.top);return Qd.b(P.ranges,Yb=>Yb.isRow)&&Qd.b(Ta.commandParameters.originalDestinations,Yb=>1!==Yb.left)||pb}FKh(P){switch(P){case 1:return this.vFd;
case 64:case 4:case 2:case 256:return this.TVc;default:throw Error.invalidOperation("Unsupported selection");}}tGh(){return W.g(this.$).ha.Je&470?Dd.floatingObject:1===W.g(this.$).ha.Je?Dd.cells:Dd.unknown}getDialogResponse(){}}Object(c.a)(Nd,"ExcelCopyPasteApplicationHost",null,[776]);var he=a(155);class ve extends x.a{constructor(P,Ta){super(P);this.Yo=null;this.Xai=(pb,Yb)=>{1===pb?(pb=ve.Jeh[Yb[ve.Ieh]],d.ULS.sendTraceTag(537167683,0,50,`InsertCopiedCutCellsDialog.InsertCopiedCutCellsDialogHandler OK button pressed with valid input, shift direction = ${0===
pb?"Horizontal":"Vertical"}`),this.Yo.setResult(pb)):(d.ULS.sendTraceTag(537167682,0,50,"InsertCopiedCutCellsDialog.InsertCopiedCutCellsDialogHandler cancel button pressed"),this.Yo.ps())};this.vg(Ta)}get oc(){return"InsertCopiedCutCellsDialog"}vg(P){this.Yo=new he.a;const Ta=B.a.instance.ga(16);P=this.KM(P);this.initializeAndShow(Ta,this.Xai,P)}KM(P){return{[ve.Tu]:this.oc,[ve.bli]:P}}}ve.Ieh="direction";ve.bli="isRtl";ve.Jeh={["Vertical"]:1,["Horizontal"]:0};Object(c.a)(ve,"InsertCopiedCutCellsDialog",
x.a,[]);class Td{b3b(P,Ta){return(new ve(P,Ta)).Yo.task}}Object(c.a)(Td,"InsertCopiedCutCellsDialogFactory",null,[691]);var ke=a(86),xe=a(47),le=a(45);class Je{constructor(P){this.a4b="";this.y1=this.Ps=null;this.epc=!1;this.S6e=(Ta=null,pb=null)=>{this.hide(Ta,pb)};this.gridView=W.g(P);this.gridView.ha.NG(this.S6e)}iIe(){this.epc||(d.ULS.sendTraceTag(537167680,0,50,"PasteIndicationManager.DownloadPrerequisitesIfNeeded: Trying to get appChrome"),this.gridView.$.Qx(P=>{P.aaa(0).then(()=>{this.epc=
!0})}))}Vjj(P){var Ta=P.commandParameters.id;d.ULS.sendTraceTag(537167651,0,50,`PasteIndicationManager.ScheduleDisplay: pasteCommandId = ${Ta}, cancelCtx is null = ${!this.Ps}, PrerequisitesDownloaded = ${this.epc}`);this.iIe();this.a4b=Ta;Ta=!this.erf();if(!this.Ps||Ta)this.rve(),this.Ps=xe.a.instance.create(()=>{this.yfh(P)},void 0===P.timeoutToShowSpinnerInMs||null===P.timeoutToShowSpinnerInMs?100:P.timeoutToShowSpinnerInMs,le.a.yWi);this.y1=P.commandParameters.originalDestinations}yfh(P){this.epc?
(this.display(P.commandParameters.originalDestinations),P.pasteIndicationDisplayStatus=Od.G5c):(d.ULS.sendTraceTag(537167650,0,50,"PasteIndicationManager.DisplayIfPossible: Prerequisites were not ready, skipping display"),this.hide(),P.pasteIndicationDisplayStatus=Od.h_i)}display(P){d.ULS.sendTraceTag(537167649,0,50,"PasteIndicationManager.Display: started");this.gridView.lb.vv(rb.a.d7(Kb.d(this.gridView.$.pa),P),Je.qoc,!0);this.gridView.lb.zn(Je.qoc)}jid(P){d.ULS.sendTraceTag(537167648,0,50,`PasteIndicationManager.HideForPasteId: pasteCommandId = ${P}, currentPasteCommandId = ${this.a4b}`);
P&&ib.a.equals(P,this.a4b,!1)&&this.hide()}hide(P=null){this.y1&&P&&this.erf()&&d.ULS.sendTraceTag(537167647,0,15,"PasteIndicationManager.Hide: Triggered by a SelectionChanged event while indication is (or will be) active but active range did not change");this.a4b="";this.rve();this.y1=null;this.gridView.lb.Mg(Je.qoc);this.gridView.lb.oi(null,Je.qoc)}erf(){return S.Q(this.gridView.ha.sa.selectedRanges,this.y1)}rve(){this.Ps&&(ke.a.Ia(this.Ps),this.Ps=null)}dispose(){this.hide();this.gridView.ha.RF(this.S6e)}}
Je.qoc=[30];Object(c.a)(Je,"PasteIndicationManager",null,[689,2]);var Fe=a(976),eb=a(54),Xb=a(696);class oc extends f.a{constructor(P){super();this.$=P;this.Qm=B.a.instance;this.Fb()}create(){const P=eb.a.LQ([74,75],4,this.hb,void 0,void 0,void 0,oc.Mma),Ta=fa.GetServiceTaskFactory.create(this.$.da,18,this.$.la,this.hb);ca.TaskExtensions.Aa(ca.TaskExtensions.Wd([Ta,P],this.la),()=>{const pb=new Fe.a;let Yb=null;this.p0g(pb).then(Ac=>{Yb=Ac.fye;const Zc=copyPasteInfra.createCopyPasteInfra(Yb,new Nd(this.$),
pb,this.$);d.ULS.shipAssertTag(537167762,0,!!this.$.ya,"CopyPasteInfrastructureFactory.Create: this.ewaControl.BootstrapContext should not be null");d.ULS.shipAssertTag(537167761,0,!!this.$.ya&&!!this.$.ya.DocumentHostInfo,"CopyPasteInfrastructureFactory.Create: this.ewaControl.BootstrapContext.DocumentHostInfo should not be null");const id=Yb.getMetadataManager();var gd=Object(Xb.b)(this.$.da,254,()=>new cc(this.$,id,Ta.result,Zc,new Ha(this.$,W.g(this.$)),new Td,this.$.ya.DocumentHostInfo.UserId,
Yb.getInitializationError()));this.qb(gd);if(Ac.t_a){gd=cc.Q9b();const Ub=JSON.stringify(Ac.t_a.dataClipboardCapabilities),Lc=Ac.t_a.clipboardStrategiesToInitialize[0].clipboardStrategyType===Ac.t_a.dataClipboardStrategyType,hd=void 0===window.bsqmXLSPageLoadStartTime||null===window.bsqmXLSPageLoadStartTime?"-1":(Date.now()-window.bsqmXLSPageLoadStartTime.getTime()).toString();d.ULS.sendTraceTag(41731933,0,50,`CopyPasteInfrastructureFactory.Create: Initialize CCP infra succeed. SliceName=${gd}, StrategyType=${Ac.t_a.dataClipboardStrategyType}, StrategyCapabilities=${Ub}, IsBestStrategyTypeInitialized=${Lc}, InfraLoadTimeMS=${hd}`)}else d.ULS.shipAssertTag(537167760,
0,!1,"CopyPasteInfrastructureFactory.Create: initResult.ClipboardPlatformEnvironmentInitializationInfo should not be null")},Ac=>{const Zc=cc.Q9b();Ac=Ac?copyPasteInfra.getStringifiedError(Ac):"null";d.ULS.shipAssertTag(38847436,0,!1,`CopyPasteInfrastructureFactory.Create: error during call to clipboardPlatformEnvironment.Init(). Copy Paste operations will not be available in this session. SliceName: ${Zc} error: ${Ac}`)})},this.la,3)}dispose(){super.dispose()}p0g(P){let Ta=null;var pb=window.clipboardPlatform;
pb&&(Ta=pb.getClipboardPlatformEnvironment());if(!Ta)return d.ULS.shipAssertTag(537167759,0,!1,"CopyPasteInfrastructureFactory.ConfigureClipboardPlatformEnvironment: getClipboardPlatformEnvironment should have returned a valid object"),Promise.reject(null);pb=this.$.ya;const Yb=[pb.OfficeOnlineChromeExtensionId,pb.ChromeClipboardAccessExtensionId],Ac=this.Qm.Xa(5);var Zc=this.$.me.get(57);let id=!Zc&&this.$.me.get(5);const gd=this.$.ea.jc;gd&&(gd.inWebPart||gd.inViewerFromWebPart||gd.isDivSyndicated)&&
(id=!1);Zc=this.DJh(id,!Zc);d.ULS.shipAssertTag(537167758,0,!!pb.DocumentHostInfo,"CopyPasteInfrastructureFactory.ConfigureClipboardPlatformEnvironment: bootstrapContext.DocumentHostInfo should not be null");return Ta.init(this.$,P,Yb,pb.SharedClipboardHostingApp,pb.SharedClipboardHostingApps,pb.SharedClipboardHostingEnvironments,pb.SharedClipboardOverrideOrigin,pb.SharedClipboardSchemaVersion,pb.SharedClipboardExpirationInMinutes,pb.ClipboardPromiseTimeoutInMinutes,Ac,pb.MachineCluster,new Tb(this.$),
Zc,pb.DocumentHostInfo.UserId,pb.ClipboardTtlInMS,r.EwaSettings.ma(310),pb.UserSessionId).then(Ub=>Object(b.a)(new nc,{fye:Ta,t_a:Ub}),Ub=>Promise.reject(Ub))}DJh(P,Ta){const pb=[];P&&Ta&&pb.push(this.R9g());Ta&&(pb.push(this.q3c(7)),pb.push(this.q3c(0)));P&&pb.push(this.VCe());pb.push({clipboardStrategyType:4});const Yb=pb?pb.map(Ac=>JSON.stringify(Ac)).join(","):"[]";d.ULS.sendTraceTag(39978242,0,50,`CopyPasteInfrastructureFactory.GetClipboardStrategiesInitList: create clipboard stratgy initialization list: isBrowserStorageAllowed=${P}, isSystemClipboardAllowed=${Ta}, result = ${Yb}`);
return pb}VCe(){const P=this.$.ya,Ta={clipboardStrategyType:5};Ta.sessionId=P.UserSessionId;Ta.useSharedClipboardIframe=!0;Ta.sharedClipboardHostingApp=P.SharedClipboardHostingApp;Ta.sharedClipboardHostingApps=P.SharedClipboardHostingApps;Ta.sharedClipboardHostingEnvironments=P.SharedClipboardHostingEnvironments;Ta.sharedClipboardOverrideOrigin=P.SharedClipboardOverrideOrigin;Ta.sharedClipboardSchemaVersion=P.SharedClipboardSchemaVersion;Ta.sharedClipboardExpirationInMinutes=P.SharedClipboardExpirationInMinutes;
Ta.wacCluster=P.MachineCluster;return Ta}R9g(){const P={clipboardStrategyType:6};P.localStorageStrategyParameters=this.VCe();P.systemClipboardStrategyParameters=this.q3c(0);return P}q3c(P){const Ta={};Ta.clipboardStrategyType=P;Ta.skipFilesIfPlainTextExists=!0;return Ta}static ka(P){P.da.Ga(373,new Je(P));P.da.Ga(oc.Mma,new oc(P))}}oc.Mma=255;Object(c.a)(oc,"CopyPasteInfrastructureFactory",f.a,[]);var Gc=a(10);a.d(C,"a",function(){return Vc});const Vc=()=>{Gc.a.Fa(P=>{oc.ka(P)})}},1149:function(t,
C,a){t=a(0);var c=a(15),b=a(681),d=a(551),f=a(83),e=a(84),k;(function(Ga){Ga[Ga.applicationFeatureHelperHandler=0]="applicationFeatureHelperHandler";Ga[Ga.cloudPolicySettings=1]="cloudPolicySettings";Ga[Ga.alternateAuthToken=2]="alternateAuthToken"})(k||(k={}));Object(t.b)("ApplicationFeatureHelperRequestType",k);class l{constructor(){this.message=null;this.Ucc=0}}Object(t.a)(l,"HttpRequstToPromiseRejectData",null,[]);var m=a(98),v=a(80),n=a(237);class w{constructor(Ga,Ba){this.nb=Ga;this.wh=Ba}G2c(Ga,
Ba,fa,Y=null,ja=null,ca=null,aa=null,ta=null){const xa=k[fa],ia=xa+"RequestFailure";m.Health.instance.recordKpiUsage(ia,0,"jpittsdirects",null);return new Promise((ya,ib)=>{c.ULS.sendTraceTag(50622688,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: Initializing HttpRequest {0}.",xa);const wa=null!=aa?aa:this.nb.nd("ApplicationFeatureHelperRequestQueueTimeout",15E3),sa=null!=ta?ta:this.nb.nd("ApplicationFeatureHelperRequestSentTimeout",3E4);this.wh.V8(Ga,1,null,this.UOh(fa,Y),ca,!1,
1,Ya=>{c.ULS.sendTraceTag(50622689,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: HttpRequest {0} Succeeded.",xa);try{if(void 0===Ya||null===Ya||void 0===Ya.data||null===Ya.data||void 0===Ya.data.Vd||null===Ya.data.Vd){m.Health.instance.recordKpiFailure(ia,"Invalid RequestSucceededEventArgs",!1,!0,null);let mb=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: args or args.Data or args.Data.ResponseData is null or undefined request {0}",xa);ib(this.Avb(mb,Ya))}else if(Ya.data.httpStatus!==
n.a.FO){m.Health.instance.recordKpiFailure(ia,"HttpStatusCode_"+Ya.data.httpStatus.toString(),!1,!0,null);let mb=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: ApplicationFeatureHelper Service token generation returned unexpected response code {0}, request {1}",Ya.data.httpStatus,xa);ib(this.Avb(mb,Ya))}else{void 0!==ja&&null!==ja&&void 0!==Ya.data.responseHeaders&&null!==Ya.data.responseHeaders&&ja(Ya.data.responseHeaders);var bb=Ba(Ya.data.Vd);if(bb)c.ULS.sendTraceTag(50622690,
3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: Successfully parsed response for request {0}",xa),ya(bb);else{m.Health.instance.recordKpiFailure(ia,"Parse Failure",!1,!0,null);let mb=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Failed to parse response for request {0}",xa);ib(this.Avb(mb,Ya))}}}catch(mb){m.Health.instance.recordKpiFailure(ia,"Unexpected Failure",!1,!0,null),bb=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Exception {0} for request {1}",
mb,xa),ib(this.Avb(bb,Ya))}},Ya=>{let bb;Ya.data?(m.Health.instance.recordKpiFailure(ia,"HttpStatusCode_"+Ya.data.httpStatus.toString(),!1,!0,null),bb=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Request Failed: HttpStatus - {0}, ResponseData - {1} for Request - {2}",Ya.data.httpStatus,Ya.data.Vd||"No Data",xa)):(m.Health.instance.recordKpiFailure(ia,"Invalid RequestFailedEventArgs",!1,!0,null),bb=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: args or args.Data is null or undefined for request {0}",
xa));ib(this.Avb(bb,Ya))},null,void 0,void 0,wa,sa)})}Avb(Ga,Ba){const fa=new l;fa.message=Ga;fa.Ucc=Ba&&Ba.data?Ba.data.httpStatus:-1;return fa}UOh(Ga,Ba){const fa={};fa["x-UserDataSignature"]=this.nb.Va("UserDataSignature");fa["x-LicensingIsEnabled"]=this.nb.qa("LicensingIsEnabled").toString();fa["x-CacheIsEnabled"]=this.nb.qa("LicensingRedisIsEnabled").toString();fa["x-OcpsIsEnabled"]=this.nb.qa("OcpsIsEnabled").toString();fa["x-LicensingAADIdIsEnabled"]=this.nb.qa("LicensingAadIdIsEnabled").toString();
0===Ga&&(fa["x-LicenseCheckOnTenantEnabled"]=this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SafeLinksLicenseCheck",!1).toString(),fa["x-SupportUserConsentDependentFeatures"]="true",fa["x-AFHUserConsentGroupValue"]="0",fa["x-UseShellServiceForUserConsentGroup"]="true",fa["x-SMBUserLicensingEnabled"]="true",fa["x-AFHPIPLComplianceEnabled"]=v.a.gz(window.location.href,"wd_afhpipl")||"false");if(Ba)for(let Y of Ba.keys)fa[Y]=Ba.na(Y);return fa}}Object(t.a)(w,"HttpRequestToPromiseUtility",
null,[]);var r=a(4),u;(function(Ga){Ga[Ga.loki=0]="loki";Ga[Ga.augloopACLP=1]="augloopACLP"})(u||(u={}));Object(t.b)("AlternateAuthSupportApp",u);var y=a(728),x=a(41);class B{constructor(){this.Token=null;this.ExpirationTime=0}}Object(t.a)(B,"WacAlternateAuthToken",null,[]);class z{constructor(Ga,Ba){this.kKj=3E5;if(void 0===Ga||null===Ga||void 0===Ba||null===Ba)throw Error.argumentNull("appSettingsManager/clientRequestManager");this.nb=Ga;this.wPb=new b.a(d.a.Sk());this.hib=new w(Ga,Ba);void 0!==
y.a.Ftd&&null!==y.a.Ftd&&void 0!==y.a.ejc&&null!==y.a.ejc&&0<y.a.ejc&&(Ga=new B,Ga.Token=y.a.Ftd,Ga.ExpirationTime=y.a.ejc,this.wPb.ia("loki",Ga))}aHh(){let Ga=null;this.wPb.mb(u[0])&&(Ga=this.wPb.na(u[0]));return void 0===Ga||null===Ga||this.aqd(Ga)?this.Vxh():Promise.resolve(Ga.Token)}aqd(Ga){return Ga.ExpirationTime-Date.now()<this.kKj}Vxh(){const Ga=new b.a(d.a.Sk());Ga.ia("X-AlternateAuthApp",u[0]);return this.hib.G2c(this.Iua("/afhs/AlternateAuthHelperHandler.ashx"),Object(f.a)(this,this.HVi,
"parseAlternateAuthTokenResponse"),2,Ga).then(Ba=>{c.ULS.sendTraceTag(545821456,3004,50,"AlternateAuthHelper:FetchNewUserDataSignatureToken: Retrieved WacAlternateAuthToken for {0}",u[0]);this.wPb.ia(u[0],Ba);return Ba.Token},Ba=>{Ba=Object(e.a)(l,Ba);c.ULS.sendTraceTag(545604827,3004,10,"AlternateAuthHelper:FetchNewUserDataSignatureToken: Error: {0}, status code: {1}",Ba.message,Ba.Ucc);return null})}HVi(Ga){let Ba=null;({Ut:Ba}=x.d(Ga));c.ULS.sendTraceTag(545821457,3004,Ba?50:10,"ParseAlternateAuthTokenResponse: fetched WacAlternateAuthToken from {0}",
Ga);return Ba}Iua(Ga){return String.format("{0}{1}?{2}",this.nb.Va("WebServiceBase"),Ga,r.AFrameworkApplication.ij)}}Object(t.a)(z,"AlternateAuthHelper",null,[244]);var A=a(452);class I{constructor(Ga,Ba,fa){this.featureName=null;this.isEnabled=!1;this.tierName=0;this.featureName=Ga;this.isEnabled=Ba;this.tierName=fa}}Object(t.a)(I,"FeatureStateChangeArgs",null,[]);var F=a(134),U=a(251),X=a(27),S=a(110),H=a(172),D;(function(Ga){Ga[Ga.Enabled=0]="Enabled";Ga[Ga.Disabled=1]="Disabled"})(D||(D={}));
Object(t.b)("FeatureState",D);var J=a(82),M=a(25),G=a(186);class T{constructor(Ga,Ba,fa=null,Y=null,ja=null){this.Xta=this.MUb=this.Mde=this.Vpa=this.OVb=null;this.hib=new w(Ga,Ba);this.nb=Ga;this.Brg=Ga.nd("LicensingMaxRetryAttempts",0);this.WJc=Ga.qa("IsO365ConsumerHost");this.VJc=Ga.qa("IsO365CommercialHost");this.ySb=Ga.qa("PremiumUpsellIsEnabled");this.v2d=fa;this.Vhe=Y;this.La=ja;this.Upa=Ga.qa("LicensingIsEnabled");this.NDa=Ga.qa("OcpsIsEnabled")&&this.VJc;this.xRc=Ga.qa("ShowPrivacyDialog")&&
!!Y;this.A7d=Ga.qa("IsAnonymousUser");this.K9c=new Promise(ca=>{ca(!1)});this.XAa=new Promise(ca=>{ca(!0)});this.Wta=new b.a(d.a.Sk());this.AWb=!0;this.d$d=this.sQh();this.eod()&&!this.A7d?(void 0!==r.AFrameworkApplication.ta&&null!==r.AFrameworkApplication.ta&&(this.OVb=r.AFrameworkApplication.ta.MD,void 0!==this.OVb&&null!==this.OVb&&(this.Vpa=this.OVb.Og("WebServiceCall","ApplicationFeatureHelperService"))),this.Xta=this.tWd()):this.Xta=new Promise(ca=>{ca({})});this.Xta.catch(ca=>{c.ULS.sendTraceTag(42513088,
3004,10,JSON.stringify(ca))});this.AWb&&(this.ySb=!1,this.isFeatureEnabled("FreemiumUpsell",!0).then(ca=>{this.ySb=this.nb.qa("PremiumUpsellIsEnabled")&&ca;return null}))}sQh(){const Ga=this.nb.lo("AllLicensedFeatures")?this.nb.fw("AllLicensedFeatures"):[],Ba=new A.a;for(let fa=0;fa<Ga.length;fa++)Ba.add(Ga[fa]);return Ba}eod(){return this.VJc||this.WJc}tWd(Ga=0,Ba=!1){c.ULS.sendTraceTag(51185368,3004,50,"ApplicationFeatureHelper_TryInitializeLicensing: forceRefresh = {0}",Ba);const fa=F.a.Lr();fa&&
(fa.set("retryAttempt",Ga.toString()),fa.set("forceRefresh",Ba.toString()),fa.set("isO365ConsumerHost",this.WJc.toString()),fa.set("isO365CommercialHost",this.VJc.toString()),fa.set("isFreemiumUpsellEnabled",this.ySb.toString()));m.Health.instance.recordKpiUsageForAlertableKpi("AFHSLicensingFailedRequest","waclicensing",fa);m.Health.instance.recordKpiUsage("AFHSLicensingSuccessfulRequest",1,"waclicensing",fa);void 0!==this.Vpa&&null!==this.Vpa&&this.Vpa.start();let Y=null;Ba&&(Y=new b.a(d.a.Sk()),
Y.ia("x-LicensingForceRefresh","true"));this.Mde=new Date;return(this.Upa?this.hib.G2c(this.Iua("/afhs/ApplicationFeatureHelperHandler.ashx"),Object(f.a)(this,this.KVi,"parseApplicationFeatureHelperResponse"),0,Y,Object(f.a)(this,this.d0i,"processApplicationFeatureHelperResponseHeaders"),["Date"]):Promise.resolve({})).then(ja=>{const ca=Object.assign(new G.a,{durationMs:this.L5f()});ca.extendedProperties=fa;ca.extendedProperties&&ja&&(ca.extendedProperties.set("featureCount",S.a.count(ja).toString()),
ca.extendedProperties.set("licensingTestFeatureEnabled",("LicensingTestFeature"in ja).toString()),ca.extendedProperties.set("msoPremiumBadgeEnabled",("MsoPremiumBadge"in ja).toString()),this.MUb&&ca.extendedProperties.set("fromCache",(this.MUb<this.Mde).toString()));m.Health.instance.recordKpiSuccess("AFHSLicensingSuccessfulRequest",ca);return ja},ja=>{const ca=Object.assign(new G.a,{durationMs:this.L5f()}),aa=Object(e.a)(l,ja);if(!aa)return c.ULS.sendTraceTag(51491471,3004,10,"ApplicationFeatureHelper_TryInitializeLicensing: Invalid cast to HttpRequestToPromiseRejectData"),
m.Health.instance.recordKpiFailure("AFHSLicensingFailedRequest","InvalidCastToHttpRequestToPromiseRejectData",!1,!0,ca),new Promise((ta,xa)=>{xa(ja)});ca.extendedProperties=fa;ca.extendedProperties&&ca.extendedProperties.set("status",aa.Ucc.toString());m.Health.instance.recordKpiFailure("AFHSLicensingFailedRequest","RequestFailed",!1,!0,ca);return 408===aa.Ucc&&++Ga<=this.Brg?this.tWd(Ga):new Promise((ta,xa)=>{xa(aa)})})}KVi(Ga){(Ga=x.b(Ga))?(c.ULS.sendTraceTag(50436170,3004,50,"ParseApplicationFeatureHelperResponse: Successfully fetched features"),
c.ULS.sendTraceTag(50938594,3004,50,"{0}",Ga)):c.ULS.sendTraceTag(50436171,3004,10,"ParseApplicationFeatureHelperResponse: ApplicationFeatureHelper Service returned a null feature set");return Ga.Features}Iua(Ga){var Ba=String.format("{0}{1}",this.nb.Va("WebServiceBase"),Ga);this.nb.lo("ApplicationFeatureHelperHttpCachingEnabled")&&this.nb.qa("ApplicationFeatureHelperHttpCachingEnabled")&&(Ga=T.W$b(this.nb))&&0<Ga.length&&(this.AWb&&(Ga+="ucbf"),Ba=new U.QueryStringBuilder(Ba),Ba.Qi("afhskey",Ga),
Ba=Ba.toString());return Ba}isFeatureEnabled(Ga,Ba){if(!this.NDa&&!this.xRc&&!this.Upa)return this.XAa;c.ULS.sendTraceTag(42513091,3004,50,"ApplicationFeatureHelper.IsFeatureEnabled: Call made to check if feature: {0} is enabled.",Ga);if("ConnectedServices"===Ga){var fa=this.NDa?this.v2d.EM("ControllerConnectedServicesEnabled"):this.XAa;const ca=this.xRc?this.Vhe.getSettings().then(aa=>2!==aa.St,()=>Ba):this.XAa;return fa.then(aa=>aa?ca:this.K9c)}fa=null;fa=this.NDa?this.v2d.isFeatureEnabled(Ga):
this.XAa;let Y=null;Y=this.Upa?this.zgi(Ga,Ba):this.XAa;let ja=null;ja=this.xRc?this.Vhe.isFeatureEnabled(Ga):this.XAa;return fa.then(ca=>ca?ja.then(aa=>aa?Y:this.K9c):this.K9c).then(ca=>{this.hlf(Ga,ca,!0);return ca},()=>{this.hlf(Ga,Ba,!1);return Ba})}hlf(Ga,Ba,fa){c.ULS.sendTraceTag(526713106,3004,50,"FeatureName={0}, IsEnabled={1}, IsSuccess={2}",Ga,Ba,fa)}getFeatureTier(Ga,Ba){if(!this.Upa)return new Promise(fa=>{fa(2)});c.ULS.sendTraceTag(42804871,3004,50,"ApplicationFeatureHelper.GetFeatureTier: Call made to get Feature's Tier.",
Ga);return this.Xta.then(fa=>this.Zac(Ga,fa,Ba),()=>Ba)}isFreemiumUpsellEnabled(){return this.ySb&&this.WJc&&!this.A7d}launchUpsellExperience(Ga,Ba=null){c.ULS.sendTraceTag(594564814,3004,50,String.format("ApplicationFeatureHelper_LaunchUpsellExperience: Launching upsell experience for experienceId: {0}",Ga));var fa=F.a.Lr();fa&&(fa.set("experienceId",Ga),Ba&&fa.set("campaignId",Ba));m.Health.instance.recordKpiUsage("AFHCLaunchUpsellSuccess",1,"waclicensing",fa);if(fa=J.a.instance.vh("Common.IInProductMessagingUIManager")){const Y=
Object(f.a)(this,this.e1h,"handleDimeTaskComplete");fa.rjf(Ga,Y,Ba)}else c.ULS.sendTraceTag(594367561,3004,15,"InProductMessaging was not initialized"),m.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","InProductMessagingNotInitialized",!1,!0,null),this.La.de(M.a.k9b,2,{["experience"]:Ga})}gma(Ga,Ba){if(!this.Upa)return null;if(!Ga||!Ba)return c.ULS.sendTraceTag(594564813,3004,10,"ApplicationFeatureHelper_RegisterFeatureStateChangeCallback: Invalid input."),null;const fa=H.a.create().toString();
this.Wta.mb(Ga)||this.Wta.ia(Ga,new b.a(d.a.Sk()));this.Wta.na(Ga).add(fa,Ba);c.ULS.sendTraceTag(594564812,3004,50,String.format("ApplicationFeatureHelper_RegisterFeatureStateChangeCallback: registered callback {0} for feature {1}",fa,Ga));return fa}CHd(Ga,Ba){this.Upa&&(Ga&&this.Wta.mb(Ga)?Ba&&H.a.isValid(Ba)?this.Wta.na(Ga).mb(Ba)?(c.ULS.sendTraceTag(594564808,3004,50,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: Removing callback {0} for feature {1}",Ba,Ga)),this.Wta.na(Ga).remove(Ba)):
c.ULS.sendTraceTag(594564809,3004,15,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: callbackId {0} not registered for feature {1} ",Ba,Ga)):c.ULS.sendTraceTag(594564810,3004,10,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: invalid callbackId {0} for feature {1}",Ba,Ga)):c.ULS.sendTraceTag(594564811,3004,10,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: invalid or non registered featureName {0}",Ga)))}Zac(Ga,Ba,fa){return this.AWb?
Ga in Ba?Ba[Ga].LicenseTier:fa:Ga in Ba?this.hWi(Ba[Ga],fa):fa}hWi(Ga,Ba){switch(Ga.toLowerCase()){case "unknown":return 0;case "basic":return 1;case "premium":return 2;default:return Ba}}e1h(){c.ULS.sendTraceTag(594367560,3004,50,"ApplicationFeatureHelper_HandleDimeTaskComplete");this.Xta.then(Ga=>{this.VMf(Ga)}).catch(()=>{this.VMf({})})}VMf(Ga){c.ULS.sendTraceTag(594051087,3004,50,"ApplicationFeatureHelper_RefreshLicensingAndNotifyUpdatedFeatures");const Ba=this.tWd(0,!0);Ba.then(fa=>{this.Xta=
Ba;S.a.count(fa)>S.a.count(Ga)?m.Health.instance.recordKpiSuccess("AFHCLaunchUpsellSuccess",null):m.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","FeatureCountNotIncreased",!1,!0,null);for(let Y of this.Wta.keys)if(Y in fa){const ja=this.Zac(Y,fa,0);Y in Ga?this.Zac(Y,Ga,0)!==ja&&this.pxd(Y,!0,ja):this.pxd(Y,!0,ja)}else Y in Ga&&this.pxd(Y,!1,this.Zac(Y,Ga,0))}).catch(fa=>{m.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","LicensingRefreshFailed",!1,!0,null);c.ULS.sendTraceTag(594051086,
3004,10,JSON.stringify(fa))})}pxd(Ga,Ba,fa){c.ULS.sendTraceTag(594051085,3004,50,"ApplicationFeatureHelper_NotifyFeatureStateChanged: Notify feature state changed callbacks for feature {0}, {1}, {2}",Ga,Ba,fa);Ba=new I(Ga,Ba,fa);fa=this.Wta.na(Ga);for(let Y of fa)try{Y.value(Ba)}catch(ja){c.ULS.sendTraceTag(594051084,3004,10,String.format("ApplicationFeatureHelper_NotifyFeatureStateChanged: Exception when calling registered callback: feature: {0} callbackId: {1}, exception {2}",Ga,Y.key,ja.message))}}Ud(Ga,
Ba){if(this.Upa){const fa=this.d$d.contains(Ga);let Y=!0,ja="",ca=!1;return this.Xta.then(aa=>{Ga in aa?(aa=aa[Ga],ja=D[aa.FeatureState],Y=1!==aa.FeatureState):Y=!fa;this.qlf(Ga,fa,ja,ca,Ba,Y);return Y},()=>{ca=!0;fa&&(Y=Ba);this.qlf(Ga,fa,ja,ca,Ba,Y);return Y})}return this.XAa}qlf(Ga,Ba,fa,Y,ja,ca){c.ULS.sendTraceTag(557389507,3004,50,"featureName : {0}, isLicenseControlledFeature={1}, encounteredError = {2}, featureData={3}, fallbackValue={4}, isAllowed={5}",Ga,Ba,Y,fa,ja,ca)}zgi(Ga,Ba){if(this.AWb)return this.Ud(Ga,
Ba);if(this.Upa){if(this.d$d.contains(Ga))return this.Xta.then(fa=>Ga in fa,()=>Ba);c.ULS.sendTraceTag(590385821,3004,50,"ApplicationFeatureHelper_IsFeatureAllowedByUserLicense: Feature '{0}' requested while not in the licensed features set.",Ga)}return this.XAa}d0i(Ga){try{Ga&&"Date"in Ga&&(this.MUb=new Date(Ga.Date),c.ULS.sendTraceTag(578863817,3004,50,"ProcessApplicationFeatureHelperResponseHeaders Date {0}",this.MUb.toString()))}catch(Ba){c.ULS.sendTraceTag(578863818,3004,10,"ProcessApplicationFeatureHelperResponseHeaders Exception {0}",
Ba)}}L5f(){if(void 0!==this.Vpa&&null!==this.Vpa){const Ga=this.Vpa.uc;this.Vpa.stop();return Ga}return null}static W$b(Ga){try{if(X.a.vGj){const Ba=Ga.Va("UserDataSignature").split(".");if(1<Ba.length){const fa=window.self.atob(Ba[1]),Y=JSON.parse(fa).LocalStorageKey;if(void 0!==Y&&null!==Y&&0<Y.length)return Y}}}catch(Ba){c.ULS.sendTraceTag(578863816,3004,10,"GetLocalStorageCacheKey exception {0}",Ba.toString())}return null}}Object(t.a)(T,"ApplicationFeatureHelper",null,[245]);var K=a(185);class L{constructor(Ga,
Ba){this.PolicySettings=null;this.ExpirationTime=0;this.PolicySettings=Ga.PolicySettings;Ga=new Date;Ga.setMinutes(Ga.getMinutes()+Ba);this.ExpirationTime=Ga.getTime()}}Object(t.a)(L,"CloudPolicySettingsCacheData",null,[]);var V=a(813),W=a(371),da=a(226);class qa{static T3f(){return r.AFrameworkApplication.fa.qa("SideCarIsEnabled")?qa.Htc&&qa.rmd?new Promise(Ga=>{Ga(!0)}):new Promise((Ga,Ba)=>{qa.Htc=da.a.create(r.AFrameworkApplication.fa.Va("SideCarUrl"));W.a.Xha(qa.Htc);qa.Htc.Z8((fa,Y)=>{(qa.rmd=
Y.succeeded)?Ga(Y.succeeded):Ba(Y.succeeded)})}):new Promise(Ga=>{Ga(!1)})}}qa.rmd=!1;qa.Htc=null;Object(t.a)(qa,"SideCarLoader",null,[]);class O{constructor(){this.ControllerConnectedServicesFeatureNames=this.PolicySettings=null}}Object(t.a)(O,"CloudPolicySettingsData",null,[]);class ea{constructor(Ga,Ba){this.PEc=0;this.D1b=null;this.hib=new w(Ga,Ba);this.nb=Ga;Ba=Ga.Va("HostAuthType");this.NDa=Ga.qa("OcpsIsEnabled")&&Ga.qa("IsO365CommercialHost")&&!(void 0===Ba||null===Ba)&&"aad"===Ba.toLowerCase();
this.hbe=x.b(Ga.Va("OcpsDefaultSettings")||"{}");this.Vib=this.W$b();Ba=this.nb.lo("ServicesControlsMicrosoftControllerServicesList")?this.nb.fw("ServicesControlsMicrosoftControllerServicesList")||[]:[];this.xQb=new A.a;for(let fa=0;fa<Ba.length;fa++)this.xQb.add(Ba[fa]);this.NDa&&!Ga.qa("IsAnonymousUser")&&Ga.qa("SideCarIsEnabled")?this.D1b=this.cNj():this.D1b=this.Vna(this.NDa,this.Iua("/afhs/CloudPolicySettings.ashx"),Object(f.a)(this,this.LVi,"parseCloudPolicySettingsResponse"));this.D1b.then(()=>
null).catch(fa=>{c.ULS.sendTraceTag(50622685,3004,10,JSON.stringify(fa))})}EM(Ga,Ba=!0){if(!this.NDa){const ca=this;return new Promise(aa=>{aa(ca.kvb(Ga))})}let fa=this,Y=this;const ja=this.D1b.then(ca=>{try{let aa=null;ca.PolicySettings&&"unknown"in ca.PolicySettings&&(aa=ca.PolicySettings.unknown);if(aa){if(Ga in aa&&void 0!==aa[Ga]&&null!==aa[Ga])return new Promise(xa=>{xa("0"!==aa[Ga])});const ta=Ga.toLowerCase();if(ta in aa&&void 0!==aa[ta]&&null!==aa[ta])return new Promise(xa=>{xa("0"!==aa[ta])});
c.ULS.sendTraceTag(51512667,3004,50,"Policy"+Ga+" not found, using default");return new Promise(xa=>{xa(fa.kvb(Ga))})}return new Promise(ta=>{ta(fa.kvb(Ga))})}catch(aa){return c.ULS.sendTraceTag(50622686,3004,10,"Failed to get "+Ga+" policy value. Error Message: {0}",aa.message),fa.handleError(aa.toString(),Ba,fa.kvb(Ga))}},ca=>Y.handleError(ca,Ba,Y.kvb(Ga)));ja.then(ca=>{c.ULS.sendTraceTag(50651667,3004,50,"CloudPolicySettingsHelper.GetBooleanPolicySetting: policy: {0}, value: {1}",Ga,ca);return null});
return ja}isFeatureEnabled(Ga,Ba=!0){if(this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UseApplicationFeatureHelperAPIForFeedbackAndSurvey",!1))return this.Bgi(Ga,Ba);let fa=new Promise(ja=>{ja(!0)}),Y="";this.xQb.contains(Ga)&&(Y="ControllerConnectedServicesEnabled",fa=this.EM(Y,Ba));fa.then(ja=>{c.ULS.sendTraceTag(50651668,3004,50,"CloudPolicySettingsHelper.IsFeatureEnabled: Feature: {0}, enabled or not: {1}, by policy: {2}",Ga,ja,Y);return null});return fa}Bgi(Ga,Ba=!0){let fa=new Promise(ja=>
{ja(!0)}),Y="";"mso_sendASmile"===Ga?Y="Enabled":"Survey"===Ga||"FloodgateSurvey"===Ga?Y="SurveyEnabled":this.xQb.contains(Ga)&&(Y="ControllerConnectedServicesEnabled");""!==Y&&(fa=this.EM(Y,Ba));fa.then(ja=>{c.ULS.sendTraceTag(558187080,3004,50,"CloudPolicySettingsHelper.IsFeatureEnabledV2: Feature: {0}, enabled or not: {1}, by policy: {2}",Ga,ja,Y);return null});return fa}handleError(Ga,Ba,fa){return Ba?new Promise(Y=>{Y(fa)}):new Promise((Y,ja)=>{ja(Ga)})}Vna(Ga,Ba,fa){if(!Ga)return Promise.resolve(new O);
let Y=!1,ja=null;m.Health.instance.recordKpiUsage("GetCloudPolicySettings",1,"jpittsdirects",null);let ca=this.d2c("GetCloudPolicySettings");return(new Promise((aa,ta)=>{if(void 0!==this.Vib&&null!==this.Vib&&0<this.Vib.length){const xa=this.MMj();if(void 0!==xa&&null!==xa){Y=!0;aa(xa);return}}this.hib.G2c(Ba,fa,1,null,Object(f.a)(this,this.h0i,"processCloudPolicySettingsResponseHeaders"),["CheckIn-Interval"],this.nb.nd("CloudPolicySettingsRequestQueueTimeout",15E3),this.nb.nd("CloudPolicySettingsRequestSentTimeout",
3E4)).then(xa=>{c.ULS.sendTraceTag(51662933,3004,50,"Retrieved CloudPolicySettingsData from OCPS");this.CNj(xa);aa(xa);return xa},xa=>{ta(xa);return null})})).then(aa=>{({stopwatch:ca,returnValue:ja}=this.Gxc(ca));var ta=F.a.Lr();ta&&ta.set("FromCache",Y.toString());ta=Object.assign(new G.a,{durationMs:ja,extendedProperties:ta});m.Health.instance.recordKpiSuccess("GetCloudPolicySettings",ta);return aa})}cNj(){return qa.T3f().then(()=>{c.ULS.sendTraceTag(593282845,3004,50,"CloudPolicySettingsHelper - Retrieving CloudPolicySettingsData Promise from Sidecar");
return sidecar.cloudPolicy.GetCloudPolicySettingsData()})}Iua(Ga){return String.format("{0}{1}",this.nb.Va("WebServiceBase"),Ga)}LVi(Ga){let Ba=null;({Ut:Ba}=x.d(Ga));c.ULS.sendTraceTag(50622687,3004,Ba?50:10,"ParseCloudPolicySettingsResponse: fetched CloudPolicySettingsData from {0}",Ga);return Ba}h0i(Ga){try{if(void 0!==Ga&&null!==Ga&&"CheckIn-Interval"in Ga){const Ba=parseInt(Ga["CheckIn-Interval"]);void 0!==Ba&&null!==Ba&&0<Ba&&(this.PEc=Ba)}}catch(Ba){c.ULS.sendTraceTag(51662934,3004,10,"ProcessCloudPolicySettingsResponseHeaders Exception {0}",
Ba)}}kvb(Ga){return Ga in this.hbe?"0"!==this.hbe[Ga]:!0}MMj(){try{const Ga=V.a.instance.getItem(this.Vib);if(void 0===Ga||null===Ga)return c.ULS.sendTraceTag(51662936,3004,50,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage is null"),null;c.ULS.sendTraceTag(51662937,3004,50,"TryGetCloudPolicySettingsDataFromCache retrieved data {0} from LocalStorage",Ga);const Ba=JSON.parse(Ga);if(void 0===Ba||null===Ba)return c.ULS.sendTraceTag(51662938,3004,15,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage is null after parsing"),
null;if(void 0===Ba.ExpirationTime||null===Ba.ExpirationTime)return c.ULS.sendTraceTag(51662939,3004,15,"TryGetCloudPolicySettingsDataFromCache ExpirationTime from LocalStorage is null after parsing"),null;if((new Date(Ba.ExpirationTime)).getTime()<Date.now())return c.ULS.sendTraceTag(51662940,3004,50,"TryGetCloudPolicySettingsDataFromCache Cache is expired"),null;const fa=new O;fa.PolicySettings=Ba.PolicySettings;fa.ControllerConnectedServicesFeatureNames=new K.a;this.nb.lo("ServicesControlsMicrosoftControllerServicesList")&&
this.nb.fw("ServicesControlsMicrosoftControllerServicesList");for(let Y of this.xQb)fa.ControllerConnectedServicesFeatureNames.add(Y);c.ULS.sendTraceTag(51662941,3004,50,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage retrieved");return fa}catch(Ga){return c.ULS.sendTraceTag(51662942,3004,10,"TryGetCloudPolicySettingsDataFromCache exception {0}",Ga.toString()),null}}CNj(Ga){try{if(void 0===Ga||null===Ga||void 0===Ga.PolicySettings||null===Ga.PolicySettings)c.ULS.sendTraceTag(51662944,
3004,15,"TrySetCloudPolicySettingsDataIntoCache data/PolicySettings is null");else if(0>=this.PEc)c.ULS.sendTraceTag(51662945,3004,15,"TrySetCloudPolicySettingsDataIntoCache _checkInInterval is Invalid");else{const Ba=new L(Ga,this.PEc),fa=JSON.stringify(Ba);c.ULS.sendTraceTag(51662946,3004,50,"TrySetCloudPolicySettingsDataIntoCache data to cache {0}",fa);V.a.instance.setItem(this.Vib,fa);c.ULS.sendTraceTag(51662947,3004,50,"TrySetCloudPolicySettingsDataIntoCache set data to cache")}}catch(Ba){c.ULS.sendTraceTag(51662976,
3004,10,"TrySetCloudPolicySettingsDataIntoCache exception {0}",Ba.toString())}}W$b(){const Ga=T.W$b(this.nb);return Ga&&0<Ga.length?"OCPS"+Ga:null}d2c(Ga){const Ba=J.a.instance.vh("Microsoft.Office.Telemetry.Usage.IStopwatchBuilder");return void 0!==Ba&&null!==Ba?Ba.Bc("WebServiceCall",Ga):null}Gxc(Ga){if(void 0!==Ga&&null!==Ga){const Ba=Ga.uc;Ga.stop();return{returnValue:Ba,stopwatch:null}}return{returnValue:null,stopwatch:Ga}}}Object(t.a)(ea,"CloudPolicySettingsHelper",null,[242]);class R{constructor(){this.cIe=
this.peg=this.St=0;this.dIe=this.qeg=this.YGa="";this.fQc=this.fea=2}clone(){const Ga=new R;Ga.St=this.St;Ga.peg=this.peg;Ga.cIe=this.cIe;Ga.YGa=this.YGa;Ga.qeg=this.qeg;Ga.dIe=this.dIe;Ga.fea=this.fea;Ga.fQc=this.src;return Ga}get src(){return this.fQc}serialize(Ga=null){const Ba={};if(!Ga||Ga.contains(R.QNa))Ba[R.QNa]=this.St;if(!Ga||Ga.contains(R.iDb))Ba[R.iDb]=this.YGa;if(!Ga||Ga.contains(R.jDb))Ba[R.jDb]=this.fea;return JSON.stringify(Ba)}static create(Ga,Ba=null){const fa=new R;fa.fQc=Ga;void 0!==
Ba&&null!==Ba&&(R.QNa in Ba&&(fa.St=Ba[R.QNa]),R.iDb in Ba&&(fa.YGa=Ba[R.iDb]),R.jDb in Ba&&(fa.fea=Ba[R.jDb]));return fa}static deserialize(Ga,Ba){try{const fa=JSON.parse(Ga);if(void 0!==fa&&null!==fa)return R.create(Ba,fa);c.ULS.sendTraceTag(50860946,306,10,"UserPrivacySettings Deserialize: Unable to convert {0} to dict",Ga);throw Error.argument("settingsData");}catch(fa){throw c.ULS.sendTraceTag(50860947,306,10,"UserPrivacySettings Deserialize Exception = {0}",fa.toString()),fa;}}}R.QNa="CCS";
R.iDb="CCSTime";R.jDb="OfficePrivacyRoamedNoticeShown";Object(t.a)(R,"UserPrivacySettings",null,[]);var oa=a(128);class pa{constructor(Ga,Ba){if(void 0===Ga||null===Ga||void 0===Ba||null===Ba)throw Error.argumentNull("appSettingsManager/clientRequestManager");this.nb=Ga;this.wh=Ba;this.wPc=this.ke=null}Iua(Ga){var Ba=String.format("{0}RoamingServiceHandler.ashx?action=",this.nb.appSettings.RoamingServiceHandlerWebServiceBase||"");Ba=new Sys.StringBuilder(Ba);Ba.append(Ga);Ba.append("&");Ba.append(r.AFrameworkApplication.ij);
return Ba.toString()}executeRequest(Ga,Ba,fa,Y=null){return this.wh.umb(Ga,Ba,Y,null,fa,"33",!1,null,6E4)}saveSettings(Ga){return new Promise((Ba,fa)=>{try{if(void 0===this.ke||null===this.ke||void 0===Ga||null===Ga)c.ULS.sendTraceTag(51258443,3004,15,"SaveUserPrivacySettings: Can't determine setting changes to save"),fa("Can't determine setting changes to save");else{var Y=this.ke.St!==Ga.St;if(2===this.ke.src&&Y)this.njj(Ga),Ba(!0);else{var ja=this.inj(Ga);if(void 0===ja||null===ja||!ja.length)c.ULS.sendTraceTag(50917389,
3004,15,"SaveUserPrivacySettings: returning since nothing changed"),fa("No changes to save");else if(1===this.ke.src)Ba(this.jag(ja));else if(0===this.ke.src){c.ULS.sendTraceTag(51258444,3004,50,"UserPrivacySettingsHelper: SaveSettings to Roaming {0}",ja);const ca=this.executeRequest(this.Iua("saveUserPrivacySettings"),2,"SaveUserPrivacySettingsRequest",ja);ca.continueWith(()=>{if(ca.Ch||ca.Sf)c.ULS.sendTraceTag(50860929,3004,10,"SaveUserPrivacySettings: Roaming Request Cancelled/Failed"),Ba(!1);
else{var aa=ca.result;void 0!==aa.Ig&&null!==aa.Ig&&void 0!==aa.Ig.data&&null!==aa.Ig.data&&aa.Ig.data.httpStatus===n.a.FO?(c.ULS.sendTraceTag(51258445,3004,50,"SaveUserPrivacySettings: Roaming Request Succeeded"),Ba(!0)):(c.ULS.sendTraceTag(51258446,3004,10,"SaveUserPrivacySettings: Roaming Request Failed"),Ba(!1))}})}}}}catch(ca){c.ULS.sendTraceTag(50860930,3004,10,"SaveUserPrivacySettings: Exception = {0}",ca.toString()),Ba(!1)}})}inj(Ga){if(void 0===this.ke||null===this.ke||void 0===Ga||null===
Ga)throw Error.invalidOperation("User Privacy settings have not been initialized");const Ba=new K.a;0===Ga.src?(this.ke.St!==Ga.St&&(Ba.add(R.QNa),Ba.add(R.iDb)),this.ke.fea!==Ga.fea&&Ba.add(R.jDb)):1===Ga.src&&this.ke.St!==Ga.St&&Ba.add(R.QNa);return Ba.count?Ga.serialize(Ba):(c.ULS.sendTraceTag(50860931,3004,50,"SaveUserPrivacySettings: returning since nothing changed"),null)}getSettings(){if(!this.wPc){const Ga=this;this.wPc=new Promise(Ba=>{try{Ga.ke?Ba(Ga.ke.clone()):Ga.VMj().then(fa=>{Ga.ke=
fa;Ba(Ga.ke.clone());return null},()=>{Ga.TMj().then(fa=>{Ga.ke=fa;Ba(Ga.ke.clone());return null},()=>{Ga.UMj().then(fa=>{Ga.ke=fa;Ba(Ga.ke.clone());return null},()=>{c.ULS.sendTraceTag(50967430,3004,10,"UserPrivacySettings TryGetSettingsFromQueryParams returned an error)");Ga.ke=new R;Ba(Ga.ke.clone());return null});return null});return null})}catch(fa){c.ULS.sendTraceTag(50860932,3004,10,"UserPrivacySettings GetSettings: Exception = {0}",fa.toString()),Ga.ke=new R,Ba(Ga.ke.clone())}})}return this.wPc}VMj(){return new Promise((Ga,
Ba)=>{try{const Y=-1!==window.location.href.indexOf("&wd_pn=2");if(this.nb.qa("PrivacyDialogShouldCheckRoaming")||Y){var fa=this.executeRequest(this.Iua("getUserPrivacySettings"),1,"GetUserPrivacySettingsRequest");fa.continueWith(()=>{try{if(fa.Ch||fa.Sf)c.ULS.sendTraceTag(50860934,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Request failure");else{const ja=fa.result;if(ja&&ja.Ig&&ja.Ig.data)if(ja.Ig.data.httpStatus!==n.a.FO)c.ULS.sendTraceTag(50860936,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Received error response {0}",
ja.Ig.data.httpStatus);else{if(ja.Ig.data.Vd){Ga(pa.parse(ja.Ig.data.Vd,0));c.ULS.sendTraceTag(51258447,3004,50,"UserPrivacySettings TryGetSettingsFromRoaming: Success, Settings {0}",ja.Ig.data.Vd);return}c.ULS.sendTraceTag(50860937,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: ResponseData is null")}else c.ULS.sendTraceTag(50860935,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Data is null");Ba("UserPrivacySettings TryGetSettingsFromRoaming Request Faillure")}}catch(ja){c.ULS.sendTraceTag(50860938,
3004,10,"UserPrivacySettings TryGetSettingsFromRoaming Exception handling request {0}",ja.toString()),Ba("UserPrivacySettings TryGetSettingsFromRoaming Request Exception")}})}else c.ULS.sendTraceTag(50860933,3004,50,"UserPrivacySettings TryGetSettingsFromRoaming: Roaming should not be used"),Ba("Roaming should not be used")}catch(Y){c.ULS.sendTraceTag(50860939,3004,10,"TryGetSettingsFromRoaming Exception = {0}",Y.toString()),Ba("UserPrivacySettings TryGetSettingsFromRoaming Exception")}})}TMj(){return new Promise((Ga,
Ba)=>{try{const fa=oa.a.get("WacUPToggleState");let Y=null;void 0!==fa&&null!==fa&&0<fa.length&&(Y=decodeURIComponent(fa));if(void 0!==Y&&null!==Y&&0<Y.length){const ja=pa.parse(Y,1);c.ULS.sendTraceTag(51258448,3004,50,"TryGetSettingsFromCookie: UserPrivacySettings retrieved from cookie {0}",ja.toString());Ga(ja)}else{const ja=R.create(1),ca=new K.a;ca.add(R.QNa);const aa=ja.serialize(ca);this.jag(aa)?(c.ULS.sendTraceTag(51258449,3004,50,"TryGetSettingsFromCookie: UserPrivacySettings initialized and retrieved from cookie {0}",
aa),Ga(ja)):(c.ULS.sendTraceTag(51258450,3004,15,"TryGetSettingsFromCookie: Failure initializing cookie with settings {0}",aa),Ba("UserPrivacySettings TryGetSettingsFromCookie Failure in TrySaveSettingsToCookie"))}}catch(fa){c.ULS.sendTraceTag(50860941,3004,10,"TryGetSettingsFromCookie from Cookie Exception = {0}",fa.toString()),Ba("UserPrivacySettings TryGetSettingsFromCookie Eception")}})}UMj(){return new Promise(Ga=>{try{var Ba=-1!==window.location.href.indexOf("&wdccsoff=1");let fa=R.create(2);
Ba?(fa.St=2,r.AFrameworkApplication.MGe(),c.ULS.sendTraceTag(51258451,3004,50,"TryGetSettingsFromQueryParams: Retrieved from query param {0}",fa.toString())):(fa.St=1,c.ULS.sendTraceTag(51258452,3004,50,"TryGetSettingsFromQueryParams: Initialized with query param as data source for {0}",fa.toString()));Ga(fa)}catch(fa){c.ULS.sendTraceTag(50967431,3004,50,"TryGetSettingsFromCookie from Query Params Exception = {0}",fa.toString()),Ba=R.create(2),Ba.St=1,Ga(Ba)}})}njj(Ga){c.ULS.sendTraceTag(51258453,
3004,50,"UserPrivacySettingsHelper: SaveSettingsToQueryParam");2===Ga.St?r.AFrameworkApplication.MGe():r.AFrameworkApplication.Jjh();c.ULS.sendTraceTag(51258454,3004,50,"SaveSettingsToQueryParam saved settings = {0}",Ga)}jag(Ga){try{c.ULS.sendTraceTag(51258455,3004,50,"UserPrivacySettingsHelper: TrySaveSettingsToCookie Saving settings {0}",Ga);const Ba=this.nb.Va("PrivacyCookieDomain")||"";if(!Ba||!Ba.length)throw Error.invalidOperation("PrivacyCookieDomain is null or empty");c.ULS.sendTraceTag(51258456,
3004,50,"SaveUserPrivacySettings to Cookie {0}",Ga);return oa.a.LOd("WacUPToggleState",Ga,oa.a.hV,"/",Ba)}catch(Ba){return c.ULS.sendTraceTag(50860942,3004,50,"SaveUserPrivacySettings to Cookie Exception = {0}",Ba.toString()),!1}}isFeatureEnabled(Ga){return this.getSettings().then(Ba=>{const fa=this.nb.lo("ServicesControlsMicrosoftControllerServicesList")?this.nb.fw("ServicesControlsMicrosoftControllerServicesList"):[],Y=new A.a;for(let ja=0;ja<fa.length;ja++)Y.add(fa[ja]);return Y.contains(Ga)?2!==
Ba.St:!0},()=>{c.ULS.sendTraceTag(50860945,3004,10,"Failed to get privacy setting for feature {0}",Ga);return!0})}static parse(Ga,Ba){try{return c.ULS.sendTraceTag(50860943,3004,50,"Parsing user privacy settings {0} from {1}",Ga,Ba),R.deserialize(Ga,Ba)}catch(fa){throw c.ULS.sendTraceTag(50860944,3004,10,"GetUserPrivacySettings Exception = {0}",fa.toString()),fa;}}}Object(t.a)(pa,"UserPrivacySettingsHelper",null,[243]);var Pa=a(246);class Z{constructor(){this.fb=null}get name(){return"Common.App.ApplicationFeatureHelper.ApplicationFeatureHelperPackage"}Rh(Ga){this.fb=
Ga;this.fb.register(242,"Common.App.ApplicationFeatureHelper.ICloudPolicySettingsHelper").tc().Fc(()=>new ea(r.AFrameworkApplication.fa,r.AFrameworkApplication.vd));this.fb.register(243,"Common.App.ApplicationFeatureHelper.IUserPrivacySettingsHelper").tc().Fc(()=>new pa(r.AFrameworkApplication.fa,r.AFrameworkApplication.vd));this.fb.register(244,"Common.App.ApplicationFeatureHelper.IAlternateAuthHelper").tc().Fc(()=>new z(r.AFrameworkApplication.fa,r.AFrameworkApplication.vd));this.fb.register(245,
"Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").tc().Fc(()=>new T(r.AFrameworkApplication.fa,r.AFrameworkApplication.vd,this.fb.resolve("Common.App.ApplicationFeatureHelper.ICloudPolicySettingsHelper"),this.fb.resolve("Common.App.ApplicationFeatureHelper.IUserPrivacySettingsHelper"),r.AFrameworkApplication.wb))}init(){r.AFrameworkApplication.fa.gv(()=>{const Ga=this.fb.resolve("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper");r.AFrameworkApplication.fa.qa("LicensingIsEnabled")&&
(Ga.isFeatureEnabled("LicensingTestFeature",!1).then(Ba=>{c.ULS.sendTraceTag(42513092,3004,50,"ApplicationFeatureHelperPackage.Init: LicensingTestFeature returned IsFeatureEnabled as {0}. IsAnonymousUser : {1}.",Ba,r.AFrameworkApplication.fa.Va("IsAnonymousUser"));return null}),Ga.getFeatureTier("LicensingTestFeature",0).then(Ba=>{c.ULS.sendTraceTag(42804872,3004,50,"ApplicationFeatureHelperPackage.Init: LicensingTestFeature returned GetFeatureTier as {0}. IsAnonymousUser : {1}.",Ba,r.AFrameworkApplication.fa.Va("IsAnonymousUser"));
return null}));this.fb.resolve("Common.App.ApplicationFeatureHelper.IAlternateAuthHelper");this.RHj()})}dispose(){}RHj(){try{r.AFrameworkApplication.fa.qa("SideCarIsEnabled")&&qa.T3f().then(Ga=>{c.ULS.sendTraceTag(594057429,3004,50,"Sidecar Loader attempted to load Sidecar.  SideCarIsAvailable:{0}",Ga);return Ga})}catch(Ga){}}static main(){Pa.a.instance.yi(new Z)}}Object(t.a)(Z,"ApplicationFeatureHelperPackage",null,[4,5]);a.d(C,"a",function(){return Ra});const Ra=()=>{Type.registerNamespace("Common");
Type.registerNamespace("Common.App.ApplicationFeatureHelper");Z.main()}},1152:function(t,C,a){var c=a(10);t=a(0);var b=a(221),d=a(15),f=a(1352),e=a(633),k=a(547),l=a(27),m=a(86),v=a(30),n=a(155),w=a(8),r=a(58),u=a(153),y=a(340),x=a(47),B=a(45),z=a(29),A=a(1),I=a(22),F=a(14),U=a(104),X=a(84),S=a(83),H=a(144),D=a(4),J=a(13),M=a(94),G=a(44),T=a(1071);class K extends H.a{constructor(Kb,rb=!0){super(!1,!1,K.wu);this.vWa=null;this.m5d=!1;this.Xm=[];this.Hj=null;this.tWb=Kb;this.ivg=rb;this.Hv=this.Kge=
!1;this.Tfa=null;this.aHc=!1;this.ag=this.meh;this.ze="InsertFileDialog";this.rc(1,this.RWb);K.wu?(this.vWa={["id"]:this.ze,["bodyControls"]:{["uploadButtonProps"]:{["label"]:CommonUIStrings.l_DialogChooseFile,["onExecute"]:Object(S.a)(this,this.SSi,"onUploadButtonClick")}},["uploadStatusLabel"]:CommonUIStrings.l_DialogNoFileChosen,["onFrameReady"]:Object(S.a)(this,this.HJi,"onFrameReady")},this.initializeAndShow(this.titleText,Object(S.a)(this,this.Jdc,"insertDialogHandler"),this.vWa),this.YQb=!0):
(this.showDialog(this.titleText,Object(S.a)(this,this.Jdc,"insertDialogHandler")),rb&&this.K_f(),(Kb=this.zU(1))&&this.Xm.push(Kb),(Kb=this.zU(0))&&this.Xm.push(Kb),this.Rcg(),this.YQb=!1)}get $Tj(){return this.tWb}validate(){this.Hj.XE||d.ULS.sendTraceTag(25798091,322,10,"UploadFrame.FileInputElement is null");return this.Hj.XE.value?!0:(K.Xz(CommonUIStrings.l_FileUploadNoFileSpecified),!1)}HJi(Kb){this.ivg&&(this.Hj=this.J_f(Kb,this.tWb))}SSi(){this.Hj&&this.Hj.XE&&(this.m5d||(this.Hj.Z7i(Object(S.a)(this,
this.gzd,"onFileChosen")),this.m5d=!0),this.Hj.gRe())}gzd(Kb){this.vWa.uploadStatusLabel=Kb;this.kTa(this.titleText,Object(S.a)(this,this.Jdc,"insertDialogHandler"),this.vWa)}Jdc(Kb){1===Kb&&this.isEnabled()?K.wu&&this.Hj.XE&&!this.Hj.XE.value?(this.vWa.uploadStatusLabel=CommonUIStrings.l_FileUploadNoFileSpecified,this.kTa(this.titleText,Object(S.a)(this,this.Jdc,"insertDialogHandler"),this.vWa)):(this.Qwb(),this.tWb.finalizeUpload(this.Hj,Object(S.a)(this,this.dispose,"dispose"))):0===Kb&&this.hide()}K_f(){this.aHc=
!1;this.Hj=this.J_f(document.getElementById("uploadFrameContainer"),this.tWb);D.AFrameworkApplication.fa.qa("InsertPictureDialogFocusLoopFixIsEnabled")&&(this.Tfa=Object(S.a)(this,this.ZAd,"onUploadFrameLoad"),G.a.addHandler(this.Hj.iFrame,"load",this.Tfa));this.Hj.XE||d.ULS.sendTraceTag(25798092,322,15,"UploadFrame.FileInputElement is null");this.NIf()}ZAd(){this.NIf()}NIf(){if(this.Hj&&!this.aHc){var Kb=this.Hj.XE;Kb&&(G.a.addHandler(Kb,J.a.Kb,Object(S.a)(this,this.onKeyDown,"onKeyDown")),Kb=[Kb],
this.Xm=Kb.concat.apply(Kb,this.Xm),this.Rcg(),this.aHc=!0)}}dispose(){if(this.Hj&&!K.wu){const Kb=this.Hj.XE;Kb&&G.a.removeHandler(Kb,J.a.Kb,Object(S.a)(this,this.onKeyDown,"onKeyDown"));this.Tfa&&G.a.removeHandler(this.Hj.iFrame,"load",this.Tfa)}this.Hj=null;super.dispose()}Rcg(){if(0<this.Xm.length){const Kb=new T.a(this.Xm),rb=M.FocusManager.instance().eQ();rb&&(this.Xm[0].focus(),rb.af=Kb,rb.KZ=!0)}}onKeyDown(Kb){4!==M.FocusManager.instance().PIf(Kb)&&Kb.preventDefault()}static get wu(){return D.AFrameworkApplication.ta.Oa.mv&&
D.AFrameworkApplication.ta.Oa.eff}static Xz(Kb){const rb=document.getElementById("errorText");rb.innerText=Kb;rb.style.display="inline-block"}}Object(t.a)(K,"InsertFileDialog",H.a,[]);class L{static get ag(){return H.a.ap(L.Bk,CommonUIStrings.l_ImageUploadDialogText,CommonUIStrings.l_ImageUploadNoFileSpecified)}}L.Bk="<div class='WACDialogRow' id='block1'> <label id='labelText' class='WACDialogLabel' >{0}</label> </div> <div class='WACDialogRowNoBreak' id='block2'> <div id='uploadFrameContainer'></div> <div class='WACDialogError' id='errorText' role='alert'>{1}</div> </div>";
Object(t.a)(L,"InsertImageDialogHtml",null,[]);class V extends K{constructor(Kb,rb=!0){super(Kb,rb)}get RWb(){return CommonUIStrings.l_ImageUploadButtonText}get titleText(){return CommonUIStrings.l_ImageUploadingTitle}get meh(){return L.ag}validate(){this.Hj.XE||d.ULS.sendTraceTag(25798095,322,10,"UploadFrame.FileInputElement is null");const Kb=Object(X.a)(f.a,this.$Tj),rb=Kb.Peg(this.Hj.XE.value);return 0!==rb?(K.Xz(Kb.DXe(rb)),!1):!0}}Object(t.a)(V,"InsertImageDialog",K,[]);var W=a(552);const da=
(Kb,rb,cc)=>{if(Kb){var nc=0;do{try{Kb();break}catch(Wb){if(d.ULS.sendTraceTag(50946190,306,10,"RetryOnException: [Retries: {0}] [Caller: {1}] [Exception: {2}] [Callstack: {3}].",nc,cc,Wb.message,Wb.stack),nc>=rb)break}nc++}while(1)}};var qa=a(107),O=a(88),ea=a(41),R=a(251),oa=a(199),pa=a(80),Pa=a(459),Z=a(172);class Ra{constructor(Kb,rb,cc,nc,Wb,Ea,ua,ma,fb=!0,sb=null,Ua=!1){this.mRe="FileUpload.ashx";this.$n=null;this._initialized=!1;this.Hg=this.Chb=this.$Gc=this.Tfa=this.xRb=this.Xq=this.Ds=null;
this.xm=!1;this.UD=this.yRb=this.tRc=null;this._parent=Kb;this.Zpg=rb;this.yug=cc;this.S5d=Wb;this.tPc=ua;this.c0d=ma;this.Z1d=sb;this.sRc=!1;this.vqg=nc.qa("CanaryRenewalForFileUploadIsEnabled");this.ceg=!1;(this.kqa=Ua)||this.L3g(Ea);fb&&this.U9e()}get YSf(){return this.yug}get sessionId(){return this.tPc}get iFrame(){return this.$n}get XE(){return this.Xq}get A8a(){return D.AFrameworkApplication.fa?D.AFrameworkApplication.fa.qa("NativeFileOpenDialogIsEnabled"):!1}get hRe(){return D.AFrameworkApplication.fa?
D.AFrameworkApplication.fa.qa("FileInputDescriptionAccessibilityIsEnabled"):!1}get qii(){return this.kqa?!1:oa.b(this.$n.contentWindow.location.pathname,this.mRe,0)}get CIg(){return!l.a.aka&&D.AFrameworkApplication.fa.qa("AllowMultipleImageInsertFromLocalDevice")}U9e(){this.UD=Z.a.create().toString();this.kqa?this.m7c():this.GJg()}L3g(Kb){this.$n=document.createElement("iframe");this.$n.className=Kb;this.$n.id=Kb;this.S5d&&(this.$n.style.visibility="visible",this.$n.style.height="30px",this.$n.setAttribute("frameborder",
"0"));this.Tfa=Object(S.a)(this,this.ZAd,"onUploadFrameLoad");G.a.addHandler(this.$n,"load",this.Tfa)}J5b(Kb=null){D.AFrameworkApplication.ta.cpc();if(!this.Xq)return d.ULS.sendTraceTag(25798093,322,50,"_fileInput is null"),"";G.a.addHandler(this.Xq,"change",()=>{this.pyh(Kb)});da(Object(S.a)(this,this.gRe,"fileInputClick"),1,"DoFileOpenDialog");return this.Xq.value}pyh(Kb){Kb&&Kb(this.Xq.value)}qyh(){this.xRb&&(this.xRb.innerText=this.VYe())}Z7i(Kb){G.a.addHandler(this.Xq,"change",()=>{Kb(this.VYe())})}VYe(){let Kb=
null;if(this.Xq.value){const rb=this.Xq.value,cc=rb.lastIndexOf("\\");0<cc&&(Kb=rb.substring(cc+1,rb.length))}return Kb?Kb:""}gRe(){try{d.ULS.sendTraceTag(35939520,322,50,"UploadFrame.FileInputClick - Clicking on File input element."),this.Xq.click()}catch(Kb){throw d.ULS.sendTraceTag(36783331,322,10,"UploadFrame.FileInputClick Exception: {0}",Kb.message),Kb;}}JFj(){this.xli()?this.E6f():(this.hYd(),this.Ds.submit())}xli(){return(this.vqg||this.kqa)&&!(void 0===window.self.FormData||null===window.self.FormData)}dXf(Kb){if(Kb){const rb=
this.EBe();this.Hg=new XMLHttpRequest;this.Hg.open("POST",rb);this.Hg.setRequestHeader("X-CorrelationId",this.UD);this.Pti(Kb);this.Hg.onreadystatechange=Object(S.a)(this,this.ioa,"uploadResponseReceived");this.Hg.send(Kb)}}Pti(Kb){if(!l.a.aka&&Kb.get){var rb=Kb.get("ImageId");Kb=window.self.navigator;rb={["CorrelationId"]:this.UD,["Canary"]:D.AFrameworkApplication.canary,["ImageNodeId"]:rb};Kb&&(Kb=Kb.connection?Kb.connection:Kb.mozConnection?Kb.mozConnection:Kb.webkitConnection?Kb.webkitConnection:
null)&&(rb.effectiveType=Kb.effectiveType,rb.downlink=Kb.downlink,rb.type=Kb.type,rb.rtt=Kb.rtt);d.ULS.sendTraceTag(573345858,322,50,"LogFileUploadStatistics: FileUpload {0}",rb)}}E6f(){try{this.hYd();d.ULS.sendTraceTag(594888409,322,50,"SubmitFormWithRequest is preparing to send an upload request");const Kb=new (Type.parse("FormData"))(this.Ds);this.dXf(Kb)}catch(Kb){d.ULS.sendTraceTag(594888407,322,10,"SubmitFormWithRequest failed to send the request with exception "+Kb.message),this.K9a(null)}}D6f(Kb){try{if(this.hYd(),
d.ULS.sendTraceTag(594888406,322,50,"SubmitFormWithBlob is preparing to send an upload request"),this.iVj(Kb)){this.yRb=Kb;this.Ds.contains(this.Xq)&&this.Ds.removeChild(this.Xq);var rb=new (Type.parse("FormData"))(this.Ds);rb.append("applicationfileInput",Kb.blob,Kb.filename);this.dXf(rb)}else this.K9a(null)}catch(cc){d.ULS.sendTraceTag(591267743,322,10,"SubmitFormWithBlob failed to send the request with exception "+cc.message),this.K9a(null)}}iVj(Kb){return Kb&&void 0!==Kb.blob&&null!==Kb.blob&&
void 0!==Kb.filename&&null!==Kb.filename&&""!==Kb.filename?void 0===window.self.FormData||null===window.self.FormData?(d.ULS.sendTraceTag(578380442,322,10,"FormData isn't supported"),!1):!0:(Kb=Kb?String.format("[isNull: false] [blobIsNullorEmpty: {0}] [filenameIsNullOrEmpty: {1}]",void 0===Kb.blob||null===Kb.blob,void 0===Kb.filename||null===Kb.filename||""===Kb.filename):"[isNull: true] [blobIsNullorEmpty: false] [filenameIsNullOrEmpty: false]",d.ULS.sendTraceTag(578380441,322,10,String.format("Content of the blob is empty {0}",
Kb)),!1)}ioa(){if(4===this.Hg.readyState)if(200===this.Hg.status){d.ULS.sendTraceTag(594888405,322,50,"UploadResponseReceived received a successful response. CorrelationId: {0}",this.UD);const Kb=this.Hg.getResponseHeader("X-NewKey"),rb=this.vei(this.Hg);let cc=!1;if(void 0!==Kb&&null!==Kb&&rb&&(cc=this.$Uj(Kb),!this.sRc&&cc)){d.ULS.sendTraceTag(594888404,322,50,"UploadResponseReceived resubmitting the upload request with a fresh canary. correlationId: {0}",this.UD);this.sRc=!0;void 0!==this.yRb&&
null!==this.yRb?this.D6f(this.yRb):this.E6f();return}d.ULS.sendTraceTag(594888403,322,50,"UploadResponseReceived processing the response [retried: {0}] [canaryInvalid: {1}] [gotNewCanary: {2}] [canaryRenewed: {3}] [CorrelationId: {4}]",this.sRc,rb,!(void 0===Kb||null===Kb),cc,this.UD);this.K9a(this.Hg.responseText)}else d.ULS.sendTraceTag(42874946,322,15,"Upload request failed with status: {0} [isResponseNull: {1}] [correlationId: {2}]",this.Hg.status,this.Hg.responseText?!1:!0,this.UD),this.K9a(null)}vei(Kb){try{const rb=
ea.a(Kb.responseText).Responses;if(void 0!==rb&&null!==rb&&1===rb.length){const cc=rb[0];if(void 0!==cc&&null!==cc&&2===cc.length&&28===cc[1].StatusCode)return!0}}catch(rb){}return!1}$Uj(Kb){Pa.a.Ubg(Kb);return D.AFrameworkApplication.canary!==Kb?!1:!0}hYd(){this.tRc||(this.tRc=new Date)}dispose(){this.xm||(this.kqa?this._parent.removeChild(this.Ds):(this._parent.removeChild(this.$n),G.a.removeHandler(this.$n,"load",this.Tfa),this.Tfa=null),this.$Gc&&(G.a.removeHandler(this.Xq,"change",this.$Gc),
this.$Gc=null),this.hRe&&(this.Chb&&(G.a.removeHandler(this.Xq,"change",this.Chb),this.Chb=null),this.xRb=null),this.Xq=this.Ds=this._parent=this.$n=null,this.xm=!0,this.tRc=null,d.ULS.sendTraceTag(25798094,322,50,"UploadFrame disposed"))}delayedDispose(){this.dispose()}m6g(Kb){if(this.Ds){var rb;(rb=this.Ds.querySelector("input[name=__REQUESTDIGEST]"))?rb.value=Kb:(rb=this.K2c(),rb.type="hidden",rb.id="__REQUESTDIGEST",rb.name="__REQUESTDIGEST",rb.value=Kb,this.Ds.appendChild(rb))}}K2c(){return this.kqa?
document.createElement("input"):this.$n.contentWindow.document.createElement("input")}ZAd(){try{if(!this.$n.contentWindow.document.body)return}catch(rb){this.y3h();return}if(!(this._initialized||this.A8a&&l.a.wF))this.m7c();else if(!this.A8a||!l.a.wF||this.qii){let rb;rb=l.a.fu?this.$n.contentWindow.document.body.innerText:this.ceg?this.$n.contentWindow.document.body.firstChild.innerText:this.$n.contentWindow.document.body.firstChild.innerHTML;var Kb=this.$n.contentWindow.document.body.innerText.toLowerCase();
const cc=0<=Kb.indexOf("responses")||0<=Kb.indexOf("wopisrc");Kb=0<=Kb.indexOf("http error");!cc&&Kb&&d.ULS.sendTraceTag(42551183,322,15,"Couldn't obtain a valid response but the frame contains: "+this.$n.contentWindow.document.body.innerText);this.K9a(rb)}}m7c(){if(!this._initialized){var Kb=this.ga("uploadForm");const rb=this.ga("fileInput"),cc=this.EBe();this.S5g();this.Ds.id=Kb;this.Ds.method="post";this.Ds.encoding="multipart/form-data";this.Ds.action=cc;this.Xq.type="file";this.c0d&&(this.Xq.accept=
this.c0d,this.Z1d&&(this.Xq.capture=this.Z1d));this.Xq.id=rb;this.Xq.name=rb;this.CIg&&(this.Xq.multiple=!0);!this.hRe||l.a.fu||l.a.JH||(this.Chb=Object(S.a)(this,this.qyh,"fileInputChangedHandleAccessibility"),G.a.addHandler(this.Xq,"change",this.Chb),this.xRb=O.a.tpe(this.Ds,this.Xq,"InputFileDescription"));this.S5d&&(this.kqa||(Kb=this.$n.contentWindow.document.body,Kb.style.margin="0",Kb.style.overflow="hidden"),Kb=D.AFrameworkApplication.ta,this.Xq.style.fontFamily=Kb.s0,this.Xq.style.fontSize=
Kb.Lzc,this.Xq.style.margin="0");(Kb=document.getElementById("__REQUESTDIGEST"))&&this.m6g(Kb.value);this.Ds.appendChild(this.Xq);this._initialized=!0;this.Zpg(this)}}S5g(){if(this.kqa)this.Ds=document.createElement("form"),this._parent.appendChild(this.Ds),this.Xq=document.createElement("input");else{this.Ds=this.$n.contentWindow.document.createElement("form");const Kb=this.$n.contentWindow.document;Kb.body.appendChild(this.Ds);this.Xq=Kb.createElement("input")}}GJg(){this._parent.appendChild(this.$n);
this.A8a&&l.a.wF&&this.m7c()}EBe(){var Kb=new R.QueryStringBuilder(this.mRe);D.AFrameworkApplication.NXa(Kb);this.Znj(Kb);Kb=Kb.toString();if(l.a.Tf||l.a.wF||l.a.JH)Kb=pa.a.TUe(Kb);return Kb}gke(){const Kb=new qa.a(2,1,0,Object(S.a)(this,this.delayedDispose,"delayedDispose"),4);D.AFrameworkApplication.zi.Ag(Kb)}}Object(t.a)(Ra,"UploadFrame",null,[2]);var Ga=a(43),Ba=a(121),fa=a(21);class Y extends Ra{constructor(Kb,rb,cc,nc,Wb,Ea,ua=!1){super(Kb,rb,cc,nc,Wb,"UploadFrame",Ea.ea.sessionId,"image/*",
!1,null,ua);this.$=Ea;this.ceg=!0;this.U9e()}ga(Kb){return Kb}Znj(Kb){d.ULS.shipAssertTag(526399105,0,!!this.sessionId,"SessionId shouldn't be null.");Ba.a.oVc(Kb,this.$.ya);Kb.U8(w.a.sessionId,this.sessionId);var rb=fa.g(this.$).ha;rb=Ga.o(rb.sa.q3,this.$);Kb.U8(w.a.w1i,this.$.xa.pa.name);Kb.U8(w.a.v1i,rb.FirstRow.toString());Kb.U8(w.a.u1i,rb.FirstColumn.toString())}y3h(){this.YSf("ServerUploadError")}K9a(Kb){this.YSf(Kb)}static xgi(Kb){return!Kb||I.a.equals(Kb,"ServerUploadError",!1)}}Object(t.a)(Y,
"UploadFrameWrapper",Ra,[]);class ja extends V{constructor(Kb,rb,cc){super(Kb,!1);this.lU=null;this.yAa=!1;this.Qlc=()=>{this.tXd("");this.Zzc();return!1};this.$=rb;this.gBc=Kb;this.tQ=W.a.instance;this.fa=cc;this.K_f();this.qkd();this.$.rb.Zx=!0}J_f(Kb,rb){return new Y(Kb,Object(S.a)(rb,rb.LEb,"onUploadFrameInitialized"),Object(S.a)(rb,rb.ioa,"uploadResponseReceived"),this.fa,!0,this.$)}dispose(){this.Zzc();this.tQ=this.gBc=null;super.dispose()}hide(){super.hide();this.$.rb.Zx=!1}validate(){var Kb=
this.gBc.OYd(this.Hj.XE.value,this.gBc.P$f(this.Hj));return 0!==Kb?(Kb=this.gBc.Ocd(Kb).Description,this.tXd(Kb),this.rTd(),!1):!0}isEnabled(){return!0}tXd(Kb){this.lU.innerHTML=Kb}qkd(){this.lU=document.getElementById("errorText");this.lU.style.display="inline-block";this.yAa=!1;this.tXd("");this.MHa.style.maxWidth=this.MHa.currentStyle.minWidth}rTd(){this.tQ.ra(J.a.click,this.Hj.XE,this.Qlc);this.tQ.ra(J.a.Kb,this.Hj.XE,this.Qlc);this.yAa=!0}Zzc(){this.yAa&&(this.tQ.Ba(J.a.click,this.Hj.XE,this.Qlc),
this.tQ.Ba(J.a.Kb,this.Hj.XE,this.Qlc),this.yAa=!1)}}Object(t.a)(ja,"InsertImageDialogWrapper",V,[]);var ca=a(51),aa=a(55);class ta extends f.a{constructor(Kb,rb,cc,nc,Wb=!0){super(null,rb,cc);this.M$=this.wt=null;this.T6a=!1;this.DCd=null;this.ioa=Ea=>{this.FZd.stop();this.UZb.cancel();if(Y.xgi(Ea))this.$yc?this.k4e(4):(Ea=new e.a(0,2,null,null,!1,null,null,null),Ea.status=8,this.VVd(new k.a(Ea),null,"InsertPictureWebMethod")),d.ULS.sendTraceTag(526399121,0,50,`Http Error occurred, isTimeoutError: ${this.$yc}`);
else{const ua=ta.mVj(Ea);0!==ua?(d.ULS.sendTraceTag(526399122,0,50,`Server returned error, response: ${Ea}`),this.k4e(ua)):this.m3h(Ea)}this.Bnc();this.dispose()};this.dJi=Ea=>{this.sBa(Ea,this.Hj)&&this.finalizeUpload(this.Hj,null)};this.LEb=Ea=>{d.ULS.sendTraceTag(526399120,0,50,"Upload frame initialized");this.Hj=Ea;if(!this.V0a){if(this.qYd){if(this.bve()||this.A8a&&l.a.wF){Ea.J5b(this.dJi);return}const ua=Ea.J5b(null);if(!this.sBa(ua,Ea))return}this.finalizeUpload(Ea,null)}};this.oSi=()=>{this.$yc=
!0};this.jb=Kb;this.FZd=Kb.Ib.Og("WebServiceCall","InsertPictureOperation");this.UZb=x.a.instance.create(this.oSi,1E5,B.a.gNg,!1);this.$yc=!1;this.Ijc=this.$.ya.InsertPictureMaxFileSizeBytes;nc&&(this.T6a="TestOnly"in nc);Wb&&this.showDialog()}get $(){return this.jb}get dyi(){return this.Ijc/1024/1024}dispose(){m.a.Ia(this.UZb);this.Hj&&this.Hj.gke();this.Hj=this.UZb=this.jb=null}X4i(Kb){if(!this.$)return d.ULS.sendTraceTag(526399119,0,50,"ReadPictureAsDataURLTask: EwaControl is null"),aa.Task.Ta(!0);
if(!this.$.aba)return aa.Task.Ta(!0);const rb=new n.a,cc=new FileReader;Kb=Kb.XE.files[0];const nc=()=>{rb.Ow(!0)};cc.onload=()=>{this.DCd=cc.result;rb.Ow(!0)};cc.onerror=nc;cc.onabort=nc;cc.readAsDataURL(Kb);return rb.task}P$f(Kb){let rb=-1;Kb=Kb.XE;(null===Kb||void 0===Kb?0:Kb.files)&&0<Kb.files.length&&(rb=Kb.files[0].size);return rb}OYd(Kb,rb){let cc=ta.I2g(f.a.sBa(Kb));0===cc?-1!==rb&&(d.ULS.sendTraceTag(526399118,0,50,`Validating picture, pictureSize: ${rb}, maxAllowedSize: ${this.Ijc}, remainingWorkbookSize: ${this.$.ea.Yif}`),
rb>this.Ijc?cc=3:rb>this.$.ea.Yif&&(cc=7)):6===cc&&this.Svi(Kb);d.ULS.sendTraceTag(526399117,0,50,`Validated file on client, validation result: ${cc}`);return cc}sBa(Kb,rb){Kb=this.OYd(Kb,this.P$f(rb));return 0!==Kb?(this.V0a||1===Kb||this.fRd(Kb),!1):!0}k$f(Kb){Kb.JFj()}Ocd(Kb){let rb=0,cc=1,nc=-1100324317,Wb="InsertPictureUnknownError",Ea=null;switch(Kb){case 1:rb=1755;cc=0;nc=940870981;Wb="InsertPictureNoFileSelected";break;case 3:cc=0;nc=1250467391;Wb="InsertPicturePictureTooBig";Ea=String.format(F.a.instance.ob(180),
this.dyi.toLocaleString());break;case 6:rb=1759;cc=0;nc=1380041209;Wb="InsertPictureUnsupportedFormat";break;case 7:rb=1756;cc=0;nc=-903115058;Wb="InsertPictureExceedWorkbookSize";break;case 4:rb=1757;cc=0;nc=1218352119;Wb="InsertPictureUploadTimeout";break;case 5:rb=1758,cc=0,nc=1979899005,Wb="InsertPictureServiceNonDeterministicError"}Kb=ta.Yc(rb,cc,nc,Wb);Ea&&(Kb.Description=Ea);return Kb}showDialog(){this.bve()?(this.V0a=!1,this.Hj=new Y(this.$.domElement,this.LEb,this.ioa,this.fa,!1,this.$,!0)):
(d.ULS.sendTraceTag(526399115,0,50,"Showing Insert Picture dialog"),!this.T6a&&(l.a.kv||l.a.wF&&72>l.a.jxe)?(this.V0a=!1,this.Hj=new Y(this.$.domElement,this.LEb,this.ioa,this.fa,!1,this.$)):(this.V0a=!0,this.Hj=(new ja(this,this.$,this.fa)).Hj))}m3h(Kb){let rb={};try{if(rb=r.a.Vh(Kb),ca.b().DA(this.FZd.id,rb.ServerCorrelationId,"actions","ServerActions"),!z.a.rg(rb.Errors)&&rb.Result){this.$.ea.BW(rb.StateId,"BasePictureUploaderWrapper.UploadResponseReceived");const cc=rb.Result;U.a(this.$).Ima(1,
cc);const nc=this.$.da.za(277);nc&&nc.iTc(this.$,1,rb.Result,rb,"InsertPicture");d.ULS.sendTraceTag(526399114,0,50,"Insert picture completed successfully :)")}}catch(cc){d.ULS.sendTraceTag(526399113,0,50,`BasePictureUploaderWrapper.HandleSuccessCallback: got exception while try to JSON.Parse string length: ${Kb?Kb.length:-1}, errror: ${cc}`)}this.zzc(rb,null,"InsertPictureWebMethod")}k4e(Kb){Kb=this.Ocd(Kb);const rb={};rb.Errors=[Kb];this.zzc(rb,null,"InsertPictureWebMethod")}zzc(Kb,rb,cc){this.wt(Kb,
rb,cc)}VVd(Kb,rb,cc){this.M$(Kb,rb,cc)}fRd(Kb){Kb=this.Ocd(Kb);A.EwaSettings.wz()?new y.a(this.$,Kb):(new u.ErrorDialog(this.$,Kb)).Ff()}Svi(Kb){const rb=this.$.ya.InsertPicturUnsupportedExtensionsForLogging;Kb=v.a.ll(Kb);for(let cc=0;cc<rb.length;++cc)if(Kb.endsWith(rb[cc])){d.ULS.sendTraceTag(526399112,0,50,`Insert picture blocked invalid extension: ${rb[cc]}`);break}}static mVj(Kb){return!Kb||I.a.equals(Kb,w.a.insertPictureUnknownError,!0)?2:I.a.equals(Kb,w.a.insertPictureNoFileSelectedError,!0)?
1:I.a.equals(Kb,w.a.gbi,!0)?3:I.a.equals(Kb,w.a.hbi,!0)?5:0}static Yc(Kb,rb,cc,nc){return z.a.Yc(1,0,0,Kb,rb,cc,nc)}static I2g(Kb){switch(Kb){case 1:return 1;case 2:return 6}return 0}bve(){return this.T6a||void 0===window.self.FormData||null===window.self.FormData?!1:!0}}Object(t.a)(ta,"BasePictureUploaderWrapper",f.a,[2]);class xa extends ta{constructor(Kb,rb,cc,nc,Wb,Ea=!0){super(Kb,rb,cc,nc,!1);this.vyh=Wb;this.j8b=Kb.Ib.Og("LoadResource","FileReaderUploaderLoadResource");Ea&&this.showDialog()}qzj(){this.Ijc=
28E5;this.fRd(3)}l$c(Kb){d.ULS.sendTraceTag(526399111,0,50,"FileReaderUploaderWrapper.finalizeUploadImpl - Start function.");const rb=new FileReader;Kb=Kb.XE.files;if(0==Kb.length)d.ULS.sendTraceTag(526399110,0,15,"FileReaderUploaderWrapper.finalizeUploadImpl - No image file found.");else{var cc=Kb[0];rb.onload=()=>{this.j8b.stop();this.vyh.JRi(rb.result,this);d.ULS.sendTraceTag(526399109,0,50,`FileReaderUploaderWrapper.finalizeUploadImpl - End function. Type:${cc.type}, Size:${cc.size.toString()}`)};
rb.onerror=()=>{this.j8b.stop();d.ULS.sendTraceTag(526399108,0,10,`FileReaderUploaderWrapper.finalizeUploadImpl - Can't read image. Type:${cc.type}, Size:${cc.size.toString()}`)};rb.onabort=()=>{this.j8b.stop();d.ULS.sendTraceTag(526399107,0,10,`FileReaderUploaderWrapper.finalizeUploadImpl - Aborted read image. Type:${cc.type}, Size:${cc.size.toString()}`)};this.j8b.start();rb.readAsDataURL(cc)}}finalizeUpload(Kb,rb){this.l$c(Kb,rb)}}Object(t.a)(xa,"FileReaderUploaderWrapper",ta,[492]);var ia=a(513),
ya=a(368),ib=a(170);class wa{constructor(Kb,rb){this.dataUri=this.sheetName=null;this.sheetName=Kb;this.dataUri=rb}getSheetName(){return this.sheetName}}Object(t.a)(wa,"MacroRecorderPictureInsertedPayload",null,[101]);class sa extends ta{constructor(Kb,rb,cc,nc,Wb,Ea=!0){super(Kb,cc,nc,Wb,!1);this.Jd=rb;Ea&&this.showDialog()}l$c(Kb,rb){super.finalizeUpload(Kb,rb);ya.a(this.$.userOperationManager,(cc,nc)=>{this.wt=cc;this.M$=nc;this.FZd.start();this.UZb.Rq();this.$yc=!1;this.k$f(Kb);return this.X4i(Kb)},
cc=>{var nc={};this.$.Xj(nc);const Wb=nc.SheetName;nc=()=>new wa(Wb,this.DCd?this.DCd:"");cc=A.EwaSettings.dc()?new ib.a(510,0,cc,72,nc):new ia.a(510,0,cc,8,nc);cc.Xma(()=>!0);cc.Jd=this.Jd;return cc},this.Jd)}finalizeUpload(Kb,rb){this.l$c(Kb,rb)}}Object(t.a)(sa,"PictureUploaderWrapper",ta,[]);class Ya{constructor(Kb,rb){this.filename=Kb;this.blob=rb}}Object(t.a)(Ya,"UploadBlobParameters",null,[]);class bb extends sa{constructor(Kb,rb,cc,nc,Wb,Ea,ua){super(Kb,rb,cc,nc,Wb,!1);this.qYd=!1;this.k0=
ua;this.edc=bb.qEh(Ea);Kb=this.OYd(this.edc.name,this.edc.size);0!==Kb?(this.fRd(Kb),this.k0.setException(Error.create("DataUrlUploaderWrapper: Invlid data url")),this.dispose()):this.Hj=new Y(this.$.domElement,this.LEb,this.ioa,nc,!1,this.$)}VVd(Kb,rb,cc){super.VVd(Kb,rb,cc);this.k0.setException(Error.create("DataUrlUploaderWrapper.TriggerFailedCallback: File upload request failed"))}zzc(Kb,rb,cc){super.zzc(Kb,rb,cc);z.a.rg(Kb.Errors)?this.k0.setException(Error.create(`DataUrlUploaderWrapper.TriggerSuccessCallback: File upload request returned with errors: ${z.a.yc(Kb.Errors)}`)):
this.k0.setResult(!0)}k$f(Kb){const rb=new Ya(this.edc.name,this.edc);Kb.D6f(rb)}static qEh(Kb){var rb=Kb.split(",");Kb=rb[0].includes("base64")?window.self.atob(rb[1]):window.self.decodeURI(rb[1]);rb=rb[0].split(":")[1].split(";")[0];const cc=new Uint8Array(Kb.length);for(let nc=0;nc<Kb.length;nc++)cc[nc]=Kb.charCodeAt(nc);Kb=new Blob([cc],{type:rb});Kb.name="Image.png";return Kb}}Object(t.a)(bb,"DataUrlUploaderWrapper",sa,[]);class mb{constructor(){}P$h(Kb,rb,cc,nc,Wb){new sa(Kb,rb,cc,nc,Wb,!0)}L9h(Kb,
rb,cc,nc,Wb,Ea){new bb(Kb,null,rb,cc,nc,Wb,Ea)}X9h(Kb,rb,cc,nc,Wb){new xa(Kb,rb,cc,nc,Wb,!0)}}Object(t.a)(mb,"UploaderCreator",null,[355]);class Ca extends b.a{constructor(Kb){super();this.$=Kb;this.Fb()}static ka(Kb){Kb.da.Ga(485,new Ca(Kb))}create(){var Kb;this.qb(null!==(Kb=this.$.da.za(484))&&void 0!==Kb?Kb:this.$.da.Ga(484,new mb))}}Object(t.a)(Ca,"UploaderCreatorFactory",b.a,[]);a.d(C,"a",function(){return $a});const $a=()=>{c.a.Fa(Kb=>{Ca.ka(Kb)})}},1184:function(t,C,a){var c=a(10);t=a(0);
var b=a(691),d=a(155),f=a(103),e=a(4),k=a(182),l=a(15),m=a(1352),v=a(30),n=a(98),w=a(82),r=a(555),u=a(172),y=a(43),x=a(368),B=a(170),z=a(247),A=a(29),I=a(281),F=a(11),U=a(14),X=a(280),S=a(104),H=a(21),D=a(144),J=a(88),M=a(94),G=a(163),T=a(179),K=a(96),L=a(153),V=a(340),W=a(1),da=a(1232),qa=a(80);class O extends da.a{constructor(aa,ta){super(aa,qa.a.naa(ta))}Cqc(aa,ta){this.isEnabled()&&this.$Ea(this.targetOrigin)&&(this.eo(aa),this.Tl(aa,ta))}}Object(t.a)(O,"InsertMediaCrossDocumentMessenger",da.a,
[414,156,2]);var ea=a(7);class R{}Object(t.a)(R,"OnlineMediaSearchResult",null,[]);var oa=a(310);class pa extends D.a{constructor(aa,ta,xa,ia,ya,ib){super();this.yfc=!1;this.RMa=this.hR=this.Lva=null;this.cGi=()=>{this.Vta(this.zZa)};this.ard=wa=>{wa.keyCode===Sys.UI.Key.tab&&("KeepFocusDiv"!==wa.target.id||wa.shiftKey?"KeepFocusStartDiv"===wa.target.id&&wa.shiftKey&&(wa.preventDefault(),document.getElementById("KeepFocusDiv").focus()):(wa.preventDefault(),document.getElementById("KeepFocusStartDiv").focus()))};
this.dNi=()=>{this.gnb&&(this.gnb.launchUpsellExperience("stockimages"),l.ULS.sendTraceTag(537155807,0,50,"OnLaunchM365Upsell: Launched Dime Upsell flow"))};this.Gl=ib;this.$=aa;this.g$e=ta;this.gnb=xa;this.Jza=[];this.cpf=ia;this.neh=ya;this.roe=this.$.ya.InsertOnlinePictureMaxCountOfImagesToInsert;this.ag=this.B6g()}Qzj(aa){this.yfc=!1;this.showDialog(this.Gl,null);this.Lva=document.getElementById(this.hi("InsertMediaFrame"));if(!this.Lva)throw this.Vta(this.zZa),Error.invalidOperation("Couldn't get InsertMediaIframe.");
var ta=document.getElementById(this.hi("WACDialogPanel"));ta&&ta.setAttribute(J.a.Kd,J.a.RYa);ta=document.createElement("div");ta.id="KeepFocusStartDiv";ta.tabIndex=0;ta.className="keep-focus-start";this.Lva.parentNode.insertBefore(ta,this.Lva.parentNode.firstChild);ta=document.createElement("div");ta.id="KeepFocusDiv";ta.tabIndex=0;ta.className="keep-focus";this.Lva.parentNode.appendChild(ta);$addHandler(this.MHa,"keydown",this.ard);this.Lva.src=this.g$e;this.Lva.frameBorder="0";ta=document.getElementById(this.hi("WACDialogButtonPanel"));
if(!ta)throw Error.invalidOperation("Couldn't get WACDialogButtonPanel.");ta.className="display-none";ta=document.getElementById(this.hi("WACDialogTitleText"));if(!ta)throw Error.invalidOperation("Couldn't get WACDialogTitleText.");ta.className="display-none";2===this.cpf&&(document.getElementById(this.hi("WACDialogTitlePanel")).className="display-none",document.getElementById(this.hi("WACDialogBodyPanel")).className="padding-zero");M.FocusManager.instance().eQ().scope.dN=!0;this.hR=new O(this.Lva.contentWindow,
this.g$e);this.hR.Cqc(G.a.XAg,xa=>{this.WEi(xa,aa.ioa)});this.hR.Cqc(G.a.insert,()=>{this.rMi(aa.ioa)});this.hR.Cqc(G.a.FYc,this.cGi);2===this.cpf&&0===this.neh&&(this.hR.Cqc(G.a.pqi,this.dNi),this.RMa=this.gnb.gma("MsoPremiumStockImages",xa=>{l.ULS.sendTraceTag(537155811,0,50,"OnCompleteM365Upsell: Upsell completed from stock images");xa.isEnabled?this.hR.Fj(G.a.UTj,{["LicenseTier"]:xa.toString()}):l.ULS.sendTraceTag(537155810,0,10,"OnCompleteM365Upsell: Upsell completed but license tier didn't upgrade.")}))}dispose(){this.Jza=
null;this.gnb&&this.RMa&&this.gnb.CHd("MsoPremiumStockImages",this.RMa);this.hR&&(this.hR.dispose(),this.hR=null);super.dispose()}hide(){super.hide();K.a.Xuc(this.$)}get r3(){return T.a.e5b+"/InsertMediaDialog"}get UX(){return!1}WEi(aa,ta){aa=aa&&aa.Values?(aa=aa.Values)?Object(ea.a)(new R,{Action:aa.action||"",Caption:aa.caption||"",ContentType:aa.contentType||"",FileExtension:aa.extension||"",PageUrl:aa.pageUrl||"",SourceUrl:aa.sourceUrl||"",ThumbnailUrl:aa.thumbnailUrl||"",LicenseUrl:aa.licenseUrl||
"",LicenseDisplayName:aa.licenseDisplayName||"",Height:aa.height||0,Width:aa.width||0}):null:null;aa&&(this.Jza.push(aa),this.yfc&&(l.ULS.sendTraceTag(537155809,0,50,"InsertMediaDialog.OnAddItem: Insert Message handling was pending"),ta(this.Jza),this.yfc=!1,this.Vta(this.zZa)))}rMi(aa){this.Jza&&0<this.Jza.length?this.Jza.length<=this.roe?(aa(this.Jza),this.Vta(this.zZa)):(this.Xz(),l.ULS.sendTraceTag(537155808,0,10,"OnInsert : Tried to insert more than allowed limit of items."),this.Jza.length=
0):this.yfc=!0}B6g(){const aa=document.createElement("div");aa.id="InsertMediaDialog";aa.className=W.EwaSettings.getBooleanFeatureGate("Microsoft.Office.ExcelOnline.InsertMediaDialog.ZoomFixHorizonalScroll",!0)?"insert-media-dialog":"insert-media-dialog-old";const ta=document.createElement("div");ta.id="InsertMediaPanel";ta.className=W.EwaSettings.getBooleanFeatureGate("Microsoft.Office.ExcelOnline.InsertMediaDialog.ZoomFixCancelButton",!0)?"insert-media-panel":"insert-media-panel-old";const xa=document.createElement("iframe");
xa.id="InsertMediaFrame";xa.className="insert-media-frame";aa.appendChild(ta);ta.appendChild(xa);return oa.b(aa)}Xz(){const aa=A.a.Yc(1,0,0,0,0,466721363,"InsertPictureExceededAllowedCount");aa.Description=String.format(U.a.instance.ob(205),this.roe.toLocaleString());W.EwaSettings.wz()?new V.a(this.$,aa):(new L.ErrorDialog(this.$,aa)).Ff()}}Object(t.a)(pa,"InsertMediaDialog",D.a,[]);var Pa=a(456),Z=a(374);class Ra extends m.a{constructor(aa,ta,xa,ia,ya,ib){super(null,xa,ia);this.zmf=0;this.ioa=wa=>
{if(wa){var sa=Array(wa.length);for(var Ya=0;Ya<wa.length;Ya++){const Ca=wa[Ya];sa[Ya]={};sa[Ya].SourceUrl=Ca.SourceUrl;v.a.swa(Ca.LicenseUrl)&&v.a.swa(Ca.PageUrl)&&(sa[Ya].LicenseUrl=Ca.LicenseUrl,sa[Ya].LicenseDisplayName=Ca.LicenseDisplayName,sa[Ya].PageUrl=Ca.PageUrl);sa[Ya].AltText=-2053056795===this.Jd.command?Ca.Caption:""}var bb=-2009825598===this.Jd.command?"bing":"M365";Ya=H.g(this.$);var mb=y.o(Ya.ha.sa.activeCell,this.$);x.a(this.$.userOperationManager,(Ca,$a,Kb)=>z.r(this.$.oa.va,mb,
sa,bb,X.b(Ca,this.POi),X.a($a,this.OOi),Kb,null),Ca=>new B.a(595,0,Ca),this.Jd);F.HelperMethods.rZ?(Ya=new Map,Ya.set("MediaProvider",bb),Ya.set("ImagesCount",wa.length.toString()),Ya.set("TimeTakenToOpenDialog",this.zmf.toString()),n.Health.instance.recordKpiUsage(Z.a.dbi,1,Pa.a.e8f,Ya)):l.ULS.sendTraceTag(537155805,0,15,"OnlinePictureUploaderWrapper.UploadResponseReceived: KPI Usage not supported.");this.Bnc()}else l.ULS.sendTraceTag(537155806,0,10,"OnlinePictureUploaderWrapper.UploadResponseReceived: Response is null")};
this.POi=wa=>{I.a(wa)?l.ULS.sendTraceTag(537155799,0,10,`OnlinePictureUploaderWrapper.OnPictureUploadSuccess: Operation succeeded with errors. Errors: ${A.a.yc(wa.Errors)}`):(l.ULS.sendTraceTag(537155801,0,50,"OnlinePictureUploaderWrapper.OnPictureUploadSuccess: Operation succeeded."),wa.Result?S.a(this.$).Ima(1,wa.Result):l.ULS.sendTraceTag(537155800,0,10,"OnlinePictureUploaderWrapper.OnPictureUploadSuccess:Result.result is null"))};this.OOi=()=>{l.ULS.sendTraceTag(537155798,0,10,"OnlinePictureUploaderWrapper.OnPictureUploadFailed: Operation failed")};
this.$=aa;this.Jd=ta;this.k0=ib;this.bpe=w.a.instance.Wb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper");this.showDialog()}dispose(){this.$=null}showDialog(){let aa=null;aa=this.$.Ib.Bc("UserAction","showOnlineImagesDialogTimeStopwatch");switch(this.Jd.command){case -2009825598:this.azj();break;case -2053056795:this.bpe.execute(ta=>{ta.isFeatureEnabled("MsoPremiumStockImages",!1).catch(xa=>l.ULS.sendTraceTag(557200643,0,10,`OnlinePictureUploaderWrapper::ShowDialog - Failed to load the premium state from application feature helper: ${xa}`)).then(xa=>
{this.bzj(xa);return null})})}aa.stop();this.zmf=aa.uc}azj(){let aa=this.$.ya.BingPictureEndpoint;const ta=r.a.YJ(e.AFrameworkApplication.lcid),xa=u.a.create();aa?(aa=0<aa.search(RegExp("insertmedia.bing.office.net","gi"))?String.format(aa,1,1):String.format(aa,1,e.AFrameworkApplication.lcid,ta?ta.name:"en-us",e.AFrameworkApplication.buildVersion,xa.toString(),1,this.$.ya.DocumentHostInfo.LoggableUserId),this.b3b(aa,1,-1,U.a.instance.ga(1761))):(l.ULS.sendTraceTag(537155804,0,10,"OnlinePictureUploaderWrapper::ShowDialogForBingPictures - Can't access the Bing service endpoint"),
this.k0.setException(Error.create("Failed to access the Bing service endpoint")))}bzj(aa){var ta=this.$.ya.M365PictureEndpoint,xa=u.a.create();if(ta){var ia=this.$.ya.DocumentHostInfo.UserId;ia=ia?v.a.Sv(ia).toString():"0";var ya=this.bpe.instance.isFreemiumUpsellEnabled();aa=aa?1:ya?0:-1;xa=xa.toString();ya=r.a.YJ(e.AFrameworkApplication.lcid).name;ta=String.format(ta,e.AFrameworkApplication.lcid,ya,e.AFrameworkApplication.buildVersion,xa,1,ia,aa,1);this.b3b(ta,2,aa,U.a.instance.ga(1760))}else l.ULS.sendTraceTag(537155803,
0,10,"OnlinePictureUploaderWrapper::ShowDialogForStockImages - Can't access the M365 service endpoint"),this.k0.setException(Error.create("Failed to access the M365 service endpoint"))}b3b(aa,ta,xa,ia){try{(new pa(this.$,aa,w.a.instance.vh("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"),ta,xa,ia)).Qzj(this),this.k0.setResult(!0)}catch(ya){l.ULS.sendTraceTag(537155802,0,10,`OnlinePictureUploaderWrapper::CreateAndShowDialog failed [Exception : ${ya}] [MediaProvider : ${ta}] [DialogLicenseTier : ${xa}]`),
this.k0.setException(ya)}}}Object(t.a)(Ra,"OnlinePictureUploaderWrapper",m.a,[2]);var Ga=a(55);class Ba{constructor(aa,ta){this.$=aa;this.uploaderCreator=ta}executeCommand(aa,ta,xa){aa=ta.command;switch(aa){case 1403967063:if(xa&&"dataUrl"in xa)return ta=new d.a,this.uploaderCreator&&this.uploaderCreator.L9h(this.$,f.a.instance,e.AFrameworkApplication.fa,xa,xa.dataUrl,ta),ta.task;this.uploaderCreator&&this.uploaderCreator.P$h(this.$,ta,f.a.instance,e.AFrameworkApplication.fa,xa);return Ga.Task.Ta(!0);
case -2053056795:case -2009825598:return aa=new d.a,new Ra(this.$,ta,f.a.instance,e.AFrameworkApplication.fa,xa,aa),aa.task;default:return k.a(aa)}}Cc(aa,ta){if(aa=this.$.isEditMode)switch(ta.command){case 1403967063:aa=!0;break;case -2053056795:aa=!0;break;case -2009825598:aa=!0;break;default:aa=!1}return aa}Rc(){return!1}Nc(){return!1}}Object(t.a)(Ba,"PictureCommandHandler",null,[195]);var fa=a(37),Y=a(50);class ja extends b.a{constructor(aa){super(aa)}yd(){fa.TaskExtensions.Aa(Y.GetServiceTaskFactory.Ra(this.$.da,
484,485,1),aa=>{this.gd([new Ba(this.$,aa.result)])},this.$.la,3)}static ka(aa){b.a.Nd(90,new ja(aa))}}Object(t.a)(ja,"PictureCommandHandlerFactory",b.a,[]);a.d(C,"a",function(){return ca});const ca=()=>{c.a.Fa(aa=>{ja.ka(aa)})}},1208:function(t,C,a){var c=a(10);t=a(0);var b=a(221),d=a(15),f=a(508),e=a(38),k=a(4),l=a(61);class m{}m.gdd="GetFontPreviewData";Object(t.a)(m,"FontWebServiceMethods",null,[]);const v=(z,A,I,F,U=null)=>{const X=m.gdd;U=z.Na(5,U);U.locale=k.AFrameworkApplication.uiCulture;
return l.g(z,X,U,A,I,F,null,644)};var n=a(11),w=a(1);const r={xlyellow:"xlyellow"};class u extends e.a{constructor(z,A){super();this.$=z;this.Xu=A;this.iua={};this.QR={};this.Fqe=!1;this.styles=null;this.BJi=(I,F,U)=>{d.ULS.sendTraceTag(520710152,1,50,`FontServiceManager.onFontPreviewRequestComplete: Attempt to request FontUrl method: ${U} has succeeded.`);this.NZi(I);this.Fqe=!0;this.E2i()};this.CJi=(I,F,U)=>{d.ULS.sendTraceTag(520710151,1,10,`FontServiceManager.onFontPreviewRequestFailed: Encountered errors for ${U}.`)};
this.Hej=()=>{this.Hm&&this.gdd(this.BJi,this.CJi)};this.Hm=w.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FontServiceIntegration",!1);this.Hej()}NZi(z){if(this.tni(z)){var A=n.HelperMethods.Lba(()=>{const I=z.Result;this.styles=`@font-face{font-family:"msofpNew";font-style:normal;font-weight:normal;src:url('${I.PreviewUrl}') format('truetype')}`;const F=I.FontFacePropertiesList;I.FontNameList.forEach((U,X)=>{this.iua[U]=F[X].Codepoint;this.styles=this.CJg(this.styles,F[X].FontFamily,
`https://fs.microsoft.com/fs/${I.CatalogVersion}/rawguids/${F[X].FontGuid}`,F[X].FontWeight);this.QR[U]=F[X].LocalizedFontName});f.a.Hi(this.styles)});10<A&&d.ULS.sendTraceTag(520710159,1,50,`FontServiceManager.prepareFontCodepointMap: Duration for prepareFontCodepointMap the model, duration=${A}`)}}tni(z){if(!z.Result)return d.ULS.sendTraceTag(520710158,1,15,"FontServiceManager.isValidFontPreviewData: Result in EwaResult is Null."),!1;z=z.Result;return z?z.PreviewUrl?z.FontFacePropertiesList?z.FontNameList?
0===z.FontFacePropertiesList.length||z.FontFacePropertiesList.length!==z.FontNameList.length?(d.ULS.sendTraceTag(520710153,1,15,"FontServiceManager.isValidFontPreviewData: Mismatch in length of FontFacePropertiesList and FontNameList in fontListPreviewData."),!1):!0:(d.ULS.sendTraceTag(520710154,1,15,"FontServiceManager.isValidFontPreviewData: FontNameList in fontListPreviewData is Null."),!1):(d.ULS.sendTraceTag(520710155,1,15,"FontServiceManager.isValidFontPreviewData: FontFacePropertiesList in fontListPreviewData is Null."),
!1):(d.ULS.sendTraceTag(520710156,1,15,"FontServiceManager.isValidFontPreviewData: PreviewUrl in fontListPreviewData is Null."),!1):(d.ULS.sendTraceTag(520710157,1,15,"FontServiceManager.isValidFontPreviewData: fontListPreviewData is Null."),!1)}CJg(z,A,I,F){return z+`@font-face{font-family:"${A}";src:url('${I}');font-weight:${F};}`}gdd(z,A){return v(this.Xu,z,A,null,this.Xu.Sb())}E2i(){this.gfc&&this.raiseEvent(u.kTe)}get dyc(){return this.QR}get VBh(){return this.iua}get gfc(){return this.Fqe}isFontSupported(z){return this.Hm&&
this.QR&&(!!this.QR[z]||!!r[z.replace(/\s/g,"").toLowerCase()])}Jme(z){this.addHandler(u.kTe,z)}}u.kTe="fsmFD";Object(t.a)(u,"FontServiceManager",e.a,[282]);var y=a(696);class x extends b.a{constructor(z){super();this.$=z;this.Fb()}static ka(z){z.da.Ga(505,new x(z))}create(){this.qb(Object(y.b)(this.$.da,504,()=>new u(this.$,this.$.oa.Xu)))}}Object(t.a)(x,"FontServiceManagerFactory",b.a,[]);a.d(C,"a",function(){return B});const B=()=>{c.a.Fa(z=>{x.ka(z)})}},1245:function(t,C,a){t=a(0);var c=a(108),
b=a(221),d=a(15),f=a(13),e=a(38),k=a(175),l=a(90),m=a(1),v=a(21),n=a(5);class w extends e.a{constructor(B,z,A){super();this.statusBarManager=null;this.TGe=()=>{this.p5b()};this.Reh=()=>{this.p5b()};this.SGe=I=>{10===I&&this.p5b()};this.onKeyDown=I=>13===I.Ca.keyCode?(I=new l.a(237279923,1,2,6,null),this.$.Ka.Mb(I,{[n.a.skipClipboardAccess]:!0,[n.a.KKe]:!0}),!0):!1;this.$=B;this.Fq=z;this.tm=A;this.y7c=!1;(this.V1f=m.EwaSettings.getBooleanFeatureGate(k.a.ePa,!1))&&this.$.da.Za(29,I=>{this.statusBarManager=
I;I.oJ(this)})}dispose(){this.ek();this.tm=this.Fq=this.$=null;this.statusBarManager&&(this.statusBarManager.PF(this),this.statusBarManager=null)}nn(){return this.V1f}Rr(B,z){if("QueryPasteShortcutEnabledLabel"!==B&&!w.TEj.includes(B))return!1;const A=this.so();"QueryPasteShortcutEnabledLabel"===B?(z.Visible=A,d.ULS.sendTraceTag(537167636,0,100,`PasteShortcutManager.ExecuteRootCommand: Setting visible to ${A} for commandId ${B}`)):(z.Visible=!A,d.ULS.sendTraceTag(537167635,0,100,`PasteShortcutManager.ExecuteRootCommand: Setting visible to ${!A} for commandId ${B}`));
return!0}Ojh(){this.Bj();this.raiseEvent("pasteShortcutStatusChanged")}p5b(){this.ek();this.raiseEvent("pasteShortcutStatusChanged")}so(){return this.y7c}qq(B){this.addHandler("pasteShortcutStatusChanged",B)}Oq(B){this.removeHandler("pasteShortcutStatusChanged",B)}Bj(){if(!this.so()){this.y7c=!0;v.g(this.$).Di.Nk(this.TGe);this.tm.ka("blur",this.Reh);const B=this.$.da.za(65);B&&B.r2&&B.r2.registerForCommentEvents(this.SGe);this.Fq.pt(f.a.Kb,this.$.Qu,this.onKeyDown,!0)}}ek(){if(this.so()){this.y7c=
!1;v.g(this.$).Di.tk(this.TGe);this.tm.detach("blur");const B=this.$.da.za(65);B&&B.r2&&B.r2.unregisterForCommentEvents(this.SGe);this.Fq.At(f.a.Kb,this.$.Qu,this.onKeyDown,!0)}}}w.TEj=["QuerySheetNumberButton","QueryWorkbookStatisticsButton"];Object(t.a)(w,"PasteShortcutManager",e.a,[362,191,192,2]);var r=a(127);class u extends b.a{constructor(B){super();this.$=B;this.Fb()}create(){const B=this.$;this.qb(B.da.za(478)||this.$.da.Ga(478,new w(B,c.KeyInputManager.instance,r.a.instance.aH())))}static ka(B){B.da.Ga(479,
new u(B))}}Object(t.a)(u,"PasteShortcutManagerFactory",b.a,[]);var y=a(10);a.d(C,"a",function(){return x});const x=()=>{y.a.Fa(B=>{u.ka(B)})}},1246:function(t,C,a){var c=a(10);t=a(0);var b=a(108),d=a(221),f=a(127),e=a(7),k=a(15),l=a(4),m=a(1390),v=a(13),n=a(5),w=a(898),r=a(47),u=a(28),y=a(21),x=a(1),B=a(43),z=a(65),A=a(338),I=a(37),F=a(50);class U{constructor(H,D,J,M){this.recoveryUI=null;this.bya=()=>{this.Vaa()&&(this.grid.Uab(this.bya),this.l$f())};this.l$f=()=>{if(y.g(this.$).Db.u4(this.pasteRange))k.ULS.sendTraceTag(526758983,
306,50,"RecoveryUIController:triggerHandRaiseAfterConsistentGrid Last paste was a table. Table hand raise is not triggered.");else if(y.g(this.$).Db.s4(this.pasteRange))k.ULS.sendTraceTag(526758982,306,50,"RecoveryUIController:triggerHandRaiseAfterConsistentGrid Last paste was a pivot table. Table hand raise is not triggered.");else{var G=z.d(this.$.xa.pa);G=new A.a(this.pasteRange,G);this.dWd(G)}};this.hdg=()=>{this.recoveryUI&&(this.sZd=u.a.Wa.je.m,this.hide(),r.a.instance.create(()=>{this.DSj()},
250,"RecoveryUI.UpdatePositionOnVisibleAreaChanged",void 0,!0))};this.gHe=G=>{10===G&&this.THa()};this.ifh=()=>{if(this.recoveryUI){const G=document.getElementById("PasteRecoveryUI");G&&n.a.lk===G.getAttribute(n.a.LX)&&G.click();this.documentHidden=!0;this.THa()}};this.hHe=()=>{this.THa()};this.iHe=()=>{this.THa()};this.onKeyUp=G=>{if(this.recoveryUI){if(this.FZ)return!1;if(17===G.Ca.keyCode&&this.N7b){G=document.getElementById("PasteRecoveryUI");if(!G)return k.ULS.shipAssertTag(537154070,0,!1,"RecoveryUIController.OnKeyUp: recoveryUIElement is null."),
!1;const T=G.getAttribute(n.a.LX)||"";if(n.a.fr===T)return G.click(),!0}}return!1};this.onKeyDown=G=>{if(this.recoveryUI){this.N7b=!1;this.FZ=G.ctrlKey;G=G.Ca.keyCode;if(27===G)return this.THa(),x.EwaSettings.isChangeGateEnabled("OfficeVSO:6022397_ClearStateWhileHidingRecoveryUI")&&(G=this.$.da.za(254))&&G.ir("RecoveryUIController.onKeyDown",!0,!0).catch(()=>{}),!0;if(17===G)return this.N7b=!0}return!1};this.YQ=(G,T)=>{this.tAb=G=T.Jd;-1027730316!==G.command&&-1059615499!==G.command?this.THa():(T=
T.properties)&&T.launcherId!==this.iQh()&&this.THa()};this.$=H;this.aqc=D;this.Fq=J;this.tm=M;this.Zhc=this.tAb=this.hrd=null;this.FZ=this.N7b=this.u5b=this.vcc=!1;this.sZd=0;this.documentHidden=!1;this.grid=y.g(this.$);this.pasteRange=null;x.EwaSettings.fl()||this.$.da.Ga(406,this)}dispose(){this.cbg();this.ibg();this.Zhc=this.hrd=this.recoveryUI=this.tm=this.Fq=this.aqc=this.$=null;this.sZd=0}INg(H){this.recoveryUI=H;this.hrd=H.wHg;this.Zhc=H.i6i}THa(){this.recoveryUI&&(this.pasteRange=B.K(this.recoveryUI.Kwh),
this.HCj(),this.hide(),this.cbg(),this.recoveryUI=null)}HCj(){const H=[1868184698,-1985798686,753331043,2137617149,237279923,1804571062,1766348718,42074747,-875588320,-958589048,-185374993,-111689794,-1502853784,-1096627081,1441131127,-1027730316,-847286761];l.AFrameworkApplication.XH("XLS-SmartView-OnPasteEnabled-Control;XLS-SmartView-OnPasteEnabled-Treatment");x.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.OnPasteEnabled",!1)&&this.pasteRange&&(k.ULS.sendTraceTag(523622037,
0,50,"RecoveryUIController:smartViewOnPaste RecoveryUI is being dismissed."),null!=this.tAb&&H.includes(this.tAb.command)?(k.ULS.sendTraceTag(526758984,306,50,`RecoveryUIController:smartViewOnPaste Table hand raise is not triggered. Last command was ${w.a[this.tAb.command]}`),this.tAb=null):this.documentHidden?(k.ULS.sendTraceTag(523833603,306,50,"RecoveryUIController:smartViewOnPaste Table hand raise is not triggered. User clicked outside of document."),this.documentHidden=!1):this.Vaa()?this.l$f():
(k.ULS.sendTraceTag(520725721,306,50,"RecoveryUIController:smartViewOnPaste Grid is not in consistent state."),this.grid.cYa(this.bya)))}Vaa(){return this.grid.Ea.oK(4,this.$.pa)}yki(){return!!this.recoveryUI&&this.aqc.Lgi}MAj(H){this.recoveryUI?this.show(H):k.ULS.shipAssertTag(537154072,0,!1,"RecoveryUIController.ShowRecoveryUI: recoveryUI is null.")}iQh(){return this.recoveryUI?this.recoveryUI.Iqi:null}show(H){const D=this.recoveryUI.YLh();D?(this.aqc.showFloatie(Object(e.a)(new m.a,{x:D.x,y:D.y}),
this.recoveryUI.xJa(),H),this.Bj()):k.ULS.sendTraceTag(537154071,0,100,"RecoveryUIController.Show: point is null.")}hide(){this.yki()&&this.aqc.MC();this.ibg()}Bj(){if(!this.u5b){var H=y.g(this.$);H.view.Ls(this.hdg);H.Di.Nk(this.hHe);this.tm.ka("blur",this.ifh);this.$.Ka.fFa(this.YQ);this.$.xa.Pf(this.iHe);(H=this.$.da.za(65))&&H.r2&&H.r2.registerForCommentEvents(this.gHe);this.u5b=!0}this.vcc||(this.Fq.pt(v.a.Kb,this.$.domElement,this.onKeyDown,!0),this.Fq.pt(v.a.Fd,this.$.domElement,this.onKeyUp,
!0),this.vcc=!0)}cbg(){if(this.u5b){var H=y.g(this.$);H.view.Pq(this.hdg);H.Di.tk(this.hHe);this.tm.detach("blur");this.$.Ka.mza(this.YQ);this.$.xa.zg(this.iHe);(H=this.$.da.za(65))&&H.r2&&H.r2.unregisterForCommentEvents(this.gHe);this.u5b=!1}}ibg(){this.vcc&&(this.Fq.At(v.a.Kb,this.$.domElement,this.onKeyDown,!0),this.Fq.At(v.a.Fd,this.$.domElement,this.onKeyUp,!0),this.vcc=this.FZ=this.N7b=!1)}DSj(){this.recoveryUI&&250<=u.a.Wa.je.m-this.sZd&&this.show(-1)}dWd(H){I.TaskExtensions.Aa(F.GetServiceTaskFactory.Ra(this.$.da,
426,427,1),D=>{void D.result.g7(H,"Paste");k.ULS.sendTraceTag(523622036,0,50,"RecoveryUIController.triggerTableInvitationHandRaise: IntelligentMetadataOverlayManager is triggered.")},this.$.la,3)}}Object(t.a)(U,"RecoveryUIController",null,[394,2]);class X extends d.a{constructor(H){super();this.$=H;this.Fb()}create(){if(x.EwaSettings.fl())this.eCi();else{const H=this.$;H.Qx(D=>{D.qdc().then(J=>{this.qb(this.$.da.za(406)||new U(H,J,b.KeyInputManager.instance,f.a.instance.aH()))})})}}eCi(){const H=
this.$;let D=this.$.da.za(406);D?this.qb(D):H.Qx(J=>{J.qdc().then(M=>{D=new U(H,M,b.KeyInputManager.instance,f.a.instance.aH());this.$.da.Ga(406,D);this.qb(D)})})}static ka(H){H.da.Ga(405,new X(H))}}Object(t.a)(X,"RecoveryUIControllerFactory",d.a,[]);a.d(C,"a",function(){return S});const S=()=>{c.a.Fa(H=>{X.ka(H)})}},1352:function(t,C,a){t=a(0);var c=a(15),b=a(83);a(107);var d=a(27);class f{constructor(w,r,u){this.Hj=this.YAd=null;this.hEa=this.Bqa=0;this.zRb=null;this.nS=w;this.fe=r;this.nb=u;this.V0a=
!1;this.qYd=!0;this.zfj();this.A8a=this.fa.qa("NativeFileOpenDialogIsEnabled")}get context(){return this.nS}get fa(){return this.nb}get retryCount(){return this.Bqa}get RKd(){return this.hEa}LEb(w){this.Hj=w;if(!this.V0a){if(this.qYd){if(this.A8a&&d.a.wF){this.zRb=w.J5b(Object(b.a)(this,this.gzd,"onFileChosen"));return}this.zRb=w.J5b(null);if(!this.sBa(this.zRb,w))return}this.finalizeUpload(w,null)}}gzd(w){if(this.sBa(w,this.Hj)){if(d.a.wF||d.a.Tf)this.zRb=w;this.finalizeUpload(this.Hj,null)}}Bnc(){this.YAd&&
this.YAd()}zfj(){this.Bqa=0;this.hEa=this.fa.nd("Box4UploadRetryDelayStart",200);this.Hj&&(this.Hj.dispose(),this.Hj=null)}}Object(t.a)(f,"FileUploader",null,[]);var e=a(4),k=a(315),l=a(778),m=a(133),v=a(30);a.d(C,"a",function(){return n});class n extends f{constructor(w,r,u){super(w,r,u);this.dUb=this.Vqa=null}get kO(){return e.AFrameworkApplication.ta.MD}DXe(w){switch(w){case 1:return CommonUIStrings.l_ImageUploadNoFileSpecified;case 2:return CommonUIStrings.l_ImageUploadUnsupportedFileType;default:return""}}Peg(w){return n.sBa(w,
this.wZh())}wZh(){return n.Zhe}sBa(w,r=null){w=this.Peg(w);return 0!==w?(r&&r.gke(),2===w&&this.oj(0,this.DXe(w)),!1):!0}finalizeUpload(w,r){c.ULS.sendTraceTag(36783360,322,50,"PictureUploader.FinalizeUpload");this.YAd=r;this.Yzj();k.a.mark(5576);this.dUb=this.kO.Bc("LoadResource","PictureUploadTime")}oj(w,r){const u=new m.StandardDialog;u.Rb=0;u.Xz(w,CommonUIStrings.l_ImageUploadFailedTitle,r,null)}Bnc(){c.ULS.sendTraceTag(36783361,322,50,"PictureUploader.OnUploadComplete");super.Bnc();this.dUb&&
(this.dUb.stop(),this.dUb=null);this.FYg()}Yzj(){this.Vqa=(new l.a).create();this.Vqa.message=CommonUIStrings.l_ImageUploadWait;this.Vqa.Rb=5;this.Vqa.ft=!1;this.Vqa.lAa(null,null,null)}FYg(){this.Vqa&&(this.Vqa.close(),this.Vqa=null)}static D4h(w,r){w=v.a.ll(w);for(let u=0;u<r.length;++u)if(w.endsWith(r[u]))return!0;return!1}static sBa(w,r=null){r||(r=n.Zhe);return w?n.D4h(w,r)?0:2:1}}n.Zhe=".jpg .jpeg .png .gif .bmp .tif .tiff".split(" ");Object(t.a)(n,"PictureUploader",f,[])},1424:function(t,C,
a){a.r(C);var c=a(1149),b=a(0),d=a(15),f=a(4),e=a(119),k=a(393);class l extends k.a{constructor(Ub){super(Ub)}get R2b(){return!1}createElement(){const Ub=document.createElement("link");Ub.setAttribute("rel","stylesheet");Ub.setAttribute("type","text/css");Ub.setAttribute("href",this.rt);return Ub}E2c(){return null}Nqc(){this.element.setAttribute("href","");this.element.setAttribute("href",this.Qz.rt)}}Object(b.a)(l,"CssResource",k.a,[]);var m=a(371),v=a(226),n=a(30),w=a(55);class r{constructor(){this.jUb=
this.ERb=null}Sri(){this.ERb||(d.ULS.sendTraceTag(21030598,324,50,"InProductMessagingDependenciesLoad usage"),this.ERb=w.Task.WAA(r.Yri(),r.Pri()),this.ERb.continueWith(Ub=>{d.ULS.sendTraceTag(21030599,324,10,"{0}",n.a.Pcd(Ub.exception))},5));return this.ERb}Vri(){if(!this.jUb)try{d.ULS.sendTraceTag(39978390,324,50,"InProductMessagingFreemiumDependenciesLoad usage"),this.jUb=w.Task.WAA(r.f7c(v.a.create(f.AFrameworkApplication.fa.Va("DimeUrl"),null,null))),this.jUb.continueWith(Ub=>{d.ULS.sendTraceTag(39978391,
324,10,"{0}",n.a.Pcd(Ub.exception))},5)}catch(Ub){d.ULS.sendTraceTag(594874951,324,10,"{0}",n.a.Pcd(Ub))}return this.jUb}static Yri(){var Ub=r.abc("inproductmessaging.js");Ub=v.a.create(Ub,null,null);return r.f7c(Ub)}static Pri(){var Ub=r.abc("inproductmessaging.css");Ub=new l(Ub);return r.f7c(Ub)}static abc(Ub){return e.a.X1b(String.format("ipm/{0}",Ub))}static f7c(Ub){m.a.Xha(Ub);return Ub.L7a}}Object(b.a)(r,"DependencyDownloader",null,[774]);class u{}u.WUi="inProductMessagingOverlayDiv";u.JXi=
"PlayButtonImage";u.zdj="ReplayButtonImage";Object(b.a)(u,"Constants",null,[]);class y{constructor(){this.Pfe=this.nae=this.c1d=!0;this.Adj=this.KXi=null;this.dBi=!1;this.locale=null;this.Bag={}}get Wre(){return this.c1d}set Wre(Ub){this.c1d=Ub}get Qpf(){return this.nae}set Qpf(Ub){this.nae=Ub}get V2f(){return this.Pfe}set V2f(Ub){(this.Pfe=Ub)&&this.yrj()}yrj(){this.xle(u.JXi,this.KXi);this.xle(u.zdj,this.Adj)}xle(Ub,Lc){Lc&&(this.Bag[Ub]=Lc)}}Object(b.a)(y,"FirstRunExperienceUISettings",null,[775]);
class x{constructor(){this.completed=this.c9i=!1}}Object(b.a)(x,"FirstRunExperienceViewData",null,[724]);var B=a(83),z=a(176),A=a(106),I=a(25);class F{constructor(Ub,Lc,hd){this.La=Ub;this.We=Lc;this.hSb=hd}Gg(){this.La.Ie(I.a.IAh,A.a.frame,Object(B.a)(this,this.GAh,"firstRunExperienceHandler"),64);this.La.Ob(I.a.uSe,A.a.frame,Object(B.a)(this,this.y7h,"inProductMessagingTabHandler"));this.La.Ob(I.a.tSe,A.a.frame,Object(B.a)(this,this.x7h,"inProductMessagingShiftTabHandler"));this.La.Ob(I.a.Eeh,A.a.frame,
Object(B.a)(this,this.Feh,"dimeLaunchHandler"));this.La.Ob(I.a.mRf,A.a.frame,z.ActionManager.lg);this.La.Ob(I.a.Xdj,A.a.frame,z.ActionManager.lg);this.La.Ob(I.a.Ydj,A.a.frame,z.ActionManager.lg);this.We&&this.We.updateCommandUI()}GAh(Ub,Lc,hd,Kd,Wd){2===hd&&this.hSb.nqi(Wd);return 32}Feh(Ub,Lc,hd,Kd,Wd){2===hd&&this.hSb.kqi(Wd);return 32}y7h(Ub,Lc,hd){return 2===hd?this.hSb.Qvd():32}x7h(Ub,Lc,hd){return 2===hd?this.hSb.Ovd():32}}Object(b.a)(F,"InProductMessagingActor",null,[]);var U=a(84);class X{constructor(){this.SNf=
this.PSf=this.R7f=this.nic=this.instance=null}}Object(b.a)(X,"DimeExperienceUISettings",null,[]);var S=a(159),H=a(461);class D{constructor(Ub,Lc,hd,Kd,Wd){this.j9b=!1;this.Erb=null;this.La=Ub;this.CEa=Lc;this.JUb=hd;this.F0=Kd;this.FDc=Wd}n$h(Ub){S.b("getHeaderApi")?Ub.isFeatureEnabled("MsoPremiumBadge",!0).then(Lc=>{const hd=Ub.isFreemiumUpsellEnabled();hd&&(appChrome.getHeaderApi().then(Kd=>{Kd.updatePremiumStatus(Lc,hd);return null}),Ub.gma("MsoPremiumBadge",Kd=>{appChrome.getHeaderApi().then(Wd=>
{Wd.updatePremiumStatus(Kd.isEnabled,hd);return null})}));return null}):d.ULS.sendTraceTag(593859840,324,10,"getHeaderApi not available")}nqi(Ub){this.JUb.Sri().continueWith(()=>{this.CEa.mBj(Ub)})}kqi(Ub){let Lc="gopremium",hd=null,Kd=()=>{};Ub?(Ub.experience&&""!==Object(U.a)(String,Ub.experience)&&(Lc=Object(U.a)(String,Ub.experience)),Ub.onTaskComplete&&(Kd=Ub.onTaskComplete),Ub.campaignId&&""!==Object(U.a)(String,Ub.campaignId)&&(hd=Object(U.a)(String,Ub.campaignId))):d.ULS.sendTraceTag(51675402,
324,50,"Experience not given, using default experience");this.rjf(Lc,Kd,hd)}rjf(Ub,Lc,hd=null){if(this.j9b&&this.Erb){const Kd={};Kd.experience=Ub||"gopremium";Kd.campaignId=hd||H.b(this.F0,this.FDc,Object(U.a)(String,Kd.experience),!0);this.La.processAction(I.a.mRf,2);d.ULS.sendTraceTag(51675403,324,50,"Launching Freemium Upsell dialog: "+Kd.experience);try{const Wd=Object.assign(new X,{instance:this.Erb,nic:Kd,R7f:Lc||(()=>{}),PSf:oe=>{d.ULS.sendTraceTag(51675405,324,50,"Dime launch result: "+oe.status)},
SNf:()=>{d.ULS.sendTraceTag(51675406,324,10,"Dime launch error");this.j9b=!1;this.Erb=null}});this.CEa.Azj(Wd)}catch(Wd){d.ULS.sendTraceTag(51675407,324,10,"Dime launch error: "+Wd.message),this.j9b=!1,this.Erb=null,this.La.de(I.a.k9b,2,{["experience"]:Kd.experience})}}else d.ULS.sendTraceTag(39978392,324,10,"FreemiumUpsellDialogDependencies not loaded"),this.La.de(I.a.k9b,2,{["experience"]:Ub})}fkf(){this.JUb.Vri().continueWith(()=>{try{var Ub=n.a.ll(f.AFrameworkApplication.uiCulture);const Kd=H.c(this.F0);
if(Kd){var Lc={};Lc.partnerId=Kd;Lc.language=Ub;Lc.sessionId=f.AFrameworkApplication.userSessionId;Lc.authHint=f.AFrameworkApplication.fa.Va("UserPrincipalName");var hd=f.AFrameworkApplication.fa.Va("Puid")||"";""!==hd&&(Ub={},Ub.puid=hd,Lc.userInfo=Ub);this.Erb=new Dime(Lc);this.j9b=!0;d.ULS.sendTraceTag(592721856,324,50,"Dime initialized")}else d.ULS.sendTraceTag(51675409,324,15,"App not supported")}catch(Kd){d.ULS.sendTraceTag(51675410,324,10,"FreemiumUpsellDialogDependencies failed: "+Kd.message)}},
3)}Qvd(){return this.CEa.Qvd()}Ovd(){return this.CEa.Ovd()}}Object(b.a)(D,"InProductMessagingUIManager",null,[701]);class J{constructor(){this.phe=0;this.UVa=Array(5);this.UVa[0]=10;this.UVa[1]=15;this.UVa[2]=50;this.UVa[3]=100;this.UVa[4]=200}Init(Ub){this.phe=Ub}SendTrace(Ub,Lc){d.ULS.sendTraceTag(34182235,this.phe,this.UVa[Ub],"{0}",Lc)}}Object(b.a)(J,"DefaultNetworkingManager",null,[725]);var M=a(259),G=a(311),T=a(94);class K{constructor(Ub){this.Zb=Ub}mBj(Ub){Ub&&(InProductMessaging.Networking.NetworkingMgr=
new J,InProductMessaging.Networking.NetworkingMgr.Init(387),InProductMessaging.Init(Ub.V2f,Ub.Qpf,Ub.Wre,Ub.dBi,Ub.locale,Object(B.a)(this,this.kIi,"onDismissFirstRunExperience"),Ub.Bag),this.eRa(u.WUi,!0))}Azj(Ub){if(Ub&&Ub.instance&&Ub.nic){let Lc=document.getElementById("wacDimeContainer");Lc||(Lc=document.createElement("div"),Lc.id="wacDimeContainer",document.body.appendChild(Lc));f.AFrameworkApplication.fa.qa("DimeFocusManagerIsEnabled")&&this.eRa("wacDimeContainer",!1);Ub.nic.parentElementId=
"wacDimeContainer";Ub.instance.launch(Ub.nic,Ub.R7f).then(hd=>{this.sHb();document.body.removeChild(Lc);Ub.PSf(hd)}).catch(hd=>{this.sHb();document.body.removeChild(Lc);Ub.SNf(hd)})}else throw Error.argument("DimeExperienceUISettings");}eRa(Ub,Lc){if(this.Zb&&Ub&&(Ub=document.getElementById(Ub),this.d$h(Ub),Ub=this.Zb.LM("InProductMessagingFocusId"))){const hd=this.Zb.ei;hd&&"InProductMessagingFocusId"===hd.name||this.Zb.jR("InProductMessagingFocusId",!1);Lc&&this.ZLf(Ub.scope)}}d$h(Ub){var Lc=this.Zb.vi("InProductMessagingFocusId");
Lc.parent=M.AFrame.hT;const hd=new G.DOMFocusListing(()=>Ub);hd.Fab=!1;hd.fo(3);hd.fo(2);hd.fo(4);Lc=this.Zb.Tra(()=>Ub,Lc,hd);Lc.kHb();Lc.KZ=!0;Lc.QGa=!0}ZLf(Ub){Ub.vk(T.FocusManager.instance().p1);Ub.vk(T.FocusManager.instance().q1);Ub.bindAction(T.FocusManager.instance().p1,I.a.uSe);Ub.bindAction(T.FocusManager.instance().q1,I.a.tSe)}sHb(){this.Zb&&(this.Zb.pca("InProductMessagingFocusId"),this.Zb.NPa("InProductMessagingFocusId"))}kIi(Ub,Lc){this.sHb();Ub=Object.assign(new x,{completed:Ub,c9i:Lc});
f.AFrameworkApplication.wb.de(I.a.FAh,2,Ub)}Qvd(){const Ub=document.activeElement,Lc=this.Zb.eQ();return Ub&&Lc&&Lc.af&&Ub===Lc.af.ow?(Lc.af.Bl(Ub),Lc.Gxa()?32:8):4}Ovd(){const Ub=document.activeElement,Lc=this.Zb.eQ();return Ub&&Lc&&Lc.af&&Ub===Lc.af.firstElement?(Lc.af.Bl(Ub),Lc.GNa()?32:8):4}}Object(b.a)(K,"InProductMessagingUIWrapper",null,[699]);var L=a(136),V=a(246),W=a(27);class da{constructor(){this.fb=null}get name(){return"Common.App.InProductMessaging"}Rh(Ub){Ub.register(r,"Common.App.InProductMessaging.DependencyDownloader").as("Common.App.InProductMessaging.IDependencyDownloader").tc().Fc(()=>
new r);Ub.register(K,"Common.App.InProductMessaging.InProductMessagingUIWrapper").as("Common.IInProductMessagingUIWrapper").tc().Fc(()=>new K(T.FocusManager.instance()));Ub.register(D,"Common.App.InProductMessaging.InProductMessagingUIManager").as("Common.IInProductMessagingUIManager").tc().Fc(()=>new D(f.AFrameworkApplication.wb,Ub.resolve("Common.IInProductMessagingUIWrapper"),Ub.resolve("Common.App.InProductMessaging.IDependencyDownloader"),f.AFrameworkApplication.ta.Oa.xj,f.AFrameworkApplication.ta.Oa.o5));
Ub.register(F,"Common.App.InProductMessaging.InProductMessagingActor").tc().Fc(()=>new F(f.AFrameworkApplication.wb,f.AFrameworkApplication.ta,Ub.resolve("Common.IInProductMessagingUIManager")));Ub.register(y,"Common.App.InProductMessaging.FirstRunExperienceUISettings").as("Common.IFirstRunExperienceUISettings").tc().Fc(()=>new y);Ub.register(x,"Common.App.InProductMessaging.FirstRunExperienceViewData").as("Common.IFirstRunExperienceViewData").tc().Fc(()=>new x);this.fb=Ub}init(){this.fb.resolve("Common.App.InProductMessaging.InProductMessagingActor").Gg();
f.AFrameworkApplication.fa.gv(()=>{f.AFrameworkApplication.ta.Oa.$r&&L.a.get_instance().rk(15,()=>{this.fb.Wb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(Ub=>{this.fb.resolve("Common.App.InProductMessaging.InProductMessagingUIManager").n$h(Ub)})});f.AFrameworkApplication.fa.qa("FreemiumUpsellShowDialogIsEnabled")&&H.a()&&!W.a.aka&&1!==f.AFrameworkApplication.ta.Oa.xj&&this.fb.Wb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(Ub=>{Ub.isFeatureEnabled("MsoPremiumBadge",
!0).then(Lc=>{!Lc&&Ub.isFreemiumUpsellEnabled()&&this.fb.resolve("Common.App.InProductMessaging.InProductMessagingUIManager").fkf();return null})})})}dispose(){}static main(){V.a.instance.yi(new da)}}Object(b.a)(da,"InProductMessagingPackage",null,[4,5]);var qa=a(185),O=a(41);class ea{constructor(Ub,Lc,hd,Kd=null,Wd=null){this.Kv=Ub;this.Whb=Lc;this.Shb=hd;this.Ice=Kd;this.$jb=Wd}F7b(Ub){const Lc=new Sys.StringBuilder(this.Kv.JIb);Lc.append("RoamingServiceHandler.ashx?action=");Lc.append("getFirstRunExperienceSettings");
Lc.append("&");Lc.append(this.Led(Ub));Lc.append("&");Lc.append(f.AFrameworkApplication.ij);f.AFrameworkApplication.vd.Bm(Lc.toString(),1,null,null,!0,2,Object(B.a)(this,this.hja,"getRequestSuccessCallback"),Object(B.a)(this,this.w3,"getRequestFailureCallback"),null)}X1a(Ub){var Lc=new Sys.StringBuilder(this.Kv.JIb);Lc.append("RoamingServiceHandler.ashx?action=");Lc.append("saveFirstRunExperienceSettings");Lc.append("&");Lc.append(f.AFrameworkApplication.ij);Lc=Lc.toString();Ub=O.c(Ub);f.AFrameworkApplication.vd.Bm(Lc,
2,Ub,null,!0,4,Object(B.a)(this,this.iZi,"postRequestSuccessCallback"),Object(B.a)(this,this.AV,"postRequestFailureCallback"),null)}hja(Ub){let Lc=!1,hd=null;try{if(0<Ub.data.Vd.length){const Kd=Object(U.a)(Object,O.a(Ub.data.Vd)),Wd=Kd?Kd[this.Kv.jVc]:null;Wd&&(hd=Object(U.a)(Object,O.a(Wd.toString())))}Lc=!0}catch(Kd){this.w3(null)}Lc&&this.Whb&&this.Whb(Ub.data,hd)}w3(Ub){this.Shb&&this.Shb(Ub?Ub.data:null)}iZi(Ub){this.Ice&&this.Ice(Ub?Ub.data:null)}AV(Ub){this.$jb&&this.$jb(Ub?Ub.data:null)}Led(Ub){const Lc=
new Sys.StringBuilder("requestedsettings=");for(let hd=0;hd<Ub.count;hd++)Lc.append(Ub.na(hd)),hd<Ub.count-1&&Lc.append(";");return Lc.toString()}}Object(b.a)(ea,"FirstRunExperienceRequestHandler",null,[]);var R=a(229),oa=a(82);class pa{constructor(){this.Jhb=this.FRb=this.Kv=null}$Qd(Ub){Ub?(this.Kv=Ub,this.Eii()&&(d.ULS.sendTraceTag(51675532,306,50,"Initiating call to get FRE data for current user from Roaming Settings Service"),Ub=new qa.a,Ub.add(this.Kv.jVc),this.FRb=new ea(this.Kv,Object(B.a)(this,
this.hja,"getRequestSuccessCallback"),Object(B.a)(this,this.w3,"getRequestFailureCallback"),null,Object(B.a)(this,this.AV,"postRequestFailureCallback")),this.FRb.F7b(Ub)),(this.Kv.T6a||f.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceUITest",!1))&&this.aRd()):d.ULS.sendTraceTag(51675531,306,10,"Invalid launcherSettings")}Eii(){try{if(this.Kv.T6a)return!0;if(!f.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceEnabled",
!0)||f.AFrameworkApplication.fa.qa("IsAnonymousUser"))return!1;if(this.Kv.Efi||this.Kv.V6a||f.AFrameworkApplication.fa.qa("IsO365ConsumerHost"))return!0;const Ub=f.AFrameworkApplication.fa.Va("FlightId");return-1!==(Ub?Ub.toString().toLowerCase():"").indexOf("firstrunexperienceui")}catch(Ub){d.ULS.sendTraceTag(576582624,306,10,"Error checking setting {0}",Ub?Ub.toString():null)}return!1}UUf(Ub){const Lc={},hd={};hd.FREDisplayedDate=(new Date).toUTCString();hd.VersionDisplayed=Ub;hd.RemindMeLater=
!1;Lc[this.Kv.jVc]=O.c(hd);d.ULS.sendTraceTag(51675533,306,50,"Initiating call to save FRE data for current user from Roaming Settings Service");this.FRb&&this.FRb.X1a(Lc)}hja(Ub,Lc){Ub=Ub?+Ub.t2-+Ub.pF:-1;Ub>this.Kv.LTf?d.ULS.sendTraceTag(51675534,306,50,"Call to Roaming Settings Service took {0}ms. This is more than the {1}ms threshold. A new attempt will be made next time the user starts a new session.",Ub,this.Kv.LTf):Lc?this.oyj(Lc)?(d.ULS.sendTraceTag(51675536,306,50,"FRE data already exists for current user. FRE UI should be displayed again. User selected 'Remind me later' option more than {0} hours ago.",
this.Kv.Gpf),this.aRd()):(this.B5c(!1),d.ULS.sendTraceTag(51675537,306,100,"Current user has already seen this version of the FRE. No further action required.")):(d.ULS.sendTraceTag(51675535,306,50,"No FRE data found for current user. FRE UI should be displayed."),this.aRd())}w3(Ub){this.B5c(!1);d.ULS.sendTraceTag(51675541,306,10,"First Run Experience failed to GET data from Roaming Settings Service with status: {0}",Ub?Ub.httpStatus:-1)}AV(Ub){d.ULS.sendTraceTag(51675542,306,10,"First Run Experience failed to POST data to Roaming Settings Service with status: {0}",
Ub?Ub.httpStatus:-1)}aRd(){this.B5c(!0);var Ub=oa.a.instance.vh("Common.ISystemInitiatedFeedback");Ub?this.J2f(Ub):(d.ULS.sendTraceTag(51675543,306,50,"Error resolving ISystemInitiatedFeedback"),f.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceUIResolveFuture",!0)&&((Ub=oa.a.instance.Wb("Common.ISystemInitiatedFeedback"))?Ub.execute(Lc=>{this.J2f(Lc)}):d.ULS.sendTraceTag(539494111,306,50,"Error resolving ISystemInitiatedFeedback Future")))}J2f(Ub){if(Ub){var Lc=
this.Kv.TAh;Lc&&(f.AFrameworkApplication.jxa(Lc),f.AFrameworkApplication.XH(Lc));d.ULS.sendTraceTag(51675544,306,50,"Attempting to display First Run Experience UI using floodgate.",Lc);Ub.logActivity("ShowFirstRunExperienceUIV2",null);window.addEventListener?(this.Jhb=Object(B.a)(this,this.iJi,"onFirstRunExperienceCampaignEvent"),window.addEventListener("FGWebSurfaceEvent",this.Jhb,!0),window.addEventListener("FRELaunchedEvent",this.Jhb,!0)):(d.ULS.sendTraceTag(51675545,306,50,"FRE V2 UI triggered. Attempting to save FRE data."),
this.UUf(this.Kv.currentVersion))}else d.ULS.sendTraceTag(539494112,306,50,"Invalid ISystemInitiatedFeedback")}iJi(Ub){if(Ub){var Lc=Ub.detail;Ub=Ub.type;var hd=this.Kv&&this.Kv.campaignId?this.Kv.campaignId.split("-")[0]:null;if("FRELaunchedEvent"===Ub||hd&&Lc&&Lc.id&&-1!==Lc.id.indexOf(hd))Lc.success&&(d.ULS.sendTraceTag(51675546,306,50,"FRE V2 UI has been launched. Attempting to save FRE data."),this.UUf(this.Kv.currentVersion)),window.removeEventListener&&(window.removeEventListener("FGWebSurfaceEvent",
this.Jhb,!0),window.removeEventListener("FRELaunchedEvent",this.Jhb,!0))}}oyj(Ub){if("RemindMeLater"in Ub&&"FREDisplayedDate"in Ub){if("true"===Ub.RemindMeLater.toString()&&(+new Date-+new Date(Ub.FREDisplayedDate.toString()))/36E5>this.Kv.Gpf)return!0}else if(f.AFrameworkApplication.fa.qa("WacShowVersionBasedFREToAllUsers")&&"VersionDisplayed"in Ub&&Ub.VersionDisplayed<this.Kv.currentVersion)return d.ULS.sendTraceTag(528262853,306,50,"Current version is higher so FRE V2 UI should be displayed again."),
!0;return!1}B5c(Ub){f.AFrameworkApplication.fa.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.DispatchFREDecisionEvent")&&R.a.dispatch("FREDecisionEvent",{["show"]:Ub})}}Object(b.a)(pa,"FirstRunExperienceLauncher",null,[675]);class Pa{constructor(){this.fb=null}get name(){return"Common.App.FirstRunExperienceLauncher"}Rh(Ub){this.fb=Ub;this.fb.register(675,"Common.App.FirstRunExperienceLauncher.IFirstRunExperienceLauncher").tc().Fc(()=>new pa)}init(){}dispose(){}static main(){V.a.instance.yi(new Pa)}}
Object(b.a)(Pa,"FirstRunExperienceLauncherPackage",null,[4,5]);var Z=a(1106),Ra=a(1107),Ga=a(1133),Ba=a(1245),fa=a(10),Y=a(221);class ja{constructor(Ub){this.$=Ub}get jVc(){return"Excel"}get campaignId(){return"aed9de6b-d4e7-4878-988a-9dfec66fed9e"}get version(){return 1}get currentVersion(){return 0}get Efi(){return this.isEnabled()&&this.$.ma(336)}get V6a(){return this.isEnabled()&&this.$.ma(338)}get T6a(){return this.$.ma(337)}get TAh(){return null}get Gpf(){return 24}get LTf(){return 4E3}get JIb(){return this.$.ya.WebServiceBase||
""}isEnabled(){if(f.AFrameworkApplication.fa?f.AFrameworkApplication.fa.qa("IsAnonymousUser"):1)return!1;const Ub=f.AFrameworkApplication.Qb?Object(U.a)(String,f.AFrameworkApplication.Qb.AudienceGroup):"";return"Unknown"!==Ub&&"Automation"!==Ub}}Object(b.a)(ja,"FirstRunExperienceLauncherSettings",null,[698]);class ca{constructor(Ub,Lc){this.vSe=Ub;this.HAh=Lc}$Qd(){this.vSe&&this.vSe.$Qd(this.HAh)}}Object(b.a)(ca,"FirstRunExperienceManager",null,[696]);var aa=a(696);class ta extends Y.a{constructor(Ub){super();
this.$=Ub;this.Fb()}create(){const Ub=Object(aa.a)(this.$.da,311,()=>this.M5g());this.qb(Ub)}M5g(){var Ub=new ja(this.$);Ub=new ca(oa.a.instance.resolve("Common.App.FirstRunExperienceLauncher.IFirstRunExperienceLauncher"),Ub);Ub.$Qd();return Ub}static ka(Ub){Ub.da.Ga(312,new ta(Ub))}}Object(b.a)(ta,"FirstRunExperienceManagerFactory",Y.a,[]);var xa=a(59);class ia extends Y.a{constructor(Ub){super();this.Ijd=null;this.$=Ub;this.Fb()}create(){const Ub=Object(aa.a)(this.$.da,361,()=>this.y6g());this.qb(Ub)}y6g(){this.Ijd=
oa.a.instance.vh("Common.IInProductMessagingUIManager");xa.a.tg.$r?L.a.get_instance().rk(16,()=>{this.X9e()}):this.X9e();return this.Ijd}X9e(){oa.a.instance.Wb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(Ub=>{Ub.isFeatureEnabled("MsoPremiumBadge",!0).then(Lc=>{!Lc&&Ub.isFreemiumUpsellEnabled()&&this.Ijd.fkf();return null})})}static ka(Ub){Ub.da.Ga(362,new ia(Ub))}}Object(b.a)(ia,"InProductMessagingManagerFactory",Y.a,[]);var ya=a(1184),ib=a(1109),wa=a(47),sa=a(412),Ya=
a(78),bb=a(1),mb=a(527),Ca=a(21),$a=a(573);class Kb extends mb.a{constructor(Ub){super(1);this.bfa=!1;this.euf=()=>{this.refresh()};this.fuf=()=>{this.refresh()};this.gridView=Ca.g(Ub);this.gridView.Xb.Nk(this.fuf);this.gridView.Xb.em(this.euf);this.refresh()}get cI(){return this.Zjc(this.bfa)}QOd(Ub){this.bfa!==Ub&&(this.bfa=Ub,this.yGb())}get name(){return $a.a.cellEdit}dispose(){this.gridView.Xb.tk(this.fuf);this.gridView.Xb.yl(this.euf);this.gridView=null;super.dispose()}yGb(){this.rFd(this.bfa)}refresh(){this.QOd(!this.gridView.eb)}}
Object(b.a)(Kb,"CellEditSafeStatePublisher",mb.a,[]);var rb=a(38),cc=a(109);class nc{constructor(Ub,Lc){this.handler=null;this.publisher=Ub;this.cI=Lc}}Object(b.a)(nc,"SafeStatePublisherState",null,[]);var Wb=a(607);const Ea=Ub=>Ub?`${Ub.Current} / ${Ub.Pending} @${Ub.SuspensionStartTimestamp}`:null,ua=Ub=>(null===Ub||void 0===Ub?void 0:Ub.SuspensionStartTimestamp)&&Ub.Pending>Ub.Current;class ma extends rb.a{constructor(Ub,Lc){super();this.$if=null;this.t7a=!1;this.cEb=(hd,Kd)=>{3===Kd.qpf&&this.t7a&&
d.ULS.sendTraceTag(520480204,0,15,"ClientStateMonitor.onMergeDidntOccur: Aborted merge occurred after another aborted merge.");this.t7a=!0;this.dab()};this.wQa=new qa.a;this.Cxa=Ub;this.Qla=Lc;this.kyb=bb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DoPendingMergeWhenUnsafe",!1);this.y6a=bb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.RetryDoPendingMergeAfterBailout",!1);this.kyb&&(this.Qla.gYa(this.fya.bind(this)),this.y6a?this.Cxa.Ame(this.cEb):this.Cxa.mFg(this.Ryf.bind(this)))}get mPj(){return cc.f(cc.c(this.wQa.toArray(),
Ub=>0!=Ub.cI),Ub=>Ub.publisher.name)}CYb(Ub){this.addHandler(ma.vQa,Ub)}Lrc(Ub){this.removeHandler(ma.vQa,Ub)}hza(Ub,Lc){const hd=new nc(Ub,Lc);this.wQa.add(hd);Lc=(Kd,Wd)=>{hd.cI=Wd.cI;this.dab()};Ub.CYb(Lc);hd.handler=Lc;this.dab()}$Wd(Ub){let Lc=null;for(let hd of this.wQa)if(hd.publisher===Ub){this.ybg(hd);Lc=hd;break}Lc&&(this.wQa.remove(Lc),this.dab())}dispose(){for(let Ub of this.wQa)this.ybg(Ub);this.wQa.clear();this.kyb&&(this.Qla.Wab(this.fya.bind(this)),this.y6a?this.Cxa.XPf(this.cEb):
this.Cxa.mbj(this.Ryf.bind(this)));super.dispose()}K9b(){let Ub=dc.K9b(this.wQa.toArray().map(Lc=>Lc.cI));return this.t7a&&1===Ub?2:Ub}ybg(Ub){Ub.publisher.Lrc(Ub.handler)}dab(){const Ub=this.K9b();Ub!==this.$if&&(this.raiseEvent(ma.vQa,new Wb.a(Ub)),this.$if=Ub)}Ryf(){this.t7a&&d.ULS.sendTraceTag(523317957,0,15,"ClientStateMonitor.onMergeWasAborted: Aborted merge occurred after another aborted merge.");this.t7a=!0;this.dab()}fya(Ub,Lc){Ub=Lc.Mba;(Lc=!ua(Ub))||(Lc=this.Epi,Lc=(null===Ub||void 0===
Ub?void 0:Ub.SuspensionStartTimestamp)!==(null===Lc||void 0===Lc?void 0:Lc.SuspensionStartTimestamp));Lc&&(this.t7a=!1);this.Epi=Ub;this.dab()}}ma.vQa="SSC";Object(b.a)(ma,"ClientStateMonitor",rb.a,[]);var fb=a(6),sb=a(68);class Ua extends mb.a{constructor(Ub,Lc=null){super(1);this.bfa=!1;this.tN=()=>{this.refresh()};this.ivf=()=>{this.refresh()};this.$=Ub;this.Q6d=Lc||sb.a(Ub).cQ(fb.a.idle);sb.a(Ub).OTc(this.ivf);this.R4a.qq(this.tN);this.refresh()}get cI(){return this.Zjc(this.bfa)}QOd(Ub){Ub!==
this.bfa&&(this.bfa=Ub,this.yGb())}get name(){return $a.a.R4a}get R4a(){return this.Q6d}dispose(){sb.a(this.$).prc(this.ivf);this.R4a.Oq(this.tN);this.Q6d=null;super.dispose()}yGb(){this.rFd(this.bfa)}refresh(){this.QOd(1===this.R4a.Zt||sb.a(this.$).di===this.R4a)}}Object(b.a)(Ua,"IdleActivitySafeStatePublisher",mb.a,[]);var ab=a(312),na=a(3),Na=a(22);class Va extends Ya.a{constructor(){super()}Nc(){return!1}executeCommand(){return w.Task.Ta(!0)}Cc(Ub,Lc){return 1905775613===Lc.command}Rc(){return!1}}
Object(b.a)(Va,"ToggleMergeSuspensionSafeState",Ya.a,[195]);class Sa extends rb.a{constructor(Ub,Lc){super();this.statusBarManager=null;this.Pwd=!1;this.fya=(hd,Kd)=>{hd=`${Kd.Mba.Current===Kd.Mba.Pending?"\u26ad":"\u26ae"}${Kd.Mba.Current}`;Na.a.equals(this.Gkc,hd,!1)||(this.Gkc=hd,this.Dz())};this.nOa=(hd,Kd)=>{hd=0==Kd.cI;this.Pwd!==hd&&(this.Pwd=hd,this.Dz())};this.mergeSuspensionManager=Lc;this.mergeSuspensionManager.Qla.gYa(this.fya);this.Gkc="";ab.a.O8(1905775613,na.a.wc,0,1);this.Ka=Ub.Ka;
this.RMb=new Va;Ub.da.Za(29,hd=>{this.mergeSuspensionManager&&(this.statusBarManager=hd,hd.oJ(this),this.mergeSuspensionManager.cha.CYb(this.nOa))});this.Ka.P8(this.RMb)}qq(Ub){this.addHandler(Sa.vvd,Ub)}Oq(Ub){this.removeHandler(Sa.vvd,Ub)}Dz(){this.raiseEvent(Sa.vvd)}nn(Ub){return Ub===Sa.D1i&&!!this.mergeSuspensionManager}Rr(Ub,Lc){if(!this.nn(Ub))return!1;this.mergeSuspensionManager&&(Lc.LabelText=this.Gkc,Lc.On=this.Pwd);return!0}dispose(){this.RMb&&(this.Ka.Iab(this.RMb),this.RMb.dispose(),
this.RMb=null);this.mergeSuspensionManager&&(this.mergeSuspensionManager.Qla.Wab(this.fya),this.mergeSuspensionManager.cha.Lrc(this.nOa),this.mergeSuspensionManager=null);this.statusBarManager&&(this.statusBarManager.PF(this),this.statusBarManager=null);this.Gkc=null;super.dispose()}}Sa.vvd="MSMSC";Sa.D1i="QueryMergeSuspensionStatus";Object(b.a)(Sa,"MergeSuspensionIndicatorManager",rb.a,[191,192,2]);var vb=a(7),Oa=a(873);class yb extends Sys.EventArgs{constructor(Ub){super();this.xwa=Ub}}Object(b.a)(yb,
"TogglePendingMergeBlockedByClientEventArgs",Sys.EventArgs,[]);class Ob{}Object(b.a)(Ob,"SuspensionState",null,[]);class Ja extends Ob{constructor(Ub){super();this.poe=!1;this.poe=Ub}}Object(b.a)(Ja,"ReadyForPendingMergeState",Ob,[]);const lb=new Ob,Pb=new Ob,Jb=new Ja(!1),Lb=new Ja(!0);var Ab=a(874);class nb extends Ab.a{constructor(Ub,Lc,hd){super(Ub);this.DIg=Lc;this.PBj=hd}}Object(b.a)(nb,"ReadyForPendingMergesUpdatedEventArgs",Ab.a,[]);class va extends rb.a{constructor(Ub,Lc,hd){super();this.fya=
(Kd,Wd)=>{Kd=this.getState();const oe=this.QZ;this.QZ=Wd.Mba;Wd=this.getState();this.Mui(Kd,Wd,oe);this.raiseEvent(va.qvd);this.fSe(Kd,Wd)};this.nOa=(Kd,Wd)=>{Kd=this.getState();this.cI=Wd.cI;Wd=this.getState();this.fSe(Kd,Wd)};this.cEb=(Kd,Wd)=>{this.y6a&&4===Wd.qpf&&(d.ULS.sendTraceTag(520480203,0,50,"MergeSuspensionStateHandler.onMergeDidntOccur: Retry DoPendingMerge after bailout. Current merge counter: {0}, Response merge counter: {1}",Ea(this.QZ),Ea(Wd.QZ)),this.uKf(this.getState(),!0))};this.kyb=
bb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DoPendingMergeWhenUnsafe",!1);this.y6a=bb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.RetryDoPendingMergeAfterBailout",!1);this.cha=Ub;this.cha.CYb(this.nOa);this.Qla=Lc;this.Qla.gYa(this.fya);this.y6a&&(this.Cxa=hd,this.Cxa.Ame(this.cEb));this.QZ=Object(vb.a)(new Oa.a,{Pending:0,Current:0,SuspensionStartTimestamp:null});this.cI=this.B8h()}B8h(){return Object(sa.a)(ma,this.cha)?Object(U.a)(ma,this.cha).K9b():1}HYb(Ub){this.addHandler(va.gVd,
Ub)}Prc(Ub){this.removeHandler(va.gVd,Ub)}bGg(Ub){this.addHandler(va.aGd,Ub)}Qbj(Ub){this.removeHandler(va.aGd,Ub)}lFg(Ub){this.addHandler(va.qvd,Ub)}lbj(Ub){this.removeHandler(va.qvd,Ub)}s3i(){this.pFd(this.getState()===Pb)}dispose(){this.cha.Lrc(this.nOa);this.cha=null;this.Qla.Wab(this.fya);this.Qla=null;this.y6a&&(this.Cxa.XPf(this.cEb),this.Cxa=null);super.dispose()}$dd(){return Object(vb.a)(new Oa.a,{Current:this.QZ.Current,Pending:this.QZ.Pending,SuspensionStartTimestamp:this.QZ.SuspensionStartTimestamp})}getState(){return ua(this.QZ)?
0==this.cI?Lb:this.kyb&&1==this.cI?Jb:Pb:lb}fSe(Ub,Lc){Ub!==Lc&&(Lc===Pb?this.pFd(!0):Ub===Pb&&this.pFd(!1));this.uKf(Lc)}uKf(Ub,Lc=!1){Ub instanceof Ja&&this.raiseEvent(va.aGd,new nb(this.QZ,Ub.poe||!this.kyb,Lc))}Mui(Ub,Lc,hd){Ub===lb&&Lc!==lb?(Ub=Lc===Pb,Lc=Lc===Jb,d.ULS.sendTraceTag(252760283,0,50,`MergeSuspensionStateHandler.LogPendingMergesStatusChanged: Pending changes exist. IsBlocking: ${Lc} publisher: ${Lc||Ub?this.cha.mPj.join(","):""} counter: ${Ea(this.QZ)} isBlockingAllMerges: ${Ub}`)):
Ub!==lb&&Lc===lb&&d.ULS.sendTraceTag(252760284,0,50,`MergeSuspensionStateHandler.LogPendingMergesStatusChanged: No pending changes. counter: ${Ea(hd)}`)}pFd(Ub){this.raiseEvent(va.gVd,new yb(Ub))}}va.gVd="TPMBBC";va.aGd="RFPMU";va.qvd="MCC";Object(b.a)(va,"MergeSuspensionStateHandler",rb.a,[]);class db extends rb.a{constructor(Ub){super();this.c1=null;this.Uhc=0;this.BBa=(Lc,hd)=>{var Kd;if(null===(Kd=null===hd||void 0===hd?void 0:hd.dd)||void 0===Kd?0:Kd.MergeCount)Na.a.equals(hd.dd.SessionId,this.$.ea.sessionId,
!1)?this.eya(hd.dd.MergeCount,db.bsb):d.ULS.sendTraceTag(579737049,0,50,`Stale merge counter (${hd.dd.MergeCount.Current}/${hd.dd.MergeCount.Pending})`)};this.hCb=(Lc,hd)=>{(null===hd||void 0===hd?0:hd.Mba)&&this.eya(hd.Mba,db.IZd)};this.Buc=()=>{this.DSf();this.lKf(this.c1,db.qfj)};this.h9a=(Lc,hd)=>{hd.Rpb&&this.c1.SuspensionStartTimestamp&&d.ULS.sendTraceTag(17318084,0,50,`PendingMergeMonitor.OnEditCellEnded: committed with counter ${Ea(this.c1)}`)};this.DSf();this.$=Ub;this.$.ea.jk(this.Buc);
this.$.ea.$L(this.Buc);Ca.g(this.$).Xb.em(this.h9a);bb.EwaSettings.isChangeGateEnabled("OfficeVSO:6329027_UpdateMergeCountWhenWebMethodReturnsWithErrors")||this.$.oa.Ir(this.BBa);this.$.da.Za(292,Lc=>{Lc.gYa(this.hCb);d.ULS.sendTraceTag(588276809,0,50,"PendingMergeMonitor initialized")})}gYa(Ub){this.addHandler("MCU",Ub)}Wab(Ub){this.removeHandler("MCU",Ub)}get QZ(){return this.c1}eya(Ub,Lc=""){const hd=this.c1.Current<Ub.Current||this.c1.Pending<Ub.Pending;if(Ub.SuspensionStartTimestamp&&this.Uhc!==
Ub.SuspensionStartTimestamp){if(this.Uhc>Ub.SuspensionStartTimestamp){hd&&d.ULS.sendTraceTag(553736149,0,50,`PendingMergeMonitor.OnMergeCounterReceivedFromServer: skipping a higher stale counter received via ${Lc}. S: ${db.gCb(Ub)}, C: ${db.gCb(this.c1)}`);return}hd||d.ULS.sendTraceTag(553736148,0,50,`PendingMergeMonitor.OnMergeCounterReceivedFromServer: recovering from a potentially stale counter. S: ${db.gCb(Ub)}, C: ${db.gCb(this.c1)}`)}else if(!hd)return;this.c1=Ub;this.lKf(Ub,Lc)}dispose(){this.$.ea.Ik(this.Buc);
this.$.ea.pR(this.Buc);Ca.g(this.$).Xb.yl(this.h9a);bb.EwaSettings.isChangeGateEnabled("OfficeVSO:6329027_UpdateMergeCountWhenWebMethodReturnsWithErrors")||this.$.oa.qt(this.BBa);const Ub=this.$.da.za(292);Ub&&Ub.Wab(this.hCb);super.dispose()}lKf(Ub,Lc=""){ua(Ub)&&Ub.SuspensionStartTimestamp>this.Uhc&&(d.ULS.sendTraceTag(537155416,0,50,`PendingMergeMonitor.RaiseMergeCounterUpdated: Merge suspension requested. MergeCounter: ${Ea(Ub)}, Origin: ${Lc}`),this.Uhc=Ub.SuspensionStartTimestamp);this.raiseEvent("MCU",
new Ab.a(Ub))}DSf(){d.ULS.sendTraceTag(588276808,0,50,`PendingMergeMonitor.ResetMergeCounter : Last counter was ${db.gCb(this.c1)}`);this.c1=Object(vb.a)(new Oa.a,{Pending:0,Current:0,SuspensionStartTimestamp:null})}static gCb(Ub){return Ub?`(${Ub.Current}/${Ub.Pending} @${Ub.SuspensionStartTimestamp})`:"null"}}db.IZd="PMM.RTC";db.bsb="PMM.EwaResult";db.qfj="PMM.resetMergeCounter";Object(b.a)(db,"PendingMergeMonitor",rb.a,[]);class Xa{}Object(b.a)(Xa,"ClientRevisions",null,[]);var gb=a(45),Ha=a(61);
const tb=(Ub,Lc,hd,Kd,Wd,oe,We,Ze=null)=>{Ze=Ub.Na(1,Ze);Ze.viewportState=Lc;Ze.allowViewAdjustment=hd;return Ha.g(Ub,"DoPendingMerge",Ze,Kd,Wd,oe,We,0)},bc=(Ub,Lc,hd,Kd,Wd,oe,We=null)=>{We=Ub.Na(1,We);We.suspensionStartTimestamp=Lc;return Ha.g(Ub,"KeepBlockingPendingMerges",We,hd,Kd,Wd,oe,0)};class tc extends rb.a{constructor(Ub,Lc,hd,Kd){super();this.VHa=null;this.hAb=0;this.iAb=this.i7a=null;this.AAf=(Wd,oe)=>{this.VHa.eMg(oe.Mba,oe.DIg,oe.PBj)};this.HEb=(Wd,oe)=>{oe.xwa?this.eEj():this.Jxc()};
this.Qyf=()=>{this.hAb=0};this.UWf=()=>{const Wd=this.e5.$dd();bc(this.va,null!=Wd.SuspensionStartTimestamp?Wd.SuspensionStartTimestamp:0,null,()=>{this.PMi(Wd)},null,null,this.va.Sb())};this.CBa=(Wd,oe)=>{if(oe){oe.Ymb.MergeCount=this.e5.$dd();let We;({min:Wd,max:We}=Ca.g(this.$).Kzi());bb.EwaSettings.isChangeGateEnabled("OfficeVSO:5524817_LogOnMergeRaceCondition2")?oe.Ymb.ClientRevisions=Object(vb.a)(new Xa,{Min:Wd,Max:We,MaxFromBlockCache:Ca.g(this.$).Ea.Pof}):oe.Ymb.ClientRevisions=Object(vb.a)(new Xa,
{Min:Wd,Max:We})}};this.$=Ub;this.ZYa=hd;this.e5=Lc;this.e5.bGg(this.AAf);this.e5.HYb(this.HEb);this.e5.lFg(this.Qyf);this.$.oa.mga(this.CBa);this.va=this.$.oa.va;this.SJd=this.$.ya.MergeSuspensionRequestThrottlingTimeInMs;this.Xoi=this.$.ya.KeepBlockingPendingMergesRequestIntervalMs;this.VHa=Kd;d.ULS.sendTraceTag(588276807,0,50,"RequestController initialized")}dispose(){this.$.oa.qma(this.CBa);this.Jxc();this.e5.Qbj(this.AAf);this.e5.Prc(this.HEb);this.e5.lbj(this.Qyf);this.e5=null;super.dispose()}eEj(){this.Jxc();
if(this.GGe()){const Ub=this.e5.$dd();d.ULS.sendTraceTag(537155414,0,50,`RequestController.StartKeepBlockingPendingMergesTimer: Prevented starting StartKeepBlockingPendingMergesTimer because of repeated failure in counter ${Ea(Ub)} fail count: ${this.hAb}`)}else this.iAb=this.ZYa.create(this.UWf,this.SJd,gb.a.iAb),this.i7a=this.ZYa.FE(this.UWf,this.Xoi,gb.a.i7a)}Jxc(){this.i7a&&(this.iAb.cancel(),this.i7a.cancel(),this.i7a=this.iAb=null)}PMi(Ub){let Lc;Lc=" fail count: "+this.hAb;this.hAb++;this.GGe()&&
this.Jxc();d.ULS.sendTraceTag(542229773,0,10,`RequestController.OnKeepBlockingPendingMergesRequestFailed: request failed ${Ea(Ub)}${Lc}`)}GGe(){return this.hAb>tc.uyi}}tc.uyi=5;Object(b.a)(tc,"RequestController",rb.a,[]);var Ma=a(155),Tb=a(194),zb=a(28),ic=a(280);class Qb extends Sys.EventArgs{constructor(Ub,Lc){super();this.qpf=Ub;this.QZ=Lc}}Object(b.a)(Qb,"MergeDidntOccurEventArgs",Sys.EventArgs,[]);class wb extends rb.a{constructor(Ub,Lc,hd=null,Kd=null,Wd=null){super();this.Thc=null;this.eBd=
0;this.documentVisibilityObserver=null;this.rif=!1;this.va=Ub;this.SJd=Lc.ya.MergeSuspensionRequestThrottlingTimeInMs;const oe=Lc.ya.GetRangeContentPrefetchDelayForMergeInMs;this.ry=()=>{Lc.CVf(oe)};this.Lh=hd||zb.a.Wa;this.yeg=0;this.nL=Kd;this.Kza=Wd;Lc.da.Za(291,We=>{this.documentVisibilityObserver=We})}get jLa(){return 0<this.eBd}mFg(Ub){this.addHandler(wb.wvd,Ub)}mbj(Ub){this.removeHandler(wb.wvd,Ub)}Ame(Ub){this.addHandler(wb.rvd,Ub)}XPf(Ub){this.removeHandler(wb.rvd,Ub)}get isDocumentHidden(){return!!this.documentVisibilityObserver&&
this.documentVisibilityObserver.Ii}eMg(Ub,Lc,hd=!1){this.dLb(Ub,Lc,hd)?(new Ma.a).setResult(!0):(Lc=this.QWi(Ub,Lc),this.Thc=Ub,this.eBd++,Lc.continueWith(()=>{this.oIi()},0,Tb.a.none,this.nL))}QWi(Ub,Lc){this.yeg=this.Lh.gea;this.rif=Lc;d.ULS.sendTraceTag(554767493,0,50,`DoPendingMergeSender.performDoPendingMergeInternal: Sending DoPendingMerge ${Ub.Current} / ${Ub.Pending} @${Ub.SuspensionStartTimestamp}. allowSelectionAdjustment: ${Lc}`);this.isDocumentHidden||this.ry();return this.amj(Lc,Ub)}dLb(Ub,
Lc,hd=!1){if(this.Kza&&!Lc&&!this.Kza.emi())return d.ULS.sendTraceTag(523317956,0,50,"DoPendingMergeSender.shouldThrottle: We can't retrieve selection and selection adjustments are disallowed."),!0;if(!this.Thc||Ub.SuspensionStartTimestamp>this.Thc.SuspensionStartTimestamp)return this.jLa&&d.ULS.sendTraceTag(523551556,0,50,`DoPendingMergeSender.shouldThrottle: Allowing request for new suspension while previous is ongoing, new counter: ${Ub.Current} / ${Ub.Pending} @${Ub.SuspensionStartTimestamp}`),
!1;if(this.jLa)return!0;if(hd)return!1;hd=this.Thc;const Kd=this.Lh.gea-this.yeg<this.SJd;Lc=this.rif===Lc;return(Ub||hd?Ub&&hd?Ub.Current===hd.Current&&Ub.Pending===hd.Pending&&Ub.SuspensionStartTimestamp===hd.SuspensionStartTimestamp:!1:!0)&&Kd&&Lc}amj(Ub,Lc){const hd=this.va.Sb(),Kd=()=>{d.ULS.sendTraceTag(588276806,0,10,`DoPendingMergeSender.sendDoPendingMergeRequest: request failed ${Lc.Current} / ${Lc.Pending} @${Lc.SuspensionStartTimestamp}`)};return this.Kza?this.Kza.yij(this.aMh(Ub,Kd,hd)):
this.Oue(null,!0,void 0,Kd,hd)}aMh(Ub,Lc,hd){return(Kd,Wd,oe)=>{let We=void 0;d.ULS.shipAssertTag(523317955,0,null!=Kd||Ub,"!allowSelectionAdjustment requires a non-null initialViewportState.");We=this.pIi.bind(this);Wd&&(We=ic.b.call(null,Ze=>{const Be=Ze.Result;let af=null===Be||void 0===Be?void 0:Be.AdjustedViewportState;3===(null===Be||void 0===Be?void 0:Be.MergeResultState)&&(af=void 0);Wd(af,Ze.StateId)},We));oe&&(Lc=ic.a.call(null,oe,Lc));return this.Oue(Kd,Ub,We,Lc,hd)}}Oue(Ub,Lc,hd,Kd,Wd){return tb(this.va,
Ub,Lc,hd,Kd,null,null,Wd)}pIi(Ub){var Lc=Ub.Result;void 0!=Lc&&(Lc=Lc.MergeResultState,bb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.RetryDoPendingMergeAfterBailout",!1)&&2!==Lc?this.S2i(Lc,Ub.MergeCount):3===Lc&&(d.ULS.sendTraceTag(523317954,0,50,"DoPendingMergeSender.onDoPendingMergeSucceeded: Aborted merge."),this.T2i()))}T2i(){this.raiseEvent(wb.wvd,new Sys.EventArgs)}S2i(Ub,Lc){this.raiseEvent(wb.rvd,new Qb(Ub,Lc))}oIi(){this.eBd--}}wb.wvd="MWA";wb.rvd="MDO";Object(b.a)(wb,"DoPendingMergeSender",
rb.a,[719,720]);class hc{constructor(Ub=!1){this.divergenceOnResponse=this.adjustedDidntChangeWithDivergence=this.editBoxDivergence=this.differentSheetAdjust=this.parallel=this.errors=this.nonContinuous=this.divergenceOnViewportReady=this.adjusted=this.adjustedDidntChange=0;this.v7h=Ub}get reportName(){return this.v7h?"SelectionAdjustInHiddenDocument":"SelectionAdjust"}}Object(b.a)(hc,"SelectionAdjustSessionEndsReport",null,[734]);var Za=a(43),ub=a(97);class uc{constructor(Ub,Lc,hd,Kd,Wd,oe){this.bJ=
void 0;this.jb=Ub;this.sG=Lc;this.A8=hd;this.qVb=Kd;this.m0d=Wd;bb.EwaSettings.isChangeGateEnabled("OfficeVSO:6592063_GetIndexOfActiveRangeFromInitialSelection_V2")&&(this.bJ=oe)}get activeCell(){return this.sG}get selectedRanges(){return this.A8}get Xr(){let Ub=!1;if(null===this.bJ||void 0===this.bJ)Ub=!0;else if(this.bJ>=this.selectedRanges.length||!this.selectedRanges[this.bJ].contains(this.activeCell))d.ULS.sendTraceTag(521200010,0,50,`SelectionState.indexOfActiveRange: the index of the adjusted active range has changed. indexOfActiveRange: ${this.bJ}, selectedRangesLength: ${this.selectedRanges.length}`),
Ub=!0;Ub&&(this.bJ=this.bTg());return this.bJ}get activeRange(){return 0>this.Xr?this.activeCell:this.selectedRanges[this.Xr]}get sheetName(){return this.qVb}get activeItemName(){return this.m0d}get Big(){return 1===this.selectedRanges.length}yfg(Ub){let Lc=this.selectedRanges.map(hd=>this.KMj(hd,this.m0d));for(let hd of Lc)if(hd)for(let Kd of hd)if(Kd.Dk&&Kd.se.Revision<Ub)return!1;return!0}OJj(){var Ub;return{SheetName:this.sheetName,ActiveCell:null===(Ub=this.activeCell)||void 0===Ub?void 0:Ub.toString(),
TopLeft:void 0,SelectedRanges:Za.r(this.selectedRanges,this.jb)}}toString(){var Ub,Lc;return`active cell: ${null!==(Lc=null===(Ub=this.activeCell)||void 0===Ub?void 0:Ub.toString())&&void 0!==Lc?Lc:"null"} selection: ${cc.f(this.selectedRanges,hd=>{var Kd;return null!==(Kd=null===hd||void 0===hd?void 0:hd.toString())&&void 0!==Kd?Kd:"null"}).join(",")}`}equals(Ub){return Ub?this.activeCell.equals(Ub.activeCell)&&Za.Q(this.selectedRanges,Ub.selectedRanges)&&this.sheetName===Ub.sheetName:!1}bTg(){for(let [Ub,
Lc]of this.selectedRanges.entries())if(null===Lc||void 0===Lc?0:Lc.contains(this.activeCell))return Ub;return-1}KMj(Ub,Lc){var hd;const Kd=Ca.g(this.jb).Ea.Y2a(Ub,Lc);Kd||d.ULS.sendTraceTag(522803340,0,50,`SelectionState.tryGetBlockCacheItemsFromRange: no items found. range: ${null!==(hd=null===Ub||void 0===Ub?void 0:Ub.toString())&&void 0!==hd?hd:"null"} ; activeItemNameIsDefined: ${!!Lc}`);return Kd}}Object(b.a)(uc,"SelectionState",null,[]);var Oc=a(201),Bb=a(735);class Nb{constructor(Ub){this.Exc=
0;this.FA=this.lF=null;this.C0d=new hc;this.D0d=new hc(!0);this.SH=0;this.WHj=!1;this.Ozi=1E4;this.$c=()=>{this.LDe()};this.Li=()=>{this.lWc(!0,!1)};this.Z8a=()=>{this.lWc(!1,!1)};this.$=Ub;this.gridView=Ca.g(this.$);this.gridView.Ea.kx(this.Li);this.gridView.Ea.Ks(this.Z8a);this.gridView.Ea.Jle(this.Z8a);this.gridView.Ea.jga(this.Z8a);bb.EwaSettings.isChangeGateEnabled("OfficeVSO:6385622_SelectionAdjustImplementsCustomReportManager")&&this.$.el(this.$c);this.LDe()}yij(Ub){let Lc=null,hd=null,Kd=
()=>{this.YEi()};this.oaf()?(this.fP.parallel++,d.ULS.sendTraceTag(526390086,0,15,`SelectionAdjustManager.runRequestWithSelectionAdjust: Skipping parallel request. Current adjustedSelection is defined : ${!!this.FA}`)):(Lc=(Wd,oe)=>{this.ZEi(Wd,oe)},hd=this.Drj());return null===Ub||void 0===Ub?void 0:Ub(hd,Lc,Kd)}emi(){return!this.oaf()&&this.faa().Big}Drj(){var Ub;d.ULS.shipAssertTag(525135961,0,0===this.SH,"SelectionAdjustManager.setPreRequestState: unexpected state");this.FA&&(this.fP.errors++,
d.ULS.sendTraceTag(526960090,0,10,`SelectionAdjustManager.setPreRequestState: About to ignore a defined Adjusted selection: ${this.FA.toString()}`));this.FA=null;this.lF=this.faa();let Lc=null;const hd=null===(Ub=this.lF)||void 0===Ub?void 0:Ub.OJj();hd&&(Lc={ActiveSheetName:this.lF.sheetName,SheetViewportStateChanges:[hd]});this.SH=1;return Lc}YEi(){d.ULS.shipAssertTag(525135960,0,1===this.SH,"SelectionAdjustManager.onAdjustedRequestFailed: unexpected state");this.fP.errors++;this.SH=2;this.ir()}ZEi(Ub,
Lc){try{d.ULS.shipAssertTag(525135959,0,1===this.SH,"SelectionAdjustManager.onAdjustedSelectionReady: unexpected state"),this.Exc=Lc,Lc=2,this.lF?Ub?(this.FA=this.cvj(Ub))?(Lc=7,this.lF.equals(this.FA)?this.lF.equals(this.faa())?(this.fP.adjustedDidntChange++,Lc=4):(this.fP.adjustedDidntChangeWithDivergence++,Lc=5):this.lF.sheetName!=this.FA.sheetName?(this.fP.differentSheetAdjust++,Lc=10):this.lF.equals(this.faa())||(this.fP.divergenceOnResponse++,Lc=6,this.hRf())):this.fP.errors++:(this.fP.errors++,
d.ULS.sendTraceTag(537155412,0,15,`SelectionAdjustManager.OnAdjustedSelectionReady: Adjusted returned null, initialSelection: ${this.lF.toString()}`)):(this.fP.errors++,d.ULS.sendTraceTag(537155413,0,10,`SelectionAdjustManager.OnAdjustedSelectionReady: Adjusted selection results returned when not waiting for them, adjusted:  ActiveCell: ${null===Ub||void 0===Ub?void 0:Ub.ActiveCell}`)),this.SH=Lc}catch(hd){this.SH=12,d.ULS.sendTraceTag(525135958,0,10,`SelectionAdjustManager.OnAdjustedSelectionReady: caught Exception ${hd}`)}finally{7!=
this.SH?this.ir():this.lWc(!1,!0)}}dispose(){this.gridView.Ea.sv(this.Li);this.gridView.Ea.Nq(this.Z8a);this.gridView.Ea.kPf(this.Z8a);this.gridView.Ea.Mab(this.Z8a);bb.EwaSettings.isChangeGateEnabled("OfficeVSO:6385622_SelectionAdjustImplementsCustomReportManager")&&this.$.Al(this.$c)}oaf(){return 1===this.SH||7===this.SH}cvj(Ub){let Lc;if(!({range:Lc}=Za.Z(Ub.ActiveCell,this.$.xa)).returnValue)return d.ULS.sendTraceTag(537155411,0,10,`SelectionAdjustManager.sheetViewportStateToSelectionState: Unable to extract active cell ${Ub.ActiveCell}`),
null;let hd=[];const Kd=this.$.pa,Wd=!!Kd&&2===Kd.aG;if(Ub.SelectedRanges)hd=Za.g(Ub.SelectedRanges.Ranges);else if(!Wd)return d.ULS.sendTraceTag(522826913,0,10,`SelectionAdjustManager.sheetViewportStateToSelectionState: SelectedRanges is null, active sheet exists: ${!!Kd}`),null;return new uc(this.$,Lc,hd,Ub.SheetName,this.lF.activeItemName,this.lF.Xr)}faa(){const Ub=this.$.pa;if((null===Ub||void 0===Ub?0:Ub.activeCell)&&Ub.selectedRanges&&Ub.sheetName)return new uc(this.$,Ub.activeCell,Ub.selectedRanges,
Ub.sheetName,this.$.activeItemName,Ub.Xr);d.ULS.sendTraceTag(525135957,0,15,`SelectionAdjustManager.getCurrentSelection: invalid activeItem. activeItem null: ${!Ub}, activeCell null: ${!(null===Ub||void 0===Ub?0:Ub.activeCell)}, selectedRanges null: ${!(null===Ub||void 0===Ub?0:Ub.selectedRanges)}, sheetName null: ${!(null===Ub||void 0===Ub?0:Ub.sheetName)}`);return null}LDe(){this.$.da.Za(276,()=>{const Ub=Oc.a(this.$);Ub.FX(this.C0d);Ub.FX(this.D0d)})}lWc(Ub,Lc){var hd;if(this.tki(Ub))if(8===this.SH)d.ULS.sendTraceTag(523106438,
0,15,"SelectionAdjustManager.attemptAdjustSelection: skipping as was already adjusted");else{Lc&&d.ULS.sendTraceTag(524039250,0,50,"SelectionAdjustManager.attemptAdjustSelection: viewport ready on response");try{d.ULS.shipAssertTag(525135956,0,7===this.SH,"SelectionAdjustManager.attemptAdjustSelection: unexpected state"),this.lF.equals(this.faa())?(null===(hd=this.gridView)||void 0===hd?0:hd.eb)?(this.fP.editBoxDivergence++,this.SH=11):(Ub=0,Ub=this.FA.Xr,-1==Ub?(this.fP.errors++,d.ULS.sendTraceTag(522826912,
0,10,"SelectionAdjustManager.attemptAdjustSelection: invalid indexOfActiveRange")):(this.fP.adjusted++,this.SH=8,bb.EwaSettings.isChangeGateEnabled("OfficeVSO:6413876_AdjustSelectionWithoutCallingGoto")?this.gridView.ha.Lw(this.FA.selectedRanges,Ub,this.FA.activeCell,0,void 0,ub.a.DWf):this.gridView.WY(this.FA.selectedRanges,Ub,this.FA.sheetName,null,this.FA.activeCell,null,null,0,ub.a.DWf))):(this.fP.divergenceOnViewportReady++,this.hRf(),this.SH=9)}catch(Kd){this.SH=12,d.ULS.sendTraceTag(525135955,
0,10,`SelectionAdjustManager.attemptAdjustSelection: caught Exception ${Kd}`)}finally{this.ir()}}}tki(Ub){if(!this.FA)return!1;if(!this.lF)return d.ULS.sendTraceTag(537155409,0,10,`SelectionAdjustManager.attemptAdjustSelection: initialSelection is null while adjustedSelection isn't null, adjustedSelection: ${this.FA.toString()}`),!1;if(Ca.g(this.$).Ea.Pof<this.Exc)return!1;if(Ub||this.WHj)d.ULS.sendTraceTag(528590295,0,15,"SelectionAdjustManager.attemptAdjustSelection: got to blockCacheConsistent while pending for selection adjust");
else if(!this.lF.yfg(this.Exc)||!this.FA.yfg(this.Exc))return!1;return!0}ir(){this.lF=this.FA=null;this.SH=0}hRf(){const Ub=this.faa();d.ULS.sendTraceTag(537155408,0,50,`SelectionAdjustManager.ReportDivergence: initial: ${this.lF.toString()} current: ${Ub?Ub.toString():""} adjusted: ${this.FA.toString()} sheetSameBetweenInitialAndAdjusted: ${this.lF.sheetName===this.FA.sheetName} sheetSameBetweenInitialAndCurrent: ${this.lF.sheetName===(Ub?Ub.sheetName:null)}`)}get fP(){return Bb.a.bD(this.Ozi)?this.D0d:
this.C0d}}Object(b.a)(Nb,"SelectionAdjustManager",null,[718,2]);class dc extends Ya.a{constructor(Ub,Lc,hd=null){super();this.jCa=this.ndc=this.S4a=this.c_a=null;d.ULS.sendTraceTag(537155417,0,50,"MergeSuspensionManager.ctor started");this.$=Ub;this.nWa=new db(Ub);this.Kza=new Nb(this.$);this.VHa=new wb(this.$.oa.va,this.$,void 0,void 0,this.Kza);this.W8h(Ub,hd);this.ifa=new va(this.jCa,this.nWa,this.VHa);this.NJd=new tc(Ub,this.ifa,Lc,this.VHa);bb.EwaSettings.ma(254)&&(this.ndc=new Sa(Ub,this));
d.ULS.sendTraceTag(588276810,0,50,"MergeSuspensionManager created")}HYb(Ub){this.ifa.HYb(Ub)}Prc(Ub){this.ifa&&this.ifa.Prc(Ub)}get cha(){return this.jCa}get Qla(){return this.nWa}get e5(){return this.ifa}hza(Ub,Lc){this.jCa.hza(Ub,Lc)}$Wd(Ub){this.jCa.$Wd(Ub)}eya(Ub,Lc=""){this.nWa.eya(Ub,Lc)}dispose(){this.ndc&&(this.ndc.dispose(),this.ndc=null);this.Kza&&this.Kza.dispose();this.VHa.dispose();this.NJd&&(this.NJd.dispose(),this.NJd=null);this.ifa&&(this.ifa.dispose(),this.ifa=null);this.nWa.dispose();
this.nWa=null;this.jCa.dispose();this.jCa=null;this.c_a&&(this.c_a.dispose(),this.c_a=null);this.S4a&&(this.S4a.dispose(),this.S4a=null);this.$=null;super.dispose()}yGb(){this.ifa.s3i()}static K9b(Ub){let Lc=0;for(let hd of Ub){if(2==hd)return 2;1==hd&&(Lc=1)}return Lc}W8h(Ub,Lc){this.jCa=new ma(this.VHa,this.nWa);Lc?Object(sa.a)(Ua,Lc)?this.hza(Lc,Object(U.a)(Ua,Lc).cI):Object(sa.a)(Kb,Lc)?this.hza(Lc,Object(U.a)(Kb,Lc).cI):this.hza(Lc,0):(this.c_a=new Kb(Ub),this.S4a=new Ua(Ub),this.hza(this.c_a,
this.c_a.cI),this.hza(this.S4a,this.S4a.cI))}}Object(b.a)(dc,"MergeSuspensionManager",Ya.a,[694,2]);class sc extends Y.a{constructor(Ub){super();this.Jc=Ub;this.Fb()}create(){d.ULS.sendTraceTag(537155419,0,50,"MergeSuspensionFactory.Create");this.qb(this.Jc.da.za(343)||this.Jc.da.Ga(343,new dc(this.Jc,wa.a.instance)))}static ka(Ub){d.ULS.sendTraceTag(537155418,0,50,"MergeSuspensionFactory.Attach");Ub.da.Ga(344,new sc(Ub))}}Object(b.a)(sc,"MergeSuspensionFactory",Y.a,[]);var yc=a(50),cd=a(37),pd=a(86),
Rb=a(98),Dc=a(58),nd=a(14);class od{}od.Gri=3;od.connected=0;Object(b.a)(od,"ConnectionStateConstants",null,[]);var wd=a(111),Pc=a(118),Hb=a(42);class Nc{constructor(Ub,Lc,hd){var Kd;this.type=0;this.startTime=null;this.blockedOperationsCount=this.durationMs=0;this.blockedActions=null;this.blockedUserOperationsWhileToastShown=this.durationUntilToastShownMs=0;this.toastRaiser=null;this.wasUserActiveOnPIEnd=this.wasUserActiveOnPIStart=this.hasTabbedOut=this.isToastShown=!1;this.durationUntilUserInactive=
-1;this.isTaskPaneCollapsed=this.isTaskPaneShown=this.isDialogShown=!1;this.Ptf=(Wd,oe)=>{this.blockedOperationsCount++;Wd=`${oe.componentName}_${oe.actionName}_${oe.details})`;this.blockedActions[Wd]=this.blockedActions[Wd]?this.blockedActions[Wd]+1:1;this.isToastShown&&this.blockedUserOperationsWhileToastShown++};this.aBd=Wd=>{this.durationUntilUserInactive=wd.getElapsedSeconds(this.startTime,zb.a.Wa.Nb);Wd.UId(this.aBd)};this.t5=()=>{this.hasTabbedOut=!0};this.bca=(Wd,oe)=>{oe.tFf!==this.type||
this.isToastShown||(this.durationUntilToastShownMs=Pc.a(zb.a.Wa,this.startTime),this.toastRaiser=oe.toastRaiser,this.isToastShown=!0)};this.startTime=Ub;this.durationUntilToastShownMs=0;this.blockedActions={};this.isToastShown=hd;if(null===(Kd=Lc.ea)||void 0===Kd?0:Kd.jf)this.wasUserActiveOnPIStart=Lc.ea.jf.cs;this.Bj(Lc);this.isDialogShown=0<Lc.rb.eR;Ub=Lc.da.za(183);this.isTaskPaneShown=!!Ub&&Ub.isVisible&&!Ub.isCollapsed;this.isTaskPaneCollapsed=!!Ub&&Ub.isVisible&&Ub.isCollapsed}HYf(){this.durationMs=
Pc.a(zb.a.Wa,this.startTime)}jAd(Ub){var Lc;this.HYf();Hb.a(Ub).Jrc(this.Ptf);Hb.a(Ub).Vf.Krc(this.bca);Ub.da.Za(291,hd=>{hd.Oab(this.t5)});if(null===(Lc=Ub.ea)||void 0===Lc?0:Lc.jf)Ub.ea.jf.UId(this.aBd),this.wasUserActiveOnPIEnd=Ub.ea.jf.cs}Bj(Ub){Hb.a(Ub).xYb(this.Ptf);this.isToastShown?this.toastRaiser="Immediate":Hb.a(Ub).Vf.hUc(this.bca);Ub.da.Za(291,Lc=>{this.hasTabbedOut=Lc.Ii;Lc.ZXa(this.t5)});this.wasUserActiveOnPIStart&&Ub.ea.jf.nne(this.aBd)}}Object(b.a)(Nc,"PartialInteractivityData",
null,[]);var Db=a(1110);class Cc extends Nc{constructor(Ub,Lc,hd,Kd,Wd,oe){super(Ub,Lc,Kd);this.swappedOffline=this.swappedByOffline=!1;this.lastFailedRequestToOnlineTimeGapSec=this.longestDurationBetweenFailedRequestsSec=this.averageDurationBetweenFailedRequestsSec=0;this.errorDataDuringConnectivityIssuesMode=this.disconnectionSource=null;this.failedRequests=[];this.triggeringRequest=null;this.type=4;this.swappedOffline=hd;this.disconnectionSource=Enum.toString(Db.a,Wd);this.triggeringRequest=oe}mHi(Ub,
Lc){this.swappedByOffline=Lc;this.jAd(Ub)}vpj(Ub){this.errorDataDuringConnectivityIssuesMode=Ub}I5i(Ub){10>this.failedRequests.length&&(Ub=Ub+"_"+wd.getElapsedSeconds(this.startTime,zb.a.Wa.Nb).toString(),this.failedRequests.push(Ub))}}Object(b.a)(Cc,"ConnectivityIssuesData",Nc,[]);var Xc=a(157),ld=a(125),Dd=a(112);class Od{}Od.Phh="DuringWork";Od.connectivityIssues="ConnectivityIssues";Od.offline="Offline";Object(b.a)(Od,"UnavailabilityTypes",null,[]);var Qd=a(51);class Nd{constructor(Ub){this.Ohc=
this.data=null;this.H9c=0;this.tAe=null;this.Zuf=(Lc,hd)=>{hd.UL?(this.data=new Cc(zb.a.Wa.Nb,this.$,5===hd.Dna,0!==hd.Dna,this.$.Rf.disconnectionSource,this.tAe),this.Ohc=this.$.Rf.hjf,this.H9c=1,this.$.oa.Rf.dHg(this.Un),Xc.a(this.$).PTc(this.SUf)):(this.data.mHi(this.$,5===hd.Dna),this.$.oa.Rf.sQf(this.Un),this.data.lastFailedRequestToOnlineTimeGapSec=wd.getElapsedSeconds(this.Ohc,zb.a.Wa.Nb),bb.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_7pzab_ConnectivityIssues")?
Qd.b().IJb(557682689,0,50,Od.connectivityIssues,this.data.durationMs,"ConnectivityIssuesTelemetryManager.OnConnectivityIssuesEnded: this partial interactivity's info: {0}",Dc.a.Ac(this.data)):d.ULS.sendTraceTag(557682689,0,50,`ConnectivityIssuesTelemetryManager.OnConnectivityIssuesEnded: this partial interactivity's info: ${Dc.a.Ac(this.data)}`),this.data&&this.data.isToastShown&&Rb.Health.instance.recordQosError(ld.a.ZXg,[Dd.a.wic],!0,!1,!1,!1,null),Xc.a(this.$).nId(this.SUf),this.data=null)};this.SUf=
(Lc,hd)=>{this.data.vpj(hd.kU)};this.Un=(Lc,hd)=>{this.data.I5i(hd.context.methodName);Lc=zb.a.Wa.Nb;hd=wd.getElapsedSeconds(this.Ohc,Lc);this.Ohc=Lc;hd>this.data.longestDurationBetweenFailedRequestsSec&&(this.data.longestDurationBetweenFailedRequestsSec=hd);this.H9c++;this.data.averageDurationBetweenFailedRequestsSec=this.QSg(hd)};this.Wuf=(Lc,hd)=>{this.tAe=hd.hMj};this.$=Ub;Hb.a(this.$).Vf.Sle(this.Zuf);this.$.Rf.Rle(this.Wuf)}dispose(){this.$&&(Hb.a(this.$).Vf.uPf(this.Zuf),this.$.Rf&&this.$.Rf.tPf(this.Wuf));
this.data&&this.$.oa.Rf.sQf(this.Un);this.$=null}QSg(Ub){const Lc=this.H9c-1;return(this.data.averageDurationBetweenFailedRequestsSec*(Lc-1)+Ub)/Lc}}Object(b.a)(Nd,"ConnectivityIssuesTelemetryManager",null,[2]);var he=a(843),ve=a(127),Td=a(781);class ke{constructor(Ub){this._count=0;this.sessionID=this.allOfflinePartialInteractivitiesDataInSession=null;this.allOfflinePartialInteractivitiesDataInSession=[];this.sessionID=Ub}get count(){return this._count}get OT(){return this.allOfflinePartialInteractivitiesDataInSession[this.allOfflinePartialInteractivitiesDataInSession.length-
1]}HQj(){this.OT&&this.OT.HYf()}BBg(Ub){this.allOfflinePartialInteractivitiesDataInSession.push(Ub);this._count++}}Object(b.a)(ke,"OfflinePartialInteractivitiesDataForLog",null,[]);class xe extends Nc{constructor(Ub,Lc,hd){super(Ub,Lc,hd);this.timeFromLastOffline=0;this._errorDataDuringOfflineMode=null;this.timeFromLastOffline=-1;this.type=5}Ysj(Ub){this.timeFromLastOffline=Ub}wpj(Ub){this._errorDataDuringOfflineMode=Ub}}Object(b.a)(xe,"OfflinePartialInteractivityData",Nc,[]);class le{constructor(Ub,
Lc){this.RNa=this.OT=null;this.$Dd=-1;this.xtb=null;this.bjf=w.Task.delay(0);this.z9a=(hd,Kd)=>{Kd.UL?this.uOi(Kd.Dna):this.vOi()};this.bca=(hd,Kd)=>{5===Kd.tFf&&this.r2a()};this.TUf=(hd,Kd)=>{this.OT.wpj(Kd.kU)};this.r2a=()=>{this.RNa.HQj();this.tjj(le.cCd,Sys.Serialization.JavaScriptSerializer.serialize(this.RNa))};this.jej=hd=>{if(hd=hd.result)this.Qfg=!0,d.ULS.sendTraceTag(576811915,0,50,`OfflineModeTelemetryManager.ReportOfflinePartialInteractivityDataFromIDB: Previous session's offline partial interactivy data: ${hd}`)};
this.A9i=()=>{this.Qfg&&(this.$?cd.TaskExtensions.Aa(this.indexedDB.X4c(le.cCd),()=>{d.ULS.sendTraceTag(537155204,0,50,"OfflineModeTelemetryManager.RemoveDataFromIDB: Previous session's offline partial interactivy data successfuly removed from IDB.")},this.$.la):d.ULS.sendTraceTag(537155203,0,10,"OfflineModeTelemetryManager.RemoveDataFromIDB: EwaControl is null when attempting to remove offline mode data stored in IDB."))};this.WNa=()=>{if(this.RNa&&0<this.RNa.count){const hd=Sys.Serialization.JavaScriptSerializer.serialize(this.RNa);
d.ULS.sendTraceTag(560791644,0,50,`OfflineModeTelemetryManager.OnBeforeUnload: This session's offline partial interactivy data: ${hd}`)}};this.$=Ub;this.indexedDB=Lc;this.Qfg=!1;this.indexedDB.If()&&(this.indexedDB.initialize(le.Tjd,le.Ujd),this.Hdj(),this.RNa=new ke(this.$.ya.UserSessionId),Hb.a(this.$).Vf.$Tc(this.z9a));this.tm=ve.a.instance.aH();this.tm.ka("beforeunload",this.WNa)}dispose(){this.$&&Hb.a(this.$)&&Hb.a(this.$).Vf.zId(this.z9a);pd.a.Ia(this.xtb);this.$=this.xtb=null}uOi(Ub){this.OT=
new xe(zb.a.Wa.Nb,this.$,0!==Ub);this.OT.Ysj(-1!==this.$Dd?window.performance.now()-this.$Dd:-1);this.RNa.BBg(this.OT);Hb.a(this.$).Vf.hUc(this.bca);this.r2a();this.xtb=wa.a.instance.FE(this.r2a,le.oBh,gb.a.r2a);Xc.a(this.$).PTc(this.TUf)}vOi(){this.OT.jAd(this.$);this.r2a();pd.a.Ia(this.xtb);this.xtb=null;this.$Dd=window.performance.now();Hb.a(this.$).Vf.Krc(this.bca);Xc.a(this.$).nId(this.TUf);this.Mdj()}tjj(Ub,Lc){this.$?this.bjf=cd.TaskExtensions.Aa(this.bjf,()=>{this.indexedDB.Nbb(new Td.a(Ub,
Lc))},this.$.la):d.ULS.sendTraceTag(537155205,0,15,"OfflineModeTelemetryManager.SaveToIndexedDBSequential: EwaControl is null when attempting to write to IDB")}Hdj(){const Ub=this.$.la;cd.TaskExtensions.Aa(cd.TaskExtensions.Aa(this.indexedDB.x3a(le.cCd),this.jej,Ub),this.A9i,Ub)}Mdj(){if(this.OT){const Ub=Sys.Serialization.JavaScriptSerializer.serialize(this.OT);bb.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_71qb3_Offline")?Qd.b().IJb(560791645,0,50,Od.offline,this.OT.durationMs,
"OfflineModeTelemetryManager.ReportCurrentOfflinePartialInteractivityData: Ending offline partial interactivy data: {0}",Ub):d.ULS.sendTraceTag(560791645,0,50,`OfflineModeTelemetryManager.ReportCurrentOfflinePartialInteractivityData: Ending offline partial interactivy data: ${Ub}`)}this.OT&&this.OT.isToastShown&&Rb.Health.instance.recordQosError(ld.a.yUj,[Dd.a.wic],!0,!1,!1,!1,null)}}le.Tjd="NetworkAvailability";le.Ujd="NetworkAvailabilityData";le.cCd="partialInteractivityData";le.oBh=3E3;Object(b.a)(le,
"OfflineModeTelemetryManager",null,[2]);class Je{constructor(Ub,Lc){this.Wka=this.$Bi=this.Jsf=null;this.$=Ub;bb.EwaSettings.isChangeGateEnabled("OfficeVSO:4956381_DisableNetworkLoggingInFirefox")&&W.a.Tf||(this.Jsf=new le(Ub,Lc));!bb.EwaSettings.ma(554)||bb.EwaSettings.isChangeGateEnabled("OfficeVSO:4956381_DisableNetworkLoggingInFirefox")&&W.a.Tf||(this.Wka=new he.NetworkConnectionHealthChecker(this.$));this.L0g=new Nd(this.$)}dispose(){pd.a.Ia(this.Jsf);pd.a.Ia(this.$Bi);pd.a.Ia(this.Wka);pd.a.Ia(this.L0g);
this.$=null}}Object(b.a)(Je,"NetworkConnectionTelemetryManager",null,[2]);class Fe extends Nc{constructor(Ub,Lc,hd,Kd){super(Ub,Lc,hd);this.wasInteruptedByOfflineMode=!1;this.type=Kd;this.wasInteruptedByOfflineMode=!1}z9a(){this.wasInteruptedByOfflineMode=!0}}Object(b.a)(Fe,"SilentReopenData",Nc,[]);class eb{constructor(Ub){this.R6=null;this.vCf=(Lc,hd)=>{this.sCf(hd,3)};this.Kyf=(Lc,hd)=>{this.sCf(hd,2)};this.$=Ub;this.Vf=Hb.a(this.$).Vf;this.Vf.xme(this.Kyf);this.Vf.GGg(this.vCf)}dispose(){this.Vf.VPf(this.Kyf);
this.Vf.qcj(this.vCf);this.R6=this.Vf=this.$=null}sCf(Ub,Lc){Ub.UL?this.R6=new Fe(zb.a.Wa.Nb,this.$,0!==Ub.Dna,Lc):(5===Ub.Dna&&(this.R6.wasInteruptedByOfflineMode=!0),3!==Ub.Dna&&2!==Ub.Dna||d.ULS.sendTraceTag(537155202,0,10,"SilentReopenPartialInteractivityTelemetryManager.OnSilentReopen: BackToWork/DuringWork partial interactivity has been swapped to DuringWork/BackToWork."),this.R6.jAd(this.$),2===Lc?bb.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_8dtae_B2W")?Qd.b().JJb(571289604,
0,50,Od.offline,this.R6.durationMs,this.R6):d.ULS.sendTraceTag(571289604,0,50,Dc.a.Ac(this.R6)):bb.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_6w9lg_DuringWork")?Qd.b().JJb(542782150,0,50,Od.Phh,this.R6.durationMs,this.R6):d.ULS.sendTraceTag(542782150,0,50,Dc.a.Ac(this.R6)),this.R6=null)}}Object(b.a)(eb,"SilentReopenPartialInteractivityTelemetryManager",null,[2]);class Xb extends rb.a{constructor(Ub,Lc,hd=!0){super();this.c0=this.n2b=this.SNa=this.nna=this.VRa=null;
this.Tqf=0;this.Jqc=this.Cab=this.Dab=!1;this.Uqf=this.documentVisibilityObserver=null;this.Ipa=!1;this.Kjd=this.a7=0;this.ozb=!1;this.b4f=0;this.cQd=!1;this.p0=null;this.tzf=()=>{d.ULS.sendTraceTag(537155219,0,50,"NetworkConnectionStateManager.OnNetworkDownEvent: Network down.");this.hkc(1,!1)};this.pla=()=>{this.Wja||this.DBb?window.setTimeout(()=>{this.fVd()},this.Tqf):this.fVd();this.documentVisibilityObserver.Pab(this.pla);this.ozb=!1};this.Jf=()=>{d.ULS.sendTraceTag(537155218,0,50,`NetworkConnectionStateManager.OnEditEnded: Edit ended. IsInOfflineMode:${this.DBb}, IsInDuringWorkSilentReopenMode:${this.fjc&&
!this.Ipa}`);this.DBb&&this.Wie();this.fjc&&!this.Ipa&&this.Tie();Ca.g(this.$).hc.yl(this.Jf);this.Dab=this.Cab=!1};this.uzf=()=>{d.ULS.sendTraceTag(537155213,0,50,"NetworkConnectionStateManager.OnNetworkResumedEvent: network was resumed.");this.hkc(1,!0);this.Cab&&!this.Dab&&Ca.g(this.$).hc.yl(this.Jf);this.Cab=!1};this.tOa=(Kd,Wd)=>{this.Kjd=this.a7;this.a7=Wd.Vyc};this.uCf=()=>{this.$&&(this.Jqc||(sb.a(this.$).cQ(fb.a.AOa).mEg(this.Ezf),this.$.el(this.$c),this.Jqc=!0),this.Ipa=this.Tdi(),this.hkc(2,
!1))};this.Ezf=()=>{var Kd=sb.a(this.$).di;const Wd=Kd.xKg();Kd=cc.f(Kd.Bs.jd.errors,oe=>oe.MessageIdName);d.ULS.sendTraceTag(545842889,0,50,`NetworkConnectionStateManager.OnOpenWebMethodErrorUserAlertExecuting: IsStateUnrecoverable:${Wd}, IsB2W:${this.Ipa}, Errors: ${Dc.a.Ac(Kd)}`);Wd&&(this.VRa?(this.Ipa=!1,this.eFe(),this.Wzc()):this.nna&&(this.fFe(),this.Wzc()))};this.$c=()=>{this.$?(d.ULS.sendTraceTag(541193955,0,50,"NetworkConnectionStateManager.OnWorkbookOpened: Workbook opened."),this.Ipa=
!1,this.c0&&this.c0.Bq&&(pd.a.Ia(this.c0),this.c0=null),this.p0&&this.p0.Bq&&(pd.a.Ia(this.p0),this.p0=null),this.hkc(2,!0),this.Wzc()):d.ULS.sendTraceTag(537155212,0,10,"NetworkConnectionStateManager.OnWorkbookOpened: bug monitoring: EwaControl is null.")};this.Xuf=()=>{this.Rpf(!0)};this.Yuf=()=>{this.Rpf(!1)};this.iVb=od.Gri;this.Y0c=od.connected;this.$=Ub;this.Rf=Ub.oa.Rf;hd&&(this.Uqf=new Je(Ub,Lc));this.$.da.Za(291,Kd=>{this.documentVisibilityObserver=Kd});this.Tqf=this.$.ya.ExcelNetworkCheckAfterTabActivationDelayMs;
this.Rf.sFg(this.tzf);this.Rf.rYb(this.uzf);this.Rf.Rle(this.Xuf);this.Rf.TDg(this.Yuf);new eb(this.$,this);this.rmf=this.$.ya.LongInactivityTimePeriodSeconds;this.$.ea.sUc(this.uCf);this.$.ea.jf.ora(this.tOa);this.b4f=this.$.ya.SilentReopenDuringWorkDelayMs}get Ufi(){return this.Ipa}get DBb(){return!(this.iVb&1)}get fjc(){return!(this.iVb&2)}get Wja(){return!!(this.Y0c&2)}dispose(){this.Rf&&(this.Rf.rbj(this.tzf),this.Rf.Crc(this.uzf),this.Rf.tPf(this.Xuf),this.Rf.faj(this.Yuf));this.ozb&&this.documentVisibilityObserver&&
(this.documentVisibilityObserver.Pab(this.pla),this.ozb=!1);this.$&&(this.Jqc&&this.Wzc(),this.$.ea&&(this.$.ea.lQf(this.uCf),this.$.ea.jf&&this.$.ea.jf.SPa(this.tOa)));this.p0&&(this.p0.dispose(),this.p0=null);pd.a.Ia(this.Uqf);this.$=null;super.dispose()}Txi(){this.cQd=!0}Tie(){this.nna||(this.nna=Hb.a(this.$).Vf.CXa(3,"NetworkConnectionStateManager.ActivateDuringWorkSilentReopenPartialInteractivity"))}Tdi(){if(this.cQd)return this.cQd=!1,!0;const Ub=this.a7>this.rmf||this.Kjd>this.rmf&&10>this.a7;
d.ULS.sendTraceTag(537155223,0,50,`NetworkConnectionStateManager.IsBackToWorkSilentReopen: Inactivity duration: Time from last activity:${this.a7}, Time gap between last two activities: ${this.Kjd}. return value:${Ub}`);return Ub}uej(){this.p0=wa.a.instance.create(()=>{Rb.Health.instance.recordQosError(ld.a.zCj,[Dd.a.wic],!0,!0,!1,!1,null)},6E3,"ReportLongSilentReopenBackToWorkVeto",void 0,!0)}czg(){this.nna||this.c0?d.ULS.sendTraceTag(542782155,0,10,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Trying to activate during-work partial interactivity when we are already in this partial interactivity or there is a running timer that's going to do it soon."):
this.c0=wa.a.instance.create(()=>{this.$?this.nna?d.ULS.sendTraceTag(537155221,0,15,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Tried to activate SilentReopenDuringWork PI when there is already an DuringWorkSilentReopen partial interactivity object"):Ca.g(this.$).eb?(this.Cab||(Ca.g(this.$).hc.em(this.Jf),d.ULS.sendTraceTag(541893722,0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Registered OnEditEnded while during-work silent reopen")),
this.Dab=!0,d.ULS.sendTraceTag(537155220,0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Need to init during-work silent reopen partial interactivity but the user is during a cell edit. Registered to OnEditEnded event.")):this.Tie():d.ULS.sendTraceTag(537155222,0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: EwaControl is null")},this.b4f,gb.a.yBj,void 0,!0)}Rpf(Ub){this.Y0c=this.tue(2,Ub,!0);this.Nne()}hkc(Ub,Lc){this.iVb=this.tue(Ub,Lc,
!1);this.Nne()}tue(Ub,Lc,hd){hd=hd?this.Y0c:this.iVb;return Lc?hd|Ub:hd&~Ub}fVd(){const Ub=!!this.SNa,Lc=!!this.VRa,hd=!!this.nna,Kd=!!this.n2b;this.DBb&&!Ub?this.bzg():!this.DBb&&Ub&&this.qbh();!this.fjc||Lc||hd?this.fjc||(Lc?this.eFe():(hd||this.c0&&this.c0.Bq)&&this.fFe()):this.Ipa?this.$yg():this.c0||this.czg();this.Wja&&!Kd?this.r9f(!0):!this.Wja&&Kd&&this.r9f(!1)}bzg(){this.$?this.SNa?d.ULS.sendTraceTag(537155215,0,15,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Tried to activate offline PI when there is already an offline partial interactivity object"):
Ca.g(this.$).eb?(this.Dab||(Ca.g(this.$).hc.em(this.Jf),d.ULS.sendTraceTag(537155217,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Registered OnEditEnded during offline mode")),this.Cab=!0,d.ULS.sendTraceTag(537155216,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Turned offline while user is editing a cell, registered to OnEditEnded event.")):this.Wie():d.ULS.sendTraceTag(537155214,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: EwaControl is null")}Wie(){this.SNa||
(this.SNa=Hb.a(this.$).Vf.CXa(5,"NetworkConnecStateManager.ActivateOfflinePartialInteractivity"))}qbh(){this.SNa&&(pd.a.Ia(this.SNa),this.SNa=null)}eFe(){this.VRa&&(pd.a.Ia(this.VRa),this.VRa=null);this.p0&&this.p0.Bq&&this.p0.cancel();this.p0=null}fFe(){this.nna&&(pd.a.Ia(this.nna),this.nna=null);this.c0&&(pd.a.Ia(this.c0),this.c0=null);this.Dab&&!this.Cab&&Ca.g(this.$).hc.yl(this.Jf);this.Dab=!1}$yg(){this.VRa||(this.VRa=Hb.a(this.$).Vf.CXa(2,"NetworkConnectionStateManager.ActivateLongInactivitySilentReopenPartialInteractivity",
void 0,nd.a.instance.ga(2189)));this.uej()}r9f(Ub){Ub?(this.n2b=Hb.a(this.$).Vf.CXa(4,"NetworkConnectionStateManager.ConnectivityIssues"),this.E1i()):(pd.a.Ia(this.n2b),this.n2b=null)}E1i(){if(this.$&&this.$.oa){const Ub=this.$.oa.va.Sb();Ha.I(this.$.oa.va,null,null,null,Ub)}}Wzc(){sb.a(this.$).cQ(fb.a.AOa).Oq(this.Ezf);this.$.Al(this.$c);this.Jqc=!1}Nne(){this.documentVisibilityObserver||d.ULS.sendTraceTag(537155211,0,15,"NetworkConnectionStateManager.AdjustPartialInteractivityStateWhenPossible: Document visibility observer is null while it shouldn't be.");
this.documentVisibilityObserver&&this.documentVisibilityObserver.Ii?this.ozb||(this.documentVisibilityObserver.Cmb(this.pla),this.ozb=!0,d.ULS.sendTraceTag(541193954,0,50,"NetworkConnectionStateManager.AdjustPartialInteractivityStateWhenPossible: tabbed out user, will update the partial interactivity state when the user will be back.")):this.fVd()}}Object(b.a)(Xb,"NetworkConnectionStateManager",rb.a,[697,2]);class oc extends Y.a{constructor(Ub){super();this.$=Ub;this.Fb()}create(){cd.TaskExtensions.Aa(yc.GetServiceTaskFactory.Ra(this.$.da,
395,396,this.hb),Ub=>{let Lc;Lc=bb.EwaSettings.isChangeGateEnabled("OfficeVSO:6143820_MoveServiceRegistrationFromFAM_V2")?Object(aa.c)(this.$.da,400,()=>new Xb(this.$,Ub.result)):this.$.da.za(400)||new Xb(this.$,Ub.result);this.qb(Lc)},this.$.la,3)}static ka(Ub){Ub.da.Ga(401,new oc(Ub))}}Object(b.a)(oc,"NetworkConnectionStateManagerFactory",Y.a,[]);var Gc=a(1246),Vc=a(1152),P=a(1208),Ta=a(124),pb=a(107),Yb=a(146),Ac=a(318);class Zc{constructor(Ub){this.JBb=this.oud=this.pNa=this.rjc=0;this.hud=this.Cnf=
null;Ub?(this.Ajc=Ub,this.prb=Date.now,this.V7g(),this.f8i()):d.ULS.sendTraceTag(520955213,209,10,"Can not initialize PenMinutesManager because TaskManager is null")}rrj(){this.Cnf="Office.Excel.Online.Data.Activity.PenMinutes"}f8i(){window.document.body.addEventListener("pointerenter",Object(B.a)(this,this.Vmc,"onPointerEnter"));window.document.body.addEventListener("pointerleave",Object(B.a)(this,this.b_,"onPointerLeave"))}Vmc(Ub){"pen"!==Ub.pointerType||this.pNa||(this.pNa=Math.floor(this.prb()/
1E3),this.pNa<=this.rjc&&(this.pNa=this.rjc),this.oud=0)}b_(Ub){"pen"===Ub.pointerType&&(Ub=Math.ceil(this.prb()/1E3),this.pNa&&Ub>this.rjc&&(this.oud=Ub,this.JBb+=this.oud-this.pNa),this.rjc=Ub,this.pNa=0)}V7g(){this.hud=new pb.a(4,2,6E4,Object(B.a)(this,this.Lui,"logPenUsage"));this.Ajc.Ag(this.hud)}Lui(){0<this.JBb&&this.xmj(this.JBb);this.JBb=0}xmj(Ub){const Lc=new Ac.a;Lc.name=this.Cnf;const hd=[];(Ub=Ta.a.Cub("PenInputSec",Ub.toString(),3))&&Array.add(hd,Ub);Lc.dataFields=hd;Yb.a.sendActivityEvent(Lc)}dispose(){this.Ajc.Xo(this.hud)}}
Object(b.a)(Zc,"PenMinutesManager",null,[445]);class id{constructor(){this.nNc=this.fb=null}get name(){return"Common.App.PenMinutesManager"}Rh(Ub){this.fb=Ub;const Lc=f.AFrameworkApplication.zi;this.fb.register(445,"Common.App.PenMinutesManager.IPenMinutesManager").tc().Fc(()=>new Zc(Lc))}init(){this.nNc=this.fb.resolve("Common.App.PenMinutesManager.IPenMinutesManager")}dispose(){this.nNc&&this.nNc.dispose()}static main(){V.a.instance.yi(new id)}}Object(b.a)(id,"PenMinutesManagerPackage",null,[4,
5]);class gd extends Y.a{constructor(Ub){super();this.$=Ub;this.Fb()}static ka(Ub){Ub.da.Ga(514,new gd(Ub))}create(){this.qb(Object(aa.c)(this.$.da,513,()=>{Type.registerNamespace("Common.App.PenMinutesManager");id.main();const Ub=oa.a.instance.resolve("Common.App.PenMinutesManager.IPenMinutesManager");Ub.rrj();return Ub}))}}Object(b.a)(gd,"PenMinutesFactory",Y.a,[]);Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.InsertPicture");Type.registerNamespace("_Ewa");Object(c.a)();Object(Z.a)();
Object(Ra.a)();Object(Ga.a)();Object(Ba.a)();Object(ya.a)();Object(ib.a)();Object(P.a)();Type.registerNamespace("Common.App.InProductMessaging");da.main();Type.registerNamespace("Common.App.FirstRunExperienceLauncher");Pa.main();(()=>{fa.a.Fa(()=>{fa.a.Fa(ta.ka)})})();(()=>{fa.a.Fa(()=>{fa.a.Fa(ia.ka)})})();fa.a.Fa(sc.ka);fa.a.Fa(oc.ka);(()=>{fa.a.Fa(Ub=>{gd.ka(Ub)})})();Object(Gc.a)();Object(Vc.a)()},843:function(t,C,a){a.r(C);t=a(0);var c=a(7),b=a(15),d=a(316),f=a(29),e=a(11),k=a(309);class l{constructor(){this.scenario=
null;this.timeElapsed=0;this.isNewSession=!1;this.rawData=null}}Object(t.a)(l,"ConnectionErrorLogInfo",null,[]);class m{}m.bhg="b-ring_Apc_Trans";m.nhg="cdn_static_resource_ewa_image";Object(t.a)(m,"ResourceHosts",null,[]);var v=a(58),n=a(251);class w{constructor(z,A){this.testName=null;this.startTimeMs=0;this.isSuccess=!1;this.caller=this.errorStatusCode=this.errorMessage=null;this.reqTotalDurationMs=0;this.browserResourceTiming=null;this.testIteration=0;this.testName=z;this.caller=A;this.reset()}reset(){this.isSuccess=
!1;this.startTimeMs=-1;this.errorStatusCode=this.errorMessage="";this.reqTotalDurationMs=-1;this.browserResourceTiming=null}}Object(t.a)(w,"NetworkTestResult",null,[]);var r=a(577);class u{constructor(z,A,I,F,U){this.url="";this.b5a=!1;this.c7=-1;this.testIteration=0;this.baseUrl=I;this.Puf=F;this.K7e=A;this.result=new w(A,U)}runTest(){try{if(this.b5a)return b.ULS.sendTraceTag(537155206,0,50,`NetworkTestReq.RunTest: a test for the host ${this.K7e} is already mid way, not starting a new one.`),!1;
this.reset();this.b5a=!0;this.result.startTimeMs=Date.now();const z=new n.QueryStringBuilder(this.baseUrl);z.U8("tid",this.result.startTimeMs.toString());this.url=z.toString();this.Slj();this.testIteration++;this.result.testIteration=this.testIteration;return!0}catch(z){return this.ktb("Exeption: "+z.message),!1}}reset(){this.url="";this.result.reset();this.b5a=!1;this.c7=-1}clearTimeout(){-1!==this.c7&&(window.clearTimeout(this.c7),this.c7=-1)}Slj(){try{const z=new XMLHttpRequest;z.onreadystatechange=
()=>{4===z.readyState&&(200===z.status?this.mAh():this.ktb(`Error when downloading resource. status code: ${z.status}, status text: ${z.statusText}`,z.status.toString()))};z.onerror=()=>{this.ktb(`Client error when attempting to download resource. status code: ${z.status}, response: ${z.statusText}`)};this.c7=window.setTimeout(()=>{this.c7=-1;this.ktb("Request timeout")},1E4);z.open("GET",this.url,!0);z.send(null)}catch(z){this.ktb("Exeption: "+z.message)}}mAh(){this.b5a&&(this.result.reqTotalDurationMs=
Date.now()-this.result.startTimeMs,this.clearTimeout(),this.result.browserResourceTiming=r.a(this.url),this.result.isSuccess=!0,this.$1b())}ktb(z,A=null){this.b5a&&(this.clearTimeout(),this.result.errorMessage=z,this.result.isSuccess=!1,this.result.errorStatusCode=A,this.$1b())}$1b(){this.b5a=!1;this.Puf&&this.Puf(this.result,this.K7e)}}Object(t.a)(u,"NetworkTestReq",null,[]);class y{static eFh(z,A,I=null){y.Dkc||(y.Dkc=Array.isArray(v.a.Vh(A.ya.NetworkMeasurementUrlList))?v.a.Vh(A.ya.NetworkMeasurementUrlList):
null);const F=[];for(let U=0;U<y.Dkc.length;U++){const X=y.Dkc[U];let S=X.key;S||(S=X.Key);if(I&&!I.includes(S))continue;let H=X.value;H||(H=X.Value);S&&H&&F.push(new u(A,S,H,z,"OnNetworkDownImmediatePing"))}return F}}y.Dkc=null;Object(t.a)(y,"NetworkConnectionHelpers",null,[]);class x{constructor(z){this.Xid=[m.nhg,m.bhg];this.Fn=(A,I)=>{this.UN[I]=A;this.r4h()&&this.oej("OnNetworkDownImmediatePing"===A.caller)};this.Wka=z;this.$=z.$;this.UN={}}Zpi(){const z=y.eFh(this.Fn,this.$,this.Xid);for(const A of z)A.runTest()}r4h(){for(const z of this.Xid)if(void 0===
this.UN[z]||null===this.UN[z])return!1;return!0}oej(z){const A=this.$.Rf.tZ;z&&this.xFj(A);for(var I of this.Xid)this.UN[I]=Sys.Serialization.JavaScriptSerializer.serialize(this.UN[I]);z=Date.now();I=this.Wka.Mfd(a(843).NetworkConnectionHealthChecker.ICb).returnValue;const F=this.Wka.Mfd(a(843).NetworkConnectionHealthChecker.MJb).returnValue;this.UN.isOfflineMode=A;this.UN.networkDownBBAge=-1===I?I:z-I;this.UN.transientServerCommunicationFailuresBBAge=-1===F?F:z-F;this.Wka.businessBar?(this.UN.isNetworkDownBBShown=
this.Wka.businessBar.xE(56).toString(),this.UN.isServerErrorBBShown=this.Wka.businessBar.xE(21).toString()):(this.UN.isNetworkDownBBShown="unknown",this.UN.isServerErrorBBShown="unknown");b.ULS.sendTraceTag(537155224,0,50,`ConnectionHealthTestsRunner.ReportPingResults: ${Sys.Serialization.JavaScriptSerializer.serialize(this.UN)}`)}xFj(z){const {NetworkConnectionHealthChecker:A}=a(843),I={};for(const F of Object.keys(this.UN)){const U=this.UN[F];I[U.testName]=U.isSuccess}I.isOfflineMode=z;this.Wka.iTd(A.X0c,
Sys.Serialization.JavaScriptSerializer.serialize(I))}}Object(t.a)(x,"ConnectionHealthTestsRunner",null,[]);a.d(C,"NetworkConnectionHealthChecker",function(){return B});class B{constructor(z){this.businessBar=this.r7a=null;this.OFi=(A,I)=>{I.G5c?this.QFi(I):this.PFi(I)};this.ni=(A,I)=>{A=I.context.methodName;this.r7a&&A===this.r7a&&(b.ULS.sendTraceTag(537155230,0,50,`NetworkConnectionHealthChecker.OnWebMethodSuccess: Failed web method "${this.r7a}" has now succeeded. Querying local storage for BB showings.`),
this.P7a(B.MJb,!0),this.r7a=null);this.Dlf(!1);this.l2b=!1};this.Un=(A,I)=>{f.a.jh(I.errors,[-1387426400])&&!this.l2b&&(this.l2b=!0,this.s1f()&&window.performance.mark(B.Isf),(new x(this)).Zpi())};this.xg=()=>{this.Dlf(!0);this.P7a(B.ICb,!1);this.P7a(B.MJb,!1)};this.jEb=()=>{b.ULS.sendTraceTag(537155225,0,50,"NetworkConnectionHealthChecker.OnNetworkResumed: Network resumed for session. Querying local storage for BB showings.");this.P7a(B.ICb,!0)};this.$=z;this.oa=this.$.oa;this.localStorage=new k.a;
this.l2b=!1;this.$.ea.El(this.xg);this.oa.Rf.rYb(this.jEb);this.oa.Ir(this.ni);this.$.da.Za(5,A=>{this.businessBar=A;A.yDg(this.OFi)});this.oa.Ly(this.Un)}dispose(){this.$&&(this.$.ea&&this.$.ea.Wn(this.xg),this.oa&&(this.oa.Rf.Crc(this.jEb),this.oa.Oz(this.Un),this.oa.qt(this.ni)))}QFi(z){const A={};A.Timestamp=Date.now().toString();switch(z.$Fa){case 21:this.r7a=z.data.FailedMethod;A.FailedMethod=this.r7a;this.iTd(B.MJb,JSON.stringify(A));break;case 56:this.iTd(B.ICb,JSON.stringify(A))}}PFi(z){switch(z.$Fa){case 21:this.P7a(B.MJb,
!0);break;case 56:this.P7a(B.ICb,!0)}}iTd(z,A){try{this.localStorage.If()&&this.localStorage.setItem(z,A)}catch(I){b.ULS.sendTraceTag(537155231,0,15,`NetworkConnectionHealthChecker.StoreDataInLocalStorage: Failed to set item to local storage. reason: ${I.message||"Unknown"}`)}}Mfd(z){if(this.localStorage.If()&&(z=this.localStorage.Yub(z))&&"null"!==z){var A=JSON.parse(z);z=parseInt(A.Timestamp,10);A=Sys.Serialization.JavaScriptSerializer.serialize(A);return{returnValue:z,rawData:A}}return{returnValue:-1,
rawData:null}}Dlf(z){if(this.localStorage.If()){const A=this.localStorage.Yub(B.X0c);if(A&&"null"!==A){let I=-1;this.l2b&&(I=this.mMh(B.Isf,B.DEi));b.ULS.sendTraceTag(537155229,0,50,`NetworkConnectionHealthChecker.LogPingResultsFromLocalStorage: Ping Results: ${Sys.Serialization.JavaScriptSerializer.serialize(A)}, Period offline: ${I}, New session: ${z}`);this.localStorage.removeItem(B.X0c)}}}mMh(z,A){if(!this.s1f())return-1;window.performance.measure(A,z);z=window.performance.getEntriesByName(A);
return z.length&&z[z.length-1]?z[z.length-1].duration:(b.ULS.sendTraceTag(537155228,0,10,`NetworkConnectionHealthChecker.LogPingResultsFromLocalStorage: measure name ${A} returned no measures.`),-1)}P7a(z,A){try{let I;const F=({rawData:I}=this.Mfd(z)).returnValue;if(-1!==F){const U=Object(c.a)(new l,{timeElapsed:Date.now()-F,scenario:z,isNewSession:!A,rawData:I});b.ULS.sendTraceTag(537155227,0,50,`NetworkConnectionHealthChecker.LogNetworkIssueBBShown: ${JSON.stringify(U)}`)}this.localStorage.removeItem(z)}catch(I){b.ULS.sendTraceTag(537155226,
0,15,`NetworkConnectionHealthChecker.LogNetworkIssueBBShown: Failed to get item from local storage. reason: ${I.message||"Unknown"}`)}}s1f(){return e.HelperMethods.sXc&&d.a.oob}}B.ICb="NetworkDownBBShown";B.MJb="ServerCommunicationFailureBBShown";B.X0c="ConnectionHealthPingRsults";B.Isf="offMoStMa";B.DEi="offMoDuMea";Object(t.a)(B,"NetworkConnectionHealthChecker",null,[2])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.pi.js.map/a7993eed11ceb794368203df5e946306/EwaDSEsNext.pi.js.map